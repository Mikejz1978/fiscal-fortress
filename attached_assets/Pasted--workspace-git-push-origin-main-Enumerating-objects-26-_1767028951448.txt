~/workspace$ git push origin main
Enumerating objects: 26, done.
Counting objects: 100% (26/26), done.
Delta compression using up to 8 threads
Compressing objects: 100% (15/15), done.
Writing objects: 100% (15/15), 835.27 KiB | 32.13 MiB/s, done.
Total 15 (delta 10), reused 0 (delta 0), pack-reused 0 (from 0)
remote: Resolving deltas: 100% (10/10), completed with 9 local objects.
To https://github.com/Mikejz1978/fiscal-fortress.git
   879db38..ee169a2  main -> main
~/workspace$ cd ~/workspace
npm i -D tsx
git add package.json package-lock.json
git commit -m "Add tsx for Render build"
git push

added 2 packages, changed 1 package, and audited 504 packages in 2s

74 packages are looking for funding
  run `npm fund` for details

found 0 vulnerabilities
[main 47f4547] Add tsx for Render build
 2 files changed, 490 insertions(+), 6 deletions(-)
Enumerating objects: 7, done.
Counting objects: 100% (7/7), done.
Delta compression using up to 8 threads
Compressing objects: 100% (4/4), done.
Writing objects: 100% (4/4), 715 bytes | 715.00 KiB/s, done.
Total 4 (delta 3), reused 0 (delta 0), pack-reused 0 (from 0)
remote: Resolving deltas: 100% (3/3), completed with 3 local objects.
To https://github.com/Mikejz1978/fiscal-fortress.git
   ee169a2..47f4547  main -> main
~/workspace$ cd ~/workspace
npm run build

# show the exact code around line 76
nl -ba dist/index.cjs | sed -n '60,95p'

# run it like Render does to see the full error message
NODE_ENV=production node dist/index.cjs

> rest-express@1.0.0 build
> tsx script/build.ts

building client...
vite v7.3.0 building client environment for production...
transforming (5) ../node_modules/@tanstack/react-query/build/modern/index.js
A PostCSS plugin did not pass the `from` option to `postcss.parse`. This may cause imported assets to be incorrectly transformed. If you've recently added a PostCSS plugin that raised this warning, please contact the package author to fix the issue.
✓ 2040 modules transformed.
../dist/public/index.html                   2.48 kB │ gzip:   0.94 kB
../dist/public/assets/index-D-cqVnpB.css   76.87 kB │ gzip:  12.35 kB
../dist/public/assets/index-QOBP0qL9.js   442.71 kB │ gzip: 135.98 kB
✓ built in 6.83s
building server...

  dist/index.cjs  1.2mb ⚠️

⚡ Done in 316ms
    60  <pre>`+e+`</pre>
    61  </body>
    62  </html>
    63  `}function y9(){return function(){this.error(404)}}function x9(){return function(e){if(this.hasTrailingSlash()){this.error(404);return}var r=im.original(this.req);r.path=null,r.pathname=g9(r.pathname+"/");var n=p9(m9.format(r)),i=v9("Redirecting","Redirecting to "+d9(n));e.statusCode=301,e.setHeader("Content-Type","text/html; charset=UTF-8"),e.setHeader("Content-Length",Buffer.byteLength(i)),e.setHeader("Content-Security-Policy","default-src 'none'"),e.setHeader("X-Content-Type-Options","nosniff"),e.setHeader("Location",n),e.end(i)}}});var OS=v((At,IS)=>{"use strict";var gl=bw(),b9=require("events").EventEmitter,kS=_w(),CS=j_(),w9=Af(),_9=Cf(),TS=aS(),PS=SS();At=IS.exports=S9;function S9(){var t=function(e,r,n){t.handle(e,r,n)};return kS(t,b9.prototype,!1),kS(t,CS,!1),t.request=Object.create(TS,{app:{configurable:!0,enumerable:!0,writable:!0,value:t}}),t.response=Object.create(PS,{app:{configurable:!0,enumerable:!0,writable:!0,value:t}}),t.init(),t}At.application=CS;At.request=TS;At.response=PS;At.Route=w9;At.Router=_9;At.json=gl.json;At.query=Tf();At.raw=gl.raw;At.static=AS();At.text=gl.text;At.urlencoded=gl.urlencoded;var E9=["bodyParser","compress","cookieSession","session","logger","cookieParser","favicon","responseTime","errorHandler","timeout","methodOverride","vhost","csrf","directory","limit","multipart","staticCache"];E9.forEach(function(t){Object.defineProperty(At,t,{get:function(){throw new Error("Most middleware (like "+t+") is no longer bundled with Express and must be installed separately. Please see https://github.com/senchalabs/connect#middleware.")},configurable:!0})})});var am=v((UU,NS)=>{"use strict";NS.exports=OS()});var jS=v((zU,RS)=>{RS.exports=function(t){var e,r,n=[];return t.on("data",e=function(i,s){n.push(["data",i,s])}),t.on("end",r=function(i,s){n.push(["end",i,s])}),{end:function(){t.removeListener("data",e),t.removeListener("end",r)},resume:function(){this.end();for(var i=0,s=n.length;i<s;++i)t.emit.apply(t,n[i])}}}});var $S=v((QU,DS)=>{function qS(){}qS.prototype.authenticate=function(t,e){throw new Error("Strategy#authenticate must be overridden by subclass")};DS.exports=qS});var cm=v((om,FS)=>{var MS=$S();om=FS.exports=MS;om.Strategy=MS});var lm=v((HU,LS)=>{var A9=jS(),k9=require("util"),BS=cm();function um(t,e){typeof t=="function"&&(e=t,t=void 0),t=t||{},BS.call(this),this.name="session",this._key=t.key||"passport",this._deserializeUser=e}k9.inherits(um,BS);um.prototype.authenticate=function(t,e){if(!t.session)return this.error(new Error("Login sessions require session support. Did you forget to use `express-session` middleware?"));e=e||{};var r=this,n;if(t.session[this._key]&&(n=t.session[this._key].user),n||n===0){var i=e.pauseStream?A9(t):null;this._deserializeUser(n,t,function(s,a){if(s)return r.error(s);if(!a)delete t.session[r._key].user;else{var o=t._userProperty||"user";t[o]=a}r.pass(),i&&i.resume()})}else r.pass()};LS.exports=um});var QS=v((VU,zS)=>{var US=Ss();function pm(t,e){typeof t=="function"&&(e=t,t=void 0),t=t||{},this._key=t.key||"passport",this._serializeUser=e}pm.prototype.logIn=function(t,e,r,n){if(typeof r=="function"&&(n=r,r={}),r=r||{},!t.session)return n(new Error("Login sessions require session support. Did you forget to use `express-session` middleware?"));var i=this,s=t.session;t.session.regenerate(function(a){if(a)return n(a);i._serializeUser(e,t,function(o,u){if(o)return n(o);r.keepSessionInfo&&US(t.session,s),t.session[i._key]||(t.session[i._key]={}),t.session[i._key].user=u,t.session.save(function(c){if(c)return n(c);n()})})})};pm.prototype.logOut=function(t,e,r){if(typeof e=="function"&&(r=e,e={}),e=e||{},!t.session)return r(new Error("Login sessions require session support. Did you forget to use `express-session` middleware?"));var n=this;t.session[this._key]&&delete t.session[this._key].user;var i=t.session;t.session.save(function(s){if(s)return r(s);t.session.regenerate(function(a){if(a)return r(a);e.keepSessionInfo&&US(t.session,i),r()})})};zS.exports=pm});var dm=v((HS,VS)=>{var Os=HS=VS.exports={};Os.login=Os.logIn=function(t,e,r){typeof e=="function"&&(r=e,e={}),e=e||{};var n=this._userProperty||"user",i=e.session===void 0?!0:e.session;if(this[n]=t,i&&this._sessionManager){if(typeof r!="function")throw new Error("req#login requires a callback function");var s=this;this._sessionManager.logIn(this,t,e,function(a){if(a)return s[n]=null,r(a);r()})}else r&&r()};Os.logout=Os.logOut=function(t,e){typeof t=="function"&&(e=t,t={}),t=t||{};var r=this._userProperty||"user";if(this[r]=null,this._sessionManager){if(typeof e!="function")throw new Error("req#logout requires a callback function");this._sessionManager.logOut(this,t,e)}else e&&e()};Os.isAuthenticated=function(){var t=this._userProperty||"user";return!!this[t]};Os.isUnauthenticated=function(){return!this.isAuthenticated()}});var GS=v((WU,WS)=>{var vl=dm();WS.exports=function(e,r){return r=r||{},function(i,s,a){i.login=i.logIn=i.logIn||vl.logIn,i.logout=i.logOut=i.logOut||vl.logOut,i.isAuthenticated=i.isAuthenticated||vl.isAuthenticated,i.isUnauthenticated=i.isUnauthenticated||vl.isUnauthenticated,i._sessionManager=e._sm,r.userProperty&&(i._userProperty=r.userProperty);var o=r.compat===void 0?!0:r.compat;o&&(e._userProperty=r.userProperty||"user",i._passport={},i._passport.instance=e),a()}}});var ZS=v((GU,JS)=>{function KS(t,e){Error.call(this),Error.captureStackTrace(this,arguments.callee),this.name="AuthenticationError",this.message=t,this.status=e||401}KS.prototype.__proto__=Error.prototype;JS.exports=KS});var eE=v((KU,YS)=>{var XS=require("http"),yl=dm(),C9=ZS();YS.exports=function(e,r,n,i){typeof n=="function"&&(i=n,n={}),n=n||{};var s=!0;return Array.isArray(r)||(r=[r],s=!1),function(o,u,c){o.login=o.logIn=o.logIn||yl.logIn,o.logout=o.logOut=o.logOut||yl.logOut,o.isAuthenticated=o.isAuthenticated||yl.isAuthenticated,o.isUnauthenticated=o.isUnauthenticated||yl.isUnauthenticated,o._sessionManager=e._sm;var l=[];function p(){if(i)if(s){var d=l.map(function(R){return R.challenge}),f=l.map(function(R){return R.status});return i(null,!1,d,f)}else return i(null,!1,l[0].challenge,l[0].status);var h=l[0]||{},m=h.challenge||{},x;if(n.failureFlash){var _=n.failureFlash;typeof _=="string"&&(_={type:"error",message:_}),_.type=_.type||"error";var w=_.type||m.type||"error";x=_.message||m.message||m,typeof x=="string"&&o.flash(w,x)}if(n.failureMessage&&(x=n.failureMessage,typeof x=="boolean"&&(x=m.message||m),typeof x=="string"&&(o.session.messages=o.session.messages||[],o.session.messages.push(x))),n.failureRedirect)return u.redirect(n.failureRedirect);for(var A=[],P,F,T=0,C=l.length;T<C;T++)h=l[T],m=h.challenge,F=h.status,P=P||F,typeof m=="string"&&A.push(m);if(u.statusCode=P||401,u.statusCode==401&&A.length&&u.setHeader("WWW-Authenticate",A),n.failWithError)return c(new C9(XS.STATUS_CODES[u.statusCode],P));u.end(XS.STATUS_CODES[u.statusCode])}(function d(f){var h=r[f];if(!h)return p();var m,x;if(typeof h.authenticate=="function")m=h;else{if(x=e._strategy(h),!x)return c(new Error('Unknown authentication strategy "'+h+'"'));m=Object.create(x)}m.success=function(_,w){if(i)return i(null,_,w);w=w||{};var A;if(n.successFlash){var P=n.successFlash;typeof P=="string"&&(P={type:"success",message:P}),P.type=P.type||"success";var F=P.type||w.type||"success";A=P.message||w.message||w,typeof A=="string"&&o.flash(F,A)}if(n.successMessage&&(A=n.successMessage,typeof A=="boolean"&&(A=w.message||w),typeof A=="string"&&(o.session.messages=o.session.messages||[],o.session.messages.push(A))),n.assignProperty){o[n.assignProperty]=_,n.authInfo!==!1?e.transformAuthInfo(w,o,function(T,C){if(T)return c(T);o.authInfo=C,c()}):c();return}o.logIn(_,n,function(T){if(T)return c(T);function C(){if(n.successReturnToOrRedirect){var R=n.successReturnToOrRedirect;return o.session&&o.session.returnTo&&(R=o.session.returnTo,delete o.session.returnTo),u.redirect(R)}if(n.successRedirect)return u.redirect(n.successRedirect);c()}n.authInfo!==!1?e.transformAuthInfo(w,o,function(R,z){if(R)return c(R);o.authInfo=z,C()}):C()})},m.fail=function(_,w){typeof _=="number"&&(w=_,_=void 0),l.push({challenge:_,status:w}),d(f+1)},m.redirect=function(_,w){u.statusCode=w||302,u.setHeader("Location",_),u.setHeader("Content-Length","0"),u.end()},m.pass=function(){c()},m.error=function(_){if(i)return i(_);c(_)},m.authenticate(o,n)})(0)}}});var nE=v((tE,rE)=>{var T9=GS(),P9=eE();tE=rE.exports=function(){return{initialize:T9,authenticate:P9}}});var sE=v((JU,iE)=>{var I9=lm(),O9=QS();function qt(){this._key="passport",this._strategies={},this._serializers=[],this._deserializers=[],this._infoTransformers=[],this._framework=null,this.init()}qt.prototype.init=function(){this.framework(nE()()),this.use(new I9({key:this._key},this.deserializeUser.bind(this))),this._sm=new O9({key:this._key},this.serializeUser.bind(this))};qt.prototype.use=function(t,e){if(e||(e=t,t=e.name),!t)throw new Error("Authentication strategies must have a name");return this._strategies[t]=e,this};qt.prototype.unuse=function(t){return delete this._strategies[t],this};qt.prototype.framework=function(t){return this._framework=t,this};qt.prototype.initialize=function(t){return t=t||{},this._framework.initialize(this,t)};qt.prototype.authenticate=function(t,e,r){return this._framework.authenticate(this,t,e,r)};qt.prototype.authorize=function(t,e,r){e=e||{},e.assignProperty="account";var n=this._framework.authorize||this._framework.authenticate;return n(this,t,e,r)};qt.prototype.session=function(t){return this.authenticate("session",t)};qt.prototype.serializeUser=function(t,e,r){if(typeof t=="function")return this._serializers.push(t);var n=t;typeof e=="function"&&(r=e,e=void 0);var i=this._serializers;(function s(a,o,u){if(o==="pass"&&(o=void 0),o||u||u===0)return r(o,u);var c=i[a];if(!c)return r(new Error("Failed to serialize user into session"));function l(d,f){s(a+1,d,f)}try{var p=c.length;p==3?c(e,n,l):c(n,l)}catch(d){return r(d)}})(0)};qt.prototype.deserializeUser=function(t,e,r){if(typeof t=="function")return this._deserializers.push(t);var n=t;typeof e=="function"&&(r=e,e=void 0);var i=this._deserializers;(function s(a,o,u){if(o==="pass"&&(o=void 0),o||u)return r(o,u);if(u===null||u===!1)return r(null,!1);var c=i[a];if(!c)return r(new Error("Failed to deserialize user out of session"));function l(d,f){s(a+1,d,f)}try{var p=c.length;p==3?c(e,n,l):c(n,l)}catch(d){return r(d)}})(0)};qt.prototype.transformAuthInfo=function(t,e,r){if(typeof t=="function")return this._infoTransformers.push(t);var n=t;typeof e=="function"&&(r=e,e=void 0);var i=this._infoTransformers;(function s(a,o,u){if(o==="pass"&&(o=void 0),o||u)return r(o,u);var c=i[a];if(!c)return r(null,n);function l(f,h){s(a+1,f,h)}try{var p=c.length;if(p==1){var d=c(n);l(null,d)}else p==3?c(e,n,l):c(n,l)}catch(f){return r(f)}})(0)};qt.prototype._strategy=function(t){return this._strategies[t]};iE.exports=qt});var cE=v((si,oE)=>{var aE=sE(),N9=lm();si=oE.exports=new aE;si.Passport=si.Authenticator=aE;si.Strategy=cm();si.strategies={};si.strategies.SessionStrategy=N9});var mm=v(fm=>{"use strict";fm.parse=F9;fm.serialize=B9;var R9=Object.prototype.toString,j9=Object.prototype.hasOwnProperty,q9=/^[!#$%&'*+\-.^_`|~0-9A-Za-z]+$/,D9=/^("?)[\u0021\u0023-\u002B\u002D-\u003A\u003C-\u005B\u005D-\u007E]*\1$/,$9=/^([.]?[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)([.][a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)*$/i,M9=/^[\u0020-\u003A\u003D-\u007E]*$/;function F9(t,e){if(typeof t!="string")throw new TypeError("argument str must be a string");var r={},n=t.length;if(n<2)return r;var i=e&&e.decode||L9,s=0,a=0,o=0;do{if(a=t.indexOf("=",s),a===-1)break;if(o=t.indexOf(";",s),o===-1)o=n;else if(a>o){s=t.lastIndexOf(";",a-1)+1;continue}var u=uE(t,s,a),c=lE(t,a,u),l=t.slice(u,c);if(!j9.call(r,l)){var p=uE(t,a+1,o),d=lE(t,o,p);t.charCodeAt(p)===34&&t.charCodeAt(d-1)===34&&(p++,d--);var f=t.slice(p,d);r[l]=z9(f,i)}s=o+1}while(s<n);return r}function uE(t,e,r){do{var n=t.charCodeAt(e);if(n!==32&&n!==9)return e}while(++e<r);return r}function lE(t,e,r){for(;e>r;){var n=t.charCodeAt(--e);if(n!==32&&n!==9)return e+1}return r}function B9(t,e,r){var n=r&&r.encode||encodeURIComponent;if(typeof n!="function")throw new TypeError("option encode is invalid");if(!q9.test(t))throw new TypeError("argument name is invalid");var i=n(e);if(!D9.test(i))throw new TypeError("argument val is invalid");var s=t+"="+i;if(!r)return s;if(r.maxAge!=null){var a=Math.floor(r.maxAge);if(!isFinite(a))throw new TypeError("option maxAge is invalid");s+="; Max-Age="+a}if(r.domain){if(!$9.test(r.domain))throw new TypeError("option domain is invalid");s+="; Domain="+r.domain}if(r.path){if(!M9.test(r.path))throw new TypeError("option path is invalid");s+="; Path="+r.path}if(r.expires){var o=r.expires;if(!U9(o)||isNaN(o.valueOf()))throw new TypeError("option expires is invalid");s+="; Expires="+o.toUTCString()}if(r.httpOnly&&(s+="; HttpOnly"),r.secure&&(s+="; Secure"),r.partitioned&&(s+="; Partitioned"),r.priority){var u=typeof r.priority=="string"?r.priority.toLowerCase():r.priority;switch(u){case"low":s+="; Priority=Low";break;case"medium":s+="; Priority=Medium";break;case"high":s+="; Priority=High";break;default:throw new TypeError("option priority is invalid")}}if(r.sameSite){var c=typeof r.sameSite=="string"?r.sameSite.toLowerCase():r.sameSite;switch(c){case!0:s+="; SameSite=Strict";break;case"lax":s+="; SameSite=Lax";break;case"strict":s+="; SameSite=Strict";break;case"none":s+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}}return s}function L9(t){return t.indexOf("%")!==-1?decodeURIComponent(t):t}function U9(t){return R9.call(t)==="[object Date]"}function z9(t,e){try{return e(t)}catch{return t}}});var dE=v((XU,pE)=>{var Zo=1e3,Xo=Zo*60,Yo=Xo*60,ec=Yo*24,Q9=ec*365.25;pE.exports=function(t,e){e=e||{};var r=typeof t;if(r==="string"&&t.length>0)return H9(t);if(r==="number"&&isNaN(t)===!1)return e.long?W9(t):V9(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))};function H9(t){if(t=String(t),!(t.length>100)){var e=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(t);if(e){var r=parseFloat(e[1]),n=(e[2]||"ms").toLowerCase();switch(n){case"years":case"year":case"yrs":case"yr":case"y":return r*Q9;case"days":case"day":case"d":return r*ec;case"hours":case"hour":case"hrs":case"hr":case"h":return r*Yo;case"minutes":case"minute":case"mins":case"min":case"m":return r*Xo;case"seconds":case"second":case"secs":case"sec":case"s":return r*Zo;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}}}function V9(t){return t>=ec?Math.round(t/ec)+"d":t>=Yo?Math.round(t/Yo)+"h":t>=Xo?Math.round(t/Xo)+"m":t>=Zo?Math.round(t/Zo)+"s":t+"ms"}function W9(t){return xl(t,ec,"day")||xl(t,Yo,"hour")||xl(t,Xo,"minute")||xl(t,Zo,"second")||t+" ms"}function xl(t,e,r){if(!(t<e))return t<e*1.5?Math.floor(t/e)+" "+r:Math.ceil(t/e)+" "+r+"s"}});var vm=v((ge,fE)=>{ge=fE.exports=gm.debug=gm.default=gm;ge.coerce=X9;ge.disable=J9;ge.enable=K9;ge.enabled=Z9;ge.humanize=dE();ge.names=[];ge.skips=[];ge.formatters={};var hm;function G9(t){var e=0,r;for(r in t)e=(e<<5)-e+t.charCodeAt(r),e|=0;return ge.colors[Math.abs(e)%ge.colors.length]}function gm(t){function e(){if(e.enabled){var r=e,n=+new Date,i=n-(hm||n);r.diff=i,r.prev=hm,r.curr=n,hm=n;for(var s=new Array(arguments.length),a=0;a<s.length;a++)s[a]=arguments[a];s[0]=ge.coerce(s[0]),typeof s[0]!="string"&&s.unshift("%O");var o=0;s[0]=s[0].replace(/%([a-zA-Z%])/g,function(c,l){if(c==="%%")return c;o++;var p=ge.formatters[l];if(typeof p=="function"){var d=s[o];c=p.call(r,d),s.splice(o,1),o--}return c}),ge.formatArgs.call(r,s);var u=e.log||ge.log||console.log.bind(console);u.apply(r,s)}}return e.namespace=t,e.enabled=ge.enabled(t),e.useColors=ge.useColors(),e.color=G9(t),typeof ge.init=="function"&&ge.init(e),e}function K9(t){ge.save(t),ge.names=[],ge.skips=[];for(var e=(typeof t=="string"?t:"").split(/[\s,]+/),r=e.length,n=0;n<r;n++)e[n]&&(t=e[n].replace(/\*/g,".*?"),t[0]==="-"?ge.skips.push(new RegExp("^"+t.substr(1)+"$")):ge.names.push(new RegExp("^"+t+"$")))}function J9(){ge.enable("")}function Z9(t){var e,r;for(e=0,r=ge.skips.length;e<r;e++)if(ge.skips[e].test(t))return!1;for(e=0,r=ge.names.length;e<r;e++)if(ge.names[e].test(t))return!0;return!1}function X9(t){return t instanceof Error?t.stack||t.message:t}});var gE=v((gt,hE)=>{gt=hE.exports=vm();gt.log=tj;gt.formatArgs=ej;gt.save=rj;gt.load=mE;gt.useColors=Y9;gt.storage=typeof chrome<"u"&&typeof chrome.storage<"u"?chrome.storage.local:nj();gt.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"];function Y9(){return typeof window<"u"&&window.process&&window.process.type==="renderer"?!0:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}gt.formatters.j=function(t){try{return JSON.stringify(t)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}};function ej(t){var e=this.useColors;if(t[0]=(e?"%c":"")+this.namespace+(e?" %c":" ")+t[0]+(e?"%c ":" ")+"+"+gt.humanize(this.diff),!!e){var r="color: "+this.color;t.splice(1,0,r,"color: inherit");var n=0,i=0;t[0].replace(/%[a-zA-Z%]/g,function(s){s!=="%%"&&(n++,s==="%c"&&(i=n))}),t.splice(i,0,r)}}function tj(){return typeof console=="object"&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function rj(t){try{t==null?gt.storage.removeItem("debug"):gt.storage.debug=t}catch{}}function mE(){var t;try{t=gt.storage.debug}catch{}return!t&&typeof process<"u"&&"env"in process&&(t=process.env.DEBUG),t}gt.enable(mE());function nj(){try{return window.localStorage}catch{}}});var bE=v((Xe,xE)=>{var vE=require("tty"),tc=require("util");Xe=xE.exports=vm();Xe.init=lj;Xe.log=oj;Xe.formatArgs=aj;Xe.save=cj;Xe.load=yE;Xe.useColors=sj;Xe.colors=[6,2,3,4,5,1];Xe.inspectOpts=Object.keys(process.env).filter(function(t){return/^debug_/i.test(t)}).reduce(function(t,e){var r=e.substring(6).toLowerCase().replace(/_([a-z])/g,function(i,s){return s.toUpperCase()}),n=process.env[e];return/^(yes|on|true|enabled)$/i.test(n)?n=!0:/^(no|off|false|disabled)$/i.test(n)?n=!1:n==="null"?n=null:n=Number(n),t[r]=n,t},{});var Ns=parseInt(process.env.DEBUG_FD,10)||2;Ns!==1&&Ns!==2&&tc.deprecate(function(){},"except for stderr(2) and stdout(1), any other usage of DEBUG_FD is deprecated. Override debug.log if you want to use a different log function (https://git.io/debug_fd)")();var ij=Ns===1?process.stdout:Ns===2?process.stderr:uj(Ns);function sj(){return"colors"in Xe.inspectOpts?!!Xe.inspectOpts.colors:vE.isatty(Ns)}Xe.formatters.o=function(t){return this.inspectOpts.colors=this.useColors,tc.inspect(t,this.inspectOpts).split(`
    64  `).map(function(e){return e.trim()}).join(" ")};Xe.formatters.O=function(t){return this.inspectOpts.colors=this.useColors,tc.inspect(t,this.inspectOpts)};function aj(t){var e=this.namespace,r=this.useColors;if(r){var n=this.color,i="  \x1B[3"+n+";1m"+e+" \x1B[0m";t[0]=i+t[0].split(`
    65  `).join(`
    66  `+i),t.push("\x1B[3"+n+"m+"+Xe.humanize(this.diff)+"\x1B[0m")}else t[0]=new Date().toUTCString()+" "+e+" "+t[0]}function oj(){return ij.write(tc.format.apply(tc,arguments)+`
    67  `)}function cj(t){t==null?delete process.env.DEBUG:process.env.DEBUG=t}function yE(){return process.env.DEBUG}function uj(t){var e,r=process.binding("tty_wrap");switch(r.guessHandleType(t)){case"TTY":e=new vE.WriteStream(t),e._type="tty",e._handle&&e._handle.unref&&e._handle.unref();break;case"FILE":var n=require("fs");e=new n.SyncWriteStream(t,{autoClose:!1}),e._type="fs";break;case"PIPE":case"TCP":var i=require("net");e=new i.Socket({fd:t,readable:!1,writable:!0}),e.readable=!1,e.read=null,e._type="pipe",e._handle&&e._handle.unref&&e._handle.unref();break;default:throw new Error("Implement me. Unknown stream file type!")}return e.fd=t,e._isStdio=!0,e}function lj(t){t.inspectOpts={};for(var e=Object.keys(Xe.inspectOpts),r=0;r<e.length;r++)t.inspectOpts[e[r]]=Xe.inspectOpts[e[r]]}Xe.enable(yE())});var wE=v((YU,ym)=>{typeof process<"u"&&process.type==="renderer"?ym.exports=gE():ym.exports=bE()});var SE=v((ez,_E)=>{"use strict";_E.exports=hj;var pj=require("http"),dj=typeof pj.ServerResponse.prototype.appendHeader=="function",fj=dj?bj:wj;function mj(t,e){var r=!1;return function(i){var s=yj.apply(this,arguments);return r||(r=!0,e.call(this),typeof s[0]=="number"&&this.statusCode!==s[0]&&(s[0]=this.statusCode,s.length=1)),t.apply(this,s)}}function hj(t,e){if(!t)throw new TypeError("argument res is required");if(typeof e!="function")throw new TypeError("argument listener must be a function");t.writeHead=mj(t.writeHead,e)}function gj(t,e){if(e.length&&Array.isArray(e[0]))xj(t,e);else{if(e.length%2!==0)throw new TypeError("headers array is malformed");fj(t,e)}}function vj(t,e){for(var r=Object.keys(e),n=0;n<r.length;n++){var i=r[n];i&&t.setHeader(i,e[i])}}function yj(t){var e=arguments.length,r=e>1&&typeof arguments[1]=="string"?2:1,n=e>=r+1?arguments[r]:void 0;this.statusCode=t,Array.isArray(n)?gj(this,n):n&&vj(this,n);for(var i=new Array(Math.min(e,r)),s=0;s<i.length;s++)i[s]=arguments[s];return i}function xj(t,e){for(var r,n=0;n<e.length;n++)r=e[n][0],r&&t.setHeader(r,e[n][1])}function bj(t,e){for(var r=0;r<e.length;r+=2)t.removeHeader(e[r]);for(var n,i=0;i<e.length;i+=2)n=e[i],n&&t.appendHeader(n,e[i+1])}function wj(t,e){for(var r,n=0;n<e.length;n+=2)r=e[n],r&&t.setHeader(r,e[n+1])}});var kE=v(bl=>{var AE=require("crypto");bl.sign=function(t,e){if(typeof t!="string")throw new TypeError("Cookie value must be provided as a string.");if(e==null)throw new TypeError("Secret key must be provided.");return t+"."+AE.createHmac("sha256",e).update(t).digest("base64").replace(/\=+$/,"")};bl.unsign=function(t,e){if(typeof t!="string")throw new TypeError("Signed cookie string must be provided.");if(e==null)throw new TypeError("Secret key must be provided.");var r=t.slice(0,t.lastIndexOf(".")),n=bl.sign(r,e);return EE(n)==EE(t)?r:!1};function EE(t){return AE.createHash("sha1").update(t).digest("hex")}});var CE=v((rz,wm)=>{"use strict";var wl=require("crypto"),xm=wl.randomBytes===wl.pseudoRandomBytes?1:3;wm.exports=_j;wm.exports.sync=Sj;function _j(t,e){if(e!==void 0&&typeof e!="function")throw new TypeError("argument callback must be a function");if(!e&&!global.Promise)throw new TypeError("argument callback is required");return e?bm(t,xm,e):new Promise(function(n,i){bm(t,xm,function(a,o){if(a)return i(a);n(o)})})}function Sj(t){for(var e=null,r=0;r<xm;r++)try{return wl.randomBytes(t)}catch(n){e=n}throw e}function bm(t,e,r){wl.randomBytes(t,function(i,s){if(!i)return r(null,s);if(!--e)return r(i);setTimeout(bm.bind(null,t,e,r),10)})}});var OE=v((nz,_m)=>{"use strict";var PE=CE(),Ej=/=+$/,Aj=/\+/g,kj=/\//g;_m.exports=Cj;_m.exports.sync=Tj;function Cj(t,e){if(e!==void 0&&typeof e!="function")throw new TypeError("argument callback must be a function");if(!e&&!global.Promise)throw new TypeError("argument callback is required");return e?TE(t,e):new Promise(function(n,i){TE(t,function(a,o){if(a)return i(a);n(o)})})}function Tj(t){return IE(PE.sync(t))}function TE(t,e){PE(t,function(r,n){if(r)return e(r);e(null,IE(n))})}function IE(t){return t.toString("base64").replace(Ej,"").replace(Aj,"-").replace(kj,"_")}});var Sm=v((iz,NE)=>{"use strict";var Pj=mm(),Ij=Vt()("express-session"),Oj=NE.exports=function(e){if(this.path="/",this.maxAge=null,this.httpOnly=!0,e){if(typeof e!="object")throw new TypeError("argument options must be a object");for(var r in e)r!=="data"&&(this[r]=e[r])}(this.originalMaxAge===void 0||this.originalMaxAge===null)&&(this.originalMaxAge=this.maxAge)};Oj.prototype={set expires(t){this._expires=t,this.originalMaxAge=this.maxAge},get expires(){return this._expires},set maxAge(t){if(t&&typeof t!="number"&&!(t instanceof Date))throw new TypeError("maxAge must be a number or Date");t instanceof Date&&Ij("maxAge as Date; pass number of milliseconds instead"),this.expires=typeof t=="number"?new Date(Date.now()+t):t},get maxAge(){return this.expires instanceof Date?this.expires.valueOf()-Date.now():this.expires},get data(){return{originalMaxAge:this.originalMaxAge,partitioned:this.partitioned,priority:this.priority,expires:this._expires,secure:this.secure,httpOnly:this.httpOnly,domain:this.domain,path:this.path,sameSite:this.sameSite}},serialize:function(t,e){return Pj.serialize(t,e,this.data)},toJSON:function(){return this.data}}});var Em=v((sz,RE)=>{"use strict";RE.exports=ai;function ai(t,e){if(Object.defineProperty(this,"req",{value:t}),Object.defineProperty(this,"id",{value:t.sessionID}),typeof e=="object"&&e!==null)for(var r in e)r in this||(this[r]=e[r])}Rs(ai.prototype,"touch",function(){return this.resetMaxAge()});Rs(ai.prototype,"resetMaxAge",function(){return this.cookie.maxAge=this.cookie.originalMaxAge,this});Rs(ai.prototype,"save",function(e){return this.req.sessionStore.set(this.id,this,e||function(){}),this});Rs(ai.prototype,"reload",function(e){var r=this.req,n=this.req.sessionStore;return n.get(this.id,function(i,s){if(i)return e(i);if(!s)return e(new Error("failed to load session"));n.createSession(r,s),e()}),this});Rs(ai.prototype,"destroy",function(e){return delete this.req.session,this.req.sessionStore.destroy(this.id,e),this});Rs(ai.prototype,"regenerate",function(e){return this.req.sessionStore.regenerate(this.req,e),this});function Rs(t,e,r){Object.defineProperty(t,e,{configurable:!0,enumerable:!1,value:r,writable:!0})}});var Am=v((az,qE)=>{"use strict";var Nj=Sm(),jE=require("events").EventEmitter,Rj=Em(),jj=require("util");qE.exports=rc;function rc(){jE.call(this)}jj.inherits(rc,jE);rc.prototype.regenerate=function(t,e){var r=this;this.destroy(t.sessionID,function(n){r.generate(t),e(n)})};rc.prototype.load=function(t,e){var r=this;this.get(t,function(n,i){if(n)return e(n);if(!i)return e();var s={sessionID:t,sessionStore:r};e(null,r.createSession(s,i))})};rc.prototype.createSession=function(t,e){var r=e.cookie.expires,n=e.cookie.originalMaxAge;return e.cookie=new Nj(e.cookie),typeof r=="string"&&(e.cookie.expires=new Date(r)),e.cookie.originalMaxAge=n,t.session=new Rj(t,e),t.session}});var ME=v((oz,$E)=>{"use strict";var DE=Am(),qj=require("util"),js=typeof setImmediate=="function"?setImmediate:function(t){process.nextTick(t.bind.apply(t,arguments))};$E.exports=Mr;function Mr(){DE.call(this),this.sessions=Object.create(null)}qj.inherits(Mr,DE);Mr.prototype.all=function(e){for(var r=Object.keys(this.sessions),n=Object.create(null),i=0;i<r.length;i++){var s=r[i],a=km.call(this,s);a&&(n[s]=a)}e&&js(e,null,n)};Mr.prototype.clear=function(e){this.sessions=Object.create(null),e&&js(e)};Mr.prototype.destroy=function(e,r){delete this.sessions[e],r&&js(r)};Mr.prototype.get=function(e,r){js(r,null,km.call(this,e))};Mr.prototype.set=function(e,r,n){this.sessions[e]=JSON.stringify(r),n&&js(n)};Mr.prototype.length=function(e){this.all(function(r,n){if(r)return e(r);e(null,Object.keys(n).length)})};Mr.prototype.touch=function(e,r,n){var i=km.call(this,e);i&&(i.cookie=r.cookie,this.sessions[e]=JSON.stringify(i)),n&&js(n)};function km(t){var e=this.sessions[t];if(e){if(e=JSON.parse(e),e.cookie){var r=typeof e.cookie.expires=="string"?new Date(e.cookie.expires):e.cookie.expires;if(r&&r<=Date.now()){delete this.sessions[t];return}}return e}}});var WE=v((qs,VE)=>{"use strict";var FE=Lo().Buffer,UE=mm(),Dj=require("crypto"),ke=wE()("express-session"),ic=Vt()("express-session"),$j=SE(),Mj=ei(),zE=kE(),Fj=OE().sync,QE=Sm(),Cm=ME(),HE=Em(),Bj=Am(),Lj="production";qs=VE.exports=zj;qs.Store=Bj;qs.Cookie=QE;qs.Session=HE;qs.MemoryStore=Cm;var Uj=`Warning: connect.session() MemoryStore is not
    68  designed for a production environment, as it will leak
    69  memory, and will not scale past a single process.`,_l=typeof setImmediate=="function"?setImmediate:function(t){process.nextTick(t.bind.apply(t,arguments))};function zj(t){var e=t||{},r=e.cookie||{},n=e.genid||Qj,i=e.name||e.key||"connect.sid",s=e.store||new Cm,a=e.proxy,o=e.resave,u=!!e.rolling,c=e.saveUninitialized,l=e.secret;if(typeof n!="function")throw new TypeError("genid option must be a function");if(o===void 0&&(ic("undefined resave option; provide resave option"),o=!0),c===void 0&&(ic("undefined saveUninitialized option; provide saveUninitialized option"),c=!0),e.unset&&e.unset!=="destroy"&&e.unset!=="keep")throw new TypeError('unset option must be "destroy" or "keep"');var p=e.unset==="destroy";if(Array.isArray(l)&&l.length===0)throw new TypeError("secret option array must contain one or more strings");l&&!Array.isArray(l)&&(l=[l]),l||ic("req.secret; provide secret option"),Lj==="production"&&s instanceof Cm&&console.warn(Uj),s.generate=function(h){h.sessionID=n(h),h.session=new HE(h),h.session.cookie=new QE(r),r.secure==="auto"&&(h.session.cookie.secure=BE(h,a))};var d=typeof s.touch=="function",f=!0;return s.on("disconnect",function(){f=!1}),s.on("connect",function(){f=!0}),function(m,x,_){if(m.session){_();return}if(!f){ke("store is disconnected"),_();return}var w=Mj.original(m).pathname||"/";if(w.indexOf(r.path||"/")!==0){ke("pathname mismatch"),_();return}if(!l&&!m.secret){_(new Error("secret option required for sessions"));return}var A=l||[m.secret],P,F,T,C=!1;m.sessionStore=s;var R=m.sessionID=Hj(m,i,A);$j(x,function(){if(!m.session){ke("no session");return}if(B2(m)){if(m.session.cookie.secure&&!BE(m,a)){ke("not secured");return}C||(m.session.touch(),C=!0);try{Vj(x,i,m.sessionID,A[0],m.session.cookie.data)}catch(G){_l(_,G)}}});var z=x.end,Y=x.write,te=!1;x.end=function(Se,dr){if(te)return!1;te=!0;var fr,Zi=!0;function io(){if(Zi){fr=z.call(x,Se,dr),Zi=!1;return}z.call(x)}function Kp(){if(!Zi)return fr;if(x._header||x._implicitHeader(),Se==null)return fr=!0,fr;var so=Number(x.getHeader("Content-Length"));return!isNaN(so)&&so>0&&(Se=FE.isBuffer(Se)?Se:FE.from(Se,dr),dr=void 0,Se.length!==0)?(ke("split response"),fr=Y.call(x,Se.slice(0,Se.length-1)),Se=Se.slice(Se.length-1,Se.length),fr):(fr=Y.call(x,Se,dr),Zi=!1,fr)}return to(m)?(ke("destroying"),s.destroy(m.sessionID,function(rn){rn&&_l(_,rn),ke("destroyed"),io()}),Kp()):m.session?(C||(m.session.touch(),C=!0),ro(m)?(m.session.save(function(rn){rn&&_l(_,rn),io()}),Kp()):d&&no(m)?(ke("touching"),s.touch(m.sessionID,m.session,function(rn){rn&&_l(_,rn),ke("touched"),io()}),Kp()):z.call(x,Se,dr)):(ke("no session"),z.call(x,Se,dr))};function re(){s.generate(m),F=m.sessionID,P=nc(m.session),Ae(m.session)}function oe(G,Se){s.createSession(G,Se),F=G.sessionID,P=nc(Se),o||(T=P),Ae(G.session)}function _e(G,Se){return function(){m.session!==G&&Ae(m.session),Se.apply(this,arguments)}}function Ae(G){var Se=G.reload,dr=G.save;function fr(io){ke("reloading %s",this.id),Se.call(this,_e(this,io))}function Zi(){ke("saving %s",this.id),T=nc(this),dr.apply(this,arguments)}Object.defineProperty(G,"reload",{configurable:!0,enumerable:!1,value:fr,writable:!0}),Object.defineProperty(G,"save",{configurable:!0,enumerable:!1,value:Zi,writable:!0})}function Rt(G){return F!==G.id||P!==nc(G)}function Un(G){return F===G.id&&T===nc(G)}function to(G){return G.sessionID&&p&&G.session==null}function ro(G){return typeof G.sessionID!="string"?(ke("session ignored because of bogus req.sessionID %o",G.sessionID),!1):!c&&!T&&R!==G.sessionID?Rt(G.session):!Un(G.session)}function no(G){return typeof G.sessionID!="string"?(ke("session ignored because of bogus req.sessionID %o",G.sessionID),!1):R===G.sessionID&&!ro(G)}function B2(G){return typeof G.sessionID!="string"?!1:R!==G.sessionID?c||Rt(G.session):u||G.session.cookie.expires!=null&&Rt(G.session)}if(!m.sessionID){ke("no SID sent, generating session"),re(),_();return}ke("fetching %s",m.sessionID),s.get(m.sessionID,function(G,Se){if(G&&G.code!=="ENOENT"){ke("error %j",G),_(G);return}try{G||!Se?(ke("no session found"),re()):(ke("session found"),oe(m,Se))}catch(dr){_(dr);return}_()})}}function Qj(t){return Fj(24)}function Hj(t,e,r){var n=t.headers.cookie,i,s;if(n){var a=UE.parse(n);i=a[e],i&&(i.substr(0,2)==="s:"?(s=LE(i.slice(2),r),s===!1&&(ke("cookie signature invalid"),s=void 0)):ke("cookie unsigned"))}return!s&&t.signedCookies&&(s=t.signedCookies[e],s&&ic("cookie should be available in req.headers.cookie")),!s&&t.cookies&&(i=t.cookies[e],i&&(i.substr(0,2)==="s:"?(s=LE(i.slice(2),r),s&&ic("cookie should be available in req.headers.cookie"),s===!1&&(ke("cookie signature invalid"),s=void 0)):ke("cookie unsigned"))),s}function nc(t){var e=JSON.stringify(t,function(r,n){if(!(this===t&&r==="cookie"))return n});return Dj.createHash("sha1").update(e,"utf8").digest("hex")}function BE(t,e){if(t.connection&&t.connection.encrypted)return!0;if(e===!1)return!1;if(e!==!0)return t.secure===!0;var r=t.headers["x-forwarded-proto"]||"",n=r.indexOf(","),i=n!==-1?r.substr(0,n).toLowerCase().trim():r.toLowerCase().trim();return i==="https"}function Vj(t,e,r,n,i){var s="s:"+zE.sign(r,n),a=UE.serialize(e,s,i);ke("set-cookie %s",a);var o=t.getHeader("Set-Cookie")||[],u=Array.isArray(o)?o.concat(a):[o,a];t.setHeader("Set-Cookie",u)}function LE(t,e){for(var r=0;r<e.length;r++){var n=zE.unsign(t,e[r]);if(n!==!1)return n}return!1}});var Pm=v(GE=>{"use strict";GE.parse=function(t,e){return new Tm(t,e).parse()};var Tm=class t{constructor(e,r){this.source=e,this.transform=r||Wj,this.position=0,this.entries=[],this.recorded=[],this.dimension=0}isEof(){return this.position>=this.source.length}nextCharacter(){var e=this.source[this.position++];return e==="\\"?{value:this.source[this.position++],escaped:!0}:{value:e,escaped:!1}}record(e){this.recorded.push(e)}newEntry(e){var r;(this.recorded.length>0||e)&&(r=this.recorded.join(""),r==="NULL"&&!e&&(r=null),r!==null&&(r=this.transform(r)),this.entries.push(r),this.recorded=[])}consumeDimensions(){if(this.source[0]==="[")for(;!this.isEof();){var e=this.nextCharacter();if(e.value==="=")break}}parse(e){var r,n,i;for(this.consumeDimensions();!this.isEof();)if(r=this.nextCharacter(),r.value==="{"&&!i)this.dimension++,this.dimension>1&&(n=new t(this.source.substr(this.position-1),this.transform),this.entries.push(n.parse(!0)),this.position+=n.position-2);else if(r.value==="}"&&!i){if(this.dimension--,!this.dimension&&(this.newEntry(),e))return this.entries}else r.value==='"'&&!r.escaped?(i&&this.newEntry(!0),i=!i):r.value===","&&!i?this.newEntry():this.record(r.value);if(this.dimension!==0)throw new Error("array dimension not balanced");return this.entries}};function Wj(t){return t}});var Im=v((uz,KE)=>{var Gj=Pm();KE.exports={create:function(t,e){return{parse:function(){return Gj.parse(t,e)}}}}});var XE=v((lz,ZE)=>{"use strict";var Kj=/(\d{1,})-(\d{2})-(\d{2}) (\d{2}):(\d{2}):(\d{2})(\.\d{1,})?.*?( BC)?$/,Jj=/^(\d{1,})-(\d{2})-(\d{2})( BC)?$/,Zj=/([Z+-])(\d{2})?:?(\d{2})?:?(\d{2})?/,Xj=/^-?infinity$/;ZE.exports=function(e){if(Xj.test(e))return Number(e.replace("i","I"));var r=Kj.exec(e);if(!r)return Yj(e)||null;var n=!!r[8],i=parseInt(r[1],10);n&&(i=JE(i));var s=parseInt(r[2],10)-1,a=r[3],o=parseInt(r[4],10),u=parseInt(r[5],10),c=parseInt(r[6],10),l=r[7];l=l?1e3*parseFloat(l):0;var p,d=eq(e);return d!=null?(p=new Date(Date.UTC(i,s,a,o,u,c,l)),Om(i)&&p.setUTCFullYear(i),d!==0&&p.setTime(p.getTime()-d)):(p=new Date(i,s,a,o,u,c,l),Om(i)&&p.setFullYear(i)),p};function Yj(t){var e=Jj.exec(t);if(e){var r=parseInt(e[1],10),n=!!e[4];n&&(r=JE(r));var i=parseInt(e[2],10)-1,s=e[3],a=new Date(r,i,s);return Om(r)&&a.setFullYear(r),a}}function eq(t){if(t.endsWith("+00"))return 0;var e=Zj.exec(t.split(" ")[1]);if(e){var r=e[1];if(r==="Z")return 0;var n=r==="-"?-1:1,i=parseInt(e[2],10)*3600+parseInt(e[3]||0,10)*60+parseInt(e[4]||0,10);return i*n*1e3}}function JE(t){return-(t-1)}function Om(t){return t>=0&&t<100}});var eA=v((pz,YE)=>{YE.exports=rq;var tq=Object.prototype.hasOwnProperty;function rq(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)tq.call(r,n)&&(t[n]=r[n])}return t}});var nA=v((dz,rA)=>{"use strict";var nq=eA();rA.exports=Ds;function Ds(t){if(!(this instanceof Ds))return new Ds(t);nq(this,hq(t))}var iq=["seconds","minutes","hours","days","months","years"];Ds.prototype.toPostgres=function(){var t=iq.filter(this.hasOwnProperty,this);return this.milliseconds&&t.indexOf("seconds")<0&&t.push("seconds"),t.length===0?"0":t.map(function(e){var r=this[e]||0;return e==="seconds"&&this.milliseconds&&(r=(r+this.milliseconds/1e3).toFixed(6).replace(/\.?0+$/,"")),r+" "+e},this).join(" ")};var sq={years:"Y",months:"M",days:"D",hours:"H",minutes:"M",seconds:"S"},aq=["years","months","days"],oq=["hours","minutes","seconds"];Ds.prototype.toISOString=Ds.prototype.toISO=function(){var t=aq.map(r,this).join(""),e=oq.map(r,this).join("");return"P"+t+"T"+e;function r(n){var i=this[n]||0;return n==="seconds"&&this.milliseconds&&(i=(i+this.milliseconds/1e3).toFixed(6).replace(/0+$/,"")),i+sq[n]}};var Nm="([+-]?\\d+)",cq=Nm+"\\s+years?",uq=Nm+"\\s+mons?",lq=Nm+"\\s+days?",pq="([+-])?([\\d]*):(\\d\\d):(\\d\\d)\\.?(\\d{1,6})?",dq=new RegExp([cq,uq,lq,pq].map(function(t){return"("+t+")?"}).join("\\s*")),tA={years:2,months:4,days:6,hours:9,minutes:10,seconds:11,milliseconds:12},fq=["hours","minutes","seconds","milliseconds"];function mq(t){var e=t+"000000".slice(t.length);return parseInt(e,10)/1e3}function hq(t){if(!t)return{};var e=dq.exec(t),r=e[8]==="-";return Object.keys(tA).reduce(function(n,i){var s=tA[i],a=e[s];return!a||(a=i==="milliseconds"?mq(a):parseInt(a,10),!a)||(r&&~fq.indexOf(i)&&(a*=-1),n[i]=a),n},{})}});var sA=v((fz,iA)=>{"use strict";iA.exports=function(e){if(/^\\x/.test(e))return new Buffer(e.substr(2),"hex");for(var r="",n=0;n<e.length;)if(e[n]!=="\\")r+=e[n],++n;else if(/[0-7]{3}/.test(e.substr(n+1,3)))r+=String.fromCharCode(parseInt(e.substr(n+1,3),8)),n+=4;else{for(var i=1;n+i<e.length&&e[n+i]==="\\";)i++;for(var s=0;s<Math.floor(i/2);++s)r+="\\";n+=Math.floor(i/2)*2}return new Buffer(r,"binary")}});var dA=v((mz,pA)=>{var sc=Pm(),ac=Im(),Sl=XE(),oA=nA(),cA=sA();function El(t){return function(r){return r===null?r:t(r)}}function uA(t){return t===null?t:t==="TRUE"||t==="t"||t==="true"||t==="y"||t==="yes"||t==="on"||t==="1"}function gq(t){return t?sc.parse(t,uA):null}function vq(t){return parseInt(t,10)}function Rm(t){return t?sc.parse(t,El(vq)):null}function yq(t){return t?sc.parse(t,El(function(e){return lA(e).trim()})):null}var xq=function(t){if(!t)return null;var e=ac.create(t,function(r){return r!==null&&(r=$m(r)),r});return e.parse()},jm=function(t){if(!t)return null;var e=ac.create(t,function(r){return r!==null&&(r=parseFloat(r)),r});return e.parse()},Jt=function(t){if(!t)return null;var e=ac.create(t);return e.parse()},qm=function(t){if(!t)return null;var e=ac.create(t,function(r){return r!==null&&(r=Sl(r)),r});return e.parse()},bq=function(t){if(!t)return null;var e=ac.create(t,function(r){return r!==null&&(r=oA(r)),r});return e.parse()},wq=function(t){return t?sc.parse(t,El(cA)):null},Dm=function(t){return parseInt(t,10)},lA=function(t){var e=String(t);return/^\d+$/.test(e)?e:t},aA=function(t){return t?sc.parse(t,El(JSON.parse)):null},$m=function(t){return t[0]!=="("?null:(t=t.substring(1,t.length-1).split(","),{x:parseFloat(t[0]),y:parseFloat(t[1])})},_q=function(t){if(t[0]!=="<"&&t[1]!=="(")return null;for(var e="(",r="",n=!1,i=2;i<t.length-1;i++){if(n||(e+=t[i]),t[i]===")"){n=!0;continue}else if(!n)continue;t[i]!==","&&(r+=t[i])}var s=$m(e);return s.radius=parseFloat(r),s},Sq=function(t){t(20,lA),t(21,Dm),t(23,Dm),t(26,Dm),t(700,parseFloat),t(701,parseFloat),t(16,uA),t(1082,Sl),t(1114,Sl),t(1184,Sl),t(600,$m),t(651,Jt),t(718,_q),t(1e3,gq),t(1001,wq),t(1005,Rm),t(1007,Rm),t(1028,Rm),t(1016,yq),t(1017,xq),t(1021,jm),t(1022,jm),t(1231,jm),t(1014,Jt),t(1015,Jt),t(1008,Jt),t(1009,Jt),t(1040,Jt),t(1041,Jt),t(1115,qm),t(1182,qm),t(1185,qm),t(1186,oA),t(1187,bq),t(17,cA),t(114,JSON.parse.bind(JSON)),t(3802,JSON.parse.bind(JSON)),t(199,aA),t(3807,aA),t(3907,Jt),t(2951,Jt),t(791,Jt),t(1183,Jt),t(1270,Jt)};pA.exports={init:Sq}});var mA=v((hz,fA)=>{"use strict";var kt=1e6;function Eq(t){var e=t.readInt32BE(0),r=t.readUInt32BE(4),n="";e<0&&(e=~e+(r===0),r=~r+1>>>0,n="-");var i="",s,a,o,u,c,l;{if(s=e%kt,e=e/kt>>>0,a=4294967296*s+r,r=a/kt>>>0,o=""+(a-kt*r),r===0&&e===0)return n+o+i;for(u="",c=6-o.length,l=0;l<c;l++)u+="0";i=u+o+i}{if(s=e%kt,e=e/kt>>>0,a=4294967296*s+r,r=a/kt>>>0,o=""+(a-kt*r),r===0&&e===0)return n+o+i;for(u="",c=6-o.length,l=0;l<c;l++)u+="0";i=u+o+i}{if(s=e%kt,e=e/kt>>>0,a=4294967296*s+r,r=a/kt>>>0,o=""+(a-kt*r),r===0&&e===0)return n+o+i;for(u="",c=6-o.length,l=0;l<c;l++)u+="0";i=u+o+i}return s=e%kt,a=4294967296*s+r,o=""+a%kt,n+o+i}fA.exports=Eq});var xA=v((gz,yA)=>{var Aq=mA(),Ie=function(t,e,r,n,i){r=r||0,n=n||!1,i=i||function(f,h,m){return f*Math.pow(2,m)+h};var s=r>>3,a=function(f){return n?~f&255:f},o=255,u=8-r%8;e<u&&(o=255<<8-e&255,u=e),r&&(o=o>>r%8);var c=0;r%8+e>=8&&(c=i(0,a(t[s])&o,u));for(var l=e+r>>3,p=s+1;p<l;p++)c=i(c,a(t[p]),8);var d=(e+r)%8;return d>0&&(c=i(c,a(t[l])>>8-d,d)),c},vA=function(t,e,r){var n=Math.pow(2,r-1)-1,i=Ie(t,1),s=Ie(t,r,1);if(s===0)return 0;var a=1,o=function(c,l,p){c===0&&(c=1);for(var d=1;d<=p;d++)a/=2,(l&1<<p-d)>0&&(c+=a);return c},u=Ie(t,e,r+1,!1,o);return s==Math.pow(2,r+1)-1?u===0?i===0?1/0:-1/0:NaN:(i===0?1:-1)*Math.pow(2,s-n)*u},kq=function(t){return Ie(t,1)==1?-1*(Ie(t,15,1,!0)+1):Ie(t,15,1)},hA=function(t){return Ie(t,1)==1?-1*(Ie(t,31,1,!0)+1):Ie(t,31,1)},Cq=function(t){return vA(t,23,8)},Tq=function(t){return vA(t,52,11)},Pq=function(t){var e=Ie(t,16,32);if(e==49152)return NaN;for(var r=Math.pow(1e4,Ie(t,16,16)),n=0,i=[],s=Ie(t,16),a=0;a<s;a++)n+=Ie(t,16,64+16*a)*r,r/=1e4;var o=Math.pow(10,Ie(t,16,48));return(e===0?1:-1)*Math.round(n*o)/o},gA=function(t,e){var r=Ie(e,1),n=Ie(e,63,1),i=new Date((r===0?1:-1)*n/1e3+9466848e5);return t||i.setTime(i.getTime()+i.getTimezoneOffset()*6e4),i.usec=n%1e3,i.getMicroSeconds=function(){return this.usec},i.setMicroSeconds=function(s){this.usec=s},i.getUTCMicroSeconds=function(){return this.usec},i},oc=function(t){for(var e=Ie(t,32),r=Ie(t,32,32),n=Ie(t,32,64),i=96,s=[],a=0;a<e;a++)s[a]=Ie(t,32,i),i+=32,i+=32;var o=function(c){var l=Ie(t,32,i);if(i+=32,l==4294967295)return null;var p;if(c==23||c==20)return p=Ie(t,l*8,i),i+=l*8,p;if(c==25)return p=t.toString(this.encoding,i>>3,(i+=l<<3)>>3),p;console.log("ERROR: ElementType not implemented: "+c)},u=function(c,l){var p=[],d;if(c.length>1){var f=c.shift();for(d=0;d<f;d++)p[d]=u(c,l);c.unshift(f)}else for(d=0;d<c[0];d++)p[d]=o(l);return p};return u(s,n)},Iq=function(t){return t.toString("utf8")},Oq=function(t){return t===null?null:Ie(t,8)>0},Nq=function(t){t(20,Aq),t(21,kq),t(23,hA),t(26,hA),t(1700,Pq),t(700,Cq),t(701,Tq),t(16,Oq),t(1114,gA.bind(null,!1)),t(1184,gA.bind(null,!0)),t(1e3,oc),t(1007,oc),t(1016,oc),t(1008,oc),t(1009,oc),t(25,Iq)};yA.exports={init:Nq}});var wA=v((vz,bA)=>{bA.exports={BOOL:16,BYTEA:17,CHAR:18,INT8:20,INT2:21,INT4:23,REGPROC:24,TEXT:25,OID:26,TID:27,XID:28,CID:29,JSON:114,XML:142,PG_NODE_TREE:194,SMGR:210,PATH:602,POLYGON:604,CIDR:650,FLOAT4:700,FLOAT8:701,ABSTIME:702,RELTIME:703,TINTERVAL:704,CIRCLE:718,MACADDR8:774,MONEY:790,MACADDR:829,INET:869,ACLITEM:1033,BPCHAR:1042,VARCHAR:1043,DATE:1082,TIME:1083,TIMESTAMP:1114,TIMESTAMPTZ:1184,INTERVAL:1186,TIMETZ:1266,BIT:1560,VARBIT:1562,NUMERIC:1700,REFCURSOR:1790,REGPROCEDURE:2202,REGOPER:2203,REGOPERATOR:2204,REGCLASS:2205,REGTYPE:2206,UUID:2950,TXID_SNAPSHOT:2970,PG_LSN:3220,PG_NDISTINCT:3361,PG_DEPENDENCIES:3402,TSVECTOR:3614,TSQUERY:3615,GTSVECTOR:3642,REGCONFIG:3734,REGDICTIONARY:3769,JSONB:3802,REGNAMESPACE:4089,REGROLE:4096}});var lc=v(uc=>{var Rq=dA(),jq=xA(),qq=Im(),Dq=wA();uc.getTypeParser=$q;uc.setTypeParser=Mq;uc.arrayParser=qq;uc.builtins=Dq;var cc={text:{},binary:{}};function _A(t){return String(t)}function $q(t,e){return e=e||"text",cc[e]&&cc[e][t]||_A}function Mq(t,e,r){typeof e=="function"&&(r=e,e="text"),cc[e][t]=r}Rq.init(function(t,e){cc.text[t]=e});jq.init(function(t,e){cc.binary[t]=e})});var pc=v((xz,Mm)=>{"use strict";Mm.exports={host:"localhost",user:process.platform==="win32"?process.env.USERNAME:process.env.USER,database:void 0,password:null,connectionString:void 0,port:5432,rows:0,binary:!1,max:10,idleTimeoutMillis:3e4,client_encoding:"",ssl:!1,application_name:void 0,fallback_application_name:void 0,options:void 0,parseInputDatesAsUTC:!1,statement_timeout:!1,lock_timeout:!1,idle_in_transaction_session_timeout:!1,query_timeout:!1,connect_timeout:0,keepalives:1,keepalives_idle:0};var $s=lc(),Fq=$s.getTypeParser(20,"text"),Bq=$s.getTypeParser(1016,"text");Mm.exports.__defineSetter__("parseInt8",function(t){$s.setTypeParser(20,"text",t?$s.getTypeParser(23,"text"):Fq),$s.setTypeParser(1016,"text",t?$s.getTypeParser(1007,"text"):Bq)})});var Ms=v((bz,AA)=>{"use strict";var Lq=pc(),SA=require("util"),{isDate:Uq}=SA.types||SA;function zq(t){return'"'+t.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'}function EA(t){let e="{";for(let r=0;r<t.length;r++)if(r>0&&(e=e+","),t[r]===null||typeof t[r]>"u")e=e+"NULL";else if(Array.isArray(t[r]))e=e+EA(t[r]);else if(ArrayBuffer.isView(t[r])){let n=t[r];if(!(n instanceof Buffer)){let i=Buffer.from(n.buffer,n.byteOffset,n.byteLength);i.length===n.byteLength?n=i:n=i.slice(n.byteOffset,n.byteOffset+n.byteLength)}e+="\\\\x"+n.toString("hex")}else e+=zq(Al(t[r]));return e=e+"}",e}var Al=function(t,e){if(t==null)return null;if(typeof t=="object"){if(t instanceof Buffer)return t;if(ArrayBuffer.isView(t)){let r=Buffer.from(t.buffer,t.byteOffset,t.byteLength);return r.length===t.byteLength?r:r.slice(t.byteOffset,t.byteOffset+t.byteLength)}return Uq(t)?Lq.parseInputDatesAsUTC?Vq(t):Hq(t):Array.isArray(t)?EA(t):Qq(t,e)}return t.toString()};function Qq(t,e){if(t&&typeof t.toPostgres=="function"){if(e=e||[],e.indexOf(t)!==-1)throw new Error('circular reference detected while preparing "'+t+'" for query');return e.push(t),Al(t.toPostgres(Al),e)}return JSON.stringify(t)}function Hq(t){let e=-t.getTimezoneOffset(),r=t.getFullYear(),n=r<1;n&&(r=Math.abs(r)+1);let i=String(r).padStart(4,"0")+"-"+String(t.getMonth()+1).padStart(2,"0")+"-"+String(t.getDate()).padStart(2,"0")+"T"+String(t.getHours()).padStart(2,"0")+":"+String(t.getMinutes()).padStart(2,"0")+":"+String(t.getSeconds()).padStart(2,"0")+"."+String(t.getMilliseconds()).padStart(3,"0");return e<0?(i+="-",e*=-1):i+="+",i+=String(Math.floor(e/60)).padStart(2,"0")+":"+String(e%60).padStart(2,"0"),n&&(i+=" BC"),i}function Vq(t){let e=t.getUTCFullYear(),r=e<1;r&&(e=Math.abs(e)+1);let n=String(e).padStart(4,"0")+"-"+String(t.getUTCMonth()+1).padStart(2,"0")+"-"+String(t.getUTCDate()).padStart(2,"0")+"T"+String(t.getUTCHours()).padStart(2,"0")+":"+String(t.getUTCMinutes()).padStart(2,"0")+":"+String(t.getUTCSeconds()).padStart(2,"0")+"."+String(t.getUTCMilliseconds()).padStart(3,"0");return n+="+00:00",r&&(n+=" BC"),n}function Wq(t,e,r){return t=typeof t=="string"?{text:t}:t,e&&(typeof e=="function"?t.callback=e:t.values=e),r&&(t.callback=r),t}var Gq=function(t){return'"'+t.replace(/"/g,'""')+'"'},Kq=function(t){let e=!1,r="'";if(t==null||typeof t!="string")return"''";for(let n=0;n<t.length;n++){let i=t[n];i==="'"?r+=i+i:i==="\\"?(r+=i+i,e=!0):r+=i}return r+="'",e===!0&&(r=" E"+r),r};AA.exports={prepareValue:function(e){return Al(e)},normalizeQueryConfig:Wq,escapeIdentifier:Gq,escapeLiteral:Kq}});var CA=v((wz,kA)=>{"use strict";var Fs=require("crypto");function Fm(t){return Fs.createHash("md5").update(t,"utf-8").digest("hex")}function Jq(t,e,r){let n=Fm(e+t);return"md5"+Fm(Buffer.concat([Buffer.from(n),r]))}function Zq(t){return Fs.createHash("sha256").update(t).digest()}function Xq(t,e){return t=t.replace(/(\D)-/,"$1"),Fs.createHash(t).update(e).digest()}function Yq(t,e){return Fs.createHmac("sha256",t).update(e).digest()}async function eD(t,e,r){return Fs.pbkdf2Sync(t,e,r,32,"sha256")}kA.exports={postgresMd5PasswordHash:Jq,randomBytes:Fs.randomBytes,deriveKey:eD,sha256:Zq,hashByName:Xq,hmacSha256:Yq,md5:Fm}});var OA=v((_z,IA)=>{var TA=require("crypto");IA.exports={postgresMd5PasswordHash:rD,randomBytes:tD,deriveKey:aD,sha256:nD,hashByName:iD,hmacSha256:sD,md5:Bm};var PA=TA.webcrypto||globalThis.crypto,oi=PA.subtle,Lm=new TextEncoder;function tD(t){return PA.getRandomValues(Buffer.alloc(t))}async function Bm(t){try{return TA.createHash("md5").update(t,"utf-8").digest("hex")}catch{let r=typeof t=="string"?Lm.encode(t):t,n=await oi.digest("MD5",r);return Array.from(new Uint8Array(n)).map(i=>i.toString(16).padStart(2,"0")).join("")}}async function rD(t,e,r){let n=await Bm(e+t);return"md5"+await Bm(Buffer.concat([Buffer.from(n),r]))}async function nD(t){return await oi.digest("SHA-256",t)}async function iD(t,e){return await oi.digest(t,e)}async function sD(t,e){let r=await oi.importKey("raw",t,{name:"HMAC",hash:"SHA-256"},!1,["sign"]);return await oi.sign("HMAC",r,Lm.encode(e))}async function aD(t,e,r){let n=await oi.importKey("raw",Lm.encode(t),"PBKDF2",!1,["deriveBits"]),i={name:"PBKDF2",hash:"SHA-256",salt:e,iterations:r};return await oi.deriveBits(i,n,256,["deriveBits"])}});var zm=v((Sz,Um)=>{"use strict";var oD=parseInt(process.versions&&process.versions.node&&process.versions.node.split(".")[0])<15;oD?Um.exports=CA():Um.exports=OA()});var jA=v((Ez,RA)=>{function ci(t,e){return new Error("SASL channel binding: "+t+" when parsing public certificate "+e.toString("base64"))}function Qm(t,e){let r=t[e++];if(r<128)return{length:r,index:e};let n=r&127;if(n>4)throw ci("bad length",t);r=0;for(let i=0;i<n;i++)r=r<<8|t[e++];return{length:r,index:e}}function NA(t,e){if(t[e++]!==6)throw ci("non-OID data",t);let{length:r,index:n}=Qm(t,e);e=n;let i=e+r,s=t[e++],a=(s/40>>0)+"."+s%40;for(;e<i;){let o=0;for(;e<i;){let u=t[e++];if(o=o<<7|u&127,u<128)break}a+="."+o}return{oid:a,index:e}}function dc(t,e){if(t[e++]!==48)throw ci("non-sequence data",t);return Qm(t,e)}function cD(t,e){e===void 0&&(e=0),e=dc(t,e).index;let{length:r,index:n}=dc(t,e);e=n+r,e=dc(t,e).index;let{oid:i,index:s}=NA(t,e);switch(i){case"1.2.840.113549.1.1.4":return"MD5";case"1.2.840.113549.1.1.5":return"SHA-1";case"1.2.840.113549.1.1.11":return"SHA-256";case"1.2.840.113549.1.1.12":return"SHA-384";case"1.2.840.113549.1.1.13":return"SHA-512";case"1.2.840.113549.1.1.14":return"SHA-224";case"1.2.840.113549.1.1.15":return"SHA512-224";case"1.2.840.113549.1.1.16":return"SHA512-256";case"1.2.840.10045.4.1":return"SHA-1";case"1.2.840.10045.4.3.1":return"SHA-224";case"1.2.840.10045.4.3.2":return"SHA-256";case"1.2.840.10045.4.3.3":return"SHA-384";case"1.2.840.10045.4.3.4":return"SHA-512";case"1.2.840.113549.1.1.10":{if(e=s,e=dc(t,e).index,t[e++]!==160)throw ci("non-tag data",t);e=Qm(t,e).index,e=dc(t,e).index;let{oid:a}=NA(t,e);switch(a){case"1.2.840.113549.2.5":return"MD5";case"1.3.14.3.2.26":return"SHA-1";case"2.16.840.1.101.3.4.2.1":return"SHA-256";case"2.16.840.1.101.3.4.2.2":return"SHA-384";case"2.16.840.1.101.3.4.2.3":return"SHA-512"}throw ci("unknown hash OID "+a,t)}case"1.3.101.110":case"1.3.101.112":return"SHA-512";case"1.3.101.111":case"1.3.101.113":throw ci("Ed448 certificate channel binding is not currently supported by Postgres")}throw ci("unknown OID "+i,t)}RA.exports={signatureAlgorithmHashFromCertificate:cD}});var MA=v((Az,$A)=>{"use strict";var fn=zm(),{signatureAlgorithmHashFromCertificate:uD}=jA();function lD(t,e){let r=["SCRAM-SHA-256"];e&&r.unshift("SCRAM-SHA-256-PLUS");let n=r.find(a=>t.includes(a));if(!n)throw new Error("SASL: Only mechanism(s) "+r.join(" and ")+" are supported");if(n==="SCRAM-SHA-256-PLUS"&&typeof e.getPeerCertificate!="function")throw new Error("SASL: Mechanism SCRAM-SHA-256-PLUS requires a certificate");let i=fn.randomBytes(18).toString("base64");return{mechanism:n,clientNonce:i,response:(n==="SCRAM-SHA-256-PLUS"?"p=tls-server-end-point":e?"y":"n")+",,n=*,r="+i,message:"SASLInitialResponse"}}async function pD(t,e,r,n){if(t.message!=="SASLInitialResponse")throw new Error("SASL: Last message was not SASLInitialResponse");if(typeof e!="string")throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: client password must be a string");if(e==="")throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: client password must be a non-empty string");if(typeof r!="string")throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: serverData must be a string");let i=mD(r);if(i.nonce.startsWith(t.clientNonce)){if(i.nonce.length===t.clientNonce.length)throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: server nonce is too short")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: server nonce does not start with client nonce");let s="n=*,r="+t.clientNonce,a="r="+i.nonce+",s="+i.salt+",i="+i.iteration,o=n?"eSws":"biws";if(t.mechanism==="SCRAM-SHA-256-PLUS"){let w=n.getPeerCertificate().raw,A=uD(w);(A==="MD5"||A==="SHA-1")&&(A="SHA-256");let P=await fn.hashByName(A,w);o=Buffer.concat([Buffer.from("p=tls-server-end-point,,"),Buffer.from(P)]).toString("base64")}let u="c="+o+",r="+i.nonce,c=s+","+a+","+u,l=Buffer.from(i.salt,"base64"),p=await fn.deriveKey(e,l,i.iteration),d=await fn.hmacSha256(p,"Client Key"),f=await fn.sha256(d),h=await fn.hmacSha256(f,c),m=gD(Buffer.from(d),Buffer.from(h)).toString("base64"),x=await fn.hmacSha256(p,"Server Key"),_=await fn.hmacSha256(x,c);t.message="SASLResponse",t.serverSignature=Buffer.from(_).toString("base64"),t.response=u+",p="+m}function dD(t,e){if(t.message!=="SASLResponse")throw new Error("SASL: Last message was not SASLResponse");if(typeof e!="string")throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: serverData must be a string");let{serverSignature:r}=hD(e);if(r!==t.serverSignature)throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: server signature does not match")}function fD(t){if(typeof t!="string")throw new TypeError("SASL: text must be a string");return t.split("").map((e,r)=>t.charCodeAt(r)).every(e=>e>=33&&e<=43||e>=45&&e<=126)}function qA(t){return/^(?:[a-zA-Z0-9+/]{4})*(?:[a-zA-Z0-9+/]{2}==|[a-zA-Z0-9+/]{3}=)?$/.test(t)}function DA(t){if(typeof t!="string")throw new TypeError("SASL: attribute pairs text must be a string");return new Map(t.split(",").map(e=>{if(!/^.=/.test(e))throw new Error("SASL: Invalid attribute pair entry");let r=e[0],n=e.substring(2);return[r,n]}))}function mD(t){let e=DA(t),r=e.get("r");if(r){if(!fD(r))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: nonce must only contain printable characters")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: nonce missing");let n=e.get("s");if(n){if(!qA(n))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: salt must be base64")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: salt missing");let i=e.get("i");if(i){if(!/^[1-9][0-9]*$/.test(i))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: invalid iteration count")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: iteration missing");let s=parseInt(i,10);return{nonce:r,salt:n,iteration:s}}function hD(t){let r=DA(t).get("v");if(r){if(!qA(r))throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: server signature must be base64")}else throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: server signature is missing");return{serverSignature:r}}function gD(t,e){if(!Buffer.isBuffer(t))throw new TypeError("first argument must be a Buffer");if(!Buffer.isBuffer(e))throw new TypeError("second argument must be a Buffer");if(t.length!==e.length)throw new Error("Buffer lengths must match");if(t.length===0)throw new Error("Buffers cannot be empty");return Buffer.from(t.map((r,n)=>t[n]^e[n]))}$A.exports={startSession:lD,continueSession:pD,finalizeSession:dD}});var Cl=v((kz,FA)=>{"use strict";var vD=lc();function kl(t){this._types=t||vD,this.text={},this.binary={}}kl.prototype.getOverrides=function(t){switch(t){case"text":return this.text;case"binary":return this.binary;default:return{}}};kl.prototype.setTypeParser=function(t,e,r){typeof e=="function"&&(r=e,e="text"),this.getOverrides(e)[t]=r};kl.prototype.getTypeParser=function(t,e){return e=e||"text",this.getOverrides(e)[t]||this._types.getTypeParser(t,e)};FA.exports=kl});var UA=v((Cz,LA)=>{"use strict";function Bs(t,e={}){if(t.charAt(0)==="/"){let u=t.split(" ");return{host:u[0],database:u[1]}}let r={},n,i=!1;/ |%[^a-f0-9]|%[a-f0-9][^a-f0-9]/i.test(t)&&(t=encodeURI(t).replace(/%25(\d\d)/g,"%$1"));try{try{n=new URL(t,"postgres://base")}catch{n=new URL(t.replace("@/","@___DUMMY___/"),"postgres://base"),i=!0}}catch(u){u.input&&(u.input="*****REDACTED*****")}for(let u of n.searchParams.entries())r[u[0]]=u[1];if(r.user=r.user||decodeURIComponent(n.username),r.password=r.password||decodeURIComponent(n.password),n.protocol=="socket:")return r.host=decodeURI(n.pathname),r.database=n.searchParams.get("db"),r.client_encoding=n.searchParams.get("encoding"),r;let s=i?"":n.hostname;r.host?s&&/^%2f/i.test(s)&&(n.pathname=s+n.pathname):r.host=decodeURIComponent(s),r.port||(r.port=n.port);let a=n.pathname.slice(1)||null;r.database=a?decodeURI(a):null,(r.ssl==="true"||r.ssl==="1")&&(r.ssl=!0),r.ssl==="0"&&(r.ssl=!1),(r.sslcert||r.sslkey||r.sslrootcert||r.sslmode)&&(r.ssl={});let o=r.sslcert||r.sslkey||r.sslrootcert?require("fs"):null;if(r.sslcert&&(r.ssl.cert=o.readFileSync(r.sslcert).toString()),r.sslkey&&(r.ssl.key=o.readFileSync(r.sslkey).toString()),r.sslrootcert&&(r.ssl.ca=o.readFileSync(r.sslrootcert).toString()),e.useLibpqCompat&&r.uselibpqcompat)throw new Error("Both useLibpqCompat and uselibpqcompat are set. Please use only one of them.");if(r.uselibpqcompat==="true"||e.useLibpqCompat)switch(r.sslmode){case"disable":{r.ssl=!1;break}case"prefer":{r.ssl.rejectUnauthorized=!1;break}case"require":{r.sslrootcert?r.ssl.checkServerIdentity=function(){}:r.ssl.rejectUnauthorized=!1;break}case"verify-ca":{if(!r.ssl.ca)throw new Error("SECURITY WARNING: Using sslmode=verify-ca requires specifying a CA with sslrootcert. If a public CA is used, verify-ca allows connections to a server that somebody else may have registered with the CA, making you vulnerable to Man-in-the-Middle attacks. Either specify a custom CA certificate with sslrootcert parameter or use sslmode=verify-full for proper security.");r.ssl.checkServerIdentity=function(){};break}case"verify-full":break}else switch(r.sslmode){case"disable":{r.ssl=!1;break}case"prefer":case"require":case"verify-ca":case"verify-full":break;case"no-verify":{r.ssl.rejectUnauthorized=!1;break}}return r}function yD(t){return Object.entries(t).reduce((r,[n,i])=>(i!=null&&(r[n]=i),r),{})}function BA(t){return Object.entries(t).reduce((r,[n,i])=>{if(n==="ssl"){let s=i;typeof s=="boolean"&&(r[n]=s),typeof s=="object"&&(r[n]=yD(s))}else if(i!=null)if(n==="port"){if(i!==""){let s=parseInt(i,10);if(isNaN(s))throw new Error(`Invalid ${n}: ${i}`);r[n]=s}}else r[n]=i;return r},{})}function xD(t){return BA(Bs(t))}LA.exports=Bs;Bs.parse=Bs;Bs.toClientConfig=BA;Bs.parseIntoClientConfig=xD});var Vm=v((Tz,HA)=>{"use strict";var bD=require("dns"),QA=pc(),zA=UA().parse,vt=function(t,e,r){return r===void 0?r=process.env["PG"+t.toUpperCase()]:r===!1||(r=process.env[r]),e[t]||r||QA[t]},wD=function(){switch(process.env.PGSSLMODE){case"disable":return!1;case"prefer":case"require":case"verify-ca":case"verify-full":return!0;case"no-verify":return{rejectUnauthorized:!1}}return QA.ssl},Ls=function(t){return"'"+(""+t).replace(/\\/g,"\\\\").replace(/'/g,"\\'")+"'"},Zt=function(t,e,r){let n=e[r];n!=null&&t.push(r+"="+Ls(n))},Hm=class{constructor(e){e=typeof e=="string"?zA(e):e||{},e.connectionString&&(e=Object.assign({},e,zA(e.connectionString))),this.user=vt("user",e),this.database=vt("database",e),this.database===void 0&&(this.database=this.user),this.port=parseInt(vt("port",e),10),this.host=vt("host",e),Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:vt("password",e)}),this.binary=vt("binary",e),this.options=vt("options",e),this.ssl=typeof e.ssl>"u"?wD():e.ssl,typeof this.ssl=="string"&&this.ssl==="true"&&(this.ssl=!0),this.ssl==="no-verify"&&(this.ssl={rejectUnauthorized:!1}),this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this.client_encoding=vt("client_encoding",e),this.replication=vt("replication",e),this.isDomainSocket=!(this.host||"").indexOf("/"),this.application_name=vt("application_name",e,"PGAPPNAME"),this.fallback_application_name=vt("fallback_application_name",e,!1),this.statement_timeout=vt("statement_timeout",e,!1),this.lock_timeout=vt("lock_timeout",e,!1),this.idle_in_transaction_session_timeout=vt("idle_in_transaction_session_timeout",e,!1),this.query_timeout=vt("query_timeout",e,!1),e.connectionTimeoutMillis===void 0?this.connect_timeout=process.env.PGCONNECT_TIMEOUT||0:this.connect_timeout=Math.floor(e.connectionTimeoutMillis/1e3),e.keepAlive===!1?this.keepalives=0:e.keepAlive===!0&&(this.keepalives=1),typeof e.keepAliveInitialDelayMillis=="number"&&(this.keepalives_idle=Math.floor(e.keepAliveInitialDelayMillis/1e3))}getLibpqConnectionString(e){let r=[];Zt(r,this,"user"),Zt(r,this,"password"),Zt(r,this,"port"),Zt(r,this,"application_name"),Zt(r,this,"fallback_application_name"),Zt(r,this,"connect_timeout"),Zt(r,this,"options");let n=typeof this.ssl=="object"?this.ssl:this.ssl?{sslmode:this.ssl}:{};if(Zt(r,n,"sslmode"),Zt(r,n,"sslca"),Zt(r,n,"sslkey"),Zt(r,n,"sslcert"),Zt(r,n,"sslrootcert"),this.database&&r.push("dbname="+Ls(this.database)),this.replication&&r.push("replication="+Ls(this.replication)),this.host&&r.push("host="+Ls(this.host)),this.isDomainSocket)return e(null,r.join(" "));this.client_encoding&&r.push("client_encoding="+Ls(this.client_encoding)),bD.lookup(this.host,function(i,s){return i?e(i,null):(r.push("hostaddr="+Ls(s)),e(null,r.join(" ")))})}};HA.exports=Hm});var Gm=v((Pz,WA)=>{"use strict";var _D=lc(),VA=/^([A-Za-z]+)(?: (\d+))?(?: (\d+))?/,Wm=class{constructor(e,r){this.command=null,this.rowCount=null,this.oid=null,this.rows=[],this.fields=[],this._parsers=void 0,this._types=r,this.RowCtor=null,this.rowAsArray=e==="array",this.rowAsArray&&(this.parseRow=this._parseRowAsArray),this._prebuiltEmptyResultObject=null}addCommandComplete(e){let r;e.text?r=VA.exec(e.text):r=VA.exec(e.command),r&&(this.command=r[1],r[3]?(this.oid=parseInt(r[2],10),this.rowCount=parseInt(r[3],10)):r[2]&&(this.rowCount=parseInt(r[2],10)))}_parseRowAsArray(e){let r=new Array(e.length);for(let n=0,i=e.length;n<i;n++){let s=e[n];s!==null?r[n]=this._parsers[n](s):r[n]=null}return r}parseRow(e){let r={...this._prebuiltEmptyResultObject};for(let n=0,i=e.length;n<i;n++){let s=e[n],a=this.fields[n].name;if(s!==null){let o=this.fields[n].format==="binary"?Buffer.from(s):s;r[a]=this._parsers[n](o)}else r[a]=null}return r}addRow(e){this.rows.push(e)}addFields(e){this.fields=e,this.fields.length&&(this._parsers=new Array(e.length));let r={};for(let n=0;n<e.length;n++){let i=e[n];r[i.name]=null,this._types?this._parsers[n]=this._types.getTypeParser(i.dataTypeID,i.format||"text"):this._parsers[n]=_D.getTypeParser(i.dataTypeID,i.format||"text")}this._prebuiltEmptyResultObject={...r}}};WA.exports=Wm});var ZA=v((Iz,JA)=>{"use strict";var{EventEmitter:SD}=require("events"),GA=Gm(),KA=Ms(),Km=class extends SD{constructor(e,r,n){super(),e=KA.normalizeQueryConfig(e,r,n),this.text=e.text,this.values=e.values,this.rows=e.rows,this.types=e.types,this.name=e.name,this.queryMode=e.queryMode,this.binary=e.binary,this.portal=e.portal||"",this.callback=e.callback,this._rowMode=e.rowMode,process.domain&&e.callback&&(this.callback=process.domain.bind(e.callback)),this._result=new GA(this._rowMode,this.types),this._results=this._result,this._canceledDueToError=!1}requiresPreparation(){return this.queryMode==="extended"||this.name||this.rows?!0:!this.text||!this.values?!1:this.values.length>0}_checkForMultirow(){this._result.command&&(Array.isArray(this._results)||(this._results=[this._result]),this._result=new GA(this._rowMode,this._result._types),this._results.push(this._result))}handleRowDescription(e){this._checkForMultirow(),this._result.addFields(e.fields),this._accumulateRows=this.callback||!this.listeners("row").length}handleDataRow(e){let r;if(!this._canceledDueToError){try{r=this._result.parseRow(e.fields)}catch(n){this._canceledDueToError=n;return}this.emit("row",r,this._result),this._accumulateRows&&this._result.addRow(r)}}handleCommandComplete(e,r){this._checkForMultirow(),this._result.addCommandComplete(e),this.rows&&r.sync()}handleEmptyQuery(e){this.rows&&e.sync()}handleError(e,r){if(this._canceledDueToError&&(e=this._canceledDueToError,this._canceledDueToError=!1),this.callback)return this.callback(e);this.emit("error",e)}handleReadyForQuery(e){if(this._canceledDueToError)return this.handleError(this._canceledDueToError,e);if(this.callback)try{this.callback(null,this._results)}catch(r){process.nextTick(()=>{throw r})}this.emit("end",this._results)}submit(e){if(typeof this.text!="string"&&typeof this.name!="string")return new Error("A query must have either text or a name. Supplying neither is unsupported.");let r=e.parsedStatements[this.name];if(this.text&&r&&this.text!==r)return new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`);if(this.values&&!Array.isArray(this.values))return new Error("Query values must be an array");if(this.requiresPreparation()){e.stream.cork&&e.stream.cork();try{this.prepare(e)}finally{e.stream.uncork&&e.stream.uncork()}}else e.query(this.text);return null}hasBeenParsed(e){return this.name&&e.parsedStatements[this.name]}handlePortalSuspended(e){this._getRows(e,this.rows)}_getRows(e,r){e.execute({portal:this.portal,rows:r}),r?e.flush():e.sync()}prepare(e){this.hasBeenParsed(e)||e.parse({text:this.text,name:this.name,types:this.types});try{e.bind({portal:this.portal,statement:this.name,values:this.values,binary:this.binary,valueMapper:KA.prepareValue})}catch(r){this.handleError(r,e);return}e.describe({type:"P",name:this.portal||""}),this._getRows(e,this.rows)}handleCopyInResponse(e){e.sendCopyFail("No source stream defined")}handleCopyData(e,r){}};JA.exports=Km});var lh=v(V=>{"use strict";Object.defineProperty(V,"__esModule",{value:!0});V.NoticeMessage=V.DataRowMessage=V.CommandCompleteMessage=V.ReadyForQueryMessage=V.NotificationResponseMessage=V.BackendKeyDataMessage=V.AuthenticationMD5Password=V.ParameterStatusMessage=V.ParameterDescriptionMessage=V.RowDescriptionMessage=V.Field=V.CopyResponse=V.CopyDataMessage=V.DatabaseError=V.copyDone=V.emptyQuery=V.replicationStart=V.portalSuspended=V.noData=V.closeComplete=V.bindComplete=V.parseComplete=void 0;V.parseComplete={name:"parseComplete",length:5};V.bindComplete={name:"bindComplete",length:5};V.closeComplete={name:"closeComplete",length:5};V.noData={name:"noData",length:5};V.portalSuspended={name:"portalSuspended",length:5};V.replicationStart={name:"replicationStart",length:4};V.emptyQuery={name:"emptyQuery",length:4};V.copyDone={name:"copyDone",length:4};var Jm=class extends Error{constructor(e,r,n){super(e),this.length=r,this.name=n}};V.DatabaseError=Jm;var Zm=class{constructor(e,r){this.length=e,this.chunk=r,this.name="copyData"}};V.CopyDataMessage=Zm;var Xm=class{constructor(e,r,n,i){this.length=e,this.name=r,this.binary=n,this.columnTypes=new Array(i)}};V.CopyResponse=Xm;var Ym=class{constructor(e,r,n,i,s,a,o){this.name=e,this.tableID=r,this.columnID=n,this.dataTypeID=i,this.dataTypeSize=s,this.dataTypeModifier=a,this.format=o}};V.Field=Ym;var eh=class{constructor(e,r){this.length=e,this.fieldCount=r,this.name="rowDescription",this.fields=new Array(this.fieldCount)}};V.RowDescriptionMessage=eh;var th=class{constructor(e,r){this.length=e,this.parameterCount=r,this.name="parameterDescription",this.dataTypeIDs=new Array(this.parameterCount)}};V.ParameterDescriptionMessage=th;var rh=class{constructor(e,r,n){this.length=e,this.parameterName=r,this.parameterValue=n,this.name="parameterStatus"}};V.ParameterStatusMessage=rh;var nh=class{constructor(e,r){this.length=e,this.salt=r,this.name="authenticationMD5Password"}};V.AuthenticationMD5Password=nh;var ih=class{constructor(e,r,n){this.length=e,this.processID=r,this.secretKey=n,this.name="backendKeyData"}};V.BackendKeyDataMessage=ih;var sh=class{constructor(e,r,n,i){this.length=e,this.processId=r,this.channel=n,this.payload=i,this.name="notification"}};V.NotificationResponseMessage=sh;var ah=class{constructor(e,r){this.length=e,this.status=r,this.name="readyForQuery"}};V.ReadyForQueryMessage=ah;var oh=class{constructor(e,r){this.length=e,this.text=r,this.name="commandComplete"}};V.CommandCompleteMessage=oh;var ch=class{constructor(e,r){this.length=e,this.fields=r,this.name="dataRow",this.fieldCount=r.length}};V.DataRowMessage=ch;var uh=class{constructor(e,r){this.length=e,this.message=r,this.name="notice"}};V.NoticeMessage=uh});var XA=v(Tl=>{"use strict";Object.defineProperty(Tl,"__esModule",{value:!0});Tl.Writer=void 0;var ph=class{constructor(e=256){this.size=e,this.offset=5,this.headerPosition=0,this.buffer=Buffer.allocUnsafe(e)}ensure(e){if(this.buffer.length-this.offset<e){let n=this.buffer,i=n.length+(n.length>>1)+e;this.buffer=Buffer.allocUnsafe(i),n.copy(this.buffer)}}addInt32(e){return this.ensure(4),this.buffer[this.offset++]=e>>>24&255,this.buffer[this.offset++]=e>>>16&255,this.buffer[this.offset++]=e>>>8&255,this.buffer[this.offset++]=e>>>0&255,this}addInt16(e){return this.ensure(2),this.buffer[this.offset++]=e>>>8&255,this.buffer[this.offset++]=e>>>0&255,this}addCString(e){if(!e)this.ensure(1);else{let r=Buffer.byteLength(e);this.ensure(r+1),this.buffer.write(e,this.offset,"utf-8"),this.offset+=r}return this.buffer[this.offset++]=0,this}addString(e=""){let r=Buffer.byteLength(e);return this.ensure(r),this.buffer.write(e,this.offset),this.offset+=r,this}add(e){return this.ensure(e.length),e.copy(this.buffer,this.offset),this.offset+=e.length,this}join(e){if(e){this.buffer[this.headerPosition]=e;let r=this.offset-(this.headerPosition+1);this.buffer.writeInt32BE(r,this.headerPosition+1)}return this.buffer.slice(e?0:5,this.offset)}flush(e){let r=this.join(e);return this.offset=5,this.headerPosition=0,this.buffer=Buffer.allocUnsafe(this.size),r}};Tl.Writer=ph});var e8=v(Il=>{"use strict";Object.defineProperty(Il,"__esModule",{value:!0});Il.serialize=void 0;var dh=XA(),Ce=new dh.Writer,ED=t=>{Ce.addInt16(3).addInt16(0);for(let n of Object.keys(t))Ce.addCString(n).addCString(t[n]);Ce.addCString("client_encoding").addCString("UTF8");let e=Ce.addCString("").flush(),r=e.length+4;return new dh.Writer().addInt32(r).add(e).flush()},AD=()=>{let t=Buffer.allocUnsafe(8);return t.writeInt32BE(8,0),t.writeInt32BE(80877103,4),t},kD=t=>Ce.addCString(t).flush(112),CD=function(t,e){return Ce.addCString(t).addInt32(Buffer.byteLength(e)).addString(e),Ce.flush(112)},TD=function(t){return Ce.addString(t).flush(112)},PD=t=>Ce.addCString(t).flush(81),YA=[],ID=t=>{let e=t.name||"";e.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",e,e.length),console.error("This can cause conflicts and silent errors executing queries"));let r=t.types||YA,n=r.length,i=Ce.addCString(e).addCString(t.text).addInt16(n);for(let s=0;s<n;s++)i.addInt32(r[s]);return Ce.flush(80)},Us=new dh.Writer,OD=function(t,e){for(let r=0;r<t.length;r++){let n=e?e(t[r],r):t[r];n==null?(Ce.addInt16(0),Us.addInt32(-1)):n instanceof Buffer?(Ce.addInt16(1),Us.addInt32(n.length),Us.add(n)):(Ce.addInt16(0),Us.addInt32(Buffer.byteLength(n)),Us.addString(n))}},ND=(t={})=>{let e=t.portal||"",r=t.statement||"",n=t.binary||!1,i=t.values||YA,s=i.length;return Ce.addCString(e).addCString(r),Ce.addInt16(s),OD(i,t.valueMapper),Ce.addInt16(s),Ce.add(Us.flush()),Ce.addInt16(1),Ce.addInt16(n?1:0),Ce.flush(66)},RD=Buffer.from([69,0,0,0,9,0,0,0,0,0]),jD=t=>{if(!t||!t.portal&&!t.rows)return RD;let e=t.portal||"",r=t.rows||0,n=Buffer.byteLength(e),i=4+n+1+4,s=Buffer.allocUnsafe(1+i);return s[0]=69,s.writeInt32BE(i,1),s.write(e,5,"utf-8"),s[n+5]=0,s.writeUInt32BE(r,s.length-4),s},qD=(t,e)=>{let r=Buffer.allocUnsafe(16);return r.writeInt32BE(16,0),r.writeInt16BE(1234,4),r.writeInt16BE(5678,6),r.writeInt32BE(t,8),r.writeInt32BE(e,12),r},fh=(t,e)=>{let n=4+Buffer.byteLength(e)+1,i=Buffer.allocUnsafe(1+n);return i[0]=t,i.writeInt32BE(n,1),i.write(e,5,"utf-8"),i[n]=0,i},DD=Ce.addCString("P").flush(68),$D=Ce.addCString("S").flush(68),MD=t=>t.name?fh(68,`${t.type}${t.name||""}`):t.type==="P"?DD:$D,FD=t=>{let e=`${t.type}${t.name||""}`;return fh(67,e)},BD=t=>Ce.add(t).flush(100),LD=t=>fh(102,t),Pl=t=>Buffer.from([t,0,0,0,4]),UD=Pl(72),zD=Pl(83),QD=Pl(88),HD=Pl(99),VD={startup:ED,password:kD,requestSsl:AD,sendSASLInitialResponseMessage:CD,sendSCRAMClientFinalMessage:TD,query:PD,parse:ID,bind:ND,execute:jD,describe:MD,close:FD,flush:()=>UD,sync:()=>zD,end:()=>QD,copyData:BD,copyDone:()=>HD,copyFail:LD,cancel:qD};Il.serialize=VD});var t8=v(Ol=>{"use strict";Object.defineProperty(Ol,"__esModule",{value:!0});Ol.BufferReader=void 0;var WD=Buffer.allocUnsafe(0),mh=class{constructor(e=0){this.offset=e,this.buffer=WD,this.encoding="utf-8"}setBuffer(e,r){this.offset=e,this.buffer=r}int16(){let e=this.buffer.readInt16BE(this.offset);return this.offset+=2,e}byte(){let e=this.buffer[this.offset];return this.offset++,e}int32(){let e=this.buffer.readInt32BE(this.offset);return this.offset+=4,e}uint32(){let e=this.buffer.readUInt32BE(this.offset);return this.offset+=4,e}string(e){let r=this.buffer.toString(this.encoding,this.offset,this.offset+e);return this.offset+=e,r}cstring(){let e=this.offset,r=e;for(;this.buffer[r++]!==0;);return this.offset=r,this.buffer.toString(this.encoding,e,r-1)}bytes(e){let r=this.buffer.slice(this.offset,this.offset+e);return this.offset+=e,r}};Ol.BufferReader=mh});var i8=v(Nl=>{"use strict";Object.defineProperty(Nl,"__esModule",{value:!0});Nl.Parser=void 0;var Oe=lh(),GD=t8(),hh=1,KD=4,r8=hh+KD,n8=Buffer.allocUnsafe(0),gh=class{constructor(e){if(this.buffer=n8,this.bufferLength=0,this.bufferOffset=0,this.reader=new GD.BufferReader,e?.mode==="binary")throw new Error("Binary mode not supported yet");this.mode=e?.mode||"text"}parse(e,r){this.mergeBuffer(e);let n=this.bufferOffset+this.bufferLength,i=this.bufferOffset;for(;i+r8<=n;){let s=this.buffer[i],a=this.buffer.readUInt32BE(i+hh),o=hh+a;if(o+i<=n){let u=this.handlePacket(i+r8,s,a,this.buffer);r(u),i+=o}else break}i===n?(this.buffer=n8,this.bufferLength=0,this.bufferOffset=0):(this.bufferLength=n-i,this.bufferOffset=i)}mergeBuffer(e){if(this.bufferLength>0){let r=this.bufferLength+e.byteLength;if(r+this.bufferOffset>this.buffer.byteLength){let i;if(r<=this.buffer.byteLength&&this.bufferOffset>=this.bufferLength)i=this.buffer;else{let s=this.buffer.byteLength*2;for(;r>=s;)s*=2;i=Buffer.allocUnsafe(s)}this.buffer.copy(i,0,this.bufferOffset,this.bufferOffset+this.bufferLength),this.buffer=i,this.bufferOffset=0}e.copy(this.buffer,this.bufferOffset+this.bufferLength),this.bufferLength=r}else this.buffer=e,this.bufferOffset=0,this.bufferLength=e.byteLength}handlePacket(e,r,n,i){switch(r){case 50:return Oe.bindComplete;case 49:return Oe.parseComplete;case 51:return Oe.closeComplete;case 110:return Oe.noData;case 115:return Oe.portalSuspended;case 99:return Oe.copyDone;case 87:return Oe.replicationStart;case 73:return Oe.emptyQuery;case 68:return this.parseDataRowMessage(e,n,i);case 67:return this.parseCommandCompleteMessage(e,n,i);case 90:return this.parseReadyForQueryMessage(e,n,i);case 65:return this.parseNotificationMessage(e,n,i);case 82:return this.parseAuthenticationResponse(e,n,i);case 83:return this.parseParameterStatusMessage(e,n,i);case 75:return this.parseBackendKeyData(e,n,i);case 69:return this.parseErrorMessage(e,n,i,"error");case 78:return this.parseErrorMessage(e,n,i,"notice");case 84:return this.parseRowDescriptionMessage(e,n,i);case 116:return this.parseParameterDescriptionMessage(e,n,i);case 71:return this.parseCopyInMessage(e,n,i);case 72:return this.parseCopyOutMessage(e,n,i);case 100:return this.parseCopyData(e,n,i);default:return new Oe.DatabaseError("received invalid response: "+r.toString(16),n,"error")}}parseReadyForQueryMessage(e,r,n){this.reader.setBuffer(e,n);let i=this.reader.string(1);return new Oe.ReadyForQueryMessage(r,i)}parseCommandCompleteMessage(e,r,n){this.reader.setBuffer(e,n);let i=this.reader.cstring();return new Oe.CommandCompleteMessage(r,i)}parseCopyData(e,r,n){let i=n.slice(e,e+(r-4));return new Oe.CopyDataMessage(r,i)}parseCopyInMessage(e,r,n){return this.parseCopyMessage(e,r,n,"copyInResponse")}parseCopyOutMessage(e,r,n){return this.parseCopyMessage(e,r,n,"copyOutResponse")}parseCopyMessage(e,r,n,i){this.reader.setBuffer(e,n);let s=this.reader.byte()!==0,a=this.reader.int16(),o=new Oe.CopyResponse(r,i,s,a);for(let u=0;u<a;u++)o.columnTypes[u]=this.reader.int16();return o}parseNotificationMessage(e,r,n){this.reader.setBuffer(e,n);let i=this.reader.int32(),s=this.reader.cstring(),a=this.reader.cstring();return new Oe.NotificationResponseMessage(r,i,s,a)}parseRowDescriptionMessage(e,r,n){this.reader.setBuffer(e,n);let i=this.reader.int16(),s=new Oe.RowDescriptionMessage(r,i);for(let a=0;a<i;a++)s.fields[a]=this.parseField();return s}parseField(){let e=this.reader.cstring(),r=this.reader.uint32(),n=this.reader.int16(),i=this.reader.uint32(),s=this.reader.int16(),a=this.reader.int32(),o=this.reader.int16()===0?"text":"binary";return new Oe.Field(e,r,n,i,s,a,o)}parseParameterDescriptionMessage(e,r,n){this.reader.setBuffer(e,n);let i=this.reader.int16(),s=new Oe.ParameterDescriptionMessage(r,i);for(let a=0;a<i;a++)s.dataTypeIDs[a]=this.reader.int32();return s}parseDataRowMessage(e,r,n){this.reader.setBuffer(e,n);let i=this.reader.int16(),s=new Array(i);for(let a=0;a<i;a++){let o=this.reader.int32();s[a]=o===-1?null:this.reader.string(o)}return new Oe.DataRowMessage(r,s)}parseParameterStatusMessage(e,r,n){this.reader.setBuffer(e,n);let i=this.reader.cstring(),s=this.reader.cstring();return new Oe.ParameterStatusMessage(r,i,s)}parseBackendKeyData(e,r,n){this.reader.setBuffer(e,n);let i=this.reader.int32(),s=this.reader.int32();return new Oe.BackendKeyDataMessage(r,i,s)}parseAuthenticationResponse(e,r,n){this.reader.setBuffer(e,n);let i=this.reader.int32(),s={name:"authenticationOk",length:r};switch(i){case 0:break;case 3:s.length===8&&(s.name="authenticationCleartextPassword");break;case 5:if(s.length===12){s.name="authenticationMD5Password";let a=this.reader.bytes(4);return new Oe.AuthenticationMD5Password(r,a)}break;case 10:{s.name="authenticationSASL",s.mechanisms=[];let a;do a=this.reader.cstring(),a&&s.mechanisms.push(a);while(a)}break;case 11:s.name="authenticationSASLContinue",s.data=this.reader.string(r-8);break;case 12:s.name="authenticationSASLFinal",s.data=this.reader.string(r-8);break;default:throw new Error("Unknown authenticationOk message type "+i)}return s}parseErrorMessage(e,r,n,i){this.reader.setBuffer(e,n);let s={},a=this.reader.string(1);for(;a!=="\0";)s[a]=this.reader.cstring(),a=this.reader.string(1);let o=s.M,u=i==="notice"?new Oe.NoticeMessage(r,o):new Oe.DatabaseError(o,r,i);return u.severity=s.S,u.code=s.C,u.detail=s.D,u.hint=s.H,u.position=s.P,u.internalPosition=s.p,u.internalQuery=s.q,u.where=s.W,u.schema=s.s,u.table=s.t,u.column=s.c,u.dataType=s.d,u.constraint=s.n,u.file=s.F,u.line=s.L,u.routine=s.R,u}};Nl.Parser=gh});var vh=v(mn=>{"use strict";Object.defineProperty(mn,"__esModule",{value:!0});mn.DatabaseError=mn.serialize=mn.parse=void 0;var JD=lh();Object.defineProperty(mn,"DatabaseError",{enumerable:!0,get:function(){return JD.DatabaseError}});var ZD=e8();Object.defineProperty(mn,"serialize",{enumerable:!0,get:function(){return ZD.serialize}});var XD=i8();function YD(t,e){let r=new XD.Parser;return t.on("data",n=>r.parse(n,e)),new Promise(n=>t.on("end",()=>n()))}mn.parse=YD});var s8=v(yh=>{"use strict";Object.defineProperty(yh,"__esModule",{value:!0});yh.default={}});var o8=v((Mz,a8)=>{var{getStream:e$,getSecureStream:t$}=s$();a8.exports={getStream:e$,getSecureStream:t$};function r$(){function t(r){let n=require("net");return new n.Socket}function e(r){return require("tls").connect(r)}return{getStream:t,getSecureStream:e}}function n$(){function t(r){let{CloudflareSocket:n}=s8();return new n(r)}function e(r){return r.socket.startTls(r),r.socket}return{getStream:t,getSecureStream:e}}function i$(){if(typeof navigator=="object"&&navigator!==null&&typeof navigator.userAgent=="string")return navigator.userAgent==="Cloudflare-Workers";if(typeof Response=="function"){let t=new Response(null,{cf:{thing:!0}});if(typeof t.cf=="object"&&t.cf!==null&&t.cf.thing)return!0}return!1}function s$(){return i$()?n$():r$()}});var bh=v((Fz,c8)=>{"use strict";var a$=require("events").EventEmitter,{parse:o$,serialize:Ye}=vh(),{getStream:c$,getSecureStream:u$}=o8(),l$=Ye.flush(),p$=Ye.sync(),d$=Ye.end(),xh=class extends a${constructor(e){super(),e=e||{},this.stream=e.stream||c$(e.ssl),typeof this.stream=="function"&&(this.stream=this.stream(e)),this._keepAlive=e.keepAlive,this._keepAliveInitialDelayMillis=e.keepAliveInitialDelayMillis,this.lastBuffer=!1,this.parsedStatements={},this.ssl=e.ssl||!1,this._ending=!1,this._emitMessage=!1;let r=this;this.on("newListener",function(n){n==="message"&&(r._emitMessage=!0)})}connect(e,r){let n=this;this._connecting=!0,this.stream.setNoDelay(!0),this.stream.connect(e,r),this.stream.once("connect",function(){n._keepAlive&&n.stream.setKeepAlive(!0,n._keepAliveInitialDelayMillis),n.emit("connect")});let i=function(s){n._ending&&(s.code==="ECONNRESET"||s.code==="EPIPE")||n.emit("error",s)};if(this.stream.on("error",i),this.stream.on("close",function(){n.emit("end")}),!this.ssl)return this.attachListeners(this.stream);this.stream.once("data",function(s){switch(s.toString("utf8")){case"S":break;case"N":return n.stream.end(),n.emit("error",new Error("The server does not support SSL connections"));default:return n.stream.end(),n.emit("error",new Error("There was an error establishing an SSL connection"))}let o={socket:n.stream};n.ssl!==!0&&(Object.assign(o,n.ssl),"key"in n.ssl&&(o.key=n.ssl.key));let u=require("net");u.isIP&&u.isIP(r)===0&&(o.servername=r);try{n.stream=u$(o)}catch(c){return n.emit("error",c)}n.attachListeners(n.stream),n.stream.on("error",i),n.emit("sslconnect")})}attachListeners(e){o$(e,r=>{let n=r.name==="error"?"errorMessage":r.name;this._emitMessage&&this.emit("message",r),this.emit(n,r)})}requestSsl(){this.stream.write(Ye.requestSsl())}startup(e){this.stream.write(Ye.startup(e))}cancel(e,r){this._send(Ye.cancel(e,r))}password(e){this._send(Ye.password(e))}sendSASLInitialResponseMessage(e,r){this._send(Ye.sendSASLInitialResponseMessage(e,r))}sendSCRAMClientFinalMessage(e){this._send(Ye.sendSCRAMClientFinalMessage(e))}_send(e){return this.stream.writable?this.stream.write(e):!1}query(e){this._send(Ye.query(e))}parse(e){this._send(Ye.parse(e))}bind(e){this._send(Ye.bind(e))}execute(e){this._send(Ye.execute(e))}flush(){this.stream.writable&&this.stream.write(l$)}sync(){this._ending=!0,this._send(p$)}ref(){this.stream.ref()}unref(){this.stream.unref()}end(){if(this._ending=!0,!this._connecting||!this.stream.writable){this.stream.end();return}return this.stream.write(d$,()=>{this.stream.end()})}close(e){this._send(Ye.close(e))}describe(e){this._send(Ye.describe(e))}sendCopyFromChunk(e){this._send(Ye.copyData(e))}endCopyFrom(){this._send(Ye.copyDone())}sendCopyFail(e){this._send(Ye.copyFail(e))}};c8.exports=xh});var d8=v((Bz,p8)=>{"use strict";var{Transform:f$}=require("stream"),{StringDecoder:m$}=require("string_decoder"),hn=Symbol("last"),Rl=Symbol("decoder");function h$(t,e,r){let n;if(this.overflow){if(n=this[Rl].write(t).split(this.matcher),n.length===1)return r();n.shift(),this.overflow=!1}else this[hn]+=this[Rl].write(t),n=this[hn].split(this.matcher);this[hn]=n.pop();for(let i=0;i<n.length;i++)try{l8(this,this.mapper(n[i]))}catch(s){return r(s)}if(this.overflow=this[hn].length>this.maxLength,this.overflow&&!this.skipOverflow){r(new Error("maximum buffer reached"));return}r()}function g$(t){if(this[hn]+=this[Rl].end(),this[hn])try{l8(this,this.mapper(this[hn]))}catch(e){return t(e)}t()}function l8(t,e){e!==void 0&&t.push(e)}function u8(t){return t}function v$(t,e,r){switch(t=t||/\r?\n/,e=e||u8,r=r||{},arguments.length){case 1:typeof t=="function"?(e=t,t=/\r?\n/):typeof t=="object"&&!(t instanceof RegExp)&&!t[Symbol.split]&&(r=t,t=/\r?\n/);break;case 2:typeof t=="function"?(r=e,e=t,t=/\r?\n/):typeof e=="object"&&(r=e,e=u8)}r=Object.assign({},r),r.autoDestroy=!0,r.transform=h$,r.flush=g$,r.readableObjectMode=!0;let n=new f$(r);return n[hn]="",n[Rl]=new m$("utf8"),n.matcher=t,n.mapper=e,n.maxLength=r.maxLength,n.skipOverflow=r.skipOverflow||!1,n.overflow=!1,n._destroy=function(i,s){this._writableState.errorEmitted=!1,s(i)},n}p8.exports=v$});var h8=v((Lz,Fr)=>{"use strict";var f8=require("path"),y$=require("stream").Stream,x$=d8(),m8=require("util"),b$=5432,jl=process.platform==="win32",fc=process.stderr,w$=56,_$=7,S$=61440,E$=32768;function A$(t){return(t&S$)==E$}var zs=["host","port","database","user","password"],wh=zs.length,k$=zs[wh-1];function _h(){var t=fc instanceof y$&&fc.writable===!0;if(t){var e=Array.prototype.slice.call(arguments).concat(`
    70  `);fc.write(m8.format.apply(m8,e))}}Object.defineProperty(Fr.exports,"isWin",{get:function(){return jl},set:function(t){jl=t}});Fr.exports.warnTo=function(t){var e=fc;return fc=t,e};Fr.exports.getFileName=function(t){var e=t||process.env,r=e.PGPASSFILE||(jl?f8.join(e.APPDATA||"./","postgresql","pgpass.conf"):f8.join(e.HOME||"./",".pgpass"));return r};Fr.exports.usePgPass=function(t,e){return Object.prototype.hasOwnProperty.call(process.env,"PGPASSWORD")?!1:jl?!0:(e=e||"<unkn>",A$(t.mode)?t.mode&(w$|_$)?(_h('WARNING: password file "%s" has group or world access; permissions should be u=rw (0600) or less',e),!1):!0:(_h('WARNING: password file "%s" is not a plain file',e),!1))};var C$=Fr.exports.match=function(t,e){return zs.slice(0,-1).reduce(function(r,n,i){return i==1&&Number(t[n]||b$)===Number(e[n])?r&&!0:r&&(e[n]==="*"||e[n]===t[n])},!0)};Fr.exports.getPassword=function(t,e,r){var n,i=e.pipe(x$());function s(u){var c=T$(u);c&&P$(c)&&C$(t,c)&&(n=c[k$],i.end())}var a=function(){e.destroy(),r(n)},o=function(u){e.destroy(),_h("WARNING: error on reading file: %s",u),r(void 0)};e.on("error",o),i.on("data",s).on("end",a).on("error",o)};var T$=Fr.exports.parseLine=function(t){if(t.length<11||t.match(/^\s+#/))return null;for(var e="",r="",n=0,i=0,s=0,a={},o=!1,u=function(l,p,d){var f=t.substring(p,d);Object.hasOwnProperty.call(process.env,"PGPASS_NO_DEESCAPE")||(f=f.replace(/\\([:\\])/g,"$1")),a[zs[l]]=f},c=0;c<t.length-1;c+=1){if(e=t.charAt(c+1),r=t.charAt(c),o=n==wh-1,o){u(n,i);break}c>=0&&e==":"&&r!=="\\"&&(u(n,i,c+1),i=c+2,n+=1)}return a=Object.keys(a).length===wh?a:null,a},P$=Fr.exports.isValidEntry=function(t){for(var e={0:function(a){return a.length>0},1:function(a){return a==="*"?!0:(a=Number(a),isFinite(a)&&a>0&&a<9007199254740992&&Math.floor(a)===a)},2:function(a){return a.length>0},3:function(a){return a.length>0},4:function(a){return a.length>0}},r=0;r<zs.length;r+=1){var n=e[r],i=t[zs[r]]||"",s=n(i);if(!s)return!1}return!0}});var v8=v((zz,Sh)=>{"use strict";var Uz=require("path"),g8=require("fs"),ql=h8();Sh.exports=function(t,e){var r=ql.getFileName();g8.stat(r,function(n,i){if(n||!ql.usePgPass(i,r))return e(void 0);var s=g8.createReadStream(r);ql.getPassword(t,s,e)})};Sh.exports.warnTo=ql.warnTo});var w8=v((Qz,b8)=>{"use strict";var I$=require("events").EventEmitter,y8=Ms(),Eh=MA(),O$=Cl(),N$=Vm(),x8=ZA(),R$=pc(),j$=bh(),q$=zm(),Dl=class extends I${constructor(e){super(),this.connectionParameters=new N$(e),this.user=this.connectionParameters.user,this.database=this.connectionParameters.database,this.port=this.connectionParameters.port,this.host=this.connectionParameters.host,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:this.connectionParameters.password}),this.replication=this.connectionParameters.replication;let r=e||{};this._Promise=r.Promise||global.Promise,this._types=new O$(r.types),this._ending=!1,this._ended=!1,this._connecting=!1,this._connected=!1,this._connectionError=!1,this._queryable=!0,this.enableChannelBinding=!!r.enableChannelBinding,this.connection=r.connection||new j$({stream:r.stream,ssl:this.connectionParameters.ssl,keepAlive:r.keepAlive||!1,keepAliveInitialDelayMillis:r.keepAliveInitialDelayMillis||0,encoding:this.connectionParameters.client_encoding||"utf8"}),this.queryQueue=[],this.binary=r.binary||R$.binary,this.processID=null,this.secretKey=null,this.ssl=this.connectionParameters.ssl||!1,this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this._connectionTimeoutMillis=r.connectionTimeoutMillis||0}_errorAllQueries(e){let r=n=>{process.nextTick(()=>{n.handleError(e,this.connection)})};this.activeQuery&&(r(this.activeQuery),this.activeQuery=null),this.queryQueue.forEach(r),this.queryQueue.length=0}_connect(e){let r=this,n=this.connection;if(this._connectionCallback=e,this._connecting||this._connected){let i=new Error("Client has already been connected. You cannot reuse a client.");process.nextTick(()=>{e(i)});return}this._connecting=!0,this._connectionTimeoutMillis>0&&(this.connectionTimeoutHandle=setTimeout(()=>{n._ending=!0,n.stream.destroy(new Error("timeout expired"))},this._connectionTimeoutMillis),this.connectionTimeoutHandle.unref&&this.connectionTimeoutHandle.unref()),this.host&&this.host.indexOf("/")===0?n.connect(this.host+"/.s.PGSQL."+this.port):n.connect(this.port,this.host),n.on("connect",function(){r.ssl?n.requestSsl():n.startup(r.getStartupConf())}),n.on("sslconnect",function(){n.startup(r.getStartupConf())}),this._attachListeners(n),n.once("end",()=>{let i=this._ending?new Error("Connection terminated"):new Error("Connection terminated unexpectedly");clearTimeout(this.connectionTimeoutHandle),this._errorAllQueries(i),this._ended=!0,this._ending||(this._connecting&&!this._connectionError?this._connectionCallback?this._connectionCallback(i):this._handleErrorEvent(i):this._connectionError||this._handleErrorEvent(i)),process.nextTick(()=>{this.emit("end")})})}connect(e){if(e){this._connect(e);return}return new this._Promise((r,n)=>{this._connect(i=>{i?n(i):r()})})}_attachListeners(e){e.on("authenticationCleartextPassword",this._handleAuthCleartextPassword.bind(this)),e.on("authenticationMD5Password",this._handleAuthMD5Password.bind(this)),e.on("authenticationSASL",this._handleAuthSASL.bind(this)),e.on("authenticationSASLContinue",this._handleAuthSASLContinue.bind(this)),e.on("authenticationSASLFinal",this._handleAuthSASLFinal.bind(this)),e.on("backendKeyData",this._handleBackendKeyData.bind(this)),e.on("error",this._handleErrorEvent.bind(this)),e.on("errorMessage",this._handleErrorMessage.bind(this)),e.on("readyForQuery",this._handleReadyForQuery.bind(this)),e.on("notice",this._handleNotice.bind(this)),e.on("rowDescription",this._handleRowDescription.bind(this)),e.on("dataRow",this._handleDataRow.bind(this)),e.on("portalSuspended",this._handlePortalSuspended.bind(this)),e.on("emptyQuery",this._handleEmptyQuery.bind(this)),e.on("commandComplete",this._handleCommandComplete.bind(this)),e.on("parseComplete",this._handleParseComplete.bind(this)),e.on("copyInResponse",this._handleCopyInResponse.bind(this)),e.on("copyData",this._handleCopyData.bind(this)),e.on("notification",this._handleNotification.bind(this))}_checkPgPass(e){let r=this.connection;if(typeof this.password=="function")this._Promise.resolve().then(()=>this.password()).then(n=>{if(n!==void 0){if(typeof n!="string"){r.emit("error",new TypeError("Password must be a string"));return}this.connectionParameters.password=this.password=n}else this.connectionParameters.password=this.password=null;e()}).catch(n=>{r.emit("error",n)});else if(this.password!==null)e();else try{v8()(this.connectionParameters,i=>{i!==void 0&&(this.connectionParameters.password=this.password=i),e()})}catch(n){this.emit("error",n)}}_handleAuthCleartextPassword(e){this._checkPgPass(()=>{this.connection.password(this.password)})}_handleAuthMD5Password(e){this._checkPgPass(async()=>{try{let r=await q$.postgresMd5PasswordHash(this.user,this.password,e.salt);this.connection.password(r)}catch(r){this.emit("error",r)}})}_handleAuthSASL(e){this._checkPgPass(()=>{try{this.saslSession=Eh.startSession(e.mechanisms,this.enableChannelBinding&&this.connection.stream),this.connection.sendSASLInitialResponseMessage(this.saslSession.mechanism,this.saslSession.response)}catch(r){this.connection.emit("error",r)}})}async _handleAuthSASLContinue(e){try{await Eh.continueSession(this.saslSession,this.password,e.data,this.enableChannelBinding&&this.connection.stream),this.connection.sendSCRAMClientFinalMessage(this.saslSession.response)}catch(r){this.connection.emit("error",r)}}_handleAuthSASLFinal(e){try{Eh.finalizeSession(this.saslSession,e.data),this.saslSession=null}catch(r){this.connection.emit("error",r)}}_handleBackendKeyData(e){this.processID=e.processID,this.secretKey=e.secretKey}_handleReadyForQuery(e){this._connecting&&(this._connecting=!1,this._connected=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback&&(this._connectionCallback(null,this),this._connectionCallback=null),this.emit("connect"));let{activeQuery:r}=this;this.activeQuery=null,this.readyForQuery=!0,r&&r.handleReadyForQuery(this.connection),this._pulseQueryQueue()}_handleErrorWhileConnecting(e){if(!this._connectionError){if(this._connectionError=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback)return this._connectionCallback(e);this.emit("error",e)}}_handleErrorEvent(e){if(this._connecting)return this._handleErrorWhileConnecting(e);this._queryable=!1,this._errorAllQueries(e),this.emit("error",e)}_handleErrorMessage(e){if(this._connecting)return this._handleErrorWhileConnecting(e);let r=this.activeQuery;if(!r){this._handleErrorEvent(e);return}this.activeQuery=null,r.handleError(e,this.connection)}_handleRowDescription(e){this.activeQuery.handleRowDescription(e)}_handleDataRow(e){this.activeQuery.handleDataRow(e)}_handlePortalSuspended(e){this.activeQuery.handlePortalSuspended(this.connection)}_handleEmptyQuery(e){this.activeQuery.handleEmptyQuery(this.connection)}_handleCommandComplete(e){if(this.activeQuery==null){let r=new Error("Received unexpected commandComplete message from backend.");this._handleErrorEvent(r);return}this.activeQuery.handleCommandComplete(e,this.connection)}_handleParseComplete(){if(this.activeQuery==null){let e=new Error("Received unexpected parseComplete message from backend.");this._handleErrorEvent(e);return}this.activeQuery.name&&(this.connection.parsedStatements[this.activeQuery.name]=this.activeQuery.text)}_handleCopyInResponse(e){this.activeQuery.handleCopyInResponse(this.connection)}_handleCopyData(e){this.activeQuery.handleCopyData(e,this.connection)}_handleNotification(e){this.emit("notification",e)}_handleNotice(e){this.emit("notice",e)}getStartupConf(){let e=this.connectionParameters,r={user:e.user,database:e.database},n=e.application_name||e.fallback_application_name;return n&&(r.application_name=n),e.replication&&(r.replication=""+e.replication),e.statement_timeout&&(r.statement_timeout=String(parseInt(e.statement_timeout,10))),e.lock_timeout&&(r.lock_timeout=String(parseInt(e.lock_timeout,10))),e.idle_in_transaction_session_timeout&&(r.idle_in_transaction_session_timeout=String(parseInt(e.idle_in_transaction_session_timeout,10))),e.options&&(r.options=e.options),r}cancel(e,r){if(e.activeQuery===r){let n=this.connection;this.host&&this.host.indexOf("/")===0?n.connect(this.host+"/.s.PGSQL."+this.port):n.connect(this.port,this.host),n.on("connect",function(){n.cancel(e.processID,e.secretKey)})}else e.queryQueue.indexOf(r)!==-1&&e.queryQueue.splice(e.queryQueue.indexOf(r),1)}setTypeParser(e,r,n){return this._types.setTypeParser(e,r,n)}getTypeParser(e,r){return this._types.getTypeParser(e,r)}escapeIdentifier(e){return y8.escapeIdentifier(e)}escapeLiteral(e){return y8.escapeLiteral(e)}_pulseQueryQueue(){if(this.readyForQuery===!0)if(this.activeQuery=this.queryQueue.shift(),this.activeQuery){this.readyForQuery=!1,this.hasExecuted=!0;let e=this.activeQuery.submit(this.connection);e&&process.nextTick(()=>{this.activeQuery.handleError(e,this.connection),this.readyForQuery=!0,this._pulseQueryQueue()})}else this.hasExecuted&&(this.activeQuery=null,this.emit("drain"))}query(e,r,n){let i,s,a,o,u;if(e==null)throw new TypeError("Client was passed a null or undefined query");return typeof e.submit=="function"?(a=e.query_timeout||this.connectionParameters.query_timeout,s=i=e,typeof r=="function"&&(i.callback=i.callback||r)):(a=e.query_timeout||this.connectionParameters.query_timeout,i=new x8(e,r,n),i.callback||(s=new this._Promise((c,l)=>{i.callback=(p,d)=>p?l(p):c(d)}).catch(c=>{throw Error.captureStackTrace(c),c}))),a&&(u=i.callback,o=setTimeout(()=>{let c=new Error("Query read timeout");process.nextTick(()=>{i.handleError(c,this.connection)}),u(c),i.callback=()=>{};let l=this.queryQueue.indexOf(i);l>-1&&this.queryQueue.splice(l,1),this._pulseQueryQueue()},a),i.callback=(c,l)=>{clearTimeout(o),u(c,l)}),this.binary&&!i.binary&&(i.binary=!0),i._result&&!i._result._types&&(i._result._types=this._types),this._queryable?this._ending?(process.nextTick(()=>{i.handleError(new Error("Client was closed and is not queryable"),this.connection)}),s):(this.queryQueue.push(i),this._pulseQueryQueue(),s):(process.nextTick(()=>{i.handleError(new Error("Client has encountered a connection error and is not queryable"),this.connection)}),s)}ref(){this.connection.ref()}unref(){this.connection.unref()}end(e){if(this._ending=!0,!this.connection._connecting||this._ended)if(e)e();else return this._Promise.resolve();if(this.activeQuery||!this._queryable?this.connection.stream.destroy():this.connection.end(),e)this.connection.once("end",e);else return new this._Promise(r=>{this.connection.once("end",r)})}};Dl.Query=x8;b8.exports=Dl});var A8=v((Hz,E8)=>{"use strict";var D$=require("events").EventEmitter,_8=function(){},S8=(t,e)=>{let r=t.findIndex(e);return r===-1?void 0:t.splice(r,1)[0]},Ah=class{constructor(e,r,n){this.client=e,this.idleListener=r,this.timeoutId=n}},Qs=class{constructor(e){this.callback=e}};function $$(){throw new Error("Release called on client which has already been released to the pool.")}function $l(t,e){if(e)return{callback:e,result:void 0};let r,n,i=function(a,o){a?r(a):n(o)},s=new t(function(a,o){n=a,r=o}).catch(a=>{throw Error.captureStackTrace(a),a});return{callback:i,result:s}}function M$(t,e){return function r(n){n.client=e,e.removeListener("error",r),e.on("error",()=>{t.log("additional client error after disconnection due to error",n)}),t._remove(e),t.emit("error",n,e)}}var kh=class extends D${constructor(e,r){super(),this.options=Object.assign({},e),e!=null&&"password"in e&&Object.defineProperty(this.options,"password",{configurable:!0,enumerable:!1,writable:!0,value:e.password}),e!=null&&e.ssl&&e.ssl.key&&Object.defineProperty(this.options.ssl,"key",{enumerable:!1}),this.options.max=this.options.max||this.options.poolSize||10,this.options.min=this.options.min||0,this.options.maxUses=this.options.maxUses||1/0,this.options.allowExitOnIdle=this.options.allowExitOnIdle||!1,this.options.maxLifetimeSeconds=this.options.maxLifetimeSeconds||0,this.log=this.options.log||function(){},this.Client=this.options.Client||r||Ml().Client,this.Promise=this.options.Promise||global.Promise,typeof this.options.idleTimeoutMillis>"u"&&(this.options.idleTimeoutMillis=1e4),this._clients=[],this._idle=[],this._expired=new WeakSet,this._pendingQueue=[],this._endCallback=void 0,this.ending=!1,this.ended=!1}_isFull(){return this._clients.length>=this.options.max}_isAboveMin(){return this._clients.length>this.options.min}_pulseQueue(){if(this.log("pulse queue"),this.ended){this.log("pulse queue ended");return}if(this.ending){this.log("pulse queue on ending"),this._idle.length&&this._idle.slice().map(r=>{this._remove(r.client)}),this._clients.length||(this.ended=!0,this._endCallback());return}if(!this._pendingQueue.length){this.log("no queued requests");return}if(!this._idle.length&&this._isFull())return;let e=this._pendingQueue.shift();if(this._idle.length){let r=this._idle.pop();clearTimeout(r.timeoutId);let n=r.client;n.ref&&n.ref();let i=r.idleListener;return this._acquireClient(n,e,i,!1)}if(!this._isFull())return this.newClient(e);throw new Error("unexpected condition")}_remove(e,r){let n=S8(this._idle,s=>s.client===e);n!==void 0&&clearTimeout(n.timeoutId),this._clients=this._clients.filter(s=>s!==e);let i=this;e.end(()=>{i.emit("remove",e),typeof r=="function"&&r()})}connect(e){if(this.ending){let i=new Error("Cannot use a pool after calling end on the pool");return e?e(i):this.Promise.reject(i)}let r=$l(this.Promise,e),n=r.result;if(this._isFull()||this._idle.length){if(this._idle.length&&process.nextTick(()=>this._pulseQueue()),!this.options.connectionTimeoutMillis)return this._pendingQueue.push(new Qs(r.callback)),n;let i=(o,u,c)=>{clearTimeout(a),r.callback(o,u,c)},s=new Qs(i),a=setTimeout(()=>{S8(this._pendingQueue,o=>o.callback===i),s.timedOut=!0,r.callback(new Error("timeout exceeded when trying to connect"))},this.options.connectionTimeoutMillis);return a.unref&&a.unref(),this._pendingQueue.push(s),n}return this.newClient(new Qs(r.callback)),n}newClient(e){let r=new this.Client(this.options);this._clients.push(r);let n=M$(this,r);this.log("checking client timeout");let i,s=!1;this.options.connectionTimeoutMillis&&(i=setTimeout(()=>{this.log("ending client due to timeout"),s=!0,r.connection?r.connection.stream.destroy():r.end()},this.options.connectionTimeoutMillis)),this.log("connecting new client"),r.connect(a=>{if(i&&clearTimeout(i),r.on("error",n),a)this.log("client failed to connect",a),this._clients=this._clients.filter(o=>o!==r),s&&(a=new Error("Connection terminated due to connection timeout",{cause:a})),this._pulseQueue(),e.timedOut||e.callback(a,void 0,_8);else{if(this.log("new client connected"),this.options.maxLifetimeSeconds!==0){let o=setTimeout(()=>{this.log("ending client due to expired lifetime"),this._expired.add(r),this._idle.findIndex(c=>c.client===r)!==-1&&this._acquireClient(r,new Qs((c,l,p)=>p()),n,!1)},this.options.maxLifetimeSeconds*1e3);o.unref(),r.once("end",()=>clearTimeout(o))}return this._acquireClient(r,e,n,!0)}})}_acquireClient(e,r,n,i){i&&this.emit("connect",e),this.emit("acquire",e),e.release=this._releaseOnce(e,n),e.removeListener("error",n),r.timedOut?i&&this.options.verify?this.options.verify(e,e.release):e.release():i&&this.options.verify?this.options.verify(e,s=>{if(s)return e.release(s),r.callback(s,void 0,_8);r.callback(void 0,e,e.release)}):r.callback(void 0,e,e.release)}_releaseOnce(e,r){let n=!1;return i=>{n&&$$(),n=!0,this._release(e,r,i)}}_release(e,r,n){if(e.on("error",r),e._poolUseCount=(e._poolUseCount||0)+1,this.emit("release",n,e),n||this.ending||!e._queryable||e._ending||e._poolUseCount>=this.options.maxUses)return e._poolUseCount>=this.options.maxUses&&this.log("remove expended client"),this._remove(e,this._pulseQueue.bind(this));if(this._expired.has(e))return this.log("remove expired client"),this._expired.delete(e),this._remove(e,this._pulseQueue.bind(this));let s;this.options.idleTimeoutMillis&&this._isAboveMin()&&(s=setTimeout(()=>{this.log("remove idle client"),this._remove(e,this._pulseQueue.bind(this))},this.options.idleTimeoutMillis),this.options.allowExitOnIdle&&s.unref()),this.options.allowExitOnIdle&&e.unref(),this._idle.push(new Ah(e,r,s)),this._pulseQueue()}query(e,r,n){if(typeof e=="function"){let s=$l(this.Promise,e);return setImmediate(function(){return s.callback(new Error("Passing a function as the first parameter to pool.query is not supported"))}),s.result}typeof r=="function"&&(n=r,r=void 0);let i=$l(this.Promise,n);return n=i.callback,this.connect((s,a)=>{if(s)return n(s);let o=!1,u=c=>{o||(o=!0,a.release(c),n(c))};a.once("error",u),this.log("dispatching query");try{a.query(e,r,(c,l)=>{if(this.log("query dispatched"),a.removeListener("error",u),!o)return o=!0,a.release(c),c?n(c):n(void 0,l)})}catch(c){return a.release(c),n(c)}}),i.result}end(e){if(this.log("ending"),this.ending){let n=new Error("Called end on pool more than once");return e?e(n):this.Promise.reject(n)}this.ending=!0;let r=$l(this.Promise,e);return this._endCallback=r.callback,this._pulseQueue(),r.result}get waitingCount(){return this._pendingQueue.length}get idleCount(){return this._idle.length}get expiredCount(){return this._clients.reduce((e,r)=>e+(this._expired.has(r)?1:0),0)}get totalCount(){return this._clients.length}};E8.exports=kh});var T8=v((Vz,C8)=>{"use strict";var k8=require("events").EventEmitter,F$=require("util"),Ch=Ms(),Hs=C8.exports=function(t,e,r){k8.call(this),t=Ch.normalizeQueryConfig(t,e,r),this.text=t.text,this.values=t.values,this.name=t.name,this.queryMode=t.queryMode,this.callback=t.callback,this.state="new",this._arrayMode=t.rowMode==="array",this._emitRowEvents=!1,this.on("newListener",function(n){n==="row"&&(this._emitRowEvents=!0)}.bind(this))};F$.inherits(Hs,k8);var B$={sqlState:"code",statementPosition:"position",messagePrimary:"message",context:"where",schemaName:"schema",tableName:"table",columnName:"column",dataTypeName:"dataType",constraintName:"constraint",sourceFile:"file",sourceLine:"line",sourceFunction:"routine"};Hs.prototype.handleError=function(t){let e=this.native.pq.resultErrorFields();if(e)for(let r in e){let n=B$[r]||r;t[n]=e[r]}this.callback?this.callback(t):this.emit("error",t),this.state="error"};Hs.prototype.then=function(t,e){return this._getPromise().then(t,e)};Hs.prototype.catch=function(t){return this._getPromise().catch(t)};Hs.prototype._getPromise=function(){return this._promise?this._promise:(this._promise=new Promise(function(t,e){this._once("end",t),this._once("error",e)}.bind(this)),this._promise)};Hs.prototype.submit=function(t){this.state="running";let e=this;this.native=t.native,t.native.arrayMode=this._arrayMode;let r=function(n,i,s){if(t.native.arrayMode=!1,setImmediate(function(){e.emit("_done")}),n)return e.handleError(n);e._emitRowEvents&&(s.length>1?i.forEach((a,o)=>{a.forEach(u=>{e.emit("row",u,s[o])})}):i.forEach(function(a){e.emit("row",a,s)})),e.state="end",e.emit("end",s),e.callback&&e.callback(null,s)};if(process.domain&&(r=process.domain.bind(r)),this.name){this.name.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",this.name,this.name.length),console.error("This can cause conflicts and silent errors executing queries"));let n=(this.values||[]).map(Ch.prepareValue);if(t.namedQueries[this.name]){if(this.text&&t.namedQueries[this.name]!==this.text){let i=new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`);return r(i)}return t.native.execute(this.name,n,r)}return t.native.prepare(this.name,this.text,n.length,function(i){return i?r(i):(t.namedQueries[e.name]=e.text,e.native.execute(e.name,n,r))})}else if(this.values){if(!Array.isArray(this.values)){let i=new Error("Query values must be an array");return r(i)}let n=this.values.map(Ch.prepareValue);t.native.query(this.text,n,r)}else this.queryMode==="extended"?t.native.query(this.text,[],r):t.native.query(this.text,r)}});var R8=v((Wz,N8)=>{"use strict";var P8;try{P8=require("pg-native")}catch(t){throw t}var L$=Cl(),I8=require("events").EventEmitter,U$=require("util"),z$=Vm(),O8=T8(),Ct=N8.exports=function(t){I8.call(this),t=t||{},this._Promise=t.Promise||global.Promise,this._types=new L$(t.types),this.native=new P8({types:this._types}),this._queryQueue=[],this._ending=!1,this._connecting=!1,this._connected=!1,this._queryable=!0;let e=this.connectionParameters=new z$(t);t.nativeConnectionString&&(e.nativeConnectionString=t.nativeConnectionString),this.user=e.user,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:e.password}),this.database=e.database,this.host=e.host,this.port=e.port,this.namedQueries={}};Ct.Query=O8;U$.inherits(Ct,I8);Ct.prototype._errorAllQueries=function(t){let e=r=>{process.nextTick(()=>{r.native=this.native,r.handleError(t)})};this._hasActiveQuery()&&(e(this._activeQuery),this._activeQuery=null),this._queryQueue.forEach(e),this._queryQueue.length=0};Ct.prototype._connect=function(t){let e=this;if(this._connecting){process.nextTick(()=>t(new Error("Client has already been connected. You cannot reuse a client.")));return}this._connecting=!0,this.connectionParameters.getLibpqConnectionString(function(r,n){if(e.connectionParameters.nativeConnectionString&&(n=e.connectionParameters.nativeConnectionString),r)return t(r);e.native.connect(n,function(i){if(i)return e.native.end(),t(i);e._connected=!0,e.native.on("error",function(s){e._queryable=!1,e._errorAllQueries(s),e.emit("error",s)}),e.native.on("notification",function(s){e.emit("notification",{channel:s.relname,payload:s.extra})}),e.emit("connect"),e._pulseQueryQueue(!0),t()})})};Ct.prototype.connect=function(t){if(t){this._connect(t);return}return new this._Promise((e,r)=>{this._connect(n=>{n?r(n):e()})})};Ct.prototype.query=function(t,e,r){let n,i,s,a,o;if(t==null)throw new TypeError("Client was passed a null or undefined query");if(typeof t.submit=="function")s=t.query_timeout||this.connectionParameters.query_timeout,i=n=t,typeof e=="function"&&(t.callback=e);else if(s=t.query_timeout||this.connectionParameters.query_timeout,n=new O8(t,e,r),!n.callback){let u,c;i=new this._Promise((l,p)=>{u=l,c=p}).catch(l=>{throw Error.captureStackTrace(l),l}),n.callback=(l,p)=>l?c(l):u(p)}return s&&(o=n.callback,a=setTimeout(()=>{let u=new Error("Query read timeout");process.nextTick(()=>{n.handleError(u,this.connection)}),o(u),n.callback=()=>{};let c=this._queryQueue.indexOf(n);c>-1&&this._queryQueue.splice(c,1),this._pulseQueryQueue()},s),n.callback=(u,c)=>{clearTimeout(a),o(u,c)}),this._queryable?this._ending?(n.native=this.native,process.nextTick(()=>{n.handleError(new Error("Client was closed and is not queryable"))}),i):(this._queryQueue.push(n),this._pulseQueryQueue(),i):(n.native=this.native,process.nextTick(()=>{n.handleError(new Error("Client has encountered a connection error and is not queryable"))}),i)};Ct.prototype.end=function(t){let e=this;this._ending=!0,this._connected||this.once("connect",this.end.bind(this,t));let r;return t||(r=new this._Promise(function(n,i){t=s=>s?i(s):n()})),this.native.end(function(){e._errorAllQueries(new Error("Connection terminated")),process.nextTick(()=>{e.emit("end"),t&&t()})}),r};Ct.prototype._hasActiveQuery=function(){return this._activeQuery&&this._activeQuery.state!=="error"&&this._activeQuery.state!=="end"};Ct.prototype._pulseQueryQueue=function(t){if(!this._connected||this._hasActiveQuery())return;let e=this._queryQueue.shift();if(!e){t||this.emit("drain");return}this._activeQuery=e,e.submit(this);let r=this;e.once("_done",function(){r._pulseQueryQueue()})};Ct.prototype.cancel=function(t){this._activeQuery===t?this.native.cancel(function(){}):this._queryQueue.indexOf(t)!==-1&&this._queryQueue.splice(this._queryQueue.indexOf(t),1)};Ct.prototype.ref=function(){};Ct.prototype.unref=function(){};Ct.prototype.setTypeParser=function(t,e,r){return this._types.setTypeParser(t,e,r)};Ct.prototype.getTypeParser=function(t,e){return this._types.getTypeParser(t,e)}});var Th=v((Gz,j8)=>{"use strict";j8.exports=R8()});var Ml=v((Jz,mc)=>{"use strict";var Q$=w8(),H$=pc(),V$=bh(),W$=Gm(),G$=Ms(),K$=A8(),J$=Cl(),{DatabaseError:Z$}=vh(),{escapeIdentifier:X$,escapeLiteral:Y$}=Ms(),eM=t=>class extends K${constructor(r){super(r,t)}},Ph=function(t){this.defaults=H$,this.Client=t,this.Query=this.Client.Query,this.Pool=eM(this.Client),this._pools=[],this.Connection=V$,this.types=lc(),this.DatabaseError=Z$,this.TypeOverrides=J$,this.escapeIdentifier=X$,this.escapeLiteral=Y$,this.Result=W$,this.utils=G$};typeof process.env.NODE_PG_FORCE_NATIVE<"u"?mc.exports=new Ph(Th()):(mc.exports=new Ph(Q$),Object.defineProperty(mc.exports,"native",{configurable:!0,enumerable:!1,get(){let t=null;try{t=new Ph(Th())}catch(e){if(e.code!=="MODULE_NOT_FOUND")throw e}return Object.defineProperty(mc.exports,"native",{value:t}),t}}))});var M8=v((Zz,$8)=>{"use strict";var tM=(t,e)=>{e?t.then(r=>process.nextTick(e,null,r),r=>process.nextTick(e,r||new Error("Promise was rejected with falsy value"))):t.catch(()=>{})},q8=()=>Math.ceil(Date.now()/1e3),D8=t=>t.replaceAll('"','""');$8.exports=function(e){let r=e.Store||e.session.Store;class n extends r{#l;#p;#o;#i;#c;#e;#t;#u;#s;#a;#r;constructor(s={}){if(super(s),this.#s=s.schemaName?D8(s.schemaName):void 0,this.#r=s.tableName?D8(s.tableName):"session",!this.#s&&this.#r.includes('"."')&&(console.warn('DEPRECATION WARNING: Schema should be provided through its dedicated "schemaName" option rather than through "tableName"'),this.#r=this.#r.replace(/^([^"]+)""\.""([^"]+)$/,'$1"."$2')),this.#l=!!s.createTableIfMissing,this.#a=void 0,this.ttl=s.ttl,this.#p=!!s.disableTouch,this.#o=s.errorLog||console.error.bind(console),s.pool!==void 0)this.#e=s.pool,this.#i=!1;else if(s.pgPromise!==void 0){if(typeof s.pgPromise.any!="function")throw new TypeError("`pgPromise` config must point to an existing and configured instance of pg-promise pointing at your database");this.#c=s.pgPromise,this.#i=!1}else{let a=s.conString||process.env.DATABASE_URL,o=s.conObject;o||(o={},a&&(o.connectionString=a)),this.#e=new(Ml()).Pool(o),this.#e.on("error",u=>{this.#o("PG Pool error:",u)}),this.#i=!0}s.pruneSessionInterval===!1?this.#t=!1:(this.#t=(s.pruneSessionInterval||900)*1e3,s.pruneSessionRandomizedInterval!==!1&&(this.#u=s.pruneSessionRandomizedInterval||(a=>Math.ceil(a/2+a*Math.random()))))}async _rawEnsureSessionStoreTable(){let s=this.quotedTable(),a=await this._asyncQuery("SELECT to_regclass($1::text)",[s],!0);if(a&&a.to_regclass===null){let o=require("node:path"),l=(await require("node:fs").promises.readFile(o.resolve(__dirname,"./table.sql"),"utf8")).replaceAll('"session"',s);await this._asyncQuery(l,[],!0)}}async _ensureSessionStoreTable(s){if(!(s||this.#l===!1))return this.#a||(this.#a=this._rawEnsureSessionStoreTable()),this.#a}async close(){this.closed=!0,this.#d(),this.#i&&this.#e&&await this.#e.end()}#n(){if(this.#t&&!this.closed&&!this.pruneTimer){let s=this.#u?this.#u(this.#t):this.#t;this.pruneTimer=setTimeout(()=>{this.pruneSessions()},s),this.pruneTimer.unref()}}#d(){this.pruneTimer&&(clearTimeout(this.pruneTimer),this.pruneTimer=void 0)}pruneSessions(s){this.query("DELETE FROM "+this.quotedTable()+" WHERE expire < to_timestamp($1)",[q8()],a=>{if(s&&typeof s=="function")return s(a);a&&this.#o("Failed to prune sessions:",a),this.#d(),this.#n()})}quotedTable(){let s='"'+this.#r+'"';return this.#s&&(s='"'+this.#s+'".'+s),s}#f(s){let a;if(s&&s.cookie&&s.cookie.expires){let o=new Date(s.cookie.expires);a=Math.ceil(o.valueOf()/1e3)}else{let o=this.ttl||86400;a=Math.ceil(Date.now()/1e3+o)}return a}async _asyncQuery(s,a,o){if(await this._ensureSessionStoreTable(o),this.#c){let u=await this.#c.any(s,a);return u&&u[0]?u[0]:void 0}else{if(!this.#e)throw new Error("Pool missing for some reason");let u=await this.#e.query(s,a);return u&&u.rows&&u.rows[0]?u.rows[0]:void 0}}query(s,a,o,u){let c;if(typeof a=="function"){if(o)throw new Error("Two callback functions set at once");o=a,c=[]}else c=a||[];let l=this._asyncQuery(s,c,u);tM(l,o)}get(s,a){this.#n(),this.query("SELECT sess FROM "+this.quotedTable()+" WHERE sid = $1 AND expire >= to_timestamp($2)",[s,q8()],(o,u)=>{if(o)return a(o);if(!u)return a(null);try{return a(null,typeof u.sess=="string"?JSON.parse(u.sess):u.sess)}catch{return this.destroy(s,a)}})}set(s,a,o){this.#n();let u=this.#f(a),c="INSERT INTO "+this.quotedTable()+" (sess, expire, sid) SELECT $1, to_timestamp($2), $3 ON CONFLICT (sid) DO UPDATE SET sess=$1, expire=to_timestamp($2) RETURNING sid";this.query(c,[a,u,s],l=>{o&&o(l)})}destroy(s,a){this.#n(),this.query("DELETE FROM "+this.quotedTable()+" WHERE sid = $1",[s],o=>{a&&a(o)})}touch(s,a,o){if(this.#n(),this.#p){o&&o(null);return}let u=this.#f(a);this.query("UPDATE "+this.quotedTable()+" SET expire = to_timestamp($1) WHERE sid = $2 RETURNING sid",[u,s],c=>{o&&o(c)})}}return n}});var kL={};Jp(kL,{log:()=>Ey});module.exports=V2(kL);var Gp=mr(am(),1);var ua=mr(require("openid-client"),1),_4=require("openid-client/passport"),An=mr(cE(),1),Rv=mr(WE(),1),S4=mr(require("memoizee"),1),E4=mr(M8(),1);var g=Symbol.for("drizzle:entityKind"),Xz=Symbol.for("drizzle:hasOwnEntityKind");function E(t,e){if(!t||typeof t!="object")return!1;if(t instanceof e)return!0;if(!Object.prototype.hasOwnProperty.call(e,g))throw new Error(`Class "${e.name??"<unknown>"}" doesn't look like a Drizzle entity. If this is incorrect and the class is provided by Drizzle, please report this as a bug.`);let r=Object.getPrototypeOf(t).constructor;if(r)for(;r;){if(g in r&&r[g]===e[g])return!0;r=Object.getPrototypeOf(r)}return!1}var le=class{constructor(e,r){this.table=e,this.config=r,this.name=r.name,this.keyAsName=r.keyAsName,this.notNull=r.notNull,this.default=r.default,this.defaultFn=r.defaultFn,this.onUpdateFn=r.onUpdateFn,this.hasDefault=r.hasDefault,this.primary=r.primaryKey,this.isUnique=r.isUnique,this.uniqueName=r.uniqueName,this.uniqueType=r.uniqueType,this.dataType=r.dataType,this.columnType=r.columnType,this.generated=r.generated,this.generatedIdentity=r.generatedIdentity}static[g]="Column";name;keyAsName;primary;notNull;default;defaultFn;onUpdateFn;hasDefault;isUnique;uniqueName;uniqueType;dataType;columnType;enumValues=void 0;generated=void 0;generatedIdentity=void 0;config;mapFromDriverValue(e){return e}mapToDriverValue(e){return e}shouldDisableInsert(){return this.config.generated!==void 0&&this.config.generated.type!=="byDefault"}};var Fl=class{static[g]="ColumnBuilder";config;constructor(e,r,n){this.config={name:e,keyAsName:e==="",notNull:!1,default:void 0,hasDefault:!1,primaryKey:!1,isUnique:!1,uniqueName:void 0,uniqueType:void 0,dataType:r,columnType:n,generated:void 0}}$type(){return this}notNull(){return this.config.notNull=!0,this}default(e){return this.config.default=e,this.config.hasDefault=!0,this}$defaultFn(e){return this.config.defaultFn=e,this.config.hasDefault=!0,this}$default=this.$defaultFn;$onUpdateFn(e){return this.config.onUpdateFn=e,this.config.hasDefault=!0,this}$onUpdate=this.$onUpdateFn;primaryKey(){return this.config.primaryKey=!0,this.config.notNull=!0,this}setName(e){this.config.name===""&&(this.config.name=e)}};var ar=Symbol.for("drizzle:Name");var Bl=class{static[g]="PgForeignKeyBuilder";reference;_onUpdate="no action";_onDelete="no action";constructor(e,r){this.reference=()=>{let{name:n,columns:i,foreignColumns:s}=e();return{name:n,columns:i,foreignTable:s[0].table,foreignColumns:s}},r&&(this._onUpdate=r.onUpdate,this._onDelete=r.onDelete)}onUpdate(e){return this._onUpdate=e===void 0?"no action":e,this}onDelete(e){return this._onDelete=e===void 0?"no action":e,this}build(e){return new Ih(e,this)}},Ih=class{constructor(e,r){this.table=e,this.reference=r.reference,this.onUpdate=r._onUpdate,this.onDelete=r._onDelete}static[g]="PgForeignKey";reference;onUpdate;onDelete;getName(){let{name:e,columns:r,foreignColumns:n}=this.reference(),i=r.map(o=>o.name),s=n.map(o=>o.name),a=[this.table[ar],...i,n[0].table[ar],...s];return e??`${a.join("_")}_fk`}};function Ll(t,...e){return t(...e)}function Rh(t,e){return`${t[ar]}_${e.join("_")}_unique`}var Oh=class{constructor(e,r){this.name=r,this.columns=e}static[g]="PgUniqueConstraintBuilder";columns;nullsNotDistinctConfig=!1;nullsNotDistinct(){return this.nullsNotDistinctConfig=!0,this}build(e){return new Nh(e,this.columns,this.nullsNotDistinctConfig,this.name)}},F8=class{static[g]="PgUniqueOnConstraintBuilder";name;constructor(e){this.name=e}on(...e){return new Oh(e,this.name)}},Nh=class{constructor(e,r,n,i){this.table=e,this.columns=r,this.name=i??Rh(this.table,this.columns.map(s=>s.name)),this.nullsNotDistinct=n}static[g]="PgUniqueConstraint";columns;name;nullsNotDistinct=!1;getName(){return this.name}};function B8(t,e,r){for(let n=e;n<t.length;n++){let i=t[n];if(i==="\\"){n++;continue}if(i==='"')return[t.slice(e,n).replace(/\\/g,""),n+1];if(!r&&(i===","||i==="}"))return[t.slice(e,n).replace(/\\/g,""),n]}return[t.slice(e).replace(/\\/g,""),t.length]}function L8(t,e=0){let r=[],n=e,i=!1;for(;n<t.length;){let s=t[n];if(s===","){(i||n===e)&&r.push(""),i=!0,n++;continue}if(i=!1,s==="\\"){n+=2;continue}if(s==='"'){let[u,c]=B8(t,n+1,!0);r.push(u),n=c;continue}if(s==="}")return[r,n+1];if(s==="{"){let[u,c]=L8(t,n+1);r.push(u),n=c;continue}let[a,o]=B8(t,n,!1);r.push(a),n=o}return[r,n]}function U8(t){let[e]=L8(t,1);return e}function jh(t){return`{${t.map(e=>Array.isArray(e)?jh(e):typeof e=="string"?`"${e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`:`${e}`).join(",")}}`}var B=class extends Fl{foreignKeyConfigs=[];static[g]="PgColumnBuilder";array(e){return new Dh(this.config.name,this,e)}references(e,r={}){return this.foreignKeyConfigs.push({ref:e,actions:r}),this}unique(e,r){return this.config.isUnique=!0,this.config.uniqueName=e,this.config.uniqueType=r?.nulls,this}generatedAlwaysAs(e){return this.config.generated={as:e,type:"always",mode:"stored"},this}buildForeignKeys(e,r){return this.foreignKeyConfigs.map(({ref:n,actions:i})=>Ll((s,a)=>{let o=new Bl(()=>{let u=s();return{columns:[e],foreignColumns:[u]}});return a.onUpdate&&o.onUpdate(a.onUpdate),a.onDelete&&o.onDelete(a.onDelete),o.build(r)},n,i))}buildExtraConfigColumn(e){return new qh(e,this.config)}},N=class extends le{constructor(e,r){r.uniqueName||(r.uniqueName=Rh(e,[r.name])),super(e,r),this.table=e}static[g]="PgColumn"},qh=class extends N{static[g]="ExtraConfigColumn";getSQLType(){return this.getSQLType()}indexConfig={order:this.config.order??"asc",nulls:this.config.nulls??"last",opClass:this.config.opClass};defaultConfig={order:"asc",nulls:"last",opClass:void 0};asc(){return this.indexConfig.order="asc",this}desc(){return this.indexConfig.order="desc",this}nullsFirst(){return this.indexConfig.nulls="first",this}nullsLast(){return this.indexConfig.nulls="last",this}op(e){return this.indexConfig.opClass=e,this}},Vs=class{static[g]="IndexedColumn";constructor(e,r,n,i){this.name=e,this.keyAsName=r,this.type=n,this.indexConfig=i}name;keyAsName;type;indexConfig},Dh=class extends B{static[g]="PgArrayBuilder";constructor(e,r,n){super(e,"array","PgArray"),this.config.baseBuilder=r,this.config.size=n}build(e){let r=this.config.baseBuilder.build(e);return new $h(e,this.config,r)}},$h=class t extends N{constructor(e,r,n,i){super(e,r),this.baseColumn=n,this.range=i,this.size=r.size}size;static[g]="PgArray";getSQLType(){return`${this.baseColumn.getSQLType()}[${typeof this.size=="number"?this.size:""}]`}mapFromDriverValue(e){return typeof e=="string"&&(e=U8(e)),e.map(r=>this.baseColumn.mapFromDriverValue(r))}mapToDriverValue(e,r=!1){let n=e.map(i=>i===null?null:E(this.baseColumn,t)?this.baseColumn.mapToDriverValue(i,!0):this.baseColumn.mapToDriverValue(i));return r?n:jh(n)}};var z8=Symbol.for("drizzle:isPgEnum");function H8(t){return!!t&&typeof t=="function"&&z8 in t&&t[z8]===!0}var Q8=class extends B{static[g]="PgEnumColumnBuilder";constructor(e,r){super(e,"string","PgEnumColumn"),this.config.enum=r}build(e){return new Mh(e,this.config)}},Mh=class extends N{static[g]="PgEnumColumn";enum=this.config.enum;enumValues=this.config.enum.enumValues;constructor(e,r){super(e,r),this.enum=r.enum}getSQLType(){return this.enum.enumName}};var Fe=class{static[g]="Subquery";constructor(e,r,n,i=!1){this._={brand:"Subquery",sql:e,selectedFields:r,alias:n,isWith:i}}},Ws=class extends Fe{static[g]="WithSubquery"};var V8="0.39.3";var Fh,Bh,xe={startActiveSpan(t,e){return Fh?(Bh||(Bh=Fh.trace.getTracer("drizzle-orm",V8)),Ll((r,n)=>n.startActiveSpan(t,i=>{try{return e(i)}catch(s){throw i.setStatus({code:r.SpanStatusCode.ERROR,message:s instanceof Error?s.message:"Unknown error"}),s}finally{i.end()}}),Fh,Bh)):e()}};var be=Symbol.for("drizzle:ViewBaseConfig");var Ul=Symbol.for("drizzle:Schema"),zl=Symbol.for("drizzle:Columns"),W8=Symbol.for("drizzle:ExtraConfigColumns"),Lh=Symbol.for("drizzle:OriginalName"),Uh=Symbol.for("drizzle:BaseName"),hc=Symbol.for("drizzle:IsAlias"),G8=Symbol.for("drizzle:ExtraConfigBuilder"),K8=Symbol.for("drizzle:IsDrizzleTable"),q=class{static[g]="Table";static Symbol={Name:ar,Schema:Ul,OriginalName:Lh,Columns:zl,ExtraConfigColumns:W8,BaseName:Uh,IsAlias:hc,ExtraConfigBuilder:G8};[ar];[Lh];[Ul];[zl];[W8];[Uh];[hc]=!1;[K8]=!0;[G8]=void 0;constructor(e,r,n){this[ar]=this[Lh]=e,this[Ul]=r,this[Uh]=n}};function zh(t){return typeof t=="object"&&t!==null&&K8 in t}function Tt(t){return t[ar]}function ui(t){return`${t[Ul]??"public"}.${t[ar]}`}var J8=class{static[g]="FakePrimitiveParam"};function Qh(t){return t!=null&&typeof t.getSQL=="function"}function rM(t){let e={sql:"",params:[]};for(let r of t)e.sql+=r.sql,e.params.push(...r.params),r.typings?.length&&(e.typings||(e.typings=[]),e.typings.push(...r.typings));return e}var Be=class{static[g]="StringChunk";value;constructor(e){this.value=Array.isArray(e)?e:[e]}getSQL(){return new M([this])}},M=class t{constructor(e){this.queryChunks=e}static[g]="SQL";decoder=X8;shouldInlineParams=!1;append(e){return this.queryChunks.push(...e.queryChunks),this}toQuery(e){return xe.startActiveSpan("drizzle.buildSQL",r=>{let n=this.buildQueryFromSourceParams(this.queryChunks,e);return r?.setAttributes({"drizzle.query.text":n.sql,"drizzle.query.params":JSON.stringify(n.params)}),n})}buildQueryFromSourceParams(e,r){let n=Object.assign({},r,{inlineParams:r.inlineParams||this.shouldInlineParams,paramStartIndex:r.paramStartIndex||{value:0}}),{casing:i,escapeName:s,escapeParam:a,prepareTyping:o,inlineParams:u,paramStartIndex:c}=n;return rM(e.map(l=>{if(E(l,Be))return{sql:l.value.join(""),params:[]};if(E(l,gc))return{sql:s(l.value),params:[]};if(l===void 0)return{sql:"",params:[]};if(Array.isArray(l)){let p=[new Be("(")];for(let[d,f]of l.entries())p.push(f),d<l.length-1&&p.push(new Be(", "));return p.push(new Be(")")),this.buildQueryFromSourceParams(p,n)}if(E(l,t))return this.buildQueryFromSourceParams(l.queryChunks,{...n,inlineParams:u||l.shouldInlineParams});if(E(l,q)){let p=l[q.Symbol.Schema],d=l[q.Symbol.Name];return{sql:p===void 0||l[hc]?s(d):s(p)+"."+s(d),params:[]}}if(E(l,le)){let p=i.getColumnCasing(l);if(r.invokeSource==="indexes")return{sql:s(p),params:[]};let d=l.table[q.Symbol.Schema];return{sql:l.table[hc]||d===void 0?s(l.table[q.Symbol.Name])+"."+s(p):s(d)+"."+s(l.table[q.Symbol.Name])+"."+s(p),params:[]}}if(E(l,yt)){let p=l[be].schema,d=l[be].name;return{sql:p===void 0||l[be].isAlias?s(d):s(p)+"."+s(d),params:[]}}if(E(l,Pt)){if(E(l.value,Br))return{sql:a(c.value++,l),params:[l],typings:["none"]};let p=l.value===null?null:l.encoder.mapToDriverValue(l.value);if(E(p,t))return this.buildQueryFromSourceParams([p],n);if(u)return{sql:this.mapInlineParam(p,n),params:[]};let d=["none"];return o&&(d=[o(l.encoder)]),{sql:a(c.value++,p),params:[p],typings:d}}return E(l,Br)?{sql:a(c.value++,l),params:[l],typings:["none"]}:E(l,t.Aliased)&&l.fieldAlias!==void 0?{sql:s(l.fieldAlias),params:[]}:E(l,Fe)?l._.isWith?{sql:s(l._.alias),params:[]}:this.buildQueryFromSourceParams([new Be("("),l._.sql,new Be(") "),new gc(l._.alias)],n):H8(l)?l.schema?{sql:s(l.schema)+"."+s(l.enumName),params:[]}:{sql:s(l.enumName),params:[]}:Qh(l)?l.shouldOmitSQLParens?.()?this.buildQueryFromSourceParams([l.getSQL()],n):this.buildQueryFromSourceParams([new Be("("),l.getSQL(),new Be(")")],n):u?{sql:this.mapInlineParam(l,n),params:[]}:{sql:a(c.value++,l),params:[l],typings:["none"]}}))}mapInlineParam(e,{escapeString:r}){if(e===null)return"null";if(typeof e=="number"||typeof e=="boolean")return e.toString();if(typeof e=="string")return r(e);if(typeof e=="object"){let n=e.toString();return r(n==="[object Object]"?JSON.stringify(e):n)}throw new Error("Unexpected param value: "+e)}getSQL(){return this}as(e){return e===void 0?this:new t.Aliased(this,e)}mapWith(e){return this.decoder=typeof e=="function"?{mapFromDriverValue:e}:e,this}inlineParams(){return this.shouldInlineParams=!0,this}if(e){return e?this:void 0}},gc=class{constructor(e){this.value=e}static[g]="Name";brand;getSQL(){return new M([this])}};function Z8(t){return typeof t=="object"&&t!==null&&"mapToDriverValue"in t&&typeof t.mapToDriverValue=="function"}var X8={mapFromDriverValue:t=>t},Y8={mapToDriverValue:t=>t},LQ={...X8,...Y8},Pt=class{constructor(e,r=Y8){this.value=e,this.encoder=r}static[g]="Param";brand;getSQL(){return new M([this])}};function y(t,...e){let r=[];(e.length>0||t.length>0&&t[0]!=="")&&r.push(new Be(t[0]));for(let[n,i]of e.entries())r.push(i,new Be(t[n+1]));return new M(r)}(t=>{function e(){return new M([])}t.empty=e;function r(u){return new M(u)}t.fromList=r;function n(u){return new M([new Be(u)])}t.raw=n;function i(u,c){let l=[];for(let[p,d]of u.entries())p>0&&c!==void 0&&l.push(c),l.push(d);return new M(l)}t.join=i;function s(u){return new gc(u)}t.identifier=s;function a(u){return new Br(u)}t.placeholder=a;function o(u,c){return new Pt(u,c)}t.param=o})(y||(y={}));(t=>{class e{constructor(n,i){this.sql=n,this.fieldAlias=i}static[g]="SQL.Aliased";isSelectionField=!1;getSQL(){return this.sql}clone(){return new e(this.sql,this.fieldAlias)}}t.Aliased=e})(M||(M={}));var Br=class{constructor(e){this.name=e}static[g]="Placeholder";getSQL(){return new M([this])}};function Hh(t,e){return t.map(r=>{if(E(r,Br)){if(!(r.name in e))throw new Error(`No value for placeholder "${r.name}" was provided`);return e[r.name]}if(E(r,Pt)&&E(r.value,Br)){if(!(r.value.name in e))throw new Error(`No value for placeholder "${r.value.name}" was provided`);return r.encoder.mapToDriverValue(e[r.value.name])}return r})}var ek=Symbol.for("drizzle:IsDrizzleView"),yt=class{static[g]="View";[be];[ek]=!0;constructor({name:e,schema:r,selectedFields:n,query:i}){this[be]={name:e,originalName:e,schema:r,selectedFields:n,query:i,isExisting:!i,isAlias:!1}}getSQL(){return new M([this])}};function tk(t){return typeof t=="object"&&t!==null&&ek in t}le.prototype.getSQL=function(){return new M([this])};q.prototype.getSQL=function(){return new M([this])};Fe.prototype.getSQL=function(){return new M([this])};var li=class{constructor(e){this.table=e}static[g]="ColumnAliasProxyHandler";get(e,r){return r==="table"?this.table:e[r]}},Gs=class{constructor(e,r){this.alias=e,this.replaceOriginalName=r}static[g]="TableAliasProxyHandler";get(e,r){if(r===q.Symbol.IsAlias)return!0;if(r===q.Symbol.Name)return this.alias;if(this.replaceOriginalName&&r===q.Symbol.OriginalName)return this.alias;if(r===be)return{...e[be],name:this.alias,isAlias:!0};if(r===q.Symbol.Columns){let i=e[q.Symbol.Columns];if(!i)return i;let s={};return Object.keys(i).map(a=>{s[a]=new Proxy(i[a],new li(new Proxy(e,this)))}),s}let n=e[r];return E(n,le)?new Proxy(n,new li(new Proxy(e,this))):n}},rk=class{constructor(e){this.alias=e}static[g]="RelationTableAliasProxyHandler";get(e,r){return r==="sourceTable"?vc(e.sourceTable,this.alias):e[r]}};function vc(t,e){return new Proxy(t,new Gs(e,!1))}function wr(t,e){return new Proxy(t,new li(new Proxy(t.table,new Gs(e,!1))))}function Vh(t,e){return new M.Aliased(yc(t.sql,e),t.fieldAlias)}function yc(t,e){return y.join(t.queryChunks.map(r=>E(r,le)?wr(r,e):E(r,M)?yc(r,e):E(r,M.Aliased)?Vh(r,e):r))}var xc=class extends Error{static[g]="DrizzleError";constructor({message:e,cause:r}){super(e),this.name="DrizzleError",this.cause=r}},Ql=class extends xc{static[g]="TransactionRollbackError";constructor(){super({message:"Rollback"})}};function It(t,e){return Z8(e)&&!Qh(t)&&!E(t,Pt)&&!E(t,Br)&&!E(t,le)&&!E(t,q)&&!E(t,yt)?new Pt(t,e):t}var se=(t,e)=>y`${t} = ${It(e,t)}`,nk=(t,e)=>y`${t} <> ${It(e,t)}`;function bc(...t){let e=t.filter(r=>r!==void 0);if(e.length!==0)return e.length===1?new M(e):new M([new Be("("),y.join(e,new Be(" and ")),new Be(")")])}function ik(...t){let e=t.filter(r=>r!==void 0);if(e.length!==0)return e.length===1?new M(e):new M([new Be("("),y.join(e,new Be(" or ")),new Be(")")])}function sk(t){return y`not ${t}`}var ak=(t,e)=>y`${t} > ${It(e,t)}`,ok=(t,e)=>y`${t} >= ${It(e,t)}`,ck=(t,e)=>y`${t} < ${It(e,t)}`,uk=(t,e)=>y`${t} <= ${It(e,t)}`;function lk(t,e){return Array.isArray(e)?e.length===0?y`false`:y`${t} in ${e.map(r=>It(r,t))}`:y`${t} in ${It(e,t)}`}function pk(t,e){return Array.isArray(e)?e.length===0?y`true`:y`${t} not in ${e.map(r=>It(r,t))}`:y`${t} not in ${It(e,t)}`}function dk(t){return y`${t} is null`}function fk(t){return y`${t} is not null`}function mk(t){return y`exists ${t}`}function hk(t){return y`not exists ${t}`}function gk(t,e,r){return y`${t} between ${It(e,t)} and ${It(r,t)}`}function vk(t,e,r){return y`${t} not between ${It(e,t)} and ${It(r,t)}`}function yk(t,e){return y`${t} like ${e}`}function xk(t,e){return y`${t} not like ${e}`}function bk(t,e){return y`${t} ilike ${e}`}function wk(t,e){return y`${t} not ilike ${e}`}function _k(t){return y`${t} asc`}function Ks(t){return y`${t} desc`}var Wh=class{static[g]="ConsoleLogWriter";write(e){console.log(e)}},Hl=class{static[g]="DefaultLogger";writer;constructor(e){this.writer=e?.writer??new Wh}logQuery(e,r){let n=r.map(s=>{try{return JSON.stringify(s)}catch{return String(s)}}),i=n.length?` -- params: [${n.join(", ")}]`:"";this.writer.write(`Query: ${e}${i}`)}},Vl=class{static[g]="NoopLogger";logQuery(){}};var at=class{static[g]="QueryPromise";[Symbol.toStringTag]="QueryPromise";catch(e){return this.then(void 0,e)}finally(e){return this.then(r=>(e?.(),r),r=>{throw e?.(),r})}then(e,r){return this.execute().then(e,r)}};function Sk(t,e,r){let n={},i=t.reduce((s,{path:a,field:o},u)=>{let c;E(o,le)?c=o:E(o,M)?c=o.decoder:c=o.sql.decoder;let l=s;for(let[p,d]of a.entries())if(p<a.length-1)d in l||(l[d]={}),l=l[d];else{let f=e[u],h=l[d]=f===null?null:c.mapFromDriverValue(f);if(r&&E(o,le)&&a.length===2){let m=a[0];m in n?typeof n[m]=="string"&&n[m]!==Tt(o.table)&&(n[m]=!1):n[m]=h===null?Tt(o.table):!1}}return s},{});if(r&&Object.keys(n).length>0)for(let[s,a]of Object.entries(n))typeof a=="string"&&!r[a]&&(i[s]=null);return i}function Xt(t,e){return Object.entries(t).reduce((r,[n,i])=>{if(typeof n!="string")return r;let s=e?[...e,n]:[n];return E(i,le)||E(i,M)||E(i,M.Aliased)?r.push({path:s,field:i}):E(i,q)?r.push(...Xt(i[q.Symbol.Columns],s)):r.push(...Xt(i,s)),r},[])}function wc(t,e){let r=Object.keys(t),n=Object.keys(e);if(r.length!==n.length)return!1;for(let[i,s]of r.entries())if(s!==n[i])return!1;return!0}function Wl(t,e){let r=Object.entries(e).filter(([,n])=>n!==void 0).map(([n,i])=>E(i,M)||E(i,le)?[n,i]:[n,new Pt(i,t[q.Symbol.Columns][n])]);if(r.length===0)throw new Error("No values to set");return Object.fromEntries(r)}function Ek(t,e){for(let r of e)for(let n of Object.getOwnPropertyNames(r.prototype))n!=="constructor"&&Object.defineProperty(t.prototype,n,Object.getOwnPropertyDescriptor(r.prototype,n)||Object.create(null))}function Gl(t){return t[q.Symbol.Columns]}function Ak(t){return t[be].selectedFields}function Lr(t){return E(t,Fe)?t._.alias:E(t,yt)?t[be].name:E(t,M)?void 0:t[q.Symbol.IsAlias]?t[q.Symbol.Name]:t[q.Symbol.BaseName]}function ae(t,e){return{name:typeof t=="string"&&t.length>0?t:"",config:typeof t=="object"?t:e}}function kk(t){if(typeof t!="object"||t===null||t.constructor.name!=="Object")return!1;if("logger"in t){let e=typeof t.logger;return!(e!=="boolean"&&(e!=="object"||typeof t.logger.logQuery!="function")&&e!=="undefined")}if("schema"in t){let e=typeof t.logger;return!(e!=="object"&&e!=="undefined")}if("casing"in t){let e=typeof t.logger;return!(e!=="string"&&e!=="undefined")}if("mode"in t)return!(t.mode!=="default"||t.mode!=="planetscale"||t.mode!==void 0);if("connection"in t){let e=typeof t.connection;return!(e!=="string"&&e!=="object"&&e!=="undefined")}if("client"in t){let e=typeof t.client;return!(e!=="object"&&e!=="function"&&e!=="undefined")}return Object.keys(t).length===0}var Ur=class extends B{static[g]="PgIntColumnBaseBuilder";generatedAlwaysAsIdentity(e){if(e){let{name:r,...n}=e;this.config.generatedIdentity={type:"always",sequenceName:r,sequenceOptions:n}}else this.config.generatedIdentity={type:"always"};return this.config.hasDefault=!0,this.config.notNull=!0,this}generatedByDefaultAsIdentity(e){if(e){let{name:r,...n}=e;this.config.generatedIdentity={type:"byDefault",sequenceName:r,sequenceOptions:n}}else this.config.generatedIdentity={type:"byDefault"};return this.config.hasDefault=!0,this.config.notNull=!0,this}};var Gh=class extends Ur{static[g]="PgBigInt53Builder";constructor(e){super(e,"number","PgBigInt53")}build(e){return new Kh(e,this.config)}},Kh=class extends N{static[g]="PgBigInt53";getSQLType(){return"bigint"}mapFromDriverValue(e){return typeof e=="number"?e:Number(e)}},Jh=class extends Ur{static[g]="PgBigInt64Builder";constructor(e){super(e,"bigint","PgBigInt64")}build(e){return new Zh(e,this.config)}},Zh=class extends N{static[g]="PgBigInt64";getSQLType(){return"bigint"}mapFromDriverValue(e){return BigInt(e)}};function Ck(t,e){let{name:r,config:n}=ae(t,e);return n.mode==="number"?new Gh(r):new Jh(r)}var Xh=class extends B{static[g]="PgBigSerial53Builder";constructor(e){super(e,"number","PgBigSerial53"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new Yh(e,this.config)}},Yh=class extends N{static[g]="PgBigSerial53";getSQLType(){return"bigserial"}mapFromDriverValue(e){return typeof e=="number"?e:Number(e)}},eg=class extends B{static[g]="PgBigSerial64Builder";constructor(e){super(e,"bigint","PgBigSerial64"),this.config.hasDefault=!0}build(e){return new tg(e,this.config)}},tg=class extends N{static[g]="PgBigSerial64";getSQLType(){return"bigserial"}mapFromDriverValue(e){return BigInt(e)}};function Tk(t,e){let{name:r,config:n}=ae(t,e);return n.mode==="number"?new Xh(r):new eg(r)}var rg=class extends B{static[g]="PgBooleanBuilder";constructor(e){super(e,"boolean","PgBoolean")}build(e){return new ng(e,this.config)}},ng=class extends N{static[g]="PgBoolean";getSQLType(){return"boolean"}};function or(t){return new rg(t??"")}var ig=class extends B{static[g]="PgCharBuilder";constructor(e,r){super(e,"string","PgChar"),this.config.length=r.length,this.config.enumValues=r.enum}build(e){return new sg(e,this.config)}},sg=class extends N{static[g]="PgChar";length=this.config.length;enumValues=this.config.enumValues;getSQLType(){return this.length===void 0?"char":`char(${this.length})`}};function Pk(t,e={}){let{name:r,config:n}=ae(t,e);return new ig(r,n)}var ag=class extends B{static[g]="PgCidrBuilder";constructor(e){super(e,"string","PgCidr")}build(e){return new og(e,this.config)}},og=class extends N{static[g]="PgCidr";getSQLType(){return"cidr"}};function Ik(t){return new ag(t??"")}var cg=class extends B{static[g]="PgCustomColumnBuilder";constructor(e,r,n){super(e,"custom","PgCustomColumn"),this.config.fieldConfig=r,this.config.customTypeParams=n}build(e){return new ug(e,this.config)}},ug=class extends N{static[g]="PgCustomColumn";sqlName;mapTo;mapFrom;constructor(e,r){super(e,r),this.sqlName=r.customTypeParams.dataType(r.fieldConfig),this.mapTo=r.customTypeParams.toDriver,this.mapFrom=r.customTypeParams.fromDriver}getSQLType(){return this.sqlName}mapFromDriverValue(e){return typeof this.mapFrom=="function"?this.mapFrom(e):e}mapToDriverValue(e){return typeof this.mapTo=="function"?this.mapTo(e):e}};function Ok(t){return(e,r)=>{let{name:n,config:i}=ae(e,r);return new cg(n,i,t)}}var _r=class extends B{static[g]="PgDateColumnBaseBuilder";defaultNow(){return this.default(y`now()`)}};var lg=class extends _r{static[g]="PgDateBuilder";constructor(e){super(e,"date","PgDate")}build(e){return new _c(e,this.config)}},_c=class extends N{static[g]="PgDate";getSQLType(){return"date"}mapFromDriverValue(e){return new Date(e)}mapToDriverValue(e){return e.toISOString()}},pg=class extends _r{static[g]="PgDateStringBuilder";constructor(e){super(e,"string","PgDateString")}build(e){return new Sc(e,this.config)}},Sc=class extends N{static[g]="PgDateString";getSQLType(){return"date"}};function Nk(t,e){let{name:r,config:n}=ae(t,e);return n?.mode==="date"?new lg(r):new pg(r)}var dg=class extends B{static[g]="PgDoublePrecisionBuilder";constructor(e){super(e,"number","PgDoublePrecision")}build(e){return new fg(e,this.config)}},fg=class extends N{static[g]="PgDoublePrecision";getSQLType(){return"double precision"}mapFromDriverValue(e){return typeof e=="string"?Number.parseFloat(e):e}};function Rk(t){return new dg(t??"")}var mg=class extends B{static[g]="PgInetBuilder";constructor(e){super(e,"string","PgInet")}build(e){return new hg(e,this.config)}},hg=class extends N{static[g]="PgInet";getSQLType(){return"inet"}};function jk(t){return new mg(t??"")}var gg=class extends Ur{static[g]="PgIntegerBuilder";constructor(e){super(e,"number","PgInteger")}build(e){return new vg(e,this.config)}},vg=class extends N{static[g]="PgInteger";getSQLType(){return"integer"}mapFromDriverValue(e){return typeof e=="string"?Number.parseInt(e):e}};function Yt(t){return new gg(t??"")}var yg=class extends B{static[g]="PgIntervalBuilder";constructor(e,r){super(e,"string","PgInterval"),this.config.intervalConfig=r}build(e){return new xg(e,this.config)}},xg=class extends N{static[g]="PgInterval";fields=this.config.intervalConfig.fields;precision=this.config.intervalConfig.precision;getSQLType(){let e=this.fields?` ${this.fields}`:"",r=this.precision?`(${this.precision})`:"";return`interval${e}${r}`}};function qk(t,e={}){let{name:r,config:n}=ae(t,e);return new yg(r,n)}var bg=class extends B{static[g]="PgJsonBuilder";constructor(e){super(e,"json","PgJson")}build(e){return new Ec(e,this.config)}},Ec=class extends N{static[g]="PgJson";constructor(e,r){super(e,r)}getSQLType(){return"json"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e}};function Dk(t){return new bg(t??"")}var wg=class extends B{static[g]="PgJsonbBuilder";constructor(e){super(e,"json","PgJsonb")}build(e){return new Ac(e,this.config)}},Ac=class extends N{static[g]="PgJsonb";constructor(e,r){super(e,r)}getSQLType(){return"jsonb"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e}};function Kl(t){return new wg(t??"")}var _g=class extends B{static[g]="PgLineBuilder";constructor(e){super(e,"array","PgLine")}build(e){return new Sg(e,this.config)}},Sg=class extends N{static[g]="PgLine";getSQLType(){return"line"}mapFromDriverValue(e){let[r,n,i]=e.slice(1,-1).split(",");return[Number.parseFloat(r),Number.parseFloat(n),Number.parseFloat(i)]}mapToDriverValue(e){return`{${e[0]},${e[1]},${e[2]}}`}},Eg=class extends B{static[g]="PgLineABCBuilder";constructor(e){super(e,"json","PgLineABC")}build(e){return new Ag(e,this.config)}},Ag=class extends N{static[g]="PgLineABC";getSQLType(){return"line"}mapFromDriverValue(e){let[r,n,i]=e.slice(1,-1).split(",");return{a:Number.parseFloat(r),b:Number.parseFloat(n),c:Number.parseFloat(i)}}mapToDriverValue(e){return`{${e.a},${e.b},${e.c}}`}};function $k(t,e){let{name:r,config:n}=ae(t,e);return!n?.mode||n.mode==="tuple"?new _g(r):new Eg(r)}var kg=class extends B{static[g]="PgMacaddrBuilder";constructor(e){super(e,"string","PgMacaddr")}build(e){return new Cg(e,this.config)}},Cg=class extends N{static[g]="PgMacaddr";getSQLType(){return"macaddr"}};function Mk(t){return new kg(t??"")}var Tg=class extends B{static[g]="PgMacaddr8Builder";constructor(e){super(e,"string","PgMacaddr8")}build(e){return new Pg(e,this.config)}},Pg=class extends N{static[g]="PgMacaddr8";getSQLType(){return"macaddr8"}};function Fk(t){return new Tg(t??"")}var Ig=class extends B{static[g]="PgNumericBuilder";constructor(e,r,n){super(e,"string","PgNumeric"),this.config.precision=r,this.config.scale=n}build(e){return new kc(e,this.config)}},kc=class extends N{static[g]="PgNumeric";precision;scale;constructor(e,r){super(e,r),this.precision=r.precision,this.scale=r.scale}getSQLType(){return this.precision!==void 0&&this.scale!==void 0?`numeric(${this.precision}, ${this.scale})`:this.precision===void 0?"numeric":`numeric(${this.precision})`}};function Og(t,e){let{name:r,config:n}=ae(t,e);return new Ig(r,n?.precision,n?.scale)}var xt=Og;var Ng=class extends B{static[g]="PgPointTupleBuilder";constructor(e){super(e,"array","PgPointTuple")}build(e){return new Rg(e,this.config)}},Rg=class extends N{static[g]="PgPointTuple";getSQLType(){return"point"}mapFromDriverValue(e){if(typeof e=="string"){let[r,n]=e.slice(1,-1).split(",");return[Number.parseFloat(r),Number.parseFloat(n)]}return[e.x,e.y]}mapToDriverValue(e){return`(${e[0]},${e[1]})`}},jg=class extends B{static[g]="PgPointObjectBuilder";constructor(e){super(e,"json","PgPointObject")}build(e){return new qg(e,this.config)}},qg=class extends N{static[g]="PgPointObject";getSQLType(){return"point"}mapFromDriverValue(e){if(typeof e=="string"){let[r,n]=e.slice(1,-1).split(",");return{x:Number.parseFloat(r),y:Number.parseFloat(n)}}return e}mapToDriverValue(e){return`(${e.x},${e.y})`}};function Bk(t,e){let{name:r,config:n}=ae(t,e);return!n?.mode||n.mode==="tuple"?new Ng(r):new jg(r)}function nM(t){let e=[];for(let r=0;r<t.length;r+=2)e.push(Number.parseInt(t.slice(r,r+2),16));return new Uint8Array(e)}function Lk(t,e){let r=new ArrayBuffer(8),n=new DataView(r);for(let i=0;i<8;i++)n.setUint8(i,t[e+i]);return n.getFloat64(0,!0)}function Dg(t){let e=nM(t),r=0,n=e[r];r+=1;let i=new DataView(e.buffer),s=i.getUint32(r,n===1);r+=4;let a;if(s&536870912&&(a=i.getUint32(r,n===1),r+=4),(s&65535)===1){let o=Lk(e,r);r+=8;let u=Lk(e,r);return r+=8,[o,u]}throw new Error("Unsupported geometry type")}var $g=class extends B{static[g]="PgGeometryBuilder";constructor(e){super(e,"array","PgGeometry")}build(e){return new Mg(e,this.config)}},Mg=class extends N{static[g]="PgGeometry";getSQLType(){return"geometry(point)"}mapFromDriverValue(e){return Dg(e)}mapToDriverValue(e){return`point(${e[0]} ${e[1]})`}},Fg=class extends B{static[g]="PgGeometryObjectBuilder";constructor(e){super(e,"json","PgGeometryObject")}build(e){return new Bg(e,this.config)}},Bg=class extends N{static[g]="PgGeometryObject";getSQLType(){return"geometry(point)"}mapFromDriverValue(e){let r=Dg(e);return{x:r[0],y:r[1]}}mapToDriverValue(e){return`point(${e.x} ${e.y})`}};function Uk(t,e){let{name:r,config:n}=ae(t,e);return!n?.mode||n.mode==="tuple"?new $g(r):new Fg(r)}var Lg=class extends B{static[g]="PgRealBuilder";constructor(e,r){super(e,"number","PgReal"),this.config.length=r}build(e){return new Ug(e,this.config)}},Ug=class extends N{static[g]="PgReal";constructor(e,r){super(e,r)}getSQLType(){return"real"}mapFromDriverValue=e=>typeof e=="string"?Number.parseFloat(e):e};function zk(t){return new Lg(t??"")}var zg=class extends B{static[g]="PgSerialBuilder";constructor(e){super(e,"number","PgSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new Qg(e,this.config)}},Qg=class extends N{static[g]="PgSerial";getSQLType(){return"serial"}};function bt(t){return new zg(t??"")}var Hg=class extends Ur{static[g]="PgSmallIntBuilder";constructor(e){super(e,"number","PgSmallInt")}build(e){return new Vg(e,this.config)}},Vg=class extends N{static[g]="PgSmallInt";getSQLType(){return"smallint"}mapFromDriverValue=e=>typeof e=="string"?Number(e):e};function Qk(t){return new Hg(t??"")}var Wg=class extends B{static[g]="PgSmallSerialBuilder";constructor(e){super(e,"number","PgSmallSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new Gg(e,this.config)}},Gg=class extends N{static[g]="PgSmallSerial";getSQLType(){return"smallserial"}};function Hk(t){return new Wg(t??"")}var Kg=class extends B{static[g]="PgTextBuilder";constructor(e,r){super(e,"string","PgText"),this.config.enumValues=r.enum}build(e){return new Jg(e,this.config)}},Jg=class extends N{static[g]="PgText";enumValues=this.config.enumValues;getSQLType(){return"text"}};function we(t,e={}){let{name:r,config:n}=ae(t,e);return new Kg(r,n)}var Zg=class extends _r{constructor(e,r,n){super(e,"string","PgTime"),this.withTimezone=r,this.precision=n,this.config.withTimezone=r,this.config.precision=n}static[g]="PgTimeBuilder";build(e){return new Cc(e,this.config)}},Cc=class extends N{static[g]="PgTime";withTimezone;precision;constructor(e,r){super(e,r),this.withTimezone=r.withTimezone,this.precision=r.precision}getSQLType(){return`time${this.precision===void 0?"":`(${this.precision})`}${this.withTimezone?" with time zone":""}`}};function Vk(t,e={}){let{name:r,config:n}=ae(t,e);return new Zg(r,n.withTimezone??!1,n.precision)}var Xg=class extends _r{static[g]="PgTimestampBuilder";constructor(e,r,n){super(e,"date","PgTimestamp"),this.config.withTimezone=r,this.config.precision=n}build(e){return new Tc(e,this.config)}},Tc=class extends N{static[g]="PgTimestamp";withTimezone;precision;constructor(e,r){super(e,r),this.withTimezone=r.withTimezone,this.precision=r.precision}getSQLType(){return`timestamp${this.precision===void 0?"":` (${this.precision})`}${this.withTimezone?" with time zone":""}`}mapFromDriverValue=e=>new Date(this.withTimezone?e:e+"+0000");mapToDriverValue=e=>e.toISOString()},Yg=class extends _r{static[g]="PgTimestampStringBuilder";constructor(e,r,n){super(e,"string","PgTimestampString"),this.config.withTimezone=r,this.config.precision=n}build(e){return new Pc(e,this.config)}},Pc=class extends N{static[g]="PgTimestampString";withTimezone;precision;constructor(e,r){super(e,r),this.withTimezone=r.withTimezone,this.precision=r.precision}getSQLType(){return`timestamp${this.precision===void 0?"":`(${this.precision})`}${this.withTimezone?" with time zone":""}`}};function Te(t,e={}){let{name:r,config:n}=ae(t,e);return n?.mode==="string"?new Yg(r,n.withTimezone??!1,n.precision):new Xg(r,n?.withTimezone??!1,n?.precision)}var ev=class extends B{static[g]="PgUUIDBuilder";constructor(e){super(e,"string","PgUUID")}defaultRandom(){return this.default(y`gen_random_uuid()`)}build(e){return new Ic(e,this.config)}},Ic=class extends N{static[g]="PgUUID";getSQLType(){return"uuid"}};function Wk(t){return new ev(t??"")}var tv=class extends B{static[g]="PgVarcharBuilder";constructor(e,r){super(e,"string","PgVarchar"),this.config.length=r.length,this.config.enumValues=r.enum}build(e){return new rv(e,this.config)}},rv=class extends N{static[g]="PgVarchar";length=this.config.length;enumValues=this.config.enumValues;getSQLType(){return this.length===void 0?"varchar":`varchar(${this.length})`}};function ze(t,e={}){let{name:r,config:n}=ae(t,e);return new tv(r,n)}var nv=class extends B{static[g]="PgBinaryVectorBuilder";constructor(e,r){super(e,"string","PgBinaryVector"),this.config.dimensions=r.dimensions}build(e){return new iv(e,this.config)}},iv=class extends N{static[g]="PgBinaryVector";dimensions=this.config.dimensions;getSQLType(){return`bit(${this.dimensions})`}};function Gk(t,e){let{name:r,config:n}=ae(t,e);return new nv(r,n)}var sv=class extends B{static[g]="PgHalfVectorBuilder";constructor(e,r){super(e,"array","PgHalfVector"),this.config.dimensions=r.dimensions}build(e){return new av(e,this.config)}},av=class extends N{static[g]="PgHalfVector";dimensions=this.config.dimensions;getSQLType(){return`halfvec(${this.dimensions})`}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){return e.slice(1,-1).split(",").map(r=>Number.parseFloat(r))}};function Kk(t,e){let{name:r,config:n}=ae(t,e);return new sv(r,n)}var ov=class extends B{static[g]="PgSparseVectorBuilder";constructor(e,r){super(e,"string","PgSparseVector"),this.config.dimensions=r.dimensions}build(e){return new cv(e,this.config)}},cv=class extends N{static[g]="PgSparseVector";dimensions=this.config.dimensions;getSQLType(){return`sparsevec(${this.dimensions})`}};function Jk(t,e){let{name:r,config:n}=ae(t,e);return new ov(r,n)}var uv=class extends B{static[g]="PgVectorBuilder";constructor(e,r){super(e,"array","PgVector"),this.config.dimensions=r.dimensions}build(e){return new lv(e,this.config)}},lv=class extends N{static[g]="PgVector";dimensions=this.config.dimensions;getSQLType(){return`vector(${this.dimensions})`}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){return e.slice(1,-1).split(",").map(r=>Number.parseFloat(r))}};function Zk(t,e){let{name:r,config:n}=ae(t,e);return new uv(r,n)}function Xk(){return{bigint:Ck,bigserial:Tk,boolean:or,char:Pk,cidr:Ik,customType:Ok,date:Nk,doublePrecision:Rk,inet:jk,integer:Yt,interval:qk,json:Dk,jsonb:Kl,line:$k,macaddr:Mk,macaddr8:Fk,numeric:Og,point:Bk,geometry:Uk,real:zk,serial:bt,smallint:Qk,smallserial:Hk,text:we,time:Vk,timestamp:Te,uuid:Wk,varchar:ze,bit:Gk,halfvec:Kk,sparsevec:Jk,vector:Zk}}var pv=Symbol.for("drizzle:PgInlineForeignKeys"),Yk=Symbol.for("drizzle:EnableRLS"),et=class extends q{static[g]="PgTable";static Symbol=Object.assign({},q.Symbol,{InlineForeignKeys:pv,EnableRLS:Yk});[pv]=[];[Yk]=!1;[q.Symbol.ExtraConfigBuilder]=void 0};function iM(t,e,r,n,i=t){let s=new et(t,n,i),a=typeof e=="function"?e(Xk()):e,o=Object.fromEntries(Object.entries(a).map(([l,p])=>{let d=p;d.setName(l);let f=d.build(s);return s[pv].push(...d.buildForeignKeys(f,s)),[l,f]})),u=Object.fromEntries(Object.entries(a).map(([l,p])=>{let d=p;d.setName(l);let f=d.buildExtraConfigColumn(s);return[l,f]})),c=Object.assign(s,o);return c[q.Symbol.Columns]=o,c[q.Symbol.ExtraConfigColumns]=u,r&&(c[et.Symbol.ExtraConfigBuilder]=r),Object.assign(c,{enableRLS:()=>(c[et.Symbol.EnableRLS]=!0,c)})}var ot=(t,e,r)=>iM(t,e,r,void 0);var Jl=class{static[g]="PgPrimaryKeyBuilder";columns;name;constructor(e,r){this.columns=e,this.name=r}build(e){return new dv(e,this.columns,this.name)}},dv=class{constructor(e,r,n){this.table=e,this.columns=r,this.name=n}static[g]="PgPrimaryKey";columns;name;getName(){return this.name??`${this.table[et.Symbol.Name]}_${this.columns.map(e=>e.name).join("_")}_pk`}};var Zl=class{constructor(e,r,n){this.sourceTable=e,this.referencedTable=r,this.relationName=n,this.referencedTableName=r[q.Symbol.Name]}static[g]="Relation";referencedTableName;fieldName},fv=class{constructor(e,r){this.table=e,this.config=r}static[g]="Relations"},gn=class t extends Zl{constructor(e,r,n,i){super(e,r,n?.relationName),this.config=n,this.isNullable=i}static[g]="One";withFieldName(e){let r=new t(this.sourceTable,this.referencedTable,this.config,this.isNullable);return r.fieldName=e,r}},Oc=class t extends Zl{constructor(e,r,n){super(e,r,n?.relationName),this.config=n}static[g]="Many";withFieldName(e){let r=new t(this.sourceTable,this.referencedTable,this.config);return r.fieldName=e,r}};function e4(){return{and:bc,between:gk,eq:se,exists:mk,gt:ak,gte:ok,ilike:bk,inArray:lk,isNull:dk,isNotNull:fk,like:yk,lt:ck,lte:uk,ne:nk,not:sk,notBetween:vk,notExists:hk,notLike:xk,notIlike:wk,notInArray:pk,or:ik,sql:y}}function t4(){return{sql:y,asc:_k,desc:Ks}}function r4(t,e){Object.keys(t).length===1&&"default"in t&&!E(t.default,q)&&(t=t.default);let r={},n={},i={};for(let[s,a]of Object.entries(t))if(E(a,q)){let o=ui(a),u=n[o];r[o]=s,i[s]={tsName:s,dbName:a[q.Symbol.Name],schema:a[q.Symbol.Schema],columns:a[q.Symbol.Columns],relations:u?.relations??{},primaryKey:u?.primaryKey??[]};for(let l of Object.values(a[q.Symbol.Columns]))l.primary&&i[s].primaryKey.push(l);let c=a[q.Symbol.ExtraConfigBuilder]?.(a[q.Symbol.ExtraConfigColumns]);if(c)for(let l of Object.values(c))E(l,Jl)&&i[s].primaryKey.push(...l.columns)}else if(E(a,fv)){let o=ui(a.table),u=r[o],c=a.config(e(a.table)),l;for(let[p,d]of Object.entries(c))if(u){let f=i[u];f.relations[p]=d,l&&f.primaryKey.push(...l)}else o in n||(n[o]={relations:{},primaryKey:l}),n[o].relations[p]=d}return{tables:i,tableNamesMap:r}}function sM(t){return function(r,n){return new gn(t,r,n,n?.fields.reduce((i,s)=>i&&s.notNull,!0)??!1)}}function aM(t){return function(r,n){return new Oc(t,r,n)}}function n4(t,e,r){if(E(r,gn)&&r.config)return{fields:r.config.fields,references:r.config.references};let n=e[ui(r.referencedTable)];if(!n)throw new Error(`Table "${r.referencedTable[q.Symbol.Name]}" not found in schema`);let i=t[n];if(!i)throw new Error(`Table "${n}" not found in schema`);let s=r.sourceTable,a=e[ui(s)];if(!a)throw new Error(`Table "${s[q.Symbol.Name]}" not found in schema`);let o=[];for(let u of Object.values(i.relations))(r.relationName&&r!==u&&u.relationName===r.relationName||!r.relationName&&u.referencedTable===r.sourceTable)&&o.push(u);if(o.length>1)throw r.relationName?new Error(`There are multiple relations with name "${r.relationName}" in table "${n}"`):new Error(`There are multiple relations between "${n}" and "${r.sourceTable[q.Symbol.Name]}". Please specify relation name`);if(o[0]&&E(o[0],gn)&&o[0].config)return{fields:o[0].config.references,references:o[0].config.fields};throw new Error(`There is not enough information to infer relation "${a}.${r.fieldName}"`)}function i4(t){return{one:sM(t),many:aM(t)}}function Xl(t,e,r,n,i=s=>s){let s={};for(let[a,o]of n.entries())if(o.isJson){let u=e.relations[o.tsKey],c=r[a],l=typeof c=="string"?JSON.parse(c):c;s[o.tsKey]=E(u,gn)?l&&Xl(t,t[o.relationTableTsKey],l,o.selection,i):l.map(p=>Xl(t,t[o.relationTableTsKey],p,o.selection,i))}else{let u=i(r[a]),c=o.field,l;E(c,le)?l=c:E(c,M)?l=c.decoder:l=c.sql.decoder,s[o.tsKey]=u===null?null:l.mapFromDriverValue(u)}return s}var qe=class t{static[g]="SelectionProxyHandler";config;constructor(e){this.config={...e}}get(e,r){if(r==="_")return{...e._,selectedFields:new Proxy(e._.selectedFields,this)};if(r===be)return{...e[be],selectedFields:new Proxy(e[be].selectedFields,this)};if(typeof r=="symbol")return e[r];let i=(E(e,Fe)?e._.selectedFields:E(e,yt)?e[be].selectedFields:e)[r];if(E(i,M.Aliased)){if(this.config.sqlAliasedBehavior==="sql"&&!i.isSelectionField)return i.sql;let s=i.clone();return s.isSelectionField=!0,s}if(E(i,M)){if(this.config.sqlBehavior==="sql")return i;throw new Error(`You tried to reference "${r}" field from a subquery, which is a raw SQL field, but it doesn't have an alias declared. Please add an alias to the field using ".as('alias')" method.`)}return E(i,le)?this.config.alias?new Proxy(i,new li(new Proxy(i.table,new Gs(this.config.alias,this.config.replaceOriginalName??!1)))):i:typeof i!="object"||i===null?i:new Proxy(i,new t(this.config))}};var Nc=class extends at{constructor(e,r,n,i){super(),this.session=r,this.dialect=n,this.config={table:e,withList:i}}static[g]="PgDelete";config;where(e){return this.config.where=e,this}returning(e=this.config.table[q.Symbol.Columns]){return this.config.returningFields=e,this.config.returning=Xt(e),this}getSQL(){return this.dialect.buildDeleteQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}_prepare(e){return xe.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>xe.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken));getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new qe({alias:Tt(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};function oM(t){return(t.replace(/['\u2019]/g,"").match(/[\da-z]+|[A-Z]+(?![a-z])|[A-Z][\da-z]+/g)??[]).map(r=>r.toLowerCase()).join("_")}function cM(t){return(t.replace(/['\u2019]/g,"").match(/[\da-z]+|[A-Z]+(?![a-z])|[A-Z][\da-z]+/g)??[]).reduce((r,n,i)=>{let s=i===0?n.toLowerCase():`${n[0].toUpperCase()}${n.slice(1)}`;return r+s},"")}function uM(t){return t}var Yl=class{static[g]="CasingCache";cache={};cachedTables={};convert;constructor(e){this.convert=e==="snake_case"?oM:e==="camelCase"?cM:uM}getColumnCasing(e){if(!e.keyAsName)return e.name;let r=e.table[q.Symbol.Schema]??"public",n=e.table[q.Symbol.OriginalName],i=`${r}.${n}.${e.name}`;return this.cache[i]||this.cacheTable(e.table),this.cache[i]}cacheTable(e){let r=e[q.Symbol.Schema]??"public",n=e[q.Symbol.OriginalName],i=`${r}.${n}`;if(!this.cachedTables[i]){for(let s of Object.values(e[q.Symbol.Columns])){let a=`${i}.${s.name}`;this.cache[a]=this.convert(s.name)}this.cachedTables[i]=!0}}clearCache(){this.cache={},this.cachedTables={}}};var Js=class extends yt{static[g]="PgViewBase"};var vn=class{static[g]="PgDialect";casing;constructor(e){this.casing=new Yl(e?.casing)}async migrate(e,r,n){let i=typeof n=="string"?"__drizzle_migrations":n.migrationsTable??"__drizzle_migrations",s=typeof n=="string"?"drizzle":n.migrationsSchema??"drizzle",a=y`
    71              CREATE TABLE IF NOT EXISTS ${y.identifier(s)}.${y.identifier(i)} (
    72                  id SERIAL PRIMARY KEY,
    73                  hash text NOT NULL,
    74                  created_at bigint
    75              )
    76          `;await r.execute(y`CREATE SCHEMA IF NOT EXISTS ${y.identifier(s)}`),await r.execute(a);let u=(await r.all(y`select id, hash, created_at from ${y.identifier(s)}.${y.identifier(i)} order by created_at desc limit 1`))[0];await r.transaction(async c=>{for await(let l of e)if(!u||Number(u.created_at)<l.folderMillis){for(let p of l.sql)await c.execute(y.raw(p));await c.execute(y`insert into ${y.identifier(s)}.${y.identifier(i)} ("hash", "created_at") values(${l.hash}, ${l.folderMillis})`)}})}escapeName(e){return`"${e}"`}escapeParam(e){return`$${e+1}`}escapeString(e){return`'${e.replace(/'/g,"''")}'`}buildWithCTE(e){if(!e?.length)return;let r=[y`with `];for(let[n,i]of e.entries())r.push(y`${y.identifier(i._.alias)} as (${i._.sql})`),n<e.length-1&&r.push(y`, `);return r.push(y` `),y.join(r)}buildDeleteQuery({table:e,where:r,returning:n,withList:i}){let s=this.buildWithCTE(i),a=n?y` returning ${this.buildSelection(n,{isSingleTable:!0})}`:void 0,o=r?y` where ${r}`:void 0;return y`${s}delete from ${e}${o}${a}`}buildUpdateSet(e,r){let n=e[q.Symbol.Columns],i=Object.keys(n).filter(a=>r[a]!==void 0||n[a]?.onUpdateFn!==void 0),s=i.length;return y.join(i.flatMap((a,o)=>{let u=n[a],c=r[a]??y.param(u.onUpdateFn(),u),l=y`${y.identifier(this.casing.getColumnCasing(u))} = ${c}`;return o<s-1?[l,y.raw(", ")]:[l]}))}buildUpdateQuery({table:e,set:r,where:n,returning:i,withList:s,from:a,joins:o}){let u=this.buildWithCTE(s),c=e[et.Symbol.Name],l=e[et.Symbol.Schema],p=e[et.Symbol.OriginalName],d=c===p?void 0:c,f=y`${l?y`${y.identifier(l)}.`:void 0}${y.identifier(p)}${d&&y` ${y.identifier(d)}`}`,h=this.buildUpdateSet(e,r),m=a&&y.join([y.raw(" from "),this.buildFromTable(a)]),x=this.buildJoins(o),_=i?y` returning ${this.buildSelection(i,{isSingleTable:!a})}`:void 0,w=n?y` where ${n}`:void 0;return y`${u}update ${f} set ${h}${m}${x}${w}${_}`}buildSelection(e,{isSingleTable:r=!1}={}){let n=e.length,i=e.flatMap(({field:s},a)=>{let o=[];if(E(s,M.Aliased)&&s.isSelectionField)o.push(y.identifier(s.fieldAlias));else if(E(s,M.Aliased)||E(s,M)){let u=E(s,M.Aliased)?s.sql:s;r?o.push(new M(u.queryChunks.map(c=>E(c,N)?y.identifier(this.casing.getColumnCasing(c)):c))):o.push(u),E(s,M.Aliased)&&o.push(y` as ${y.identifier(s.fieldAlias)}`)}else E(s,le)&&(r?o.push(y.identifier(this.casing.getColumnCasing(s))):o.push(s));return a<n-1&&o.push(y`, `),o});return y.join(i)}buildJoins(e){if(!e||e.length===0)return;let r=[];for(let[n,i]of e.entries()){n===0&&r.push(y` `);let s=i.table,a=i.lateral?y` lateral`:void 0;if(E(s,et)){let o=s[et.Symbol.Name],u=s[et.Symbol.Schema],c=s[et.Symbol.OriginalName],l=o===c?void 0:i.alias;r.push(y`${y.raw(i.joinType)} join${a} ${u?y`${y.identifier(u)}.`:void 0}${y.identifier(c)}${l&&y` ${y.identifier(l)}`} on ${i.on}`)}else if(E(s,yt)){let o=s[be].name,u=s[be].schema,c=s[be].originalName,l=o===c?void 0:i.alias;r.push(y`${y.raw(i.joinType)} join${a} ${u?y`${y.identifier(u)}.`:void 0}${y.identifier(c)}${l&&y` ${y.identifier(l)}`} on ${i.on}`)}else r.push(y`${y.raw(i.joinType)} join${a} ${s} on ${i.on}`);n<e.length-1&&r.push(y` `)}return y.join(r)}buildFromTable(e){if(E(e,q)&&e[q.Symbol.OriginalName]!==e[q.Symbol.Name]){let r=y`${y.identifier(e[q.Symbol.OriginalName])}`;return e[q.Symbol.Schema]&&(r=y`${y.identifier(e[q.Symbol.Schema])}.${r}`),y`${r} ${y.identifier(e[q.Symbol.Name])}`}return e}buildSelectQuery({withList:e,fields:r,fieldsFlat:n,where:i,having:s,table:a,joins:o,orderBy:u,groupBy:c,limit:l,offset:p,lockingClause:d,distinct:f,setOperators:h}){let m=n??Xt(r);for(let _e of m)if(E(_e.field,le)&&Tt(_e.field.table)!==(E(a,Fe)?a._.alias:E(a,Js)?a[be].name:E(a,M)?void 0:Tt(a))&&!(Ae=>o?.some(({alias:Rt})=>Rt===(Ae[q.Symbol.IsAlias]?Tt(Ae):Ae[q.Symbol.BaseName])))(_e.field.table)){let Ae=Tt(_e.field.table);throw new Error(`Your "${_e.path.join("->")}" field references a column "${Ae}"."${_e.field.name}", but the table "${Ae}" is not part of the query! Did you forget to join it?`)}let x=!o||o.length===0,_=this.buildWithCTE(e),w;f&&(w=f===!0?y` distinct`:y` distinct on (${y.join(f.on,y`, `)})`);let A=this.buildSelection(m,{isSingleTable:x}),P=this.buildFromTable(a),F=this.buildJoins(o),T=i?y` where ${i}`:void 0,C=s?y` having ${s}`:void 0,R;u&&u.length>0&&(R=y` order by ${y.join(u,y`, `)}`);let z;c&&c.length>0&&(z=y` group by ${y.join(c,y`, `)}`);let Y=typeof l=="object"||typeof l=="number"&&l>=0?y` limit ${l}`:void 0,te=p?y` offset ${p}`:void 0,re=y.empty();if(d){let _e=y` for ${y.raw(d.strength)}`;d.config.of&&_e.append(y` of ${y.join(Array.isArray(d.config.of)?d.config.of:[d.config.of],y`, `)}`),d.config.noWait?_e.append(y` no wait`):d.config.skipLocked&&_e.append(y` skip locked`),re.append(_e)}let oe=y`${_}select${w} ${A} from ${P}${F}${T}${z}${C}${R}${Y}${te}${re}`;return h.length>0?this.buildSetOperations(oe,h):oe}buildSetOperations(e,r){let[n,...i]=r;if(!n)throw new Error("Cannot pass undefined values to any set operator");return i.length===0?this.buildSetOperationQuery({leftSelect:e,setOperator:n}):this.buildSetOperations(this.buildSetOperationQuery({leftSelect:e,setOperator:n}),i)}buildSetOperationQuery({leftSelect:e,setOperator:{type:r,isAll:n,rightSelect:i,limit:s,orderBy:a,offset:o}}){let u=y`(${e.getSQL()}) `,c=y`(${i.getSQL()})`,l;if(a&&a.length>0){let h=[];for(let m of a)if(E(m,N))h.push(y.identifier(m.name));else if(E(m,M)){for(let x=0;x<m.queryChunks.length;x++){let _=m.queryChunks[x];E(_,N)&&(m.queryChunks[x]=y.identifier(_.name))}h.push(y`${m}`)}else h.push(y`${m}`);l=y` order by ${y.join(h,y`, `)} `}let p=typeof s=="object"||typeof s=="number"&&s>=0?y` limit ${s}`:void 0,d=y.raw(`${r} ${n?"all ":""}`),f=o?y` offset ${o}`:void 0;return y`${u}${d}${c}${l}${p}${f}`}buildInsertQuery({table:e,values:r,onConflict:n,returning:i,withList:s,select:a,overridingSystemValue_:o}){let u=[],c=e[q.Symbol.Columns],l=Object.entries(c).filter(([_,w])=>!w.shouldDisableInsert()),p=l.map(([,_])=>y.identifier(this.casing.getColumnCasing(_)));if(a){let _=r;E(_,M)?u.push(_):u.push(_.getSQL())}else{let _=r;u.push(y.raw("values "));for(let[w,A]of _.entries()){let P=[];for(let[F,T]of l){let C=A[F];if(C===void 0||E(C,Pt)&&C.value===void 0)if(T.defaultFn!==void 0){let R=T.defaultFn(),z=E(R,M)?R:y.param(R,T);P.push(z)}else if(!T.default&&T.onUpdateFn!==void 0){let R=T.onUpdateFn(),z=E(R,M)?R:y.param(R,T);P.push(z)}else P.push(y`default`);else P.push(C)}u.push(P),w<_.length-1&&u.push(y`, `)}}let d=this.buildWithCTE(s),f=y.join(u),h=i?y` returning ${this.buildSelection(i,{isSingleTable:!0})}`:void 0,m=n?y` on conflict ${n}`:void 0,x=o===!0?y`overriding system value `:void 0;return y`${d}insert into ${e} ${p} ${x}${f}${m}${h}`}buildRefreshMaterializedViewQuery({view:e,concurrently:r,withNoData:n}){let i=r?y` concurrently`:void 0,s=n?y` with no data`:void 0;return y`refresh materialized view${i} ${e}${s}`}prepareTyping(e){return E(e,Ac)||E(e,Ec)?"json":E(e,kc)?"decimal":E(e,Cc)?"time":E(e,Tc)||E(e,Pc)?"timestamp":E(e,_c)||E(e,Sc)?"date":E(e,Ic)?"uuid":"none"}sqlToQuery(e,r){return e.toQuery({casing:this.casing,escapeName:this.escapeName,escapeParam:this.escapeParam,escapeString:this.escapeString,prepareTyping:this.prepareTyping,invokeSource:r})}buildRelationalQueryWithoutPK({fullSchema:e,schema:r,tableNamesMap:n,table:i,tableConfig:s,queryConfig:a,tableAlias:o,nestedQueryRelation:u,joinOn:c}){let l=[],p,d,f=[],h,m=[];if(a===!0)l=Object.entries(s.columns).map(([w,A])=>({dbKey:A.name,tsKey:w,field:wr(A,o),relationTableTsKey:void 0,isJson:!1,selection:[]}));else{let _=Object.fromEntries(Object.entries(s.columns).map(([C,R])=>[C,wr(R,o)]));if(a.where){let C=typeof a.where=="function"?a.where(_,e4()):a.where;h=C&&yc(C,o)}let w=[],A=[];if(a.columns){let C=!1;for(let[R,z]of Object.entries(a.columns))z!==void 0&&R in s.columns&&(!C&&z===!0&&(C=!0),A.push(R));A.length>0&&(A=C?A.filter(R=>a.columns?.[R]===!0):Object.keys(s.columns).filter(R=>!A.includes(R)))}else A=Object.keys(s.columns);for(let C of A){let R=s.columns[C];w.push({tsKey:C,value:R})}let P=[];a.with&&(P=Object.entries(a.with).filter(C=>!!C[1]).map(([C,R])=>({tsKey:C,queryConfig:R,relation:s.relations[C]})));let F;if(a.extras){F=typeof a.extras=="function"?a.extras(_,{sql:y}):a.extras;for(let[C,R]of Object.entries(F))w.push({tsKey:C,value:Vh(R,o)})}for(let{tsKey:C,value:R}of w)l.push({dbKey:E(R,M.Aliased)?R.fieldAlias:s.columns[C].name,tsKey:C,field:E(R,le)?wr(R,o):R,relationTableTsKey:void 0,isJson:!1,selection:[]});let T=typeof a.orderBy=="function"?a.orderBy(_,t4()):a.orderBy??[];Array.isArray(T)||(T=[T]),f=T.map(C=>E(C,le)?wr(C,o):yc(C,o)),p=a.limit,d=a.offset;for(let{tsKey:C,queryConfig:R,relation:z}of P){let Y=n4(r,n,z),te=ui(z.referencedTable),re=n[te],oe=`${o}_${C}`,_e=bc(...Y.fields.map((Un,to)=>se(wr(Y.references[to],oe),wr(Un,o)))),Ae=this.buildRelationalQueryWithoutPK({fullSchema:e,schema:r,tableNamesMap:n,table:e[re],tableConfig:r[re],queryConfig:E(z,gn)?R===!0?{limit:1}:{...R,limit:1}:R,tableAlias:oe,joinOn:_e,nestedQueryRelation:z}),Rt=y`${y.identifier(oe)}.${y.identifier("data")}`.as(C);m.push({on:y`true`,table:new Fe(Ae.sql,{},oe),alias:oe,joinType:"left",lateral:!0}),l.push({dbKey:C,tsKey:C,field:Rt,relationTableTsKey:re,isJson:!0,selection:Ae.selection})}}if(l.length===0)throw new xc({message:`No fields selected for table "${s.tsName}" ("${o}")`});let x;if(h=bc(c,h),u){let _=y`json_build_array(${y.join(l.map(({field:P,tsKey:F,isJson:T})=>T?y`${y.identifier(`${o}_${F}`)}.${y.identifier("data")}`:E(P,M.Aliased)?P.sql:P),y`, `)})`;E(u,Oc)&&(_=y`coalesce(json_agg(${_}${f.length>0?y` order by ${y.join(f,y`, `)}`:void 0}), '[]'::json)`);let w=[{dbKey:"data",tsKey:"data",field:_.as("data"),isJson:!0,relationTableTsKey:s.tsName,selection:l}];p!==void 0||d!==void 0||f.length>0?(x=this.buildSelectQuery({table:vc(i,o),fields:{},fieldsFlat:[{path:[],field:y.raw("*")}],where:h,limit:p,offset:d,orderBy:f,setOperators:[]}),h=void 0,p=void 0,d=void 0,f=[]):x=vc(i,o),x=this.buildSelectQuery({table:E(x,et)?x:new Fe(x,{},o),fields:{},fieldsFlat:w.map(({field:P})=>({path:[],field:E(P,le)?wr(P,o):P})),joins:m,where:h,limit:p,offset:d,orderBy:f,setOperators:[]})}else x=this.buildSelectQuery({table:vc(i,o),fields:{},fieldsFlat:l.map(({field:_})=>({path:[],field:E(_,le)?wr(_,o):_})),joins:m,where:h,limit:p,offset:d,orderBy:f,setOperators:[]});return{tableTsKey:s.tsName,sql:x,selection:l}}};var ep=class{static[g]="TypedQueryBuilder";getSelectedFields(){return this._.selectedFields}};var ct=class{static[g]="PgSelectBuilder";fields;session;dialect;withList=[];distinct;constructor(e){this.fields=e.fields,this.session=e.session,this.dialect=e.dialect,e.withList&&(this.withList=e.withList),this.distinct=e.distinct}authToken;setToken(e){return this.authToken=e,this}from(e){let r=!!this.fields,n=e,i;return this.fields?i=this.fields:E(n,Fe)?i=Object.fromEntries(Object.keys(n._.selectedFields).map(s=>[s,n[s]])):E(n,Js)?i=n[be].selectedFields:E(n,M)?i={}:i=Gl(n),new tp({table:n,fields:i,isPartialSelect:r,session:this.session,dialect:this.dialect,withList:this.withList,distinct:this.distinct}).setToken(this.authToken)}},mv=class extends ep{static[g]="PgSelectQueryBuilder";_;config;joinsNotNullableMap;tableName;isPartialSelect;session;dialect;constructor({table:e,fields:r,isPartialSelect:n,session:i,dialect:s,withList:a,distinct:o}){super(),this.config={withList:a,table:e,fields:{...r},distinct:o,setOperators:[]},this.isPartialSelect=n,this.session=i,this.dialect=s,this._={selectedFields:r},this.tableName=Lr(e),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{}}createJoin(e){return(r,n)=>{let i=this.tableName,s=Lr(r);if(typeof s=="string"&&this.config.joins?.some(a=>a.alias===s))throw new Error(`Alias "${s}" is already used in this query`);if(!this.isPartialSelect&&(Object.keys(this.joinsNotNullableMap).length===1&&typeof i=="string"&&(this.config.fields={[i]:this.config.fields}),typeof s=="string"&&!E(r,M))){let a=E(r,Fe)?r._.selectedFields:E(r,yt)?r[be].selectedFields:r[q.Symbol.Columns];this.config.fields[s]=a}if(typeof n=="function"&&(n=n(new Proxy(this.config.fields,new qe({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.joins||(this.config.joins=[]),this.config.joins.push({on:n,table:r,joinType:e,alias:s}),typeof s=="string")switch(e){case"left":{this.joinsNotNullableMap[s]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[s]=!0;break}case"inner":{this.joinsNotNullableMap[s]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[s]=!1;break}}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");createSetOperator(e,r){return n=>{let i=typeof n=="function"?n(lM()):n;if(!wc(this.getSelectedFields(),i.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return this.config.setOperators.push({type:e,isAll:r,rightSelect:i}),this}}union=this.createSetOperator("union",!1);unionAll=this.createSetOperator("union",!0);intersect=this.createSetOperator("intersect",!1);intersectAll=this.createSetOperator("intersect",!0);except=this.createSetOperator("except",!1);exceptAll=this.createSetOperator("except",!0);addSetOperators(e){return this.config.setOperators.push(...e),this}where(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new qe({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.where=e,this}having(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new qe({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.having=e,this}groupBy(...e){if(typeof e[0]=="function"){let r=e[0](new Proxy(this.config.fields,new qe({sqlAliasedBehavior:"alias",sqlBehavior:"sql"})));this.config.groupBy=Array.isArray(r)?r:[r]}else this.config.groupBy=e;return this}orderBy(...e){if(typeof e[0]=="function"){let r=e[0](new Proxy(this.config.fields,new qe({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),n=Array.isArray(r)?r:[r];this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=n:this.config.orderBy=n}else{let r=e;this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=r:this.config.orderBy=r}return this}limit(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).limit=e:this.config.limit=e,this}offset(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).offset=e:this.config.offset=e,this}for(e,r={}){return this.config.lockingClause={strength:e,config:r},this}getSQL(){return this.dialect.buildSelectQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}as(e){return new Proxy(new Fe(this.getSQL(),this.config.fields,e),new qe({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}getSelectedFields(){return new Proxy(this.config.fields,new qe({alias:this.tableName,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}$dynamic(){return this}},tp=class extends mv{static[g]="PgSelect";_prepare(e){let{session:r,config:n,dialect:i,joinsNotNullableMap:s,authToken:a}=this;if(!r)throw new Error("Cannot execute a query on a query builder. Please use a database instance instead.");return xe.startActiveSpan("drizzle.prepareQuery",()=>{let o=Xt(n.fields),u=r.prepareQuery(i.sqlToQuery(this.getSQL()),o,e,!0);return u.joinsNotNullableMap=s,u.setToken(a)})}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>xe.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken))};Ek(tp,[at]);function Zs(t,e){return(r,n,...i)=>{let s=[n,...i].map(a=>({type:t,isAll:e,rightSelect:a}));for(let a of s)if(!wc(r.getSelectedFields(),a.rightSelect.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return r.addSetOperators(s)}}var lM=()=>({union:pM,unionAll:dM,intersect:fM,intersectAll:mM,except:hM,exceptAll:gM}),pM=Zs("union",!1),dM=Zs("union",!0),fM=Zs("intersect",!1),mM=Zs("intersect",!0),hM=Zs("except",!1),gM=Zs("except",!0);var Xs=class{static[g]="PgQueryBuilder";dialect;dialectConfig;constructor(e){this.dialect=E(e,vn)?e:void 0,this.dialectConfig=E(e,vn)?void 0:e}$with=(e,r)=>{let n=this;return{as:s=>(typeof s=="function"&&(s=s(n)),new Proxy(new Ws(s.getSQL(),r??("getSelectedFields"in s?s.getSelectedFields()??{}:{}),e,!0),new qe({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};with(...e){let r=this;function n(a){return new ct({fields:a??void 0,session:void 0,dialect:r.getDialect(),withList:e})}function i(a){return new ct({fields:a??void 0,session:void 0,dialect:r.getDialect(),distinct:!0})}function s(a,o){return new ct({fields:o??void 0,session:void 0,dialect:r.getDialect(),distinct:{on:a}})}return{select:n,selectDistinct:i,selectDistinctOn:s}}select(e){return new ct({fields:e??void 0,session:void 0,dialect:this.getDialect()})}selectDistinct(e){return new ct({fields:e??void 0,session:void 0,dialect:this.getDialect(),distinct:!0})}selectDistinctOn(e,r){return new ct({fields:r??void 0,session:void 0,dialect:this.getDialect(),distinct:{on:e}})}getDialect(){return this.dialect||(this.dialect=new vn(this.dialectConfig)),this.dialect}};var Rc=class{constructor(e,r,n,i,s){this.table=e,this.session=r,this.dialect=n,this.withList=i,this.overridingSystemValue_=s}static[g]="PgInsertBuilder";authToken;setToken(e){return this.authToken=e,this}overridingSystemValue(){return this.overridingSystemValue_=!0,this}values(e){if(e=Array.isArray(e)?e:[e],e.length===0)throw new Error("values() must be called with at least one value");let r=e.map(n=>{let i={},s=this.table[q.Symbol.Columns];for(let a of Object.keys(n)){let o=n[a];i[a]=E(o,M)?o:new Pt(o,s[a])}return i});return new rp(this.table,r,this.session,this.dialect,this.withList,!1,this.overridingSystemValue_).setToken(this.authToken)}select(e){let r=typeof e=="function"?e(new Xs):e;if(!E(r,M)&&!wc(this.table[zl],r._.selectedFields))throw new Error("Insert select error: selected fields are not the same or are in a different order compared to the table definition");return new rp(this.table,r,this.session,this.dialect,this.withList,!0)}},rp=class extends at{constructor(e,r,n,i,s,a,o){super(),this.session=n,this.dialect=i,this.config={table:e,values:r,withList:s,select:a,overridingSystemValue_:o}}static[g]="PgInsert";config;returning(e=this.config.table[q.Symbol.Columns]){return this.config.returningFields=e,this.config.returning=Xt(e),this}onConflictDoNothing(e={}){if(e.target===void 0)this.config.onConflict=y`do nothing`;else{let r="";r=Array.isArray(e.target)?e.target.map(i=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(i))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(e.target));let n=e.where?y` where ${e.where}`:void 0;this.config.onConflict=y`(${y.raw(r)})${n} do nothing`}return this}onConflictDoUpdate(e){if(e.where&&(e.targetWhere||e.setWhere))throw new Error('You cannot use both "where" and "targetWhere"/"setWhere" at the same time - "where" is deprecated, use "targetWhere" or "setWhere" instead.');let r=e.where?y` where ${e.where}`:void 0,n=e.targetWhere?y` where ${e.targetWhere}`:void 0,i=e.setWhere?y` where ${e.setWhere}`:void 0,s=this.dialect.buildUpdateSet(this.config.table,Wl(this.config.table,e.set)),a="";return a=Array.isArray(e.target)?e.target.map(o=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(o))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(e.target)),this.config.onConflict=y`(${y.raw(a)})${n} do update set ${s}${r}${i}`,this}getSQL(){return this.dialect.buildInsertQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}_prepare(e){return xe.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>xe.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken));getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new qe({alias:Tt(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};var np=class extends at{constructor(e,r,n){super(),this.session=r,this.dialect=n,this.config={view:e}}static[g]="PgRefreshMaterializedView";config;concurrently(){if(this.config.withNoData!==void 0)throw new Error("Cannot use concurrently and withNoData together");return this.config.concurrently=!0,this}withNoData(){if(this.config.concurrently!==void 0)throw new Error("Cannot use concurrently and withNoData together");return this.config.withNoData=!0,this}getSQL(){return this.dialect.buildRefreshMaterializedViewQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}_prepare(e){return xe.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),void 0,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>xe.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken))};var jc=class{constructor(e,r,n,i){this.table=e,this.session=r,this.dialect=n,this.withList=i}static[g]="PgUpdateBuilder";authToken;setToken(e){return this.authToken=e,this}set(e){return new hv(this.table,Wl(this.table,e),this.session,this.dialect,this.withList).setToken(this.authToken)}},hv=class extends at{constructor(e,r,n,i,s){super(),this.session=n,this.dialect=i,this.config={set:r,table:e,withList:s,joins:[]},this.tableName=Lr(e),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{}}static[g]="PgUpdate";config;tableName;joinsNotNullableMap;from(e){let r=e,n=Lr(r);return typeof n=="string"&&(this.joinsNotNullableMap[n]=!0),this.config.from=r,this}getTableLikeFields(e){return E(e,et)?e[q.Symbol.Columns]:E(e,Fe)?e._.selectedFields:e[be].selectedFields}createJoin(e){return(r,n)=>{let i=Lr(r);if(typeof i=="string"&&this.config.joins.some(s=>s.alias===i))throw new Error(`Alias "${i}" is already used in this query`);if(typeof n=="function"){let s=this.config.from&&!E(this.config.from,M)?this.getTableLikeFields(this.config.from):void 0;n=n(new Proxy(this.config.table[q.Symbol.Columns],new qe({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})),s&&new Proxy(s,new qe({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))}if(this.config.joins.push({on:n,table:r,joinType:e,alias:i}),typeof i=="string")switch(e){case"left":{this.joinsNotNullableMap[i]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([s])=>[s,!1])),this.joinsNotNullableMap[i]=!0;break}case"inner":{this.joinsNotNullableMap[i]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([s])=>[s,!1])),this.joinsNotNullableMap[i]=!1;break}}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");where(e){return this.config.where=e,this}returning(e){if(!e&&(e=Object.assign({},this.config.table[q.Symbol.Columns]),this.config.from)){let r=Lr(this.config.from);if(typeof r=="string"&&this.config.from&&!E(this.config.from,M)){let n=this.getTableLikeFields(this.config.from);e[r]=n}for(let n of this.config.joins){let i=Lr(n.table);if(typeof i=="string"&&!E(n.table,M)){let s=this.getTableLikeFields(n.table);e[i]=s}}}return this.config.returningFields=e,this.config.returning=Xt(e),this}getSQL(){return this.dialect.buildUpdateQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}_prepare(e){let r=this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0);return r.joinsNotNullableMap=this.joinsNotNullableMap,r}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>this._prepare().execute(e,this.authToken);getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new qe({alias:Tt(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};var ip=class t extends M{constructor(e){super(t.buildEmbeddedCount(e.source,e.filters).queryChunks),this.params=e,this.mapWith(Number),this.session=e.session,this.sql=t.buildCount(e.source,e.filters)}sql;token;static[g]="PgCountBuilder";[Symbol.toStringTag]="PgCountBuilder";session;static buildEmbeddedCount(e,r){return y`(select count(*) from ${e}${y.raw(" where ").if(r)}${r})`}static buildCount(e,r){return y`select count(*) as count from ${e}${y.raw(" where ").if(r)}${r};`}setToken(e){return this.token=e,this}then(e,r){return Promise.resolve(this.session.count(this.sql,this.token)).then(e,r)}catch(e){return this.then(void 0,e)}finally(e){return this.then(r=>(e?.(),r),r=>{throw e?.(),r})}};var sp=class{constructor(e,r,n,i,s,a,o){this.fullSchema=e,this.schema=r,this.tableNamesMap=n,this.table=i,this.tableConfig=s,this.dialect=a,this.session=o}static[g]="PgRelationalQueryBuilder";findMany(e){return new ap(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e||{},"many")}findFirst(e){return new ap(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e?{...e,limit:1}:{limit:1},"first")}},ap=class extends at{constructor(e,r,n,i,s,a,o,u,c){super(),this.fullSchema=e,this.schema=r,this.tableNamesMap=n,this.table=i,this.tableConfig=s,this.dialect=a,this.session=o,this.config=u,this.mode=c}static[g]="PgRelationalQuery";_prepare(e){return xe.startActiveSpan("drizzle.prepareQuery",()=>{let{query:r,builtQuery:n}=this._toSQL();return this.session.prepareQuery(n,void 0,e,!0,(i,s)=>{let a=i.map(o=>Xl(this.schema,this.tableConfig,o,r.selection,s));return this.mode==="first"?a[0]:a})})}prepare(e){return this._prepare(e)}_getQuery(){return this.dialect.buildRelationalQueryWithoutPK({fullSchema:this.fullSchema,schema:this.schema,tableNamesMap:this.tableNamesMap,table:this.table,tableConfig:this.tableConfig,queryConfig:this.config,tableAlias:this.tableConfig.tsName})}getSQL(){return this._getQuery().sql}_toSQL(){let e=this._getQuery(),r=this.dialect.sqlToQuery(e.sql);return{query:e,builtQuery:r}}toSQL(){return this._toSQL().builtQuery}authToken;setToken(e){return this.authToken=e,this}execute(){return xe.startActiveSpan("drizzle.operation",()=>this._prepare().execute(void 0,this.authToken))}};var op=class extends at{constructor(e,r,n,i){super(),this.execute=e,this.sql=r,this.query=n,this.mapBatchResult=i}static[g]="PgRaw";getSQL(){return this.sql}getQuery(){return this.query}mapResult(e,r){return r?this.mapBatchResult(e):e}_prepare(){return this}isResponseInArrayMode(){return!1}};var Ys=class{constructor(e,r,n){if(this.dialect=e,this.session=r,this._=n?{schema:n.schema,fullSchema:n.fullSchema,tableNamesMap:n.tableNamesMap,session:r}:{schema:void 0,fullSchema:{},tableNamesMap:{},session:r},this.query={},this._.schema)for(let[i,s]of Object.entries(this._.schema))this.query[i]=new sp(n.fullSchema,this._.schema,this._.tableNamesMap,n.fullSchema[i],s,e,r)}static[g]="PgDatabase";query;$with=(e,r)=>{let n=this;return{as:s=>(typeof s=="function"&&(s=s(new Xs(n.dialect))),new Proxy(new Ws(s.getSQL(),r??("getSelectedFields"in s?s.getSelectedFields()??{}:{}),e,!0),new qe({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};$count(e,r){return new ip({source:e,filters:r,session:this.session})}with(...e){let r=this;function n(c){return new ct({fields:c??void 0,session:r.session,dialect:r.dialect,withList:e})}function i(c){return new ct({fields:c??void 0,session:r.session,dialect:r.dialect,withList:e,distinct:!0})}function s(c,l){return new ct({fields:l??void 0,session:r.session,dialect:r.dialect,withList:e,distinct:{on:c}})}function a(c){return new jc(c,r.session,r.dialect,e)}function o(c){return new Rc(c,r.session,r.dialect,e)}function u(c){return new Nc(c,r.session,r.dialect,e)}return{select:n,selectDistinct:i,selectDistinctOn:s,update:a,insert:o,delete:u}}select(e){return new ct({fields:e??void 0,session:this.session,dialect:this.dialect})}selectDistinct(e){return new ct({fields:e??void 0,session:this.session,dialect:this.dialect,distinct:!0})}selectDistinctOn(e,r){return new ct({fields:r??void 0,session:this.session,dialect:this.dialect,distinct:{on:e}})}update(e){return new jc(e,this.session,this.dialect)}insert(e){return new Rc(e,this.session,this.dialect)}delete(e){return new Nc(e,this.session,this.dialect)}refreshMaterializedView(e){return new np(e,this.session,this.dialect)}authToken;execute(e){let r=typeof e=="string"?y.raw(e):e.getSQL(),n=this.dialect.sqlToQuery(r),i=this.session.prepareQuery(n,void 0,void 0,!1);return new op(()=>i.execute(void 0,this.authToken),r,n,s=>i.mapResult(s,!0))}transaction(e,r){return this.session.transaction(e,r)}};var gv=class{constructor(e,r){this.unique=e,this.name=r}static[g]="PgIndexBuilderOn";on(...e){return new qc(e.map(r=>{if(E(r,M))return r;r=r;let n=new Vs(r.name,!!r.keyAsName,r.columnType,r.indexConfig);return r.indexConfig=JSON.parse(JSON.stringify(r.defaultConfig)),n}),this.unique,!1,this.name)}onOnly(...e){return new qc(e.map(r=>{if(E(r,M))return r;r=r;let n=new Vs(r.name,!!r.keyAsName,r.columnType,r.indexConfig);return r.indexConfig=r.defaultConfig,n}),this.unique,!0,this.name)}using(e,...r){return new qc(r.map(n=>{if(E(n,M))return n;n=n;let i=new Vs(n.name,!!n.keyAsName,n.columnType,n.indexConfig);return n.indexConfig=JSON.parse(JSON.stringify(n.defaultConfig)),i}),this.unique,!0,this.name,e)}},qc=class{static[g]="PgIndexBuilder";config;constructor(e,r,n,i,s="btree"){this.config={name:i,columns:e,unique:r,only:n,method:s}}concurrently(){return this.config.concurrently=!0,this}with(e){return this.config.with=e,this}where(e){return this.config.where=e,this}build(e){return new vv(this.config,e)}},vv=class{static[g]="PgIndex";config;constructor(e,r){this.config={...e,table:r}}};function s4(t){return new gv(!1,t)}var cp=class{constructor(e){this.query=e}authToken;getQuery(){return this.query}mapResult(e,r){return e}setToken(e){return this.authToken=e,this}static[g]="PgPreparedQuery";joinsNotNullableMap},up=class{constructor(e){this.dialect=e}static[g]="PgSession";execute(e,r){return xe.startActiveSpan("drizzle.operation",()=>xe.startActiveSpan("drizzle.prepareQuery",()=>this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1)).setToken(r).execute(void 0,r))}all(e){return this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1).all()}async count(e,r){let n=await this.execute(e,r);return Number(n[0].count)}},lp=class extends Ys{constructor(e,r,n,i=0){super(e,r,n),this.schema=n,this.nestedIndex=i}static[g]="PgTransaction";rollback(){throw new Ql}getTransactionConfigSQL(e){let r=[];return e.isolationLevel&&r.push(`isolation level ${e.isolationLevel}`),e.accessMode&&r.push(e.accessMode),typeof e.deferrable=="boolean"&&r.push(e.deferrable?"deferrable":"not deferrable"),y.raw(r.join(" "))}setTransaction(e){return this.session.execute(y`set transaction ${this.getTransactionConfigSQL(e)}`)}};var vM=ot("sessions",{sid:ze("sid").primaryKey(),sess:Kl("sess").notNull(),expire:Te("expire").notNull()},t=>[s4("IDX_session_expire").on(t.expire)]),ea=ot("users",{id:ze("id").primaryKey().default(y`gen_random_uuid()`),email:ze("email").unique(),firstName:ze("first_name"),lastName:ze("last_name"),profileImageUrl:ze("profile_image_url"),createdAt:Te("created_at").defaultNow(),updatedAt:Te("updated_at").defaultNow()});var Dt=mr(Ml(),1),DJ=Dt.default.Client,$J=Dt.default.Pool,MJ=Dt.default.Connection,FJ=Dt.default.types,BJ=Dt.default.Query,LJ=Dt.default.DatabaseError,UJ=Dt.default.escapeIdentifier,zJ=Dt.default.escapeLiteral,QJ=Dt.default.Result,HJ=Dt.default.TypeOverrides,VJ=Dt.default.defaults,yn=Dt.default;var{Pool:a4,types:Sr}=yn,yv=class extends cp{constructor(e,r,n,i,s,a,o,u){super({sql:r,params:n}),this.client=e,this.params=n,this.logger=i,this.fields=s,this._isResponseInArrayMode=o,this.customResultMapper=u,this.rawQueryConfig={name:a,text:r,types:{getTypeParser:(c,l)=>c===Sr.builtins.TIMESTAMPTZ?p=>p:c===Sr.builtins.TIMESTAMP?p=>p:c===Sr.builtins.DATE?p=>p:c===Sr.builtins.INTERVAL?p=>p:Sr.getTypeParser(c,l)}},this.queryConfig={name:a,text:r,rowMode:"array",types:{getTypeParser:(c,l)=>c===Sr.builtins.TIMESTAMPTZ?p=>p:c===Sr.builtins.TIMESTAMP?p=>p:c===Sr.builtins.DATE?p=>p:c===Sr.builtins.INTERVAL?p=>p:Sr.getTypeParser(c,l)}}}static[g]="NodePgPreparedQuery";rawQueryConfig;queryConfig;async execute(e={}){return xe.startActiveSpan("drizzle.execute",async()=>{let r=Hh(this.params,e);this.logger.logQuery(this.rawQueryConfig.text,r);let{fields:n,rawQueryConfig:i,client:s,queryConfig:a,joinsNotNullableMap:o,customResultMapper:u}=this;if(!n&&!u)return xe.startActiveSpan("drizzle.driver.execute",async l=>(l?.setAttributes({"drizzle.query.name":i.name,"drizzle.query.text":i.text,"drizzle.query.params":JSON.stringify(r)}),s.query(i,r)));let c=await xe.startActiveSpan("drizzle.driver.execute",l=>(l?.setAttributes({"drizzle.query.name":a.name,"drizzle.query.text":a.text,"drizzle.query.params":JSON.stringify(r)}),s.query(a,r)));return xe.startActiveSpan("drizzle.mapResponse",()=>u?u(c.rows):c.rows.map(l=>Sk(n,l,o)))})}all(e={}){return xe.startActiveSpan("drizzle.execute",()=>{let r=Hh(this.params,e);return this.logger.logQuery(this.rawQueryConfig.text,r),xe.startActiveSpan("drizzle.driver.execute",n=>(n?.setAttributes({"drizzle.query.name":this.rawQueryConfig.name,"drizzle.query.text":this.rawQueryConfig.text,"drizzle.query.params":JSON.stringify(r)}),this.client.query(this.rawQueryConfig,r).then(i=>i.rows)))})}isResponseInArrayMode(){return this._isResponseInArrayMode}},pp=class t extends up{constructor(e,r,n,i={}){super(r),this.client=e,this.schema=n,this.options=i,this.logger=i.logger??new Vl}static[g]="NodePgSession";logger;prepareQuery(e,r,n,i,s){return new yv(this.client,e.sql,e.params,this.logger,r,n,i,s)}async transaction(e,r){let n=this.client instanceof a4?new t(await this.client.connect(),this.dialect,this.schema,this.options):this,i=new xv(this.dialect,n,this.schema);await i.execute(y`begin${r?y` ${i.getTransactionConfigSQL(r)}`:void 0}`);try{let s=await e(i);return await i.execute(y`commit`),s}catch(s){throw await i.execute(y`rollback`),s}finally{this.client instanceof a4&&n.client.release()}}async count(e){let r=await this.execute(e);return Number(r.rows[0].count)}},xv=class t extends lp{static[g]="NodePgTransaction";async transaction(e){let r=`sp${this.nestedIndex+1}`,n=new t(this.dialect,this.session,this.schema,this.nestedIndex+1);await n.execute(y.raw(`savepoint ${r}`));try{let i=await e(n);return await n.execute(y.raw(`release savepoint ${r}`)),i}catch(i){throw await n.execute(y.raw(`rollback to savepoint ${r}`)),i}}};var bv=class{constructor(e,r,n={}){this.client=e,this.dialect=r,this.options=n}static[g]="NodePgDriver";createSession(e){return new pp(this.client,this.dialect,e,{logger:this.options.logger})}},wv=class extends Ys{static[g]="NodePgDatabase"};function Dc(t,e={}){let r=new vn({casing:e.casing}),n;e.logger===!0?n=new Hl:e.logger!==!1&&(n=e.logger);let i;if(e.schema){let u=r4(e.schema,i4);i={fullSchema:e.schema,schema:u.tables,tableNamesMap:u.tableNamesMap}}let a=new bv(t,r,{logger:n}).createSession(i),o=new wv(r,a,i);return o.$client=t,o}function dp(...t){if(typeof t[0]=="string"){let e=new yn.Pool({connectionString:t[0]});return Dc(e,t[1])}if(kk(t[0])){let{connection:e,client:r,...n}=t[0];if(r)return Dc(r,n);let i=typeof e=="string"?new yn.Pool({connectionString:e}):new yn.Pool(e);return Dc(i,n)}return Dc(t[0],t[1])}(t=>{function e(r){return Dc({},r)}t.mock=e})(dp||(dp={}));var Ov={};Jp(Ov,{bills:()=>Lt,conversations:()=>Av,debts:()=>Ft,employeePayments:()=>Sn,envelopes:()=>Mt,incomes:()=>Tr,insertBillSchema:()=>Pv,insertConversationSchema:()=>$F,insertDebtSchema:()=>Cv,insertEmployeePaymentSchema:()=>BF,insertEnvelopeSchema:()=>kv,insertIncomeSchema:()=>LF,insertMessageSchema:()=>MF,insertPayScheduleSchema:()=>Iv,insertTransactionSchema:()=>Tv,insertUserSettingsSchema:()=>UF,insertVirtualAccountSchema:()=>FF,messages:()=>w4,paySchedules:()=>Pr,sessions:()=>vM,transactions:()=>Bt,userSettings:()=>En,users:()=>ea,virtualAccounts:()=>Cr});var nt={};Jp(nt,{BRAND:()=>zM,DIRTY:()=>pi,EMPTY_PATH:()=>wM,INVALID:()=>Q,NEVER:()=>CF,OK:()=>ut,ParseStatus:()=>rt,Schema:()=>ee,ZodAny:()=>wn,ZodArray:()=>Vr,ZodBigInt:()=>fi,ZodBoolean:()=>mi,ZodBranded:()=>Mc,ZodCatch:()=>Ai,ZodDate:()=>hi,ZodDefault:()=>Ei,ZodDiscriminatedUnion:()=>hp,ZodEffects:()=>rr,ZodEnum:()=>_i,ZodError:()=>Ot,ZodFirstPartyTypeKind:()=>H,ZodFunction:()=>vp,ZodIntersection:()=>xi,ZodIssueCode:()=>I,ZodLazy:()=>bi,ZodLiteral:()=>wi,ZodMap:()=>aa,ZodNaN:()=>ca,ZodNativeEnum:()=>Si,ZodNever:()=>cr,ZodNull:()=>vi,ZodNullable:()=>kr,ZodNumber:()=>di,ZodObject:()=>Nt,ZodOptional:()=>er,ZodParsedType:()=>$,ZodPipeline:()=>Fc,ZodPromise:()=>_n,ZodReadonly:()=>ki,ZodRecord:()=>gp,ZodSchema:()=>ee,ZodSet:()=>oa,ZodString:()=>bn,ZodSymbol:()=>ia,ZodTransformer:()=>rr,ZodTuple:()=>Ar,ZodType:()=>ee,ZodUndefined:()=>gi,ZodUnion:()=>yi,ZodUnknown:()=>Hr,ZodVoid:()=>sa,addIssueToContext:()=>j,any:()=>XM,array:()=>rF,bigint:()=>WM,boolean:()=>v4,coerce:()=>kF,custom:()=>m4,date:()=>GM,datetimeRegex:()=>d4,defaultErrorMap:()=>zr,discriminatedUnion:()=>aF,effect:()=>yF,enum:()=>hF,function:()=>dF,getErrorMap:()=>ta,getParsedType:()=>Er,instanceof:()=>HM,intersection:()=>oF,isAborted:()=>fp,isAsync:()=>ra,isDirty:()=>mp,isValid:()=>xn,late:()=>QM,lazy:()=>fF,literal:()=>mF,makeIssue:()=>$c,map:()=>lF,nan:()=>VM,nativeEnum:()=>gF,never:()=>eF,null:()=>ZM,nullable:()=>bF,number:()=>g4,object:()=>nF,objectUtil:()=>_v,oboolean:()=>AF,onumber:()=>EF,optional:()=>xF,ostring:()=>SF,pipeline:()=>_F,preprocess:()=>wF,promise:()=>vF,quotelessJson:()=>yM,record:()=>uF,set:()=>pF,setErrorMap:()=>bM,strictObject:()=>iF,string:()=>h4,symbol:()=>KM,transformer:()=>yF,tuple:()=>cF,undefined:()=>JM,union:()=>sF,unknown:()=>YM,util:()=>ne,void:()=>tF});var ne;(function(t){t.assertEqual=i=>{};function e(i){}t.assertIs=e;function r(i){throw new Error}t.assertNever=r,t.arrayToEnum=i=>{let s={};for(let a of i)s[a]=a;return s},t.getValidEnumValues=i=>{let s=t.objectKeys(i).filter(o=>typeof i[i[o]]!="number"),a={};for(let o of s)a[o]=i[o];return t.objectValues(a)},t.objectValues=i=>t.objectKeys(i).map(function(s){return i[s]}),t.objectKeys=typeof Object.keys=="function"?i=>Object.keys(i):i=>{let s=[];for(let a in i)Object.prototype.hasOwnProperty.call(i,a)&&s.push(a);return s},t.find=(i,s)=>{for(let a of i)if(s(a))return a},t.isInteger=typeof Number.isInteger=="function"?i=>Number.isInteger(i):i=>typeof i=="number"&&Number.isFinite(i)&&Math.floor(i)===i;function n(i,s=" | "){return i.map(a=>typeof a=="string"?`'${a}'`:a).join(s)}t.joinValues=n,t.jsonStringifyReplacer=(i,s)=>typeof s=="bigint"?s.toString():s})(ne||(ne={}));var _v;(function(t){t.mergeShapes=(e,r)=>({...e,...r})})(_v||(_v={}));var $=ne.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Er=t=>{switch(typeof t){case"undefined":return $.undefined;case"string":return $.string;case"number":return Number.isNaN(t)?$.nan:$.number;case"boolean":return $.boolean;case"function":return $.function;case"bigint":return $.bigint;case"symbol":return $.symbol;case"object":return Array.isArray(t)?$.array:t===null?$.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?$.promise:typeof Map<"u"&&t instanceof Map?$.map:typeof Set<"u"&&t instanceof Set?$.set:typeof Date<"u"&&t instanceof Date?$.date:$.object;default:return $.unknown}};var I=ne.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),yM=t=>JSON.stringify(t,null,2).replace(/"([^"]+)":/g,"$1:"),Ot=class t extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=n=>{this.issues=[...this.issues,n]},this.addIssues=(n=[])=>{this.issues=[...this.issues,...n]};let r=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,r):this.__proto__=r,this.name="ZodError",this.issues=e}format(e){let r=e||function(s){return s.message},n={_errors:[]},i=s=>{for(let a of s.issues)if(a.code==="invalid_union")a.unionErrors.map(i);else if(a.code==="invalid_return_type")i(a.returnTypeError);else if(a.code==="invalid_arguments")i(a.argumentsError);else if(a.path.length===0)n._errors.push(r(a));else{let o=n,u=0;for(;u<a.path.length;){let c=a.path[u];u===a.path.length-1?(o[c]=o[c]||{_errors:[]},o[c]._errors.push(r(a))):o[c]=o[c]||{_errors:[]},o=o[c],u++}}};return i(this),n}static assert(e){if(!(e instanceof t))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,ne.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=r=>r.message){let r={},n=[];for(let i of this.issues)if(i.path.length>0){let s=i.path[0];r[s]=r[s]||[],r[s].push(e(i))}else n.push(e(i));return{formErrors:n,fieldErrors:r}}get formErrors(){return this.flatten()}};Ot.create=t=>new Ot(t);var xM=(t,e)=>{let r;switch(t.code){case I.invalid_type:t.received===$.undefined?r="Required":r=`Expected ${t.expected}, received ${t.received}`;break;case I.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(t.expected,ne.jsonStringifyReplacer)}`;break;case I.unrecognized_keys:r=`Unrecognized key(s) in object: ${ne.joinValues(t.keys,", ")}`;break;case I.invalid_union:r="Invalid input";break;case I.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${ne.joinValues(t.options)}`;break;case I.invalid_enum_value:r=`Invalid enum value. Expected ${ne.joinValues(t.options)}, received '${t.received}'`;break;case I.invalid_arguments:r="Invalid function arguments";break;case I.invalid_return_type:r="Invalid function return type";break;case I.invalid_date:r="Invalid date";break;case I.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(r=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(r=`${r} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?r=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?r=`Invalid input: must end with "${t.validation.endsWith}"`:ne.assertNever(t.validation):t.validation!=="regex"?r=`Invalid ${t.validation}`:r="Invalid";break;case I.too_small:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="bigint"?r=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:r="Invalid input";break;case I.too_big:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?r=`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:r="Invalid input";break;case I.custom:r="Invalid input";break;case I.invalid_intersection_types:r="Intersection results could not be merged";break;case I.not_multiple_of:r=`Number must be a multiple of ${t.multipleOf}`;break;case I.not_finite:r="Number must be finite";break;default:r=e.defaultError,ne.assertNever(t)}return{message:r}},zr=xM;var o4=zr;function bM(t){o4=t}function ta(){return o4}var $c=t=>{let{data:e,path:r,errorMaps:n,issueData:i}=t,s=[...r,...i.path||[]],a={...i,path:s};if(i.message!==void 0)return{...i,path:s,message:i.message};let o="",u=n.filter(c=>!!c).slice().reverse();for(let c of u)o=c(a,{data:e,defaultError:o}).message;return{...i,path:s,message:o}},wM=[];function j(t,e){let r=ta(),n=$c({issueData:e,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,r,r===zr?void 0:zr].filter(i=>!!i)});t.common.issues.push(n)}var rt=class t{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,r){let n=[];for(let i of r){if(i.status==="aborted")return Q;i.status==="dirty"&&e.dirty(),n.push(i.value)}return{status:e.value,value:n}}static async mergeObjectAsync(e,r){let n=[];for(let i of r){let s=await i.key,a=await i.value;n.push({key:s,value:a})}return t.mergeObjectSync(e,n)}static mergeObjectSync(e,r){let n={};for(let i of r){let{key:s,value:a}=i;if(s.status==="aborted"||a.status==="aborted")return Q;s.status==="dirty"&&e.dirty(),a.status==="dirty"&&e.dirty(),s.value!=="__proto__"&&(typeof a.value<"u"||i.alwaysSet)&&(n[s.value]=a.value)}return{status:e.value,value:n}}},Q=Object.freeze({status:"aborted"}),pi=t=>({status:"dirty",value:t}),ut=t=>({status:"valid",value:t}),fp=t=>t.status==="aborted",mp=t=>t.status==="dirty",xn=t=>t.status==="valid",ra=t=>typeof Promise<"u"&&t instanceof Promise;var L;(function(t){t.errToObj=e=>typeof e=="string"?{message:e}:e||{},t.toString=e=>typeof e=="string"?e:e?.message})(L||(L={}));var tr=class{constructor(e,r,n,i){this._cachedPath=[],this.parent=e,this.data=r,this._path=n,this._key=i}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},c4=(t,e)=>{if(xn(e))return{success:!0,data:e.value};if(!t.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let r=new Ot(t.common.issues);return this._error=r,this._error}}};function K(t){if(!t)return{};let{errorMap:e,invalid_type_error:r,required_error:n,description:i}=t;if(e&&(r||n))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:i}:{errorMap:(a,o)=>{let{message:u}=t;return a.code==="invalid_enum_value"?{message:u??o.defaultError}:typeof o.data>"u"?{message:u??n??o.defaultError}:a.code!=="invalid_type"?{message:o.defaultError}:{message:u??r??o.defaultError}},description:i}}var ee=class{get description(){return this._def.description}_getType(e){return Er(e.data)}_getOrReturnCtx(e,r){return r||{common:e.parent.common,data:e.data,parsedType:Er(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new rt,ctx:{common:e.parent.common,data:e.data,parsedType:Er(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let r=this._parse(e);if(ra(r))throw new Error("Synchronous parse encountered promise.");return r}_parseAsync(e){let r=this._parse(e);return Promise.resolve(r)}parse(e,r){let n=this.safeParse(e,r);if(n.success)return n.data;throw n.error}safeParse(e,r){let n={common:{issues:[],async:r?.async??!1,contextualErrorMap:r?.errorMap},path:r?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Er(e)},i=this._parseSync({data:e,path:n.path,parent:n});return c4(n,i)}"~validate"(e){let r={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Er(e)};if(!this["~standard"].async)try{let n=this._parseSync({data:e,path:[],parent:r});return xn(n)?{value:n.value}:{issues:r.common.issues}}catch(n){n?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),r.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:r}).then(n=>xn(n)?{value:n.value}:{issues:r.common.issues})}async parseAsync(e,r){let n=await this.safeParseAsync(e,r);if(n.success)return n.data;throw n.error}async safeParseAsync(e,r){let n={common:{issues:[],contextualErrorMap:r?.errorMap,async:!0},path:r?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Er(e)},i=this._parse({data:e,path:n.path,parent:n}),s=await(ra(i)?i:Promise.resolve(i));return c4(n,s)}refine(e,r){let n=i=>typeof r=="string"||typeof r>"u"?{message:r}:typeof r=="function"?r(i):r;return this._refinement((i,s)=>{let a=e(i),o=()=>s.addIssue({code:I.custom,...n(i)});return typeof Promise<"u"&&a instanceof Promise?a.then(u=>u?!0:(o(),!1)):a?!0:(o(),!1)})}refinement(e,r){return this._refinement((n,i)=>e(n)?!0:(i.addIssue(typeof r=="function"?r(n,i):r),!1))}_refinement(e){return new rr({schema:this,typeName:H.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:r=>this["~validate"](r)}}optional(){return er.create(this,this._def)}nullable(){return kr.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Vr.create(this)}promise(){return _n.create(this,this._def)}or(e){return yi.create([this,e],this._def)}and(e){return xi.create(this,e,this._def)}transform(e){return new rr({...K(this._def),schema:this,typeName:H.ZodEffects,effect:{type:"transform",transform:e}})}default(e){let r=typeof e=="function"?e:()=>e;return new Ei({...K(this._def),innerType:this,defaultValue:r,typeName:H.ZodDefault})}brand(){return new Mc({typeName:H.ZodBranded,type:this,...K(this._def)})}catch(e){let r=typeof e=="function"?e:()=>e;return new Ai({...K(this._def),innerType:this,catchValue:r,typeName:H.ZodCatch})}describe(e){let r=this.constructor;return new r({...this._def,description:e})}pipe(e){return Fc.create(this,e)}readonly(){return ki.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},_M=/^c[^\s-]{8,}$/i,SM=/^[0-9a-z]+$/,EM=/^[0-9A-HJKMNP-TV-Z]{26}$/i,AM=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,kM=/^[a-z0-9_-]{21}$/i,CM=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,TM=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,PM=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,IM="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",Sv,OM=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,NM=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,RM=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,jM=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,qM=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,DM=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,l4="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",$M=new RegExp(`^${l4}$`);function p4(t){let e="[0-5]\\d";t.precision?e=`${e}\\.\\d{${t.precision}}`:t.precision==null&&(e=`${e}(\\.\\d+)?`);let r=t.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${e})${r}`}function MM(t){return new RegExp(`^${p4(t)}$`)}function d4(t){let e=`${l4}T${p4(t)}`,r=[];return r.push(t.local?"Z?":"Z"),t.offset&&r.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${r.join("|")})`,new RegExp(`^${e}$`)}function FM(t,e){return!!((e==="v4"||!e)&&OM.test(t)||(e==="v6"||!e)&&RM.test(t))}function BM(t,e){if(!CM.test(t))return!1;try{let[r]=t.split(".");if(!r)return!1;let n=r.replace(/-/g,"+").replace(/_/g,"/").padEnd(r.length+(4-r.length%4)%4,"="),i=JSON.parse(atob(n));return!(typeof i!="object"||i===null||"typ"in i&&i?.typ!=="JWT"||!i.alg||e&&i.alg!==e)}catch{return!1}}function LM(t,e){return!!((e==="v4"||!e)&&NM.test(t)||(e==="v6"||!e)&&jM.test(t))}var bn=class t extends ee{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==$.string){let s=this._getOrReturnCtx(e);return j(s,{code:I.invalid_type,expected:$.string,received:s.parsedType}),Q}let n=new rt,i;for(let s of this._def.checks)if(s.kind==="min")e.data.length<s.value&&(i=this._getOrReturnCtx(e,i),j(i,{code:I.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),n.dirty());else if(s.kind==="max")e.data.length>s.value&&(i=this._getOrReturnCtx(e,i),j(i,{code:I.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),n.dirty());else if(s.kind==="length"){let a=e.data.length>s.value,o=e.data.length<s.value;(a||o)&&(i=this._getOrReturnCtx(e,i),a?j(i,{code:I.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}):o&&j(i,{code:I.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}),n.dirty())}else if(s.kind==="email")PM.test(e.data)||(i=this._getOrReturnCtx(e,i),j(i,{validation:"email",code:I.invalid_string,message:s.message}),n.dirty());else if(s.kind==="emoji")Sv||(Sv=new RegExp(IM,"u")),Sv.test(e.data)||(i=this._getOrReturnCtx(e,i),j(i,{validation:"emoji",code:I.invalid_string,message:s.message}),n.dirty());else if(s.kind==="uuid")AM.test(e.data)||(i=this._getOrReturnCtx(e,i),j(i,{validation:"uuid",code:I.invalid_string,message:s.message}),n.dirty());else if(s.kind==="nanoid")kM.test(e.data)||(i=this._getOrReturnCtx(e,i),j(i,{validation:"nanoid",code:I.invalid_string,message:s.message}),n.dirty());else if(s.kind==="cuid")_M.test(e.data)||(i=this._getOrReturnCtx(e,i),j(i,{validation:"cuid",code:I.invalid_string,message:s.message}),n.dirty());else if(s.kind==="cuid2")SM.test(e.data)||(i=this._getOrReturnCtx(e,i),j(i,{validation:"cuid2",code:I.invalid_string,message:s.message}),n.dirty());else if(s.kind==="ulid")EM.test(e.data)||(i=this._getOrReturnCtx(e,i),j(i,{validation:"ulid",code:I.invalid_string,message:s.message}),n.dirty());else if(s.kind==="url")try{new URL(e.data)}catch{i=this._getOrReturnCtx(e,i),j(i,{validation:"url",code:I.invalid_string,message:s.message}),n.dirty()}else s.kind==="regex"?(s.regex.lastIndex=0,s.regex.test(e.data)||(i=this._getOrReturnCtx(e,i),j(i,{validation:"regex",code:I.invalid_string,message:s.message}),n.dirty())):s.kind==="trim"?e.data=e.data.trim():s.kind==="includes"?e.data.includes(s.value,s.position)||(i=this._getOrReturnCtx(e,i),j(i,{code:I.invalid_string,validation:{includes:s.value,position:s.position},message:s.message}),n.dirty()):s.kind==="toLowerCase"?e.data=e.data.toLowerCase():s.kind==="toUpperCase"?e.data=e.data.toUpperCase():s.kind==="startsWith"?e.data.startsWith(s.value)||(i=this._getOrReturnCtx(e,i),j(i,{code:I.invalid_string,validation:{startsWith:s.value},message:s.message}),n.dirty()):s.kind==="endsWith"?e.data.endsWith(s.value)||(i=this._getOrReturnCtx(e,i),j(i,{code:I.invalid_string,validation:{endsWith:s.value},message:s.message}),n.dirty()):s.kind==="datetime"?d4(s).test(e.data)||(i=this._getOrReturnCtx(e,i),j(i,{code:I.invalid_string,validation:"datetime",message:s.message}),n.dirty()):s.kind==="date"?$M.test(e.data)||(i=this._getOrReturnCtx(e,i),j(i,{code:I.invalid_string,validation:"date",message:s.message}),n.dirty()):s.kind==="time"?MM(s).test(e.data)||(i=this._getOrReturnCtx(e,i),j(i,{code:I.invalid_string,validation:"time",message:s.message}),n.dirty()):s.kind==="duration"?TM.test(e.data)||(i=this._getOrReturnCtx(e,i),j(i,{validation:"duration",code:I.invalid_string,message:s.message}),n.dirty()):s.kind==="ip"?FM(e.data,s.version)||(i=this._getOrReturnCtx(e,i),j(i,{validation:"ip",code:I.invalid_string,message:s.message}),n.dirty()):s.kind==="jwt"?BM(e.data,s.alg)||(i=this._getOrReturnCtx(e,i),j(i,{validation:"jwt",code:I.invalid_string,message:s.message}),n.dirty()):s.kind==="cidr"?LM(e.data,s.version)||(i=this._getOrReturnCtx(e,i),j(i,{validation:"cidr",code:I.invalid_string,message:s.message}),n.dirty()):s.kind==="base64"?qM.test(e.data)||(i=this._getOrReturnCtx(e,i),j(i,{validation:"base64",code:I.invalid_string,message:s.message}),n.dirty()):s.kind==="base64url"?DM.test(e.data)||(i=this._getOrReturnCtx(e,i),j(i,{validation:"base64url",code:I.invalid_string,message:s.message}),n.dirty()):ne.assertNever(s);return{status:n.value,value:e.data}}_regex(e,r,n){return this.refinement(i=>e.test(i),{validation:r,code:I.invalid_string,...L.errToObj(n)})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...L.errToObj(e)})}url(e){return this._addCheck({kind:"url",...L.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...L.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...L.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...L.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...L.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...L.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...L.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...L.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...L.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...L.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...L.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...L.errToObj(e)})}datetime(e){return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof e?.precision>"u"?null:e?.precision,offset:e?.offset??!1,local:e?.local??!1,...L.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof e?.precision>"u"?null:e?.precision,...L.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...L.errToObj(e)})}regex(e,r){return this._addCheck({kind:"regex",regex:e,...L.errToObj(r)})}includes(e,r){return this._addCheck({kind:"includes",value:e,position:r?.position,...L.errToObj(r?.message)})}startsWith(e,r){return this._addCheck({kind:"startsWith",value:e,...L.errToObj(r)})}endsWith(e,r){return this._addCheck({kind:"endsWith",value:e,...L.errToObj(r)})}min(e,r){return this._addCheck({kind:"min",value:e,...L.errToObj(r)})}max(e,r){return this._addCheck({kind:"max",value:e,...L.errToObj(r)})}length(e,r){return this._addCheck({kind:"length",value:e,...L.errToObj(r)})}nonempty(e){return this.min(1,L.errToObj(e))}trim(){return new t({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxLength(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}};bn.create=t=>new bn({checks:[],typeName:H.ZodString,coerce:t?.coerce??!1,...K(t)});function UM(t,e){let r=(t.toString().split(".")[1]||"").length,n=(e.toString().split(".")[1]||"").length,i=r>n?r:n,s=Number.parseInt(t.toFixed(i).replace(".","")),a=Number.parseInt(e.toFixed(i).replace(".",""));return s%a/10**i}var di=class t extends ee{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==$.number){let s=this._getOrReturnCtx(e);return j(s,{code:I.invalid_type,expected:$.number,received:s.parsedType}),Q}let n,i=new rt;for(let s of this._def.checks)s.kind==="int"?ne.isInteger(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{code:I.invalid_type,expected:"integer",received:"float",message:s.message}),i.dirty()):s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(n=this._getOrReturnCtx(e,n),j(n,{code:I.too_small,minimum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),i.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(n=this._getOrReturnCtx(e,n),j(n,{code:I.too_big,maximum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),i.dirty()):s.kind==="multipleOf"?UM(e.data,s.value)!==0&&(n=this._getOrReturnCtx(e,n),j(n,{code:I.not_multiple_of,multipleOf:s.value,message:s.message}),i.dirty()):s.kind==="finite"?Number.isFinite(e.data)||(n=this._getOrReturnCtx(e,n),j(n,{code:I.not_finite,message:s.message}),i.dirty()):ne.assertNever(s);return{status:i.value,value:e.data}}gte(e,r){return this.setLimit("min",e,!0,L.toString(r))}gt(e,r){return this.setLimit("min",e,!1,L.toString(r))}lte(e,r){return this.setLimit("max",e,!0,L.toString(r))}lt(e,r){return this.setLimit("max",e,!1,L.toString(r))}setLimit(e,r,n,i){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:n,message:L.toString(i)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:L.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:L.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:L.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:L.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:L.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:L.toString(r)})}finite(e){return this._addCheck({kind:"finite",message:L.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:L.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:L.toString(e)})}get minValue(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&ne.isInteger(e.value))}get isFinite(){let e=null,r=null;for(let n of this._def.checks){if(n.kind==="finite"||n.kind==="int"||n.kind==="multipleOf")return!0;n.kind==="min"?(r===null||n.value>r)&&(r=n.value):n.kind==="max"&&(e===null||n.value<e)&&(e=n.value)}return Number.isFinite(r)&&Number.isFinite(e)}};di.create=t=>new di({checks:[],typeName:H.ZodNumber,coerce:t?.coerce||!1,...K(t)});var fi=class t extends ee{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==$.bigint)return this._getInvalidInput(e);let n,i=new rt;for(let s of this._def.checks)s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(n=this._getOrReturnCtx(e,n),j(n,{code:I.too_small,type:"bigint",minimum:s.value,inclusive:s.inclusive,message:s.message}),i.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(n=this._getOrReturnCtx(e,n),j(n,{code:I.too_big,type:"bigint",maximum:s.value,inclusive:s.inclusive,message:s.message}),i.dirty()):s.kind==="multipleOf"?e.data%s.value!==BigInt(0)&&(n=this._getOrReturnCtx(e,n),j(n,{code:I.not_multiple_of,multipleOf:s.value,message:s.message}),i.dirty()):ne.assertNever(s);return{status:i.value,value:e.data}}_getInvalidInput(e){let r=this._getOrReturnCtx(e);return j(r,{code:I.invalid_type,expected:$.bigint,received:r.parsedType}),Q}gte(e,r){return this.setLimit("min",e,!0,L.toString(r))}gt(e,r){return this.setLimit("min",e,!1,L.toString(r))}lte(e,r){return this.setLimit("max",e,!0,L.toString(r))}lt(e,r){return this.setLimit("max",e,!1,L.toString(r))}setLimit(e,r,n,i){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:n,message:L.toString(i)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:L.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:L.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:L.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:L.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:L.toString(r)})}get minValue(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}};fi.create=t=>new fi({checks:[],typeName:H.ZodBigInt,coerce:t?.coerce??!1,...K(t)});var mi=class extends ee{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==$.boolean){let n=this._getOrReturnCtx(e);return j(n,{code:I.invalid_type,expected:$.boolean,received:n.parsedType}),Q}return ut(e.data)}};mi.create=t=>new mi({typeName:H.ZodBoolean,coerce:t?.coerce||!1,...K(t)});var hi=class t extends ee{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==$.date){let s=this._getOrReturnCtx(e);return j(s,{code:I.invalid_type,expected:$.date,received:s.parsedType}),Q}if(Number.isNaN(e.data.getTime())){let s=this._getOrReturnCtx(e);return j(s,{code:I.invalid_date}),Q}let n=new rt,i;for(let s of this._def.checks)s.kind==="min"?e.data.getTime()<s.value&&(i=this._getOrReturnCtx(e,i),j(i,{code:I.too_small,message:s.message,inclusive:!0,exact:!1,minimum:s.value,type:"date"}),n.dirty()):s.kind==="max"?e.data.getTime()>s.value&&(i=this._getOrReturnCtx(e,i),j(i,{code:I.too_big,message:s.message,inclusive:!0,exact:!1,maximum:s.value,type:"date"}),n.dirty()):ne.assertNever(s);return{status:n.value,value:new Date(e.data.getTime())}}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}min(e,r){return this._addCheck({kind:"min",value:e.getTime(),message:L.toString(r)})}max(e,r){return this._addCheck({kind:"max",value:e.getTime(),message:L.toString(r)})}get minDate(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e!=null?new Date(e):null}};hi.create=t=>new hi({checks:[],coerce:t?.coerce||!1,typeName:H.ZodDate,...K(t)});var ia=class extends ee{_parse(e){if(this._getType(e)!==$.symbol){let n=this._getOrReturnCtx(e);return j(n,{code:I.invalid_type,expected:$.symbol,received:n.parsedType}),Q}return ut(e.data)}};ia.create=t=>new ia({typeName:H.ZodSymbol,...K(t)});var gi=class extends ee{_parse(e){if(this._getType(e)!==$.undefined){let n=this._getOrReturnCtx(e);return j(n,{code:I.invalid_type,expected:$.undefined,received:n.parsedType}),Q}return ut(e.data)}};gi.create=t=>new gi({typeName:H.ZodUndefined,...K(t)});var vi=class extends ee{_parse(e){if(this._getType(e)!==$.null){let n=this._getOrReturnCtx(e);return j(n,{code:I.invalid_type,expected:$.null,received:n.parsedType}),Q}return ut(e.data)}};vi.create=t=>new vi({typeName:H.ZodNull,...K(t)});var wn=class extends ee{constructor(){super(...arguments),this._any=!0}_parse(e){return ut(e.data)}};wn.create=t=>new wn({typeName:H.ZodAny,...K(t)});var Hr=class extends ee{constructor(){super(...arguments),this._unknown=!0}_parse(e){return ut(e.data)}};Hr.create=t=>new Hr({typeName:H.ZodUnknown,...K(t)});var cr=class extends ee{_parse(e){let r=this._getOrReturnCtx(e);return j(r,{code:I.invalid_type,expected:$.never,received:r.parsedType}),Q}};cr.create=t=>new cr({typeName:H.ZodNever,...K(t)});var sa=class extends ee{_parse(e){if(this._getType(e)!==$.undefined){let n=this._getOrReturnCtx(e);return j(n,{code:I.invalid_type,expected:$.void,received:n.parsedType}),Q}return ut(e.data)}};sa.create=t=>new sa({typeName:H.ZodVoid,...K(t)});var Vr=class t extends ee{_parse(e){let{ctx:r,status:n}=this._processInputParams(e),i=this._def;if(r.parsedType!==$.array)return j(r,{code:I.invalid_type,expected:$.array,received:r.parsedType}),Q;if(i.exactLength!==null){let a=r.data.length>i.exactLength.value,o=r.data.length<i.exactLength.value;(a||o)&&(j(r,{code:a?I.too_big:I.too_small,minimum:o?i.exactLength.value:void 0,maximum:a?i.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:i.exactLength.message}),n.dirty())}if(i.minLength!==null&&r.data.length<i.minLength.value&&(j(r,{code:I.too_small,minimum:i.minLength.value,type:"array",inclusive:!0,exact:!1,message:i.minLength.message}),n.dirty()),i.maxLength!==null&&r.data.length>i.maxLength.value&&(j(r,{code:I.too_big,maximum:i.maxLength.value,type:"array",inclusive:!0,exact:!1,message:i.maxLength.message}),n.dirty()),r.common.async)return Promise.all([...r.data].map((a,o)=>i.type._parseAsync(new tr(r,a,r.path,o)))).then(a=>rt.mergeArray(n,a));let s=[...r.data].map((a,o)=>i.type._parseSync(new tr(r,a,r.path,o)));return rt.mergeArray(n,s)}get element(){return this._def.type}min(e,r){return new t({...this._def,minLength:{value:e,message:L.toString(r)}})}max(e,r){return new t({...this._def,maxLength:{value:e,message:L.toString(r)}})}length(e,r){return new t({...this._def,exactLength:{value:e,message:L.toString(r)}})}nonempty(e){return this.min(1,e)}};Vr.create=(t,e)=>new Vr({type:t,minLength:null,maxLength:null,exactLength:null,typeName:H.ZodArray,...K(e)});function na(t){if(t instanceof Nt){let e={};for(let r in t.shape){let n=t.shape[r];e[r]=er.create(na(n))}return new Nt({...t._def,shape:()=>e})}else return t instanceof Vr?new Vr({...t._def,type:na(t.element)}):t instanceof er?er.create(na(t.unwrap())):t instanceof kr?kr.create(na(t.unwrap())):t instanceof Ar?Ar.create(t.items.map(e=>na(e))):t}var Nt=class t extends ee{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;let e=this._def.shape(),r=ne.objectKeys(e);return this._cached={shape:e,keys:r},this._cached}_parse(e){if(this._getType(e)!==$.object){let c=this._getOrReturnCtx(e);return j(c,{code:I.invalid_type,expected:$.object,received:c.parsedType}),Q}let{status:n,ctx:i}=this._processInputParams(e),{shape:s,keys:a}=this._getCached(),o=[];if(!(this._def.catchall instanceof cr&&this._def.unknownKeys==="strip"))for(let c in i.data)a.includes(c)||o.push(c);let u=[];for(let c of a){let l=s[c],p=i.data[c];u.push({key:{status:"valid",value:c},value:l._parse(new tr(i,p,i.path,c)),alwaysSet:c in i.data})}if(this._def.catchall instanceof cr){let c=this._def.unknownKeys;if(c==="passthrough")for(let l of o)u.push({key:{status:"valid",value:l},value:{status:"valid",value:i.data[l]}});else if(c==="strict")o.length>0&&(j(i,{code:I.unrecognized_keys,keys:o}),n.dirty());else if(c!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{let c=this._def.catchall;for(let l of o){let p=i.data[l];u.push({key:{status:"valid",value:l},value:c._parse(new tr(i,p,i.path,l)),alwaysSet:l in i.data})}}return i.common.async?Promise.resolve().then(async()=>{let c=[];for(let l of u){let p=await l.key,d=await l.value;c.push({key:p,value:d,alwaysSet:l.alwaysSet})}return c}).then(c=>rt.mergeObjectSync(n,c)):rt.mergeObjectSync(n,u)}get shape(){return this._def.shape()}strict(e){return L.errToObj,new t({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(r,n)=>{let i=this._def.errorMap?.(r,n).message??n.defaultError;return r.code==="unrecognized_keys"?{message:L.errToObj(e).message??i}:{message:i}}}:{}})}strip(){return new t({...this._def,unknownKeys:"strip"})}passthrough(){return new t({...this._def,unknownKeys:"passthrough"})}extend(e){return new t({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new t({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:H.ZodObject})}setKey(e,r){return this.augment({[e]:r})}catchall(e){return new t({...this._def,catchall:e})}pick(e){let r={};for(let n of ne.objectKeys(e))e[n]&&this.shape[n]&&(r[n]=this.shape[n]);return new t({...this._def,shape:()=>r})}omit(e){let r={};for(let n of ne.objectKeys(this.shape))e[n]||(r[n]=this.shape[n]);return new t({...this._def,shape:()=>r})}deepPartial(){return na(this)}partial(e){let r={};for(let n of ne.objectKeys(this.shape)){let i=this.shape[n];e&&!e[n]?r[n]=i:r[n]=i.optional()}return new t({...this._def,shape:()=>r})}required(e){let r={};for(let n of ne.objectKeys(this.shape))if(e&&!e[n])r[n]=this.shape[n];else{let s=this.shape[n];for(;s instanceof er;)s=s._def.innerType;r[n]=s}return new t({...this._def,shape:()=>r})}keyof(){return f4(ne.objectKeys(this.shape))}};Nt.create=(t,e)=>new Nt({shape:()=>t,unknownKeys:"strip",catchall:cr.create(),typeName:H.ZodObject,...K(e)});Nt.strictCreate=(t,e)=>new Nt({shape:()=>t,unknownKeys:"strict",catchall:cr.create(),typeName:H.ZodObject,...K(e)});Nt.lazycreate=(t,e)=>new Nt({shape:t,unknownKeys:"strip",catchall:cr.create(),typeName:H.ZodObject,...K(e)});var yi=class extends ee{_parse(e){let{ctx:r}=this._processInputParams(e),n=this._def.options;function i(s){for(let o of s)if(o.result.status==="valid")return o.result;for(let o of s)if(o.result.status==="dirty")return r.common.issues.push(...o.ctx.common.issues),o.result;let a=s.map(o=>new Ot(o.ctx.common.issues));return j(r,{code:I.invalid_union,unionErrors:a}),Q}if(r.common.async)return Promise.all(n.map(async s=>{let a={...r,common:{...r.common,issues:[]},parent:null};return{result:await s._parseAsync({data:r.data,path:r.path,parent:a}),ctx:a}})).then(i);{let s,a=[];for(let u of n){let c={...r,common:{...r.common,issues:[]},parent:null},l=u._parseSync({data:r.data,path:r.path,parent:c});if(l.status==="valid")return l;l.status==="dirty"&&!s&&(s={result:l,ctx:c}),c.common.issues.length&&a.push(c.common.issues)}if(s)return r.common.issues.push(...s.ctx.common.issues),s.result;let o=a.map(u=>new Ot(u));return j(r,{code:I.invalid_union,unionErrors:o}),Q}}get options(){return this._def.options}};yi.create=(t,e)=>new yi({options:t,typeName:H.ZodUnion,...K(e)});var Qr=t=>t instanceof bi?Qr(t.schema):t instanceof rr?Qr(t.innerType()):t instanceof wi?[t.value]:t instanceof _i?t.options:t instanceof Si?ne.objectValues(t.enum):t instanceof Ei?Qr(t._def.innerType):t instanceof gi?[void 0]:t instanceof vi?[null]:t instanceof er?[void 0,...Qr(t.unwrap())]:t instanceof kr?[null,...Qr(t.unwrap())]:t instanceof Mc||t instanceof ki?Qr(t.unwrap()):t instanceof Ai?Qr(t._def.innerType):[],hp=class t extends ee{_parse(e){let{ctx:r}=this._processInputParams(e);if(r.parsedType!==$.object)return j(r,{code:I.invalid_type,expected:$.object,received:r.parsedType}),Q;let n=this.discriminator,i=r.data[n],s=this.optionsMap.get(i);return s?r.common.async?s._parseAsync({data:r.data,path:r.path,parent:r}):s._parseSync({data:r.data,path:r.path,parent:r}):(j(r,{code:I.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[n]}),Q)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,r,n){let i=new Map;for(let s of r){let a=Qr(s.shape[e]);if(!a.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let o of a){if(i.has(o))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(o)}`);i.set(o,s)}}return new t({typeName:H.ZodDiscriminatedUnion,discriminator:e,options:r,optionsMap:i,...K(n)})}};function Ev(t,e){let r=Er(t),n=Er(e);if(t===e)return{valid:!0,data:t};if(r===$.object&&n===$.object){let i=ne.objectKeys(e),s=ne.objectKeys(t).filter(o=>i.indexOf(o)!==-1),a={...t,...e};for(let o of s){let u=Ev(t[o],e[o]);if(!u.valid)return{valid:!1};a[o]=u.data}return{valid:!0,data:a}}else if(r===$.array&&n===$.array){if(t.length!==e.length)return{valid:!1};let i=[];for(let s=0;s<t.length;s++){let a=t[s],o=e[s],u=Ev(a,o);if(!u.valid)return{valid:!1};i.push(u.data)}return{valid:!0,data:i}}else return r===$.date&&n===$.date&&+t==+e?{valid:!0,data:t}:{valid:!1}}var xi=class extends ee{_parse(e){let{status:r,ctx:n}=this._processInputParams(e),i=(s,a)=>{if(fp(s)||fp(a))return Q;let o=Ev(s.value,a.value);return o.valid?((mp(s)||mp(a))&&r.dirty(),{status:r.value,value:o.data}):(j(n,{code:I.invalid_intersection_types}),Q)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then(([s,a])=>i(s,a)):i(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}};xi.create=(t,e,r)=>new xi({left:t,right:e,typeName:H.ZodIntersection,...K(r)});var Ar=class t extends ee{_parse(e){let{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==$.array)return j(n,{code:I.invalid_type,expected:$.array,received:n.parsedType}),Q;if(n.data.length<this._def.items.length)return j(n,{code:I.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),Q;!this._def.rest&&n.data.length>this._def.items.length&&(j(n,{code:I.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),r.dirty());let s=[...n.data].map((a,o)=>{let u=this._def.items[o]||this._def.rest;return u?u._parse(new tr(n,a,n.path,o)):null}).filter(a=>!!a);return n.common.async?Promise.all(s).then(a=>rt.mergeArray(r,a)):rt.mergeArray(r,s)}get items(){return this._def.items}rest(e){return new t({...this._def,rest:e})}};Ar.create=(t,e)=>{if(!Array.isArray(t))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Ar({items:t,typeName:H.ZodTuple,rest:null,...K(e)})};var gp=class t extends ee{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==$.object)return j(n,{code:I.invalid_type,expected:$.object,received:n.parsedType}),Q;let i=[],s=this._def.keyType,a=this._def.valueType;for(let o in n.data)i.push({key:s._parse(new tr(n,o,n.path,o)),value:a._parse(new tr(n,n.data[o],n.path,o)),alwaysSet:o in n.data});return n.common.async?rt.mergeObjectAsync(r,i):rt.mergeObjectSync(r,i)}get element(){return this._def.valueType}static create(e,r,n){return r instanceof ee?new t({keyType:e,valueType:r,typeName:H.ZodRecord,...K(n)}):new t({keyType:bn.create(),valueType:e,typeName:H.ZodRecord,...K(r)})}},aa=class extends ee{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==$.map)return j(n,{code:I.invalid_type,expected:$.map,received:n.parsedType}),Q;let i=this._def.keyType,s=this._def.valueType,a=[...n.data.entries()].map(([o,u],c)=>({key:i._parse(new tr(n,o,n.path,[c,"key"])),value:s._parse(new tr(n,u,n.path,[c,"value"]))}));if(n.common.async){let o=new Map;return Promise.resolve().then(async()=>{for(let u of a){let c=await u.key,l=await u.value;if(c.status==="aborted"||l.status==="aborted")return Q;(c.status==="dirty"||l.status==="dirty")&&r.dirty(),o.set(c.value,l.value)}return{status:r.value,value:o}})}else{let o=new Map;for(let u of a){let c=u.key,l=u.value;if(c.status==="aborted"||l.status==="aborted")return Q;(c.status==="dirty"||l.status==="dirty")&&r.dirty(),o.set(c.value,l.value)}return{status:r.value,value:o}}}};aa.create=(t,e,r)=>new aa({valueType:e,keyType:t,typeName:H.ZodMap,...K(r)});var oa=class t extends ee{_parse(e){let{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==$.set)return j(n,{code:I.invalid_type,expected:$.set,received:n.parsedType}),Q;let i=this._def;i.minSize!==null&&n.data.size<i.minSize.value&&(j(n,{code:I.too_small,minimum:i.minSize.value,type:"set",inclusive:!0,exact:!1,message:i.minSize.message}),r.dirty()),i.maxSize!==null&&n.data.size>i.maxSize.value&&(j(n,{code:I.too_big,maximum:i.maxSize.value,type:"set",inclusive:!0,exact:!1,message:i.maxSize.message}),r.dirty());let s=this._def.valueType;function a(u){let c=new Set;for(let l of u){if(l.status==="aborted")return Q;l.status==="dirty"&&r.dirty(),c.add(l.value)}return{status:r.value,value:c}}let o=[...n.data.values()].map((u,c)=>s._parse(new tr(n,u,n.path,c)));return n.common.async?Promise.all(o).then(u=>a(u)):a(o)}min(e,r){return new t({...this._def,minSize:{value:e,message:L.toString(r)}})}max(e,r){return new t({...this._def,maxSize:{value:e,message:L.toString(r)}})}size(e,r){return this.min(e,r).max(e,r)}nonempty(e){return this.min(1,e)}};oa.create=(t,e)=>new oa({valueType:t,minSize:null,maxSize:null,typeName:H.ZodSet,...K(e)});var vp=class t extends ee{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:r}=this._processInputParams(e);if(r.parsedType!==$.function)return j(r,{code:I.invalid_type,expected:$.function,received:r.parsedType}),Q;function n(o,u){return $c({data:o,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,ta(),zr].filter(c=>!!c),issueData:{code:I.invalid_arguments,argumentsError:u}})}function i(o,u){return $c({data:o,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,ta(),zr].filter(c=>!!c),issueData:{code:I.invalid_return_type,returnTypeError:u}})}let s={errorMap:r.common.contextualErrorMap},a=r.data;if(this._def.returns instanceof _n){let o=this;return ut(async function(...u){let c=new Ot([]),l=await o._def.args.parseAsync(u,s).catch(f=>{throw c.addIssue(n(u,f)),c}),p=await Reflect.apply(a,this,l);return await o._def.returns._def.type.parseAsync(p,s).catch(f=>{throw c.addIssue(i(p,f)),c})})}else{let o=this;return ut(function(...u){let c=o._def.args.safeParse(u,s);if(!c.success)throw new Ot([n(u,c.error)]);let l=Reflect.apply(a,this,c.data),p=o._def.returns.safeParse(l,s);if(!p.success)throw new Ot([i(l,p.error)]);return p.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new t({...this._def,args:Ar.create(e).rest(Hr.create())})}returns(e){return new t({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,r,n){return new t({args:e||Ar.create([]).rest(Hr.create()),returns:r||Hr.create(),typeName:H.ZodFunction,...K(n)})}},bi=class extends ee{get schema(){return this._def.getter()}_parse(e){let{ctx:r}=this._processInputParams(e);return this._def.getter()._parse({data:r.data,path:r.path,parent:r})}};bi.create=(t,e)=>new bi({getter:t,typeName:H.ZodLazy,...K(e)});var wi=class extends ee{_parse(e){if(e.data!==this._def.value){let r=this._getOrReturnCtx(e);return j(r,{received:r.data,code:I.invalid_literal,expected:this._def.value}),Q}return{status:"valid",value:e.data}}get value(){return this._def.value}};wi.create=(t,e)=>new wi({value:t,typeName:H.ZodLiteral,...K(e)});function f4(t,e){return new _i({values:t,typeName:H.ZodEnum,...K(e)})}var _i=class t extends ee{_parse(e){if(typeof e.data!="string"){let r=this._getOrReturnCtx(e),n=this._def.values;return j(r,{expected:ne.joinValues(n),received:r.parsedType,code:I.invalid_type}),Q}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){let r=this._getOrReturnCtx(e),n=this._def.values;return j(r,{received:r.data,code:I.invalid_enum_value,options:n}),Q}return ut(e.data)}get options(){return this._def.values}get enum(){let e={};for(let r of this._def.values)e[r]=r;return e}get Values(){let e={};for(let r of this._def.values)e[r]=r;return e}get Enum(){let e={};for(let r of this._def.values)e[r]=r;return e}extract(e,r=this._def){return t.create(e,{...this._def,...r})}exclude(e,r=this._def){return t.create(this.options.filter(n=>!e.includes(n)),{...this._def,...r})}};_i.create=f4;var Si=class extends ee{_parse(e){let r=ne.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(e);if(n.parsedType!==$.string&&n.parsedType!==$.number){let i=ne.objectValues(r);return j(n,{expected:ne.joinValues(i),received:n.parsedType,code:I.invalid_type}),Q}if(this._cache||(this._cache=new Set(ne.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){let i=ne.objectValues(r);return j(n,{received:n.data,code:I.invalid_enum_value,options:i}),Q}return ut(e.data)}get enum(){return this._def.values}};Si.create=(t,e)=>new Si({values:t,typeName:H.ZodNativeEnum,...K(e)});var _n=class extends ee{unwrap(){return this._def.type}_parse(e){let{ctx:r}=this._processInputParams(e);if(r.parsedType!==$.promise&&r.common.async===!1)return j(r,{code:I.invalid_type,expected:$.promise,received:r.parsedType}),Q;let n=r.parsedType===$.promise?r.data:Promise.resolve(r.data);return ut(n.then(i=>this._def.type.parseAsync(i,{path:r.path,errorMap:r.common.contextualErrorMap})))}};_n.create=(t,e)=>new _n({type:t,typeName:H.ZodPromise,...K(e)});var rr=class extends ee{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===H.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:r,ctx:n}=this._processInputParams(e),i=this._def.effect||null,s={addIssue:a=>{j(n,a),a.fatal?r.abort():r.dirty()},get path(){return n.path}};if(s.addIssue=s.addIssue.bind(s),i.type==="preprocess"){let a=i.transform(n.data,s);if(n.common.async)return Promise.resolve(a).then(async o=>{if(r.value==="aborted")return Q;let u=await this._def.schema._parseAsync({data:o,path:n.path,parent:n});return u.status==="aborted"?Q:u.status==="dirty"?pi(u.value):r.value==="dirty"?pi(u.value):u});{if(r.value==="aborted")return Q;let o=this._def.schema._parseSync({data:a,path:n.path,parent:n});return o.status==="aborted"?Q:o.status==="dirty"?pi(o.value):r.value==="dirty"?pi(o.value):o}}if(i.type==="refinement"){let a=o=>{let u=i.refinement(o,s);if(n.common.async)return Promise.resolve(u);if(u instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return o};if(n.common.async===!1){let o=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return o.status==="aborted"?Q:(o.status==="dirty"&&r.dirty(),a(o.value),{status:r.value,value:o.value})}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(o=>o.status==="aborted"?Q:(o.status==="dirty"&&r.dirty(),a(o.value).then(()=>({status:r.value,value:o.value}))))}if(i.type==="transform")if(n.common.async===!1){let a=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!xn(a))return Q;let o=i.transform(a.value,s);if(o instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:r.value,value:o}}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(a=>xn(a)?Promise.resolve(i.transform(a.value,s)).then(o=>({status:r.value,value:o})):Q);ne.assertNever(i)}};rr.create=(t,e,r)=>new rr({schema:t,typeName:H.ZodEffects,effect:e,...K(r)});rr.createWithPreprocess=(t,e,r)=>new rr({schema:e,effect:{type:"preprocess",transform:t},typeName:H.ZodEffects,...K(r)});var er=class extends ee{_parse(e){return this._getType(e)===$.undefined?ut(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};er.create=(t,e)=>new er({innerType:t,typeName:H.ZodOptional,...K(e)});var kr=class extends ee{_parse(e){return this._getType(e)===$.null?ut(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};kr.create=(t,e)=>new kr({innerType:t,typeName:H.ZodNullable,...K(e)});var Ei=class extends ee{_parse(e){let{ctx:r}=this._processInputParams(e),n=r.data;return r.parsedType===$.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:r.path,parent:r})}removeDefault(){return this._def.innerType}};Ei.create=(t,e)=>new Ei({innerType:t,typeName:H.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...K(e)});var Ai=class extends ee{_parse(e){let{ctx:r}=this._processInputParams(e),n={...r,common:{...r.common,issues:[]}},i=this._def.innerType._parse({data:n.data,path:n.path,parent:{...n}});return ra(i)?i.then(s=>({status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new Ot(n.common.issues)},input:n.data})})):{status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new Ot(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}};Ai.create=(t,e)=>new Ai({innerType:t,typeName:H.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...K(e)});var ca=class extends ee{_parse(e){if(this._getType(e)!==$.nan){let n=this._getOrReturnCtx(e);return j(n,{code:I.invalid_type,expected:$.nan,received:n.parsedType}),Q}return{status:"valid",value:e.data}}};ca.create=t=>new ca({typeName:H.ZodNaN,...K(t)});var zM=Symbol("zod_brand"),Mc=class extends ee{_parse(e){let{ctx:r}=this._processInputParams(e),n=r.data;return this._def.type._parse({data:n,path:r.path,parent:r})}unwrap(){return this._def.type}},Fc=class t extends ee{_parse(e){let{status:r,ctx:n}=this._processInputParams(e);if(n.common.async)return(async()=>{let s=await this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return s.status==="aborted"?Q:s.status==="dirty"?(r.dirty(),pi(s.value)):this._def.out._parseAsync({data:s.value,path:n.path,parent:n})})();{let i=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return i.status==="aborted"?Q:i.status==="dirty"?(r.dirty(),{status:"dirty",value:i.value}):this._def.out._parseSync({data:i.value,path:n.path,parent:n})}}static create(e,r){return new t({in:e,out:r,typeName:H.ZodPipeline})}},ki=class extends ee{_parse(e){let r=this._def.innerType._parse(e),n=i=>(xn(i)&&(i.value=Object.freeze(i.value)),i);return ra(r)?r.then(i=>n(i)):n(r)}unwrap(){return this._def.innerType}};ki.create=(t,e)=>new ki({innerType:t,typeName:H.ZodReadonly,...K(e)});function u4(t,e){let r=typeof t=="function"?t(e):typeof t=="string"?{message:t}:t;return typeof r=="string"?{message:r}:r}function m4(t,e={},r){return t?wn.create().superRefine((n,i)=>{let s=t(n);if(s instanceof Promise)return s.then(a=>{if(!a){let o=u4(e,n),u=o.fatal??r??!0;i.addIssue({code:"custom",...o,fatal:u})}});if(!s){let a=u4(e,n),o=a.fatal??r??!0;i.addIssue({code:"custom",...a,fatal:o})}}):wn.create()}var QM={object:Nt.lazycreate},H;(function(t){t.ZodString="ZodString",t.ZodNumber="ZodNumber",t.ZodNaN="ZodNaN",t.ZodBigInt="ZodBigInt",t.ZodBoolean="ZodBoolean",t.ZodDate="ZodDate",t.ZodSymbol="ZodSymbol",t.ZodUndefined="ZodUndefined",t.ZodNull="ZodNull",t.ZodAny="ZodAny",t.ZodUnknown="ZodUnknown",t.ZodNever="ZodNever",t.ZodVoid="ZodVoid",t.ZodArray="ZodArray",t.ZodObject="ZodObject",t.ZodUnion="ZodUnion",t.ZodDiscriminatedUnion="ZodDiscriminatedUnion",t.ZodIntersection="ZodIntersection",t.ZodTuple="ZodTuple",t.ZodRecord="ZodRecord",t.ZodMap="ZodMap",t.ZodSet="ZodSet",t.ZodFunction="ZodFunction",t.ZodLazy="ZodLazy",t.ZodLiteral="ZodLiteral",t.ZodEnum="ZodEnum",t.ZodEffects="ZodEffects",t.ZodNativeEnum="ZodNativeEnum",t.ZodOptional="ZodOptional",t.ZodNullable="ZodNullable",t.ZodDefault="ZodDefault",t.ZodCatch="ZodCatch",t.ZodPromise="ZodPromise",t.ZodBranded="ZodBranded",t.ZodPipeline="ZodPipeline",t.ZodReadonly="ZodReadonly"})(H||(H={}));var HM=(t,e={message:`Input not instance of ${t.name}`})=>m4(r=>r instanceof t,e),h4=bn.create,g4=di.create,VM=ca.create,WM=fi.create,v4=mi.create,GM=hi.create,KM=ia.create,JM=gi.create,ZM=vi.create,XM=wn.create,YM=Hr.create,eF=cr.create,tF=sa.create,rF=Vr.create,nF=Nt.create,iF=Nt.strictCreate,sF=yi.create,aF=hp.create,oF=xi.create,cF=Ar.create,uF=gp.create,lF=aa.create,pF=oa.create,dF=vp.create,fF=bi.create,mF=wi.create,hF=_i.create,gF=Si.create,vF=_n.create,yF=rr.create,xF=er.create,bF=kr.create,wF=rr.createWithPreprocess,_F=Fc.create,SF=()=>h4().optional(),EF=()=>g4().optional(),AF=()=>v4().optional(),kF={string:(t=>bn.create({...t,coerce:!0})),number:(t=>di.create({...t,coerce:!0})),boolean:(t=>mi.create({...t,coerce:!0})),bigint:(t=>fi.create({...t,coerce:!0})),date:(t=>hi.create({...t,coerce:!0}))};var CF=Q;var Ne={INT8_MIN:-128,INT8_MAX:127,INT8_UNSIGNED_MAX:255,INT16_MIN:-32768,INT16_MAX:32767,INT16_UNSIGNED_MAX:65535,INT24_MIN:-8388608,INT24_MAX:8388607,INT24_UNSIGNED_MAX:16777215,INT32_MIN:-2147483648,INT32_MAX:2147483647,INT32_UNSIGNED_MAX:4294967295,INT48_MIN:-0x800000000000,INT48_MAX:0x7fffffffffff,INT48_UNSIGNED_MAX:0xffffffffffff,INT64_MIN:-9223372036854775808n,INT64_MAX:9223372036854775807n,INT64_UNSIGNED_MAX:18446744073709551615n};function De(t,e){return e.includes(t.columnType)}function PF(t){return"enumValues"in t&&Array.isArray(t.enumValues)&&t.enumValues.length>0}var IF=nt.union([nt.string(),nt.number(),nt.boolean(),nt.null()]),OF=nt.union([IF,nt.record(nt.any()),nt.array(nt.any())]),NF=nt.custom(t=>t instanceof Buffer);function y4(t,e){let r=e?.zodInstance??nt,n=e?.coerce??{},i;return PF(t)&&(i=t.enumValues.length?r.enum(t.enumValues):r.string()),i||(De(t,["PgGeometry","PgPointTuple"])?i=r.tuple([r.number(),r.number()]):De(t,["PgGeometryObject","PgPointObject"])?i=r.object({x:r.number(),y:r.number()}):De(t,["PgHalfVector","PgVector"])?(i=r.array(r.number()),i=t.dimensions?i.length(t.dimensions):i):De(t,["PgLine"])?i=r.tuple([r.number(),r.number(),r.number()]):De(t,["PgLineABC"])?i=r.object({a:r.number(),b:r.number(),c:r.number()}):De(t,["PgArray"])?(i=r.array(y4(t.baseColumn,r)),i=t.size?i.length(t.size):i):t.dataType==="array"?i=r.array(r.any()):t.dataType==="number"?i=RF(t,r,n):t.dataType==="bigint"?i=jF(t,r,n):t.dataType==="boolean"?i=n===!0||n.boolean?r.coerce.boolean():r.boolean():t.dataType==="date"?i=n===!0||n.date?r.coerce.date():r.date():t.dataType==="string"?i=qF(t,r,n):t.dataType==="json"?i=OF:t.dataType==="custom"?i=r.any():t.dataType==="buffer"&&(i=NF)),i||(i=r.any()),i}function RF(t,e,r){let n=t.getSQLType().includes("unsigned"),i,s,a=!1;De(t,["MySqlTinyInt","SingleStoreTinyInt"])?(i=n?0:Ne.INT8_MIN,s=n?Ne.INT8_UNSIGNED_MAX:Ne.INT8_MAX,a=!0):De(t,["PgSmallInt","PgSmallSerial","MySqlSmallInt","SingleStoreSmallInt"])?(i=n?0:Ne.INT16_MIN,s=n?Ne.INT16_UNSIGNED_MAX:Ne.INT16_MAX,a=!0):De(t,["PgReal","MySqlFloat","MySqlMediumInt","SingleStoreMediumInt","SingleStoreFloat"])?(i=n?0:Ne.INT24_MIN,s=n?Ne.INT24_UNSIGNED_MAX:Ne.INT24_MAX,a=De(t,["MySqlMediumInt","SingleStoreMediumInt"])):De(t,["PgInteger","PgSerial","MySqlInt","SingleStoreInt"])?(i=n?0:Ne.INT32_MIN,s=n?Ne.INT32_UNSIGNED_MAX:Ne.INT32_MAX,a=!0):De(t,["PgDoublePrecision","MySqlReal","MySqlDouble","SingleStoreReal","SingleStoreDouble","SQLiteReal"])?(i=n?0:Ne.INT48_MIN,s=n?Ne.INT48_UNSIGNED_MAX:Ne.INT48_MAX):De(t,["PgBigInt53","PgBigSerial53","MySqlBigInt53","MySqlSerial","SingleStoreBigInt53","SingleStoreSerial","SQLiteInteger"])?(n=n||De(t,["MySqlSerial","SingleStoreSerial"]),i=n?0:Number.MIN_SAFE_INTEGER,s=Number.MAX_SAFE_INTEGER,a=!0):De(t,["MySqlYear","SingleStoreYear"])?(i=1901,s=2155,a=!0):(i=Number.MIN_SAFE_INTEGER,s=Number.MAX_SAFE_INTEGER);let o=r===!0||r?.number?e.coerce.number():e.number();return o=o.min(i).max(s),a?o.int():o}function jF(t,e,r){let n=t.getSQLType().includes("unsigned"),i=n?0n:Ne.INT64_MIN,s=n?Ne.INT64_UNSIGNED_MAX:Ne.INT64_MAX;return(r===!0||r?.bigint?e.coerce.bigint():e.bigint()).min(i).max(s)}function qF(t,e,r){if(De(t,["PgUUID"]))return e.string().uuid();let n,i,s=!1;De(t,["PgVarchar","SQLiteText"])?n=t.length:De(t,["MySqlVarChar","SingleStoreVarChar"])?n=t.length??Ne.INT16_UNSIGNED_MAX:De(t,["MySqlText","SingleStoreText"])&&(t.textType==="longtext"?n=Ne.INT32_UNSIGNED_MAX:t.textType==="mediumtext"?n=Ne.INT24_UNSIGNED_MAX:t.textType==="text"?n=Ne.INT16_UNSIGNED_MAX:n=Ne.INT8_UNSIGNED_MAX),De(t,["PgChar","MySqlChar","SingleStoreChar"])&&(n=t.length,s=!0),De(t,["PgBinaryVector"])&&(i=/^[01]+$/,n=t.dimensions);let a=r===!0||r?.string?e.coerce.string():e.string();return a=i?a.regex(i):a,n&&s?a.length(n):n?a.max(n):a}function x4(t){return zh(t)?Gl(t):Ak(t)}function b4(t,e,r,n){let i={};for(let[s,a]of Object.entries(t)){if(!E(a,le)&&!E(a,M)&&!E(a,M.Aliased)&&typeof a=="object"){let p=zh(a)||tk(a)?x4(a):a;i[s]=b4(p,e[s]??{},r,n);continue}let o=e[s];if(o!==void 0&&typeof o!="function"){i[s]=o;continue}let u=E(a,le)?a:void 0,c=u?y4(u,n):nt.any(),l=typeof o=="function"?o(c):c;r.never(u)||(i[s]=l,u&&(r.nullable(u)&&(i[s]=i[s].nullable()),r.optional(u)&&(i[s]=i[s].optional())))}return nt.object(i)}var DF={never:t=>t?.generated?.type==="always"||t?.generatedIdentity?.type==="always",optional:t=>!t.notNull||t.notNull&&t.hasDefault,nullable:t=>!t.notNull};var $t=(t,e)=>{let r=x4(t);return b4(r,e??{},DF)};var Av=ot("conversations",{id:bt("id").primaryKey(),title:we("title").notNull(),createdAt:Te("created_at").default(y`CURRENT_TIMESTAMP`).notNull()}),w4=ot("messages",{id:bt("id").primaryKey(),conversationId:Yt("conversation_id").notNull().references(()=>Av.id,{onDelete:"cascade"}),role:we("role").notNull(),content:we("content").notNull(),createdAt:Te("created_at").default(y`CURRENT_TIMESTAMP`).notNull()}),$F=$t(Av).omit({id:!0,createdAt:!0}),MF=$t(w4).omit({id:!0,createdAt:!0});var Mt=ot("envelopes",{id:bt("id").primaryKey(),userId:ze("user_id").notNull(),name:we("name").notNull(),budgetAmount:xt("budget_amount",{precision:10,scale:2}).notNull(),currentBalance:xt("current_balance",{precision:10,scale:2}).notNull().default("0"),isStrict:or("is_strict").notNull().default(!1),category:we("category").notNull().default("general"),color:we("color").notNull().default("#22c55e"),createdAt:Te("created_at").defaultNow()}),Cr=ot("virtual_accounts",{id:bt("id").primaryKey(),userId:ze("user_id").notNull(),name:we("name").notNull(),type:we("type").notNull(),balance:xt("balance",{precision:10,scale:2}).notNull().default("0"),createdAt:Te("created_at").defaultNow()}),Ft=ot("debts",{id:bt("id").primaryKey(),userId:ze("user_id").notNull(),name:we("name").notNull(),totalAmount:xt("total_amount",{precision:10,scale:2}).notNull(),currentBalance:xt("current_balance",{precision:10,scale:2}).notNull(),interestRate:xt("interest_rate",{precision:5,scale:2}).notNull().default("0"),minimumPayment:xt("minimum_payment",{precision:10,scale:2}).notNull(),dueDay:Yt("due_day").notNull(),biweeklyPayment:or("biweekly_payment").notNull().default(!1),category:we("category").notNull().default("other"),createdAt:Te("created_at").defaultNow()}),Bt=ot("transactions",{id:bt("id").primaryKey(),userId:ze("user_id").notNull(),description:we("description").notNull(),amount:xt("amount",{precision:10,scale:2}).notNull(),type:we("type").notNull(),envelopeId:Yt("envelope_id"),accountId:Yt("account_id"),isWriteOff:or("is_write_off").notNull().default(!1),writeOffCategory:we("write_off_category"),date:Te("date").defaultNow(),createdAt:Te("created_at").defaultNow()}),Lt=ot("bills",{id:bt("id").primaryKey(),userId:ze("user_id").notNull(),name:we("name").notNull(),amount:xt("amount",{precision:10,scale:2}).notNull(),dueDay:Yt("due_day").notNull(),mustHaveByDay:Yt("must_have_by_day"),isAutoPay:or("is_auto_pay").notNull().default(!1),autoFundFromPaycheck:or("auto_fund_from_paycheck").notNull().default(!0),fundingRule:we("funding_rule").notNull().default("full_on_payday"),envelopeId:Yt("envelope_id"),isPaid:or("is_paid").notNull().default(!1),paidDate:Te("paid_date"),category:we("category").notNull().default("utilities"),createdAt:Te("created_at").defaultNow()}),Sn=ot("employee_payments",{id:bt("id").primaryKey(),userId:ze("user_id").notNull(),employeeName:we("employee_name").notNull(),basePayment:xt("base_payment",{precision:10,scale:2}).notNull(),perTaskPayment:xt("per_task_payment",{precision:10,scale:2}).notNull().default("0"),taskDescription:we("task_description"),tasksCompleted:Yt("tasks_completed").notNull().default(0),lastPaidDate:Te("last_paid_date"),createdAt:Te("created_at").defaultNow()}),Tr=ot("incomes",{id:bt("id").primaryKey(),userId:ze("user_id").notNull(),source:we("source").notNull(),amount:xt("amount",{precision:10,scale:2}).notNull(),frequency:we("frequency").notNull().default("monthly"),isTaxed:or("is_taxed").notNull().default(!1),taxPercentage:xt("tax_percentage",{precision:5,scale:2}),lastReceivedDate:Te("last_received_date"),createdAt:Te("created_at").defaultNow()}),Pr=ot("pay_schedules",{id:bt("id").primaryKey(),userId:ze("user_id").notNull(),name:we("name").notNull(),amount:xt("amount",{precision:10,scale:2}).notNull(),frequency:we("frequency").notNull(),nextPayday:Te("next_payday").notNull(),createdAt:Te("created_at").defaultNow()}),En=ot("user_settings",{id:bt("id").primaryKey(),userId:ze("user_id").notNull().unique(),debtAttackMode:we("debt_attack_mode").notNull().default("avalanche"),safeToSpendWarning:or("safe_to_spend_warning").notNull().default(!0),createdAt:Te("created_at").defaultNow()}),kv=$t(Mt).omit({id:!0,createdAt:!0}),FF=$t(Cr).omit({id:!0,createdAt:!0}),Cv=$t(Ft).omit({id:!0,createdAt:!0}),Tv=$t(Bt).omit({id:!0,createdAt:!0}),Pv=$t(Lt).omit({id:!0,createdAt:!0}),BF=$t(Sn).omit({id:!0,createdAt:!0}),LF=$t(Tr).omit({id:!0,createdAt:!0}),Iv=$t(Pr).omit({id:!0,createdAt:!0}),UF=$t(En).omit({id:!0,createdAt:!0});var{Pool:zF}=yn;if(!process.env.DATABASE_URL)throw new Error("DATABASE_URL must be set. Did you forget to provision a database?");var QF=new zF({connectionString:process.env.DATABASE_URL}),J=dp(QF,{schema:Ov});var Nv=class{async getUser(e){let[r]=await J.select().from(ea).where(se(ea.id,e));return r}async upsertUser(e){let[r]=await J.insert(ea).values(e).onConflictDoUpdate({target:ea.id,set:{...e,updatedAt:new Date}}).returning();return r}},Bc=new Nv;var A4=(0,S4.default)(async()=>await ua.discovery(new URL(process.env.ISSUER_URL??"https://replit.com/oidc"),process.env.REPL_ID),{maxAge:3600*1e3});function k4(){let e=(0,E4.default)(Rv.default),r=new e({conString:process.env.DATABASE_URL,createTableIfMissing:!1,ttl:6048e5,tableName:"sessions"});return(0,Rv.default)({secret:process.env.SESSION_SECRET,store:r,resave:!1,saveUninitialized:!1,cookie:{httpOnly:!0,secure:!0,maxAge:6048e5}})}function C4(t,e){t.claims=e.claims(),t.access_token=e.access_token,t.refresh_token=e.refresh_token,t.expires_at=t.claims?.exp}async function HF(t){await Bc.upsertUser({id:t.sub,email:t.email,firstName:t.first_name,lastName:t.last_name,profileImageUrl:t.profile_image_url})}async function jv(t){t.set("trust proxy",1),t.use(k4()),t.use(An.default.initialize()),t.use(An.default.session());let e=await A4(),r=async(s,a)=>{let o={};C4(o,s),await HF(s.claims()),a(null,o)},n=new Set,i=s=>{let a=`replitauth:${s}`;if(!n.has(a)){let o=new _4.Strategy({name:a,config:e,scope:"openid email profile offline_access",callbackURL:`https://${s}/api/callback`},r);An.default.use(o),n.add(a)}};An.default.serializeUser((s,a)=>a(null,s)),An.default.deserializeUser((s,a)=>a(null,s)),t.get("/api/login",(s,a,o)=>{i(s.hostname),An.default.authenticate(`replitauth:${s.hostname}`,{prompt:"login consent",scope:["openid","email","profile","offline_access"]})(s,a,o)}),t.get("/api/callback",(s,a,o)=>{i(s.hostname),An.default.authenticate(`replitauth:${s.hostname}`,{successReturnToOrRedirect:"/",failureRedirect:"/api/login"})(s,a,o)}),t.get("/api/logout",(s,a)=>{s.logout(()=>{a.redirect(ua.buildEndSessionUrl(e,{client_id:process.env.REPL_ID,post_logout_redirect_uri:`${s.protocol}://${s.hostname}`}).href)})})}var ce=async(t,e,r)=>{let n=t.user;if(!t.isAuthenticated()||!n.expires_at)return e.status(401).json({message:"Unauthorized"});if(Math.floor(Date.now()/1e3)<=n.expires_at)return r();let s=n.refresh_token;if(!s){e.status(401).json({message:"Unauthorized"});return}try{let a=await A4(),o=await ua.refreshTokenGrant(a,s);return C4(n,o),r()}catch{e.status(401).json({message:"Unauthorized"});return}};function qv(t){t.get("/api/auth/user",ce,async(e,r)=>{try{let n=e.user.claims.sub,i=await Bc.getUser(n);r.json(i)}catch(n){console.error("Error fetching user:",n),r.status(500).json({message:"Failed to fetch user"})}})}var Dv=class{async getEnvelopesByUser(e){return J.select().from(Mt).where(se(Mt.userId,e)).orderBy(Ks(Mt.createdAt))}async getEnvelope(e){let[r]=await J.select().from(Mt).where(se(Mt.id,e));return r}async createEnvelope(e){let[r]=await J.insert(Mt).values({...e,currentBalance:e.budgetAmount}).returning();return r}async updateEnvelope(e,r){let[n]=await J.update(Mt).set(r).where(se(Mt.id,e)).returning();return n}async deleteEnvelope(e){await J.delete(Mt).where(se(Mt.id,e))}async getAccountsByUser(e){return J.select().from(Cr).where(se(Cr.userId,e))}async getAccount(e){let[r]=await J.select().from(Cr).where(se(Cr.id,e));return r}async createAccount(e){let[r]=await J.insert(Cr).values(e).returning();return r}async updateAccount(e,r){let[n]=await J.update(Cr).set(r).where(se(Cr.id,e)).returning();return n}async getDebtsByUser(e){return J.select().from(Ft).where(se(Ft.userId,e)).orderBy(Ks(Ft.createdAt))}async getDebt(e){let[r]=await J.select().from(Ft).where(se(Ft.id,e));return r}async createDebt(e){let[r]=await J.insert(Ft).values(e).returning();return r}async updateDebt(e,r){let[n]=await J.update(Ft).set(r).where(se(Ft.id,e)).returning();return n}async deleteDebt(e){await J.delete(Ft).where(se(Ft.id,e))}async getTransactionsByUser(e){return J.select().from(Bt).where(se(Bt.userId,e)).orderBy(Ks(Bt.date))}async getTransaction(e){let[r]=await J.select().from(Bt).where(se(Bt.id,e));return r}async createTransaction(e){let[r]=await J.insert(Bt).values(e).returning();return r}async updateTransaction(e,r){let[n]=await J.update(Bt).set(r).where(se(Bt.id,e)).returning();return n}async deleteTransaction(e){await J.delete(Bt).where(se(Bt.id,e))}async getBillsByUser(e){return J.select().from(Lt).where(se(Lt.userId,e)).orderBy(Lt.dueDay)}async getBill(e){let[r]=await J.select().from(Lt).where(se(Lt.id,e));return r}async createBill(e){let[r]=await J.insert(Lt).values(e).returning();return r}async updateBill(e,r){let[n]=await J.update(Lt).set(r).where(se(Lt.id,e)).returning();return n}async deleteBill(e){await J.delete(Lt).where(se(Lt.id,e))}async getEmployeePaymentsByUser(e){return J.select().from(Sn).where(se(Sn.userId,e))}async createEmployeePayment(e){let[r]=await J.insert(Sn).values(e).returning();return r}async updateEmployeePayment(e,r){let[n]=await J.update(Sn).set(r).where(se(Sn.id,e)).returning();return n}async getIncomesByUser(e){return J.select().from(Tr).where(se(Tr.userId,e))}async createIncome(e){let[r]=await J.insert(Tr).values(e).returning();return r}async updateIncome(e,r){let[n]=await J.update(Tr).set(r).where(se(Tr.id,e)).returning();return n}async deleteIncome(e){await J.delete(Tr).where(se(Tr.id,e))}async getPaySchedulesByUser(e){return J.select().from(Pr).where(se(Pr.userId,e))}async createPaySchedule(e){let[r]=await J.insert(Pr).values(e).returning();return r}async updatePaySchedule(e,r){let[n]=await J.update(Pr).set(r).where(se(Pr.id,e)).returning();return n}async deletePaySchedule(e){await J.delete(Pr).where(se(Pr.id,e))}async getUserSettings(e){let[r]=await J.select().from(En).where(se(En.userId,e));return r}async upsertUserSettings(e){if(await this.getUserSettings(e.userId)){let[i]=await J.update(En).set(e).where(se(En.userId,e.userId)).returning();return i}let[n]=await J.insert(En).values(e).returning();return n}async seedUserData(e){(await this.getAccountsByUser(e)).length>0||(await Promise.all([this.createAccount({userId:e,name:"Bills Account",type:"bills",balance:"2500.00"}),this.createAccount({userId:e,name:"Spending Account",type:"spending",balance:"850.00"}),this.createAccount({userId:e,name:"Savings Account",type:"savings",balance:"1200.00"})]),await Promise.all([this.createEnvelope({userId:e,name:"Rent/Mortgage",budgetAmount:"1500.00",isStrict:!0,category:"housing",color:"#ef4444"}),this.createEnvelope({userId:e,name:"Car Payment",budgetAmount:"450.00",isStrict:!0,category:"transportation",color:"#f59e0b"}),this.createEnvelope({userId:e,name:"Insurance",budgetAmount:"200.00",isStrict:!0,category:"insurance",color:"#3b82f6"}),this.createEnvelope({userId:e,name:"Utilities",budgetAmount:"250.00",isStrict:!0,category:"utilities",color:"#8b5cf6"}),this.createEnvelope({userId:e,name:"Brady (Employee)",budgetAmount:"300.00",isStrict:!0,category:"employee",color:"#22c55e"}),this.createEnvelope({userId:e,name:"Groceries",budgetAmount:"500.00",isStrict:!1,category:"groceries",color:"#06b6d4"}),this.createEnvelope({userId:e,name:"Entertainment",budgetAmount:"150.00",isStrict:!1,category:"entertainment",color:"#ec4899"})]),await Promise.all([this.createDebt({userId:e,name:"IRS Tax Debt",totalAmount:"17000.00",currentBalance:"17000.00",interestRate:"0",minimumPayment:"500.00",dueDay:15,biweeklyPayment:!1,category:"tax"}),this.createDebt({userId:e,name:"Credit Card",totalAmount:"5000.00",currentBalance:"3200.00",interestRate:"19.99",minimumPayment:"100.00",dueDay:20,biweeklyPayment:!1,category:"credit_card"}),this.createDebt({userId:e,name:"Car Loan",totalAmount:"25000.00",currentBalance:"18500.00",interestRate:"6.5",minimumPayment:"450.00",dueDay:5,biweeklyPayment:!0,category:"car_loan"})]),await Promise.all([this.createBill({userId:e,name:"Rent",amount:"1500.00",dueDay:1,isAutoPay:!1,category:"housing"}),this.createBill({userId:e,name:"Electric",amount:"120.00",dueDay:15,isAutoPay:!0,category:"utilities"}),this.createBill({userId:e,name:"Internet",amount:"80.00",dueDay:10,isAutoPay:!0,category:"utilities"}),this.createBill({userId:e,name:"Car Insurance",amount:"150.00",dueDay:20,isAutoPay:!0,category:"insurance"})]))}},Z=new Dv;function U(t,e,r,n,i){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?i.call(t,r):i?i.value=r:e.set(t,r),r}function b(t,e,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(t):n?n.value:e.get(t)}var $v=function(){let{crypto:t}=globalThis;if(t?.randomUUID)return $v=t.randomUUID.bind(t),t.randomUUID();let e=new Uint8Array(1),r=t?()=>t.getRandomValues(e)[0]:()=>Math.random()*255&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,n=>(+n^r()&15>>+n/4).toString(16))};function Lc(t){return typeof t=="object"&&t!==null&&("name"in t&&t.name==="AbortError"||"message"in t&&String(t.message).includes("FetchRequestCanceledException"))}var Uc=t=>{if(t instanceof Error)return t;if(typeof t=="object"&&t!==null){try{if(Object.prototype.toString.call(t)==="[object Error]"){let e=new Error(t.message,t.cause?{cause:t.cause}:{});return t.stack&&(e.stack=t.stack),t.cause&&!e.cause&&(e.cause=t.cause),t.name&&(e.name=t.name),e}}catch{}try{return new Error(JSON.stringify(t))}catch{}}return new Error(t)};var D=class extends Error{},Qe=class t extends D{constructor(e,r,n,i){super(`${t.makeMessage(e,r,n)}`),this.status=e,this.headers=i,this.requestID=i?.get("x-request-id"),this.error=r;let s=r;this.code=s?.code,this.param=s?.param,this.type=s?.type}static makeMessage(e,r,n){let i=r?.message?typeof r.message=="string"?r.message:JSON.stringify(r.message):r?JSON.stringify(r):n;return e&&i?`${e} ${i}`:e?`${e} status code (no body)`:i||"(no status code or body)"}static generate(e,r,n,i){if(!e||!i)return new kn({message:n,cause:Uc(r)});let s=r?.error;return e===400?new la(e,s,n,i):e===401?new pa(e,s,n,i):e===403?new da(e,s,n,i):e===404?new fa(e,s,n,i):e===409?new ma(e,s,n,i):e===422?new ha(e,s,n,i):e===429?new ga(e,s,n,i):e>=500?new va(e,s,n,i):new t(e,s,n,i)}},Le=class extends Qe{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}},kn=class extends Qe{constructor({message:e,cause:r}){super(void 0,void 0,e||"Connection error.",void 0),r&&(this.cause=r)}},Cn=class extends kn{constructor({message:e}={}){super({message:e??"Request timed out."})}},la=class extends Qe{},pa=class extends Qe{},da=class extends Qe{},fa=class extends Qe{},ma=class extends Qe{},ha=class extends Qe{},ga=class extends Qe{},va=class extends Qe{},ya=class extends D{constructor(){super("Could not parse response content as the length limit was reached")}},xa=class extends D{constructor(){super("Could not parse response content as the request was rejected by the content filter")}},Ir=class extends Error{constructor(e){super(e)}};var WF=/^[a-z][a-z0-9+.-]*:/i,T4=t=>WF.test(t),lt=t=>(lt=Array.isArray,lt(t)),Mv=lt;function Fv(t){return typeof t!="object"?{}:t??{}}function P4(t){if(!t)return!0;for(let e in t)return!1;return!0}function I4(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function zc(t){return t!=null&&typeof t=="object"&&!Array.isArray(t)}var O4=(t,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new D(`${t} must be an integer`);if(e<0)throw new D(`${t} must be a positive integer`);return e};var N4=t=>{try{return JSON.parse(t)}catch{return}};var Or=t=>new Promise(e=>setTimeout(e,t));var Tn="6.15.0";var D4=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u";function GF(){return typeof Deno<"u"&&Deno.build!=null?"deno":typeof EdgeRuntime<"u"?"edge":Object.prototype.toString.call(typeof globalThis.process<"u"?globalThis.process:0)==="[object process]"?"node":"unknown"}var KF=()=>{let t=GF();if(t==="deno")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Tn,"X-Stainless-OS":j4(Deno.build.os),"X-Stainless-Arch":R4(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:Deno.version?.deno??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Tn,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if(t==="node")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Tn,"X-Stainless-OS":j4(globalThis.process.platform??"unknown"),"X-Stainless-Arch":R4(globalThis.process.arch??"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":globalThis.process.version??"unknown"};let e=JF();return e?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Tn,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${e.browser}`,"X-Stainless-Runtime-Version":e.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Tn,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function JF(){if(typeof navigator>"u"||!navigator)return null;let t=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(let{key:e,pattern:r}of t){let n=r.exec(navigator.userAgent);if(n){let i=n[1]||0,s=n[2]||0,a=n[3]||0;return{browser:e,version:`${i}.${s}.${a}`}}}return null}var R4=t=>t==="x32"?"x32":t==="x86_64"||t==="x64"?"x64":t==="arm"?"arm":t==="aarch64"||t==="arm64"?"arm64":t?`other:${t}`:"unknown",j4=t=>(t=t.toLowerCase(),t.includes("ios")?"iOS":t==="android"?"Android":t==="darwin"?"MacOS":t==="win32"?"Windows":t==="freebsd"?"FreeBSD":t==="openbsd"?"OpenBSD":t==="linux"?"Linux":t?`Other:${t}`:"Unknown"),q4,$4=()=>q4??(q4=KF());function M4(){if(typeof fetch<"u")return fetch;throw new Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new OpenAI({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}function Bv(...t){let e=globalThis.ReadableStream;if(typeof e>"u")throw new Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new e(...t)}function yp(t){let e=Symbol.asyncIterator in t?t[Symbol.asyncIterator]():t[Symbol.iterator]();return Bv({start(){},async pull(r){let{done:n,value:i}=await e.next();n?r.close():r.enqueue(i)},async cancel(){await e.return?.()}})}function Lv(t){if(t[Symbol.asyncIterator])return t;let e=t.getReader();return{async next(){try{let r=await e.read();return r?.done&&e.releaseLock(),r}catch(r){throw e.releaseLock(),r}},async return(){let r=e.cancel();return e.releaseLock(),await r,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function F4(t){if(t===null||typeof t!="object")return;if(t[Symbol.asyncIterator]){await t[Symbol.asyncIterator]().return?.();return}let e=t.getReader(),r=e.cancel();e.releaseLock(),await r}var B4=({headers:t,body:e})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(e)});var xp="RFC3986",Uv=t=>String(t),bp={RFC1738:t=>String(t).replace(/%20/g,"+"),RFC3986:Uv},zv="RFC1738";var wp=(t,e)=>(wp=Object.hasOwn??Function.prototype.call.bind(Object.prototype.hasOwnProperty),wp(t,e)),Nr=(()=>{let t=[];for(let e=0;e<256;++e)t.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return t})();var Qv=1024,L4=(t,e,r,n,i)=>{if(t.length===0)return t;let s=t;if(typeof t=="symbol"?s=Symbol.prototype.toString.call(t):typeof t!="string"&&(s=String(t)),r==="iso-8859-1")return escape(s).replace(/%u[0-9a-f]{4}/gi,function(o){return"%26%23"+parseInt(o.slice(2),16)+"%3B"});let a="";for(let o=0;o<s.length;o+=Qv){let u=s.length>=Qv?s.slice(o,o+Qv):s,c=[];for(let l=0;l<u.length;++l){let p=u.charCodeAt(l);if(p===45||p===46||p===95||p===126||p>=48&&p<=57||p>=65&&p<=90||p>=97&&p<=122||i===zv&&(p===40||p===41)){c[c.length]=u.charAt(l);continue}if(p<128){c[c.length]=Nr[p];continue}if(p<2048){c[c.length]=Nr[192|p>>6]+Nr[128|p&63];continue}if(p<55296||p>=57344){c[c.length]=Nr[224|p>>12]+Nr[128|p>>6&63]+Nr[128|p&63];continue}l+=1,p=65536+((p&1023)<<10|u.charCodeAt(l)&1023),c[c.length]=Nr[240|p>>18]+Nr[128|p>>12&63]+Nr[128|p>>6&63]+Nr[128|p&63]}a+=c.join("")}return a};function U4(t){return!t||typeof t!="object"?!1:!!(t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer(t))}function Hv(t,e){if(lt(t)){let r=[];for(let n=0;n<t.length;n+=1)r.push(e(t[n]));return r}return e(t)}var Q4={brackets(t){return String(t)+"[]"},comma:"comma",indices(t,e){return String(t)+"["+e+"]"},repeat(t){return String(t)}},H4=function(t,e){Array.prototype.push.apply(t,lt(e)?e:[e])},z4,He={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:L4,encodeValuesOnly:!1,format:xp,formatter:Uv,indices:!1,serializeDate(t){return(z4??(z4=Function.prototype.call.bind(Date.prototype.toISOString)))(t)},skipNulls:!1,strictNullHandling:!1};function YF(t){return typeof t=="string"||typeof t=="number"||typeof t=="boolean"||typeof t=="symbol"||typeof t=="bigint"}var Vv={};function V4(t,e,r,n,i,s,a,o,u,c,l,p,d,f,h,m,x,_){let w=t,A=_,P=0,F=!1;for(;(A=A.get(Vv))!==void 0&&!F;){let Y=A.get(t);if(P+=1,typeof Y<"u"){if(Y===P)throw new RangeError("Cyclic object value");F=!0}typeof A.get(Vv)>"u"&&(P=0)}if(typeof c=="function"?w=c(e,w):w instanceof Date?w=d?.(w):r==="comma"&&lt(w)&&(w=Hv(w,function(Y){return Y instanceof Date?d?.(Y):Y})),w===null){if(s)return u&&!m?u(e,He.encoder,x,"key",f):e;w=""}if(YF(w)||U4(w)){if(u){let Y=m?e:u(e,He.encoder,x,"key",f);return[h?.(Y)+"="+h?.(u(w,He.encoder,x,"value",f))]}return[h?.(e)+"="+h?.(String(w))]}let T=[];if(typeof w>"u")return T;let C;if(r==="comma"&&lt(w))m&&u&&(w=Hv(w,u)),C=[{value:w.length>0?w.join(",")||null:void 0}];else if(lt(c))C=c;else{let Y=Object.keys(w);C=l?Y.sort(l):Y}let R=o?String(e).replace(/\./g,"%2E"):String(e),z=n&&lt(w)&&w.length===1?R+"[]":R;if(i&&lt(w)&&w.length===0)return z+"[]";for(let Y=0;Y<C.length;++Y){let te=C[Y],re=typeof te=="object"&&typeof te.value<"u"?te.value:w[te];if(a&&re===null)continue;let oe=p&&o?te.replace(/\./g,"%2E"):te,_e=lt(w)?typeof r=="function"?r(z,oe):z:z+(p?"."+oe:"["+oe+"]");_.set(t,P);let Ae=new WeakMap;Ae.set(Vv,_),H4(T,V4(re,_e,r,n,i,s,a,o,r==="comma"&&m&&lt(w)?null:u,c,l,p,d,f,h,m,x,Ae))}return T}function eB(t=He){if(typeof t.allowEmptyArrays<"u"&&typeof t.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof t.encodeDotInKeys<"u"&&typeof t.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(t.encoder!==null&&typeof t.encoder<"u"&&typeof t.encoder!="function")throw new TypeError("Encoder has to be a function.");let e=t.charset||He.charset;if(typeof t.charset<"u"&&t.charset!=="utf-8"&&t.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let r=xp;if(typeof t.format<"u"){if(!wp(bp,t.format))throw new TypeError("Unknown format option provided.");r=t.format}let n=bp[r],i=He.filter;(typeof t.filter=="function"||lt(t.filter))&&(i=t.filter);let s;if(t.arrayFormat&&t.arrayFormat in Q4?s=t.arrayFormat:"indices"in t?s=t.indices?"indices":"repeat":s=He.arrayFormat,"commaRoundTrip"in t&&typeof t.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");let a=typeof t.allowDots>"u"?t.encodeDotInKeys?!0:He.allowDots:!!t.allowDots;return{addQueryPrefix:typeof t.addQueryPrefix=="boolean"?t.addQueryPrefix:He.addQueryPrefix,allowDots:a,allowEmptyArrays:typeof t.allowEmptyArrays=="boolean"?!!t.allowEmptyArrays:He.allowEmptyArrays,arrayFormat:s,charset:e,charsetSentinel:typeof t.charsetSentinel=="boolean"?t.charsetSentinel:He.charsetSentinel,commaRoundTrip:!!t.commaRoundTrip,delimiter:typeof t.delimiter>"u"?He.delimiter:t.delimiter,encode:typeof t.encode=="boolean"?t.encode:He.encode,encodeDotInKeys:typeof t.encodeDotInKeys=="boolean"?t.encodeDotInKeys:He.encodeDotInKeys,encoder:typeof t.encoder=="function"?t.encoder:He.encoder,encodeValuesOnly:typeof t.encodeValuesOnly=="boolean"?t.encodeValuesOnly:He.encodeValuesOnly,filter:i,format:r,formatter:n,serializeDate:typeof t.serializeDate=="function"?t.serializeDate:He.serializeDate,skipNulls:typeof t.skipNulls=="boolean"?t.skipNulls:He.skipNulls,sort:typeof t.sort=="function"?t.sort:null,strictNullHandling:typeof t.strictNullHandling=="boolean"?t.strictNullHandling:He.strictNullHandling}}function Wv(t,e={}){let r=t,n=eB(e),i,s;typeof n.filter=="function"?(s=n.filter,r=s("",r)):lt(n.filter)&&(s=n.filter,i=s);let a=[];if(typeof r!="object"||r===null)return"";let o=Q4[n.arrayFormat],u=o==="comma"&&n.commaRoundTrip;i||(i=Object.keys(r)),n.sort&&i.sort(n.sort);let c=new WeakMap;for(let d=0;d<i.length;++d){let f=i[d];n.skipNulls&&r[f]===null||H4(a,V4(r[f],f,o,u,n.allowEmptyArrays,n.strictNullHandling,n.skipNulls,n.encodeDotInKeys,n.encode?n.encoder:null,n.filter,n.sort,n.allowDots,n.serializeDate,n.format,n.formatter,n.encodeValuesOnly,n.charset,c))}let l=a.join(n.delimiter),p=n.addQueryPrefix===!0?"?":"";return n.charsetSentinel&&(n.charset==="iso-8859-1"?p+="utf8=%26%2310003%3B&":p+="utf8=%E2%9C%93&"),l.length>0?p+l:""}function K4(t){let e=0;for(let i of t)e+=i.length;let r=new Uint8Array(e),n=0;for(let i of t)r.set(i,n),n+=i.length;return r}var W4;function ba(t){let e;return(W4??(e=new globalThis.TextEncoder,W4=e.encode.bind(e)))(t)}var G4;function Gv(t){let e;return(G4??(e=new globalThis.TextDecoder,G4=e.decode.bind(e)))(t)}var Ut,zt,Ci=class{constructor(){Ut.set(this,void 0),zt.set(this,void 0),U(this,Ut,new Uint8Array,"f"),U(this,zt,null,"f")}decode(e){if(e==null)return[];let r=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?ba(e):e;U(this,Ut,K4([b(this,Ut,"f"),r]),"f");let n=[],i;for(;(i=rB(b(this,Ut,"f"),b(this,zt,"f")))!=null;){if(i.carriage&&b(this,zt,"f")==null){U(this,zt,i.index,"f");continue}if(b(this,zt,"f")!=null&&(i.index!==b(this,zt,"f")+1||i.carriage)){n.push(Gv(b(this,Ut,"f").subarray(0,b(this,zt,"f")-1))),U(this,Ut,b(this,Ut,"f").subarray(b(this,zt,"f")),"f"),U(this,zt,null,"f");continue}let s=b(this,zt,"f")!==null?i.preceding-1:i.preceding,a=Gv(b(this,Ut,"f").subarray(0,s));n.push(a),U(this,Ut,b(this,Ut,"f").subarray(i.index),"f"),U(this,zt,null,"f")}return n}flush(){return b(this,Ut,"f").length?this.decode(`
    77  `):[]}};Ut=new WeakMap,zt=new WeakMap;Ci.NEWLINE_CHARS=new Set([`
    78  `,"\r"]);Ci.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function rB(t,e){for(let i=e??0;i<t.length;i++){if(t[i]===10)return{preceding:i,index:i+1,carriage:!1};if(t[i]===13)return{preceding:i,index:i+1,carriage:!0}}return null}function J4(t){for(let n=0;n<t.length-1;n++){if(t[n]===10&&t[n+1]===10||t[n]===13&&t[n+1]===13)return n+2;if(t[n]===13&&t[n+1]===10&&n+3<t.length&&t[n+2]===13&&t[n+3]===10)return n+4}return-1}var Sp={off:0,error:200,warn:300,info:400,debug:500},Kv=(t,e,r)=>{if(t){if(I4(Sp,t))return t;$e(r).warn(`${e} was set to ${JSON.stringify(t)}, expected one of ${JSON.stringify(Object.keys(Sp))}`)}};function Qc(){}function _p(t,e,r){return!e||Sp[t]>Sp[r]?Qc:e[t].bind(e)}var nB={error:Qc,warn:Qc,info:Qc,debug:Qc},Z4=new WeakMap;function $e(t){let e=t.logger,r=t.logLevel??"off";if(!e)return nB;let n=Z4.get(e);if(n&&n[0]===r)return n[1];let i={error:_p("error",e,r),warn:_p("warn",e,r),info:_p("info",e,r),debug:_p("debug",e,r)};return Z4.set(e,[r,i]),i}var Wr=t=>(t.options&&(t.options={...t.options},delete t.options.headers),t.headers&&(t.headers=Object.fromEntries((t.headers instanceof Headers?[...t.headers]:Object.entries(t.headers)).map(([e,r])=>[e,e.toLowerCase()==="authorization"||e.toLowerCase()==="cookie"||e.toLowerCase()==="set-cookie"?"***":r]))),"retryOfRequestLogID"in t&&(t.retryOfRequestLogID&&(t.retryOf=t.retryOfRequestLogID),delete t.retryOfRequestLogID),t);var Hc,Rr=class t{constructor(e,r,n){this.iterator=e,Hc.set(this,void 0),this.controller=r,U(this,Hc,n,"f")}static fromSSEResponse(e,r,n){let i=!1,s=n?$e(n):console;async function*a(){if(i)throw new D("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");i=!0;let o=!1;try{for await(let u of iB(e,r))if(!o){if(u.data.startsWith("[DONE]")){o=!0;continue}if(u.event===null||!u.event.startsWith("thread.")){let c;try{c=JSON.parse(u.data)}catch(l){throw s.error("Could not parse message into JSON:",u.data),s.error("From chunk:",u.raw),l}if(c&&c.error)throw new Qe(void 0,c.error,void 0,e.headers);yield c}else{let c;try{c=JSON.parse(u.data)}catch(l){throw console.error("Could not parse message into JSON:",u.data),console.error("From chunk:",u.raw),l}if(u.event=="error")throw new Qe(void 0,c.error,c.message,void 0);yield{event:u.event,data:c}}}o=!0}catch(u){if(Lc(u))return;throw u}finally{o||r.abort()}}return new t(a,r,n)}static fromReadableStream(e,r,n){let i=!1;async function*s(){let o=new Ci,u=Lv(e);for await(let c of u)for(let l of o.decode(c))yield l;for(let c of o.flush())yield c}async function*a(){if(i)throw new D("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");i=!0;let o=!1;try{for await(let u of s())o||u&&(yield JSON.parse(u));o=!0}catch(u){if(Lc(u))return;throw u}finally{o||r.abort()}}return new t(a,r,n)}[(Hc=new WeakMap,Symbol.asyncIterator)](){return this.iterator()}tee(){let e=[],r=[],n=this.iterator(),i=s=>({next:()=>{if(s.length===0){let a=n.next();e.push(a),r.push(a)}return s.shift()}});return[new t(()=>i(e),this.controller,b(this,Hc,"f")),new t(()=>i(r),this.controller,b(this,Hc,"f"))]}toReadableStream(){let e=this,r;return Bv({async start(){r=e[Symbol.asyncIterator]()},async pull(n){try{let{value:i,done:s}=await r.next();if(s)return n.close();let a=ba(JSON.stringify(i)+`
    79  `);n.enqueue(a)}catch(i){n.error(i)}},async cancel(){await r.return?.()}})}};async function*iB(t,e){if(!t.body)throw e.abort(),typeof globalThis.navigator<"u"&&globalThis.navigator.product==="ReactNative"?new D("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api"):new D("Attempted to iterate over a response with no body");let r=new Jv,n=new Ci,i=Lv(t.body);for await(let s of sB(i))for(let a of n.decode(s)){let o=r.decode(a);o&&(yield o)}for(let s of n.flush()){let a=r.decode(s);a&&(yield a)}}async function*sB(t){let e=new Uint8Array;for await(let r of t){if(r==null)continue;let n=r instanceof ArrayBuffer?new Uint8Array(r):typeof r=="string"?ba(r):r,i=new Uint8Array(e.length+n.length);i.set(e),i.set(n,e.length),e=i;let s;for(;(s=J4(e))!==-1;)yield e.slice(0,s),e=e.slice(s)}e.length>0&&(yield e)}var Jv=class{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;let s={event:this.event,data:this.data.join(`
    80  `),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],s}if(this.chunks.push(e),e.startsWith(":"))return null;let[r,n,i]=aB(e,":");return i.startsWith(" ")&&(i=i.substring(1)),r==="event"?this.event=i:r==="data"&&this.data.push(i),null}};function aB(t,e){let r=t.indexOf(e);return r!==-1?[t.substring(0,r),e,t.substring(r+e.length)]:[t,"",""]}async function Ep(t,e){let{response:r,requestLogID:n,retryOfRequestLogID:i,startTime:s}=e,a=await(async()=>{if(e.options.stream)return $e(t).debug("response",r.status,r.url,r.headers,r.body),e.options.__streamClass?e.options.__streamClass.fromSSEResponse(r,e.controller,t):Rr.fromSSEResponse(r,e.controller,t);if(r.status===204)return null;if(e.options.__binaryResponse)return r;let u=r.headers.get("content-type")?.split(";")[0]?.trim();if(u?.includes("application/json")||u?.endsWith("+json")){let p=await r.json();return Zv(p,r)}return await r.text()})();return $e(t).debug(`[${n}] response parsed`,Wr({retryOfRequestLogID:i,url:r.url,status:r.status,body:a,durationMs:Date.now()-s})),a}function Zv(t,e){return!t||typeof t!="object"||Array.isArray(t)?t:Object.defineProperty(t,"_request_id",{value:e.headers.get("x-request-id"),enumerable:!1})}var Vc,Ti=class t extends Promise{constructor(e,r,n=Ep){super(i=>{i(null)}),this.responsePromise=r,this.parseResponse=n,Vc.set(this,void 0),U(this,Vc,e,"f")}_thenUnwrap(e){return new t(b(this,Vc,"f"),this.responsePromise,async(r,n)=>Zv(e(await this.parseResponse(r,n),n),n.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){let[e,r]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:r,request_id:r.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(b(this,Vc,"f"),e))),this.parsedPromise}then(e,r){return this.parse().then(e,r)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}};Vc=new WeakMap;var Ap,Wc=class{constructor(e,r,n,i){Ap.set(this,void 0),U(this,Ap,e,"f"),this.options=i,this.response=r,this.body=n}hasNextPage(){return this.getPaginatedItems().length?this.nextPageRequestOptions()!=null:!1}async getNextPage(){let e=this.nextPageRequestOptions();if(!e)throw new D("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");return await b(this,Ap,"f").requestAPIList(this.constructor,e)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(Ap=new WeakMap,Symbol.asyncIterator)](){for await(let e of this.iterPages())for(let r of e.getPaginatedItems())yield r}},Gc=class extends Ti{constructor(e,r,n){super(e,r,async(i,s)=>new n(i,s.response,await Ep(i,s),s.options))}async*[Symbol.asyncIterator](){let e=await this;for await(let r of e)yield r}},jr=class extends Wc{constructor(e,r,n,i){super(e,r,n,i),this.data=n.data||[],this.object=n.object}getPaginatedItems(){return this.data??[]}nextPageRequestOptions(){return null}},X=class extends Wc{constructor(e,r,n,i){super(e,r,n,i),this.data=n.data||[],this.has_more=n.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageRequestOptions(){let e=this.getPaginatedItems(),r=e[e.length-1]?.id;return r?{...this.options,query:{...Fv(this.options.query),after:r}}:null}},Gr=class extends Wc{constructor(e,r,n,i){super(e,r,n,i),this.data=n.data||[],this.has_more=n.has_more||!1,this.last_id=n.last_id||""}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageRequestOptions(){let e=this.last_id;return e?{...this.options,query:{...Fv(this.options.query),after:e}}:null}};var ey=()=>{if(typeof File>"u"){let{process:t}=globalThis,e=typeof t?.versions?.node=="string"&&parseInt(t.versions.node.split("."))<20;throw new Error("`File` is not defined as a global, which is required for file uploads."+(e?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function wa(t,e,r){return ey(),new File(t,e??"unknown_file",r)}function Kc(t){return(typeof t=="object"&&t!==null&&("name"in t&&t.name&&String(t.name)||"url"in t&&t.url&&String(t.url)||"filename"in t&&t.filename&&String(t.filename)||"path"in t&&t.path&&String(t.path))||"").split(/[\\/]/).pop()||void 0}var kp=t=>t!=null&&typeof t=="object"&&typeof t[Symbol.asyncIterator]=="function",ty=async(t,e)=>Xv(t.body)?{...t,body:await Y4(t.body,e)}:t,Qt=async(t,e)=>({...t,body:await Y4(t.body,e)}),X4=new WeakMap;function cB(t){let e=typeof t=="function"?t:t.fetch,r=X4.get(e);if(r)return r;let n=(async()=>{try{let i="Response"in e?e.Response:(await e("data:,")).constructor,s=new FormData;return s.toString()!==await new i(s).text()}catch{return!0}})();return X4.set(e,n),n}var Y4=async(t,e)=>{if(!await cB(e))throw new TypeError("The provided fetch function does not support file uploads with the current global FormData class.");let r=new FormData;return await Promise.all(Object.entries(t||{}).map(([n,i])=>Yv(r,n,i))),r},e2=t=>t instanceof Blob&&"name"in t,uB=t=>typeof t=="object"&&t!==null&&(t instanceof Response||kp(t)||e2(t)),Xv=t=>{if(uB(t))return!0;if(Array.isArray(t))return t.some(Xv);if(t&&typeof t=="object"){for(let e in t)if(Xv(t[e]))return!0}return!1},Yv=async(t,e,r)=>{if(r!==void 0){if(r==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof r=="string"||typeof r=="number"||typeof r=="boolean")t.append(e,String(r));else if(r instanceof Response)t.append(e,wa([await r.blob()],Kc(r)));else if(kp(r))t.append(e,wa([await new Response(yp(r)).blob()],Kc(r)));else if(e2(r))t.append(e,r,Kc(r));else if(Array.isArray(r))await Promise.all(r.map(n=>Yv(t,e+"[]",n)));else if(typeof r=="object")await Promise.all(Object.entries(r).map(([n,i])=>Yv(t,`${e}[${n}]`,i)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${r} instead`)}};var t2=t=>t!=null&&typeof t=="object"&&typeof t.size=="number"&&typeof t.type=="string"&&typeof t.text=="function"&&typeof t.slice=="function"&&typeof t.arrayBuffer=="function",lB=t=>t!=null&&typeof t=="object"&&typeof t.name=="string"&&typeof t.lastModified=="number"&&t2(t),pB=t=>t!=null&&typeof t=="object"&&typeof t.url=="string"&&typeof t.blob=="function";async function Cp(t,e,r){if(ey(),t=await t,lB(t))return t instanceof File?t:wa([await t.arrayBuffer()],t.name);if(pB(t)){let i=await t.blob();return e||(e=new URL(t.url).pathname.split(/[\\/]/).pop()),wa(await ry(i),e,r)}let n=await ry(t);if(e||(e=Kc(t)),!r?.type){let i=n.find(s=>typeof s=="object"&&"type"in s&&s.type);typeof i=="string"&&(r={...r,type:i})}return wa(n,e,r)}async function ry(t){let e=[];if(typeof t=="string"||ArrayBuffer.isView(t)||t instanceof ArrayBuffer)e.push(t);else if(t2(t))e.push(t instanceof Blob?t:await t.arrayBuffer());else if(kp(t))for await(let r of t)e.push(...await ry(r));else{let r=t?.constructor?.name;throw new Error(`Unexpected data type: ${typeof t}${r?`; constructor: ${r}`:""}${dB(t)}`)}return e}function dB(t){return typeof t!="object"||t===null?"":`; props: [${Object.getOwnPropertyNames(t).map(r=>`"${r}"`).join(", ")}]`}var k=class{constructor(e){this._client=e}};function n2(t){return t.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}var r2=Object.freeze(Object.create(null)),mB=(t=n2)=>function(r,...n){if(r.length===1)return r[0];let i=!1,s=[],a=r.reduce((l,p,d)=>{/[?#]/.test(p)&&(i=!0);let f=n[d],h=(i?encodeURIComponent:t)(""+f);return d!==n.length&&(f==null||typeof f=="object"&&f.toString===Object.getPrototypeOf(Object.getPrototypeOf(f.hasOwnProperty??r2)??r2)?.toString)&&(h=f+"",s.push({start:l.length+p.length,length:h.length,error:`Value of type ${Object.prototype.toString.call(f).slice(8,-1)} is not a valid path parameter`})),l+p+(d===n.length?"":h)},""),o=a.split(/[?#]/,1)[0],u=/(?<=^|\/)(?:\.|%2e){1,2}(?=\/|$)/gi,c;for(;(c=u.exec(o))!==null;)s.push({start:c.index,length:c[0].length,error:`Value "${c[0]}" can't be safely passed as a path parameter`});if(s.sort((l,p)=>l.start-p.start),s.length>0){let l=0,p=s.reduce((d,f)=>{let h=" ".repeat(f.start-l),m="^".repeat(f.length);return l=f.start+f.length,d+h+m},"");throw new D(`Path parameters result in path with invalid segments:
    81  ${s.map(d=>d.error).join(`
    82  `)}
    83  ${a}
    84  ${p}`)}return a},S=mB(n2);var Pi=class extends k{list(e,r={},n){return this._client.getAPIList(S`/chat/completions/${e}/messages`,X,{query:r,...n})}};function Jc(t){return t!==void 0&&"function"in t&&t.function!==void 0}function Zc(t){return t?.$brand==="auto-parseable-response-format"}function Ii(t){return t?.$brand==="auto-parseable-tool"}function i2(t,e){return!e||!ny(e)?{...t,choices:t.choices.map(r=>(a2(r.message.tool_calls),{...r,message:{...r.message,parsed:null,...r.message.tool_calls?{tool_calls:r.message.tool_calls}:void 0}}))}:Xc(t,e)}function Xc(t,e){let r=t.choices.map(n=>{if(n.finish_reason==="length")throw new ya;if(n.finish_reason==="content_filter")throw new xa;return a2(n.message.tool_calls),{...n,message:{...n.message,...n.message.tool_calls?{tool_calls:n.message.tool_calls?.map(i=>yB(e,i))??void 0}:void 0,parsed:n.message.content&&!n.message.refusal?vB(e,n.message.content):null}}});return{...t,choices:r}}function vB(t,e){return t.response_format?.type!=="json_schema"?null:t.response_format?.type==="json_schema"?"$parseRaw"in t.response_format?t.response_format.$parseRaw(e):JSON.parse(e):null}function yB(t,e){let r=t.tools?.find(n=>Jc(n)&&n.function?.name===e.function.name);return{...e,function:{...e.function,parsed_arguments:Ii(r)?r.$parseRaw(e.function.arguments):r?.function.strict?JSON.parse(e.function.arguments):null}}}function s2(t,e){if(!t||!("tools"in t)||!t.tools)return!1;let r=t.tools?.find(n=>Jc(n)&&n.function?.name===e.function.name);return Jc(r)&&(Ii(r)||r?.function.strict||!1)}function ny(t){return Zc(t.response_format)?!0:t.tools?.some(e=>Ii(e)||e.type==="function"&&e.function.strict===!0)??!1}function a2(t){for(let e of t||[])if(e.type!=="function")throw new D(`Currently only \`function\` tool calls are supported; Received \`${e.type}\``)}function o2(t){for(let e of t??[]){if(e.type!=="function")throw new D(`Currently only \`function\` tool types support auto-parsing; Received \`${e.type}\``);if(e.function.strict!==!0)throw new D(`The \`${e.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}var _a=t=>t?.role==="assistant",iy=t=>t?.role==="tool";var sy,Tp,Pp,Yc,eu,Ip,tu,Kr,ru,Op,Np,Sa,c2,Pn=class{constructor(){sy.add(this),this.controller=new AbortController,Tp.set(this,void 0),Pp.set(this,()=>{}),Yc.set(this,()=>{}),eu.set(this,void 0),Ip.set(this,()=>{}),tu.set(this,()=>{}),Kr.set(this,{}),ru.set(this,!1),Op.set(this,!1),Np.set(this,!1),Sa.set(this,!1),U(this,Tp,new Promise((e,r)=>{U(this,Pp,e,"f"),U(this,Yc,r,"f")}),"f"),U(this,eu,new Promise((e,r)=>{U(this,Ip,e,"f"),U(this,tu,r,"f")}),"f"),b(this,Tp,"f").catch(()=>{}),b(this,eu,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},b(this,sy,"m",c2).bind(this))},0)}_connected(){this.ended||(b(this,Pp,"f").call(this),this._emit("connect"))}get ended(){return b(this,ru,"f")}get errored(){return b(this,Op,"f")}get aborted(){return b(this,Np,"f")}abort(){this.controller.abort()}on(e,r){return(b(this,Kr,"f")[e]||(b(this,Kr,"f")[e]=[])).push({listener:r}),this}off(e,r){let n=b(this,Kr,"f")[e];if(!n)return this;let i=n.findIndex(s=>s.listener===r);return i>=0&&n.splice(i,1),this}once(e,r){return(b(this,Kr,"f")[e]||(b(this,Kr,"f")[e]=[])).push({listener:r,once:!0}),this}emitted(e){return new Promise((r,n)=>{U(this,Sa,!0,"f"),e!=="error"&&this.once("error",n),this.once(e,r)})}async done(){U(this,Sa,!0,"f"),await b(this,eu,"f")}_emit(e,...r){if(b(this,ru,"f"))return;e==="end"&&(U(this,ru,!0,"f"),b(this,Ip,"f").call(this));let n=b(this,Kr,"f")[e];if(n&&(b(this,Kr,"f")[e]=n.filter(i=>!i.once),n.forEach(({listener:i})=>i(...r))),e==="abort"){let i=r[0];!b(this,Sa,"f")&&!n?.length&&Promise.reject(i),b(this,Yc,"f").call(this,i),b(this,tu,"f").call(this,i),this._emit("end");return}if(e==="error"){let i=r[0];!b(this,Sa,"f")&&!n?.length&&Promise.reject(i),b(this,Yc,"f").call(this,i),b(this,tu,"f").call(this,i),this._emit("end")}}_emitFinal(){}};Tp=new WeakMap,Pp=new WeakMap,Yc=new WeakMap,eu=new WeakMap,Ip=new WeakMap,tu=new WeakMap,Kr=new WeakMap,ru=new WeakMap,Op=new WeakMap,Np=new WeakMap,Sa=new WeakMap,sy=new WeakSet,c2=function(e){if(U(this,Op,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new Le),e instanceof Le)return U(this,Np,!0,"f"),this._emit("abort",e);if(e instanceof D)return this._emit("error",e);if(e instanceof Error){let r=new D(e.message);return r.cause=e,this._emit("error",r)}return this._emit("error",new D(String(e)))};function u2(t){return typeof t.parse=="function"}var wt,ay,Rp,oy,cy,uy,l2,p2,xB=10,Ea=class extends Pn{constructor(){super(...arguments),wt.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){this._chatCompletions.push(e),this._emit("chatCompletion",e);let r=e.choices[0]?.message;return r&&this._addMessage(r),e}_addMessage(e,r=!0){if("content"in e||(e.content=null),this.messages.push(e),r){if(this._emit("message",e),iy(e)&&e.content)this._emit("functionToolCallResult",e.content);else if(_a(e)&&e.tool_calls)for(let n of e.tool_calls)n.type==="function"&&this._emit("functionToolCall",n.function)}}async finalChatCompletion(){await this.done();let e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new D("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),b(this,wt,"m",ay).call(this)}async finalMessage(){return await this.done(),b(this,wt,"m",Rp).call(this)}async finalFunctionToolCall(){return await this.done(),b(this,wt,"m",oy).call(this)}async finalFunctionToolCallResult(){return await this.done(),b(this,wt,"m",cy).call(this)}async totalUsage(){return await this.done(),b(this,wt,"m",uy).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){let e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);let r=b(this,wt,"m",Rp).call(this);r&&this._emit("finalMessage",r);let n=b(this,wt,"m",ay).call(this);n&&this._emit("finalContent",n);let i=b(this,wt,"m",oy).call(this);i&&this._emit("finalFunctionToolCall",i);let s=b(this,wt,"m",cy).call(this);s!=null&&this._emit("finalFunctionToolCallResult",s),this._chatCompletions.some(a=>a.usage)&&this._emit("totalUsage",b(this,wt,"m",uy).call(this))}async _createChatCompletion(e,r,n){let i=n?.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort())),b(this,wt,"m",l2).call(this,r);let s=await e.chat.completions.create({...r,stream:!1},{...n,signal:this.controller.signal});return this._connected(),this._addChatCompletion(Xc(s,r))}async _runChatCompletion(e,r,n){for(let i of r.messages)this._addMessage(i,!1);return await this._createChatCompletion(e,r,n)}async _runTools(e,r,n){let i="tool",{tool_choice:s="auto",stream:a,...o}=r,u=typeof s!="string"&&s.type==="function"&&s?.function?.name,{maxChatCompletions:c=xB}=n||{},l=r.tools.map(f=>{if(Ii(f)){if(!f.$callback)throw new D("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:f.$callback,name:f.function.name,description:f.function.description||"",parameters:f.function.parameters,parse:f.$parseRaw,strict:!0}}}return f}),p={};for(let f of l)f.type==="function"&&(p[f.function.name||f.function.function.name]=f.function);let d="tools"in r?l.map(f=>f.type==="function"?{type:"function",function:{name:f.function.name||f.function.function.name,parameters:f.function.parameters,description:f.function.description,strict:f.function.strict}}:f):void 0;for(let f of r.messages)this._addMessage(f,!1);for(let f=0;f<c;++f){let m=(await this._createChatCompletion(e,{...o,tool_choice:s,tools:d,messages:[...this.messages]},n)).choices[0]?.message;if(!m)throw new D("missing message in ChatCompletion response");if(!m.tool_calls?.length)return;for(let x of m.tool_calls){if(x.type!=="function")continue;let _=x.id,{name:w,arguments:A}=x.function,P=p[w];if(P){if(u&&u!==w){let R=`Invalid tool_call: ${JSON.stringify(w)}. ${JSON.stringify(u)} requested. Please try again`;this._addMessage({role:i,tool_call_id:_,content:R});continue}}else{let R=`Invalid tool_call: ${JSON.stringify(w)}. Available options are: ${Object.keys(p).map(z=>JSON.stringify(z)).join(", ")}. Please try again`;this._addMessage({role:i,tool_call_id:_,content:R});continue}let F;try{F=u2(P)?await P.parse(A):A}catch(R){let z=R instanceof Error?R.message:String(R);this._addMessage({role:i,tool_call_id:_,content:z});continue}let T=await P.function(F,this),C=b(this,wt,"m",p2).call(this,T);if(this._addMessage({role:i,tool_call_id:_,content:C}),u)return}}}};wt=new WeakSet,ay=function(){return b(this,wt,"m",Rp).call(this).content??null},Rp=function(){let e=this.messages.length;for(;e-- >0;){let r=this.messages[e];if(_a(r))return{...r,content:r.content??null,refusal:r.refusal??null}}throw new D("stream ended without producing a ChatCompletionMessage with role=assistant")},oy=function(){for(let e=this.messages.length-1;e>=0;e--){let r=this.messages[e];if(_a(r)&&r?.tool_calls?.length)return r.tool_calls.filter(n=>n.type==="function").at(-1)?.function}},cy=function(){for(let e=this.messages.length-1;e>=0;e--){let r=this.messages[e];if(iy(r)&&r.content!=null&&typeof r.content=="string"&&this.messages.some(n=>n.role==="assistant"&&n.tool_calls?.some(i=>i.type==="function"&&i.id===r.tool_call_id)))return r.content}},uy=function(){let e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(let{usage:r}of this._chatCompletions)r&&(e.completion_tokens+=r.completion_tokens,e.prompt_tokens+=r.prompt_tokens,e.total_tokens+=r.total_tokens);return e},l2=function(e){if(e.n!=null&&e.n>1)throw new D("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},p2=function(e){return typeof e=="string"?e:e===void 0?"undefined":JSON.stringify(e)};var nu=class t extends Ea{static runTools(e,r,n){let i=new t,s={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runTools"}};return i._run(()=>i._runTools(e,r,s)),i}_addMessage(e,r=!0){super._addMessage(e,r),_a(e)&&e.content&&this._emit("content",e.content)}};var tt={STR:1,NUM:2,ARR:4,OBJ:8,NULL:16,BOOL:32,NAN:64,INFINITY:128,MINUS_INFINITY:256,INF:384,SPECIAL:496,ATOM:499,COLLECTION:12,ALL:511},ly=class extends Error{},py=class extends Error{};function bB(t,e=tt.ALL){if(typeof t!="string")throw new TypeError(`expecting str, got ${typeof t}`);if(!t.trim())throw new Error(`${t} is empty`);return wB(t.trim(),e)}var wB=(t,e)=>{let r=t.length,n=0,i=d=>{throw new ly(`${d} at position ${n}`)},s=d=>{throw new py(`${d} at position ${n}`)},a=()=>(p(),n>=r&&i("Unexpected end of input"),t[n]==='"'?o():t[n]==="{"?u():t[n]==="["?c():t.substring(n,n+4)==="null"||tt.NULL&e&&r-n<4&&"null".startsWith(t.substring(n))?(n+=4,null):t.substring(n,n+4)==="true"||tt.BOOL&e&&r-n<4&&"true".startsWith(t.substring(n))?(n+=4,!0):t.substring(n,n+5)==="false"||tt.BOOL&e&&r-n<5&&"false".startsWith(t.substring(n))?(n+=5,!1):t.substring(n,n+8)==="Infinity"||tt.INFINITY&e&&r-n<8&&"Infinity".startsWith(t.substring(n))?(n+=8,1/0):t.substring(n,n+9)==="-Infinity"||tt.MINUS_INFINITY&e&&1<r-n&&r-n<9&&"-Infinity".startsWith(t.substring(n))?(n+=9,-1/0):t.substring(n,n+3)==="NaN"||tt.NAN&e&&r-n<3&&"NaN".startsWith(t.substring(n))?(n+=3,NaN):l()),o=()=>{let d=n,f=!1;for(n++;n<r&&(t[n]!=='"'||f&&t[n-1]==="\\");)f=t[n]==="\\"?!f:!1,n++;if(t.charAt(n)=='"')try{return JSON.parse(t.substring(d,++n-Number(f)))}catch(h){s(String(h))}else if(tt.STR&e)try{return JSON.parse(t.substring(d,n-Number(f))+'"')}catch{return JSON.parse(t.substring(d,t.lastIndexOf("\\"))+'"')}i("Unterminated string literal")},u=()=>{n++,p();let d={};try{for(;t[n]!=="}";){if(p(),n>=r&&tt.OBJ&e)return d;let f=o();p(),n++;try{let h=a();Object.defineProperty(d,f,{value:h,writable:!0,enumerable:!0,configurable:!0})}catch(h){if(tt.OBJ&e)return d;throw h}p(),t[n]===","&&n++}}catch{if(tt.OBJ&e)return d;i("Expected '}' at end of object")}return n++,d},c=()=>{n++;let d=[];try{for(;t[n]!=="]";)d.push(a()),p(),t[n]===","&&n++}catch{if(tt.ARR&e)return d;i("Expected ']' at end of array")}return n++,d},l=()=>{if(n===0){t==="-"&&tt.NUM&e&&i("Not sure what '-' is");try{return JSON.parse(t)}catch(f){if(tt.NUM&e)try{return t[t.length-1]==="."?JSON.parse(t.substring(0,t.lastIndexOf("."))):JSON.parse(t.substring(0,t.lastIndexOf("e")))}catch{}s(String(f))}}let d=n;for(t[n]==="-"&&n++;t[n]&&!",]}".includes(t[n]);)n++;n==r&&!(tt.NUM&e)&&i("Unterminated number literal");try{return JSON.parse(t.substring(d,n))}catch{t.substring(d,n)==="-"&&tt.NUM&e&&i("Not sure what '-' is");try{return JSON.parse(t.substring(d,t.lastIndexOf("e")))}catch(h){s(String(h))}}},p=()=>{for(;n<r&&` 
    85  \r  `.includes(t[n]);)n++};return a()},dy=t=>bB(t,tt.ALL^tt.NUM);var Ve,Jr,Aa,In,fy,jp,my,hy,gy,qp,vy,d2,Oi=class t extends Ea{constructor(e){super(),Ve.add(this),Jr.set(this,void 0),Aa.set(this,void 0),In.set(this,void 0),U(this,Jr,e,"f"),U(this,Aa,[],"f")}get currentChatCompletionSnapshot(){return b(this,In,"f")}static fromReadableStream(e){let r=new t(null);return r._run(()=>r._fromReadableStream(e)),r}static createChatCompletion(e,r,n){let i=new t(r);return i._run(()=>i._runChatCompletion(e,{...r,stream:!0},{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),i}async _createChatCompletion(e,r,n){super._createChatCompletion;let i=n?.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort())),b(this,Ve,"m",fy).call(this);let s=await e.chat.completions.create({...r,stream:!0},{...n,signal:this.controller.signal});this._connected();for await(let a of s)b(this,Ve,"m",my).call(this,a);if(s.controller.signal?.aborted)throw new Le;return this._addChatCompletion(b(this,Ve,"m",qp).call(this))}async _fromReadableStream(e,r){let n=r?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),b(this,Ve,"m",fy).call(this),this._connected();let i=Rr.fromReadableStream(e,this.controller),s;for await(let a of i)s&&s!==a.id&&this._addChatCompletion(b(this,Ve,"m",qp).call(this)),b(this,Ve,"m",my).call(this,a),s=a.id;if(i.controller.signal?.aborted)throw new Le;return this._addChatCompletion(b(this,Ve,"m",qp).call(this))}[(Jr=new WeakMap,Aa=new WeakMap,In=new WeakMap,Ve=new WeakSet,fy=function(){this.ended||U(this,In,void 0,"f")},jp=function(r){let n=b(this,Aa,"f")[r.index];return n||(n={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},b(this,Aa,"f")[r.index]=n,n)},my=function(r){if(this.ended)return;let n=b(this,Ve,"m",d2).call(this,r);this._emit("chunk",r,n);for(let i of r.choices){let s=n.choices[i.index];i.delta.content!=null&&s.message?.role==="assistant"&&s.message?.content&&(this._emit("content",i.delta.content,s.message.content),this._emit("content.delta",{delta:i.delta.content,snapshot:s.message.content,parsed:s.message.parsed})),i.delta.refusal!=null&&s.message?.role==="assistant"&&s.message?.refusal&&this._emit("refusal.delta",{delta:i.delta.refusal,snapshot:s.message.refusal}),i.logprobs?.content!=null&&s.message?.role==="assistant"&&this._emit("logprobs.content.delta",{content:i.logprobs?.content,snapshot:s.logprobs?.content??[]}),i.logprobs?.refusal!=null&&s.message?.role==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:i.logprobs?.refusal,snapshot:s.logprobs?.refusal??[]});let a=b(this,Ve,"m",jp).call(this,s);s.finish_reason&&(b(this,Ve,"m",gy).call(this,s),a.current_tool_call_index!=null&&b(this,Ve,"m",hy).call(this,s,a.current_tool_call_index));for(let o of i.delta.tool_calls??[])a.current_tool_call_index!==o.index&&(b(this,Ve,"m",gy).call(this,s),a.current_tool_call_index!=null&&b(this,Ve,"m",hy).call(this,s,a.current_tool_call_index)),a.current_tool_call_index=o.index;for(let o of i.delta.tool_calls??[]){let u=s.message.tool_calls?.[o.index];u?.type&&(u?.type==="function"?this._emit("tool_calls.function.arguments.delta",{name:u.function?.name,index:o.index,arguments:u.function.arguments,parsed_arguments:u.function.parsed_arguments,arguments_delta:o.function?.arguments??""}):(u?.type,void 0))}}},hy=function(r,n){if(b(this,Ve,"m",jp).call(this,r).done_tool_calls.has(n))return;let s=r.message.tool_calls?.[n];if(!s)throw new Error("no tool call snapshot");if(!s.type)throw new Error("tool call snapshot missing `type`");if(s.type==="function"){let a=b(this,Jr,"f")?.tools?.find(o=>Jc(o)&&o.function.name===s.function.name);this._emit("tool_calls.function.arguments.done",{name:s.function.name,index:n,arguments:s.function.arguments,parsed_arguments:Ii(a)?a.$parseRaw(s.function.arguments):a?.function.strict?JSON.parse(s.function.arguments):null})}else s.type},gy=function(r){let n=b(this,Ve,"m",jp).call(this,r);if(r.message.content&&!n.content_done){n.content_done=!0;let i=b(this,Ve,"m",vy).call(this);this._emit("content.done",{content:r.message.content,parsed:i?i.$parseRaw(r.message.content):null})}r.message.refusal&&!n.refusal_done&&(n.refusal_done=!0,this._emit("refusal.done",{refusal:r.message.refusal})),r.logprobs?.content&&!n.logprobs_content_done&&(n.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:r.logprobs.content})),r.logprobs?.refusal&&!n.logprobs_refusal_done&&(n.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:r.logprobs.refusal}))},qp=function(){if(this.ended)throw new D("stream has ended, this shouldn't happen");let r=b(this,In,"f");if(!r)throw new D("request ended without sending any chunks");return U(this,In,void 0,"f"),U(this,Aa,[],"f"),_B(r,b(this,Jr,"f"))},vy=function(){let r=b(this,Jr,"f")?.response_format;return Zc(r)?r:null},d2=function(r){var n,i,s,a;let o=b(this,In,"f"),{choices:u,...c}=r;o?Object.assign(o,c):o=U(this,In,{...c,choices:[]},"f");for(let{delta:l,finish_reason:p,index:d,logprobs:f=null,...h}of r.choices){let m=o.choices[d];if(m||(m=o.choices[d]={finish_reason:p,index:d,message:{},logprobs:f,...h}),f)if(!m.logprobs)m.logprobs=Object.assign({},f);else{let{content:T,refusal:C,...R}=f;Object.assign(m.logprobs,R),T&&((n=m.logprobs).content??(n.content=[]),m.logprobs.content.push(...T)),C&&((i=m.logprobs).refusal??(i.refusal=[]),m.logprobs.refusal.push(...C))}if(p&&(m.finish_reason=p,b(this,Jr,"f")&&ny(b(this,Jr,"f")))){if(p==="length")throw new ya;if(p==="content_filter")throw new xa}if(Object.assign(m,h),!l)continue;let{content:x,refusal:_,function_call:w,role:A,tool_calls:P,...F}=l;if(Object.assign(m.message,F),_&&(m.message.refusal=(m.message.refusal||"")+_),A&&(m.message.role=A),w&&(m.message.function_call?(w.name&&(m.message.function_call.name=w.name),w.arguments&&((s=m.message.function_call).arguments??(s.arguments=""),m.message.function_call.arguments+=w.arguments)):m.message.function_call=w),x&&(m.message.content=(m.message.content||"")+x,!m.message.refusal&&b(this,Ve,"m",vy).call(this)&&(m.message.parsed=dy(m.message.content))),P){m.message.tool_calls||(m.message.tool_calls=[]);for(let{index:T,id:C,type:R,function:z,...Y}of P){let te=(a=m.message.tool_calls)[T]??(a[T]={});Object.assign(te,Y),C&&(te.id=C),R&&(te.type=R),z&&(te.function??(te.function={name:z.name??"",arguments:""})),z?.name&&(te.function.name=z.name),z?.arguments&&(te.function.arguments+=z.arguments,s2(b(this,Jr,"f"),te)&&(te.function.parsed_arguments=dy(te.function.arguments)))}}}return o},Symbol.asyncIterator)](){let e=[],r=[],n=!1;return this.on("chunk",i=>{let s=r.shift();s?s.resolve(i):e.push(i)}),this.on("end",()=>{n=!0;for(let i of r)i.resolve(void 0);r.length=0}),this.on("abort",i=>{n=!0;for(let s of r)s.reject(i);r.length=0}),this.on("error",i=>{n=!0;for(let s of r)s.reject(i);r.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((s,a)=>r.push({resolve:s,reject:a})).then(s=>s?{value:s,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new Rr(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}};function _B(t,e){let{id:r,choices:n,created:i,model:s,system_fingerprint:a,...o}=t,u={...o,id:r,choices:n.map(({message:c,finish_reason:l,index:p,logprobs:d,...f})=>{if(!l)throw new D(`missing finish_reason for choice ${p}`);let{content:h=null,function_call:m,tool_calls:x,..._}=c,w=c.role;if(!w)throw new D(`missing role for choice ${p}`);if(m){let{arguments:A,name:P}=m;if(A==null)throw new D(`missing function_call.arguments for choice ${p}`);if(!P)throw new D(`missing function_call.name for choice ${p}`);return{...f,message:{content:h,function_call:{arguments:A,name:P},role:w,refusal:c.refusal??null},finish_reason:l,index:p,logprobs:d}}return x?{...f,index:p,finish_reason:l,logprobs:d,message:{..._,role:w,content:h,refusal:c.refusal??null,tool_calls:x.map((A,P)=>{let{function:F,type:T,id:C,...R}=A,{arguments:z,name:Y,...te}=F||{};if(C==null)throw new D(`missing choices[${p}].tool_calls[${P}].id
    86  ${Dp(t)}`);if(T==null)throw new D(`missing choices[${p}].tool_calls[${P}].type
    87  ${Dp(t)}`);if(Y==null)throw new D(`missing choices[${p}].tool_calls[${P}].function.name
    88  ${Dp(t)}`);if(z==null)throw new D(`missing choices[${p}].tool_calls[${P}].function.arguments
    89  ${Dp(t)}`);return{...R,id:C,type:T,function:{...te,name:Y,arguments:z}}})}}:{...f,message:{..._,content:h,role:w,refusal:c.refusal??null},finish_reason:l,index:p,logprobs:d}}),created:i,model:s,object:"chat.completion",...a?{system_fingerprint:a}:{}};return i2(u,e)}function Dp(t){return JSON.stringify(t)}var iu=class t extends Oi{static fromReadableStream(e){let r=new t(null);return r._run(()=>r._fromReadableStream(e)),r}static runTools(e,r,n){let i=new t(r),s={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runTools"}};return i._run(()=>i._runTools(e,r,s)),i}};var Zr=class extends k{constructor(){super(...arguments),this.messages=new Pi(this._client)}create(e,r){return this._client.post("/chat/completions",{body:e,...r,stream:e.stream??!1})}retrieve(e,r){return this._client.get(S`/chat/completions/${e}`,r)}update(e,r,n){return this._client.post(S`/chat/completions/${e}`,{body:r,...n})}list(e={},r){return this._client.getAPIList("/chat/completions",X,{query:e,...r})}delete(e,r){return this._client.delete(S`/chat/completions/${e}`,r)}parse(e,r){return o2(e.tools),this._client.chat.completions.create(e,{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"chat.completions.parse"}})._thenUnwrap(n=>Xc(n,e))}runTools(e,r){return e.stream?iu.runTools(this._client,e,r):nu.runTools(this._client,e,r)}stream(e,r){return Oi.createChatCompletion(this._client,e,r)}};Zr.Messages=Pi;var On=class extends k{constructor(){super(...arguments),this.completions=new Zr(this._client)}};On.Completions=Zr;var f2=Symbol("brand.privateNullableHeaders");function*EB(t){if(!t)return;if(f2 in t){let{values:n,nulls:i}=t;yield*n.entries();for(let s of i)yield[s,null];return}let e=!1,r;t instanceof Headers?r=t.entries():Mv(t)?r=t:(e=!0,r=Object.entries(t??{}));for(let n of r){let i=n[0];if(typeof i!="string")throw new TypeError("expected header name to be a string");let s=Mv(n[1])?n[1]:[n[1]],a=!1;for(let o of s)o!==void 0&&(e&&!a&&(a=!0,yield[i,null]),yield[i,o])}}var O=t=>{let e=new Headers,r=new Set;for(let n of t){let i=new Set;for(let[s,a]of EB(n)){let o=s.toLowerCase();i.has(o)||(e.delete(s),i.add(o)),a===null?(e.delete(s),r.add(o)):(e.append(s,a),r.delete(o))}}return{[f2]:!0,values:e,nulls:r}};var ka=class extends k{create(e,r){return this._client.post("/audio/speech",{body:e,...r,headers:O([{Accept:"application/octet-stream"},r?.headers]),__binaryResponse:!0})}};var Ca=class extends k{create(e,r){return this._client.post("/audio/transcriptions",Qt({body:e,...r,stream:e.stream??!1,__metadata:{model:e.model}},this._client))}};var Ta=class extends k{create(e,r){return this._client.post("/audio/translations",Qt({body:e,...r,__metadata:{model:e.model}},this._client))}};var qr=class extends k{constructor(){super(...arguments),this.transcriptions=new Ca(this._client),this.translations=new Ta(this._client),this.speech=new ka(this._client)}};qr.Transcriptions=Ca;qr.Translations=Ta;qr.Speech=ka;var Ni=class extends k{create(e,r){return this._client.post("/batches",{body:e,...r})}retrieve(e,r){return this._client.get(S`/batches/${e}`,r)}list(e={},r){return this._client.getAPIList("/batches",X,{query:e,...r})}cancel(e,r){return this._client.post(S`/batches/${e}/cancel`,r)}};var Pa=class extends k{create(e,r){return this._client.post("/assistants",{body:e,...r,headers:O([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}retrieve(e,r){return this._client.get(S`/assistants/${e}`,{...r,headers:O([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}update(e,r,n){return this._client.post(S`/assistants/${e}`,{body:r,...n,headers:O([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(e={},r){return this._client.getAPIList("/assistants",X,{query:e,...r,headers:O([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}delete(e,r){return this._client.delete(S`/assistants/${e}`,{...r,headers:O([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}};var Ia=class extends k{create(e,r){return this._client.post("/realtime/sessions",{body:e,...r,headers:O([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}};var Oa=class extends k{create(e,r){return this._client.post("/realtime/transcription_sessions",{body:e,...r,headers:O([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}};var Nn=class extends k{constructor(){super(...arguments),this.sessions=new Ia(this._client),this.transcriptionSessions=new Oa(this._client)}};Nn.Sessions=Ia;Nn.TranscriptionSessions=Oa;var Na=class extends k{create(e,r){return this._client.post("/chatkit/sessions",{body:e,...r,headers:O([{"OpenAI-Beta":"chatkit_beta=v1"},r?.headers])})}cancel(e,r){return this._client.post(S`/chatkit/sessions/${e}/cancel`,{...r,headers:O([{"OpenAI-Beta":"chatkit_beta=v1"},r?.headers])})}};var Ra=class extends k{retrieve(e,r){return this._client.get(S`/chatkit/threads/${e}`,{...r,headers:O([{"OpenAI-Beta":"chatkit_beta=v1"},r?.headers])})}list(e={},r){return this._client.getAPIList("/chatkit/threads",Gr,{query:e,...r,headers:O([{"OpenAI-Beta":"chatkit_beta=v1"},r?.headers])})}delete(e,r){return this._client.delete(S`/chatkit/threads/${e}`,{...r,headers:O([{"OpenAI-Beta":"chatkit_beta=v1"},r?.headers])})}listItems(e,r={},n){return this._client.getAPIList(S`/chatkit/threads/${e}/items`,Gr,{query:r,...n,headers:O([{"OpenAI-Beta":"chatkit_beta=v1"},n?.headers])})}};var Rn=class extends k{constructor(){super(...arguments),this.sessions=new Na(this._client),this.threads=new Ra(this._client)}};Rn.Sessions=Na;Rn.Threads=Ra;var ja=class extends k{create(e,r,n){return this._client.post(S`/threads/${e}/messages`,{body:r,...n,headers:O([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}retrieve(e,r,n){let{thread_id:i}=r;return this._client.get(S`/threads/${i}/messages/${e}`,{...n,headers:O([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}update(e,r,n){let{thread_id:i,...s}=r;return this._client.post(S`/threads/${i}/messages/${e}`,{body:s,...n,headers:O([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(e,r={},n){return this._client.getAPIList(S`/threads/${e}/messages`,X,{query:r,...n,headers:O([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}delete(e,r,n){let{thread_id:i}=r;return this._client.delete(S`/threads/${i}/messages/${e}`,{...n,headers:O([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}};var qa=class extends k{retrieve(e,r,n){let{thread_id:i,run_id:s,...a}=r;return this._client.get(S`/threads/${i}/runs/${s}/steps/${e}`,{query:a,...n,headers:O([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(e,r,n){let{thread_id:i,...s}=r;return this._client.getAPIList(S`/threads/${i}/runs/${e}/steps`,X,{query:s,...n,headers:O([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}};var m2=t=>{if(typeof Buffer<"u"){let e=Buffer.from(t,"base64");return Array.from(new Float32Array(e.buffer,e.byteOffset,e.length/Float32Array.BYTES_PER_ELEMENT))}else{let e=atob(t),r=e.length,n=new Uint8Array(r);for(let i=0;i<r;i++)n[i]=e.charCodeAt(i);return Array.from(new Float32Array(n.buffer))}};var jn=t=>{if(typeof globalThis.process<"u")return globalThis.process.env?.[t]?.trim()??void 0;if(typeof globalThis.Deno<"u")return globalThis.Deno.env?.get?.(t)?.trim()};var it,ji,yy,Dr,$p,ur,qi,Da,Ri,Bp,Ht,Mp,Fp,ou,su,au,h2,g2,v2,y2,x2,b2,w2,Xr=class extends Pn{constructor(){super(...arguments),it.add(this),yy.set(this,[]),Dr.set(this,{}),$p.set(this,{}),ur.set(this,void 0),qi.set(this,void 0),Da.set(this,void 0),Ri.set(this,void 0),Bp.set(this,void 0),Ht.set(this,void 0),Mp.set(this,void 0),Fp.set(this,void 0),ou.set(this,void 0)}[(yy=new WeakMap,Dr=new WeakMap,$p=new WeakMap,ur=new WeakMap,qi=new WeakMap,Da=new WeakMap,Ri=new WeakMap,Bp=new WeakMap,Ht=new WeakMap,Mp=new WeakMap,Fp=new WeakMap,ou=new WeakMap,it=new WeakSet,Symbol.asyncIterator)](){let e=[],r=[],n=!1;return this.on("event",i=>{let s=r.shift();s?s.resolve(i):e.push(i)}),this.on("end",()=>{n=!0;for(let i of r)i.resolve(void 0);r.length=0}),this.on("abort",i=>{n=!0;for(let s of r)s.reject(i);r.length=0}),this.on("error",i=>{n=!0;for(let s of r)s.reject(i);r.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((s,a)=>r.push({resolve:s,reject:a})).then(s=>s?{value:s,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){let r=new ji;return r._run(()=>r._fromReadableStream(e)),r}async _fromReadableStream(e,r){let n=r?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),this._connected();let i=Rr.fromReadableStream(e,this.controller);for await(let s of i)b(this,it,"m",su).call(this,s);if(i.controller.signal?.aborted)throw new Le;return this._addRun(b(this,it,"m",au).call(this))}toReadableStream(){return new Rr(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,r,n,i){let s=new ji;return s._run(()=>s._runToolAssistantStream(e,r,n,{...i,headers:{...i?.headers,"X-Stainless-Helper-Method":"stream"}})),s}async _createToolAssistantStream(e,r,n,i){let s=i?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort()));let a={...n,stream:!0},o=await e.submitToolOutputs(r,a,{...i,signal:this.controller.signal});this._connected();for await(let u of o)b(this,it,"m",su).call(this,u);if(o.controller.signal?.aborted)throw new Le;return this._addRun(b(this,it,"m",au).call(this))}static createThreadAssistantStream(e,r,n){let i=new ji;return i._run(()=>i._threadAssistantStream(e,r,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),i}static createAssistantStream(e,r,n,i){let s=new ji;return s._run(()=>s._runAssistantStream(e,r,n,{...i,headers:{...i?.headers,"X-Stainless-Helper-Method":"stream"}})),s}currentEvent(){return b(this,Mp,"f")}currentRun(){return b(this,Fp,"f")}currentMessageSnapshot(){return b(this,ur,"f")}currentRunStepSnapshot(){return b(this,ou,"f")}async finalRunSteps(){return await this.done(),Object.values(b(this,Dr,"f"))}async finalMessages(){return await this.done(),Object.values(b(this,$p,"f"))}async finalRun(){if(await this.done(),!b(this,qi,"f"))throw Error("Final run was not received.");return b(this,qi,"f")}async _createThreadAssistantStream(e,r,n){let i=n?.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));let s={...r,stream:!0},a=await e.createAndRun(s,{...n,signal:this.controller.signal});this._connected();for await(let o of a)b(this,it,"m",su).call(this,o);if(a.controller.signal?.aborted)throw new Le;return this._addRun(b(this,it,"m",au).call(this))}async _createAssistantStream(e,r,n,i){let s=i?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort()));let a={...n,stream:!0},o=await e.create(r,a,{...i,signal:this.controller.signal});this._connected();for await(let u of o)b(this,it,"m",su).call(this,u);if(o.controller.signal?.aborted)throw new Le;return this._addRun(b(this,it,"m",au).call(this))}static accumulateDelta(e,r){for(let[n,i]of Object.entries(r)){if(!e.hasOwnProperty(n)){e[n]=i;continue}let s=e[n];if(s==null){e[n]=i;continue}if(n==="index"||n==="type"){e[n]=i;continue}if(typeof s=="string"&&typeof i=="string")s+=i;else if(typeof s=="number"&&typeof i=="number")s+=i;else if(zc(s)&&zc(i))s=this.accumulateDelta(s,i);else if(Array.isArray(s)&&Array.isArray(i)){if(s.every(a=>typeof a=="string"||typeof a=="number")){s.push(...i);continue}for(let a of i){if(!zc(a))throw new Error(`Expected array delta entry to be an object but got: ${a}`);let o=a.index;if(o==null)throw console.error(a),new Error("Expected array delta entry to have an `index` property");if(typeof o!="number")throw new Error(`Expected array delta entry \`index\` property to be a number but got ${o}`);let u=s[o];u==null?s.push(a):s[o]=this.accumulateDelta(u,a)}continue}else throw Error(`Unhandled record type: ${n}, deltaValue: ${i}, accValue: ${s}`);e[n]=s}return e}_addRun(e){return e}async _threadAssistantStream(e,r,n){return await this._createThreadAssistantStream(r,e,n)}async _runAssistantStream(e,r,n,i){return await this._createAssistantStream(r,e,n,i)}async _runToolAssistantStream(e,r,n,i){return await this._createToolAssistantStream(r,e,n,i)}};ji=Xr,su=function(e){if(!this.ended)switch(U(this,Mp,e,"f"),b(this,it,"m",v2).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":b(this,it,"m",w2).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":b(this,it,"m",g2).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":b(this,it,"m",h2).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier");default:}},au=function(){if(this.ended)throw new D("stream has ended, this shouldn't happen");if(!b(this,qi,"f"))throw Error("Final run has not been received");return b(this,qi,"f")},h2=function(e){let[r,n]=b(this,it,"m",x2).call(this,e,b(this,ur,"f"));U(this,ur,r,"f"),b(this,$p,"f")[r.id]=r;for(let i of n){let s=r.content[i.index];s?.type=="text"&&this._emit("textCreated",s.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,r),e.data.delta.content)for(let i of e.data.delta.content){if(i.type=="text"&&i.text){let s=i.text,a=r.content[i.index];if(a&&a.type=="text")this._emit("textDelta",s,a.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(i.index!=b(this,Da,"f")){if(b(this,Ri,"f"))switch(b(this,Ri,"f").type){case"text":this._emit("textDone",b(this,Ri,"f").text,b(this,ur,"f"));break;case"image_file":this._emit("imageFileDone",b(this,Ri,"f").image_file,b(this,ur,"f"));break}U(this,Da,i.index,"f")}U(this,Ri,r.content[i.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(b(this,Da,"f")!==void 0){let i=e.data.content[b(this,Da,"f")];if(i)switch(i.type){case"image_file":this._emit("imageFileDone",i.image_file,b(this,ur,"f"));break;case"text":this._emit("textDone",i.text,b(this,ur,"f"));break}}b(this,ur,"f")&&this._emit("messageDone",e.data),U(this,ur,void 0,"f")}},g2=function(e){let r=b(this,it,"m",y2).call(this,e);switch(U(this,ou,r,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":let n=e.data.delta;if(n.step_details&&n.step_details.type=="tool_calls"&&n.step_details.tool_calls&&r.step_details.type=="tool_calls")for(let s of n.step_details.tool_calls)s.index==b(this,Bp,"f")?this._emit("toolCallDelta",s,r.step_details.tool_calls[s.index]):(b(this,Ht,"f")&&this._emit("toolCallDone",b(this,Ht,"f")),U(this,Bp,s.index,"f"),U(this,Ht,r.step_details.tool_calls[s.index],"f"),b(this,Ht,"f")&&this._emit("toolCallCreated",b(this,Ht,"f")));this._emit("runStepDelta",e.data.delta,r);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":U(this,ou,void 0,"f"),e.data.step_details.type=="tool_calls"&&b(this,Ht,"f")&&(this._emit("toolCallDone",b(this,Ht,"f")),U(this,Ht,void 0,"f")),this._emit("runStepDone",e.data,r);break;case"thread.run.step.in_progress":break}},v2=function(e){b(this,yy,"f").push(e),this._emit("event",e)},y2=function(e){switch(e.event){case"thread.run.step.created":return b(this,Dr,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let r=b(this,Dr,"f")[e.data.id];if(!r)throw Error("Received a RunStepDelta before creation of a snapshot");let n=e.data;if(n.delta){let i=ji.accumulateDelta(r,n.delta);b(this,Dr,"f")[e.data.id]=i}return b(this,Dr,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":b(this,Dr,"f")[e.data.id]=e.data;break}if(b(this,Dr,"f")[e.data.id])return b(this,Dr,"f")[e.data.id];throw new Error("No snapshot available")},x2=function(e,r){let n=[];switch(e.event){case"thread.message.created":return[e.data,n];case"thread.message.delta":if(!r)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let i=e.data;if(i.delta.content)for(let s of i.delta.content)if(s.index in r.content){let a=r.content[s.index];r.content[s.index]=b(this,it,"m",b2).call(this,s,a)}else r.content[s.index]=s,n.push(s);return[r,n];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(r)return[r,n];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},b2=function(e,r){return ji.accumulateDelta(r,e)},w2=function(e){switch(U(this,Fp,e.data,"f"),e.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":case"thread.run.incomplete":U(this,qi,e.data,"f"),b(this,Ht,"f")&&(this._emit("toolCallDone",b(this,Ht,"f")),U(this,Ht,void 0,"f"));break;case"thread.run.cancelling":break}};var Di=class extends k{constructor(){super(...arguments),this.steps=new qa(this._client)}create(e,r,n){let{include:i,...s}=r;return this._client.post(S`/threads/${e}/runs`,{query:{include:i},body:s,...n,headers:O([{"OpenAI-Beta":"assistants=v2"},n?.headers]),stream:r.stream??!1})}retrieve(e,r,n){let{thread_id:i}=r;return this._client.get(S`/threads/${i}/runs/${e}`,{...n,headers:O([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}update(e,r,n){let{thread_id:i,...s}=r;return this._client.post(S`/threads/${i}/runs/${e}`,{body:s,...n,headers:O([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(e,r={},n){return this._client.getAPIList(S`/threads/${e}/runs`,X,{query:r,...n,headers:O([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}cancel(e,r,n){let{thread_id:i}=r;return this._client.post(S`/threads/${i}/runs/${e}/cancel`,{...n,headers:O([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}async createAndPoll(e,r,n){let i=await this.create(e,r,n);return await this.poll(i.id,{thread_id:e},n)}createAndStream(e,r,n){return Xr.createAssistantStream(e,this._client.beta.threads.runs,r,n)}async poll(e,r,n){let i=O([n?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":n?.pollIntervalMs?.toString()??void 0}]);for(;;){let{data:s,response:a}=await this.retrieve(e,r,{...n,headers:{...n?.headers,...i}}).withResponse();switch(s.status){case"queued":case"in_progress":case"cancelling":let o=5e3;if(n?.pollIntervalMs)o=n.pollIntervalMs;else{let u=a.headers.get("openai-poll-after-ms");if(u){let c=parseInt(u);isNaN(c)||(o=c)}}await Or(o);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return s}}}stream(e,r,n){return Xr.createAssistantStream(e,this._client.beta.threads.runs,r,n)}submitToolOutputs(e,r,n){let{thread_id:i,...s}=r;return this._client.post(S`/threads/${i}/runs/${e}/submit_tool_outputs`,{body:s,...n,headers:O([{"OpenAI-Beta":"assistants=v2"},n?.headers]),stream:r.stream??!1})}async submitToolOutputsAndPoll(e,r,n){let i=await this.submitToolOutputs(e,r,n);return await this.poll(i.id,r,n)}submitToolOutputsStream(e,r,n){return Xr.createToolAssistantStream(e,this._client.beta.threads.runs,r,n)}};Di.Steps=qa;var qn=class extends k{constructor(){super(...arguments),this.runs=new Di(this._client),this.messages=new ja(this._client)}create(e={},r){return this._client.post("/threads",{body:e,...r,headers:O([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}retrieve(e,r){return this._client.get(S`/threads/${e}`,{...r,headers:O([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}update(e,r,n){return this._client.post(S`/threads/${e}`,{body:r,...n,headers:O([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}delete(e,r){return this._client.delete(S`/threads/${e}`,{...r,headers:O([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}createAndRun(e,r){return this._client.post("/threads/runs",{body:e,...r,headers:O([{"OpenAI-Beta":"assistants=v2"},r?.headers]),stream:e.stream??!1})}async createAndRunPoll(e,r){let n=await this.createAndRun(e,r);return await this.runs.poll(n.id,{thread_id:n.thread_id},r)}createAndRunStream(e,r){return Xr.createThreadAssistantStream(e,this._client.beta.threads,r)}};qn.Runs=Di;qn.Messages=ja;var lr=class extends k{constructor(){super(...arguments),this.realtime=new Nn(this._client),this.chatkit=new Rn(this._client),this.assistants=new Pa(this._client),this.threads=new qn(this._client)}};lr.Realtime=Nn;lr.ChatKit=Rn;lr.Assistants=Pa;lr.Threads=qn;var $i=class extends k{create(e,r){return this._client.post("/completions",{body:e,...r,stream:e.stream??!1})}};var $a=class extends k{retrieve(e,r,n){let{container_id:i}=r;return this._client.get(S`/containers/${i}/files/${e}/content`,{...n,headers:O([{Accept:"application/binary"},n?.headers]),__binaryResponse:!0})}};var Mi=class extends k{constructor(){super(...arguments),this.content=new $a(this._client)}create(e,r,n){return this._client.post(S`/containers/${e}/files`,Qt({body:r,...n},this._client))}retrieve(e,r,n){let{container_id:i}=r;return this._client.get(S`/containers/${i}/files/${e}`,n)}list(e,r={},n){return this._client.getAPIList(S`/containers/${e}/files`,X,{query:r,...n})}delete(e,r,n){let{container_id:i}=r;return this._client.delete(S`/containers/${i}/files/${e}`,{...n,headers:O([{Accept:"*/*"},n?.headers])})}};Mi.Content=$a;var Dn=class extends k{constructor(){super(...arguments),this.files=new Mi(this._client)}create(e,r){return this._client.post("/containers",{body:e,...r})}retrieve(e,r){return this._client.get(S`/containers/${e}`,r)}list(e={},r){return this._client.getAPIList("/containers",X,{query:e,...r})}delete(e,r){return this._client.delete(S`/containers/${e}`,{...r,headers:O([{Accept:"*/*"},r?.headers])})}};Dn.Files=Mi;var Ma=class extends k{create(e,r,n){let{include:i,...s}=r;return this._client.post(S`/conversations/${e}/items`,{query:{include:i},body:s,...n})}retrieve(e,r,n){let{conversation_id:i,...s}=r;return this._client.get(S`/conversations/${i}/items/${e}`,{query:s,...n})}list(e,r={},n){return this._client.getAPIList(S`/conversations/${e}/items`,Gr,{query:r,...n})}delete(e,r,n){let{conversation_id:i}=r;return this._client.delete(S`/conversations/${i}/items/${e}`,n)}};var $n=class extends k{constructor(){super(...arguments),this.items=new Ma(this._client)}create(e={},r){return this._client.post("/conversations",{body:e,...r})}retrieve(e,r){return this._client.get(S`/conversations/${e}`,r)}update(e,r,n){return this._client.post(S`/conversations/${e}`,{body:r,...n})}delete(e,r){return this._client.delete(S`/conversations/${e}`,r)}};$n.Items=Ma;var Fi=class extends k{create(e,r){let n=!!e.encoding_format,i=n?e.encoding_format:"base64";n&&$e(this._client).debug("embeddings/user defined encoding_format:",e.encoding_format);let s=this._client.post("/embeddings",{body:{...e,encoding_format:i},...r});return n?s:($e(this._client).debug("embeddings/decoding base64 embeddings from base64"),s._thenUnwrap(a=>(a&&a.data&&a.data.forEach(o=>{let u=o.embedding;o.embedding=m2(u)}),a)))}};var Fa=class extends k{retrieve(e,r,n){let{eval_id:i,run_id:s}=r;return this._client.get(S`/evals/${i}/runs/${s}/output_items/${e}`,n)}list(e,r,n){let{eval_id:i,...s}=r;return this._client.getAPIList(S`/evals/${i}/runs/${e}/output_items`,X,{query:s,...n})}};var Bi=class extends k{constructor(){super(...arguments),this.outputItems=new Fa(this._client)}create(e,r,n){return this._client.post(S`/evals/${e}/runs`,{body:r,...n})}retrieve(e,r,n){let{eval_id:i}=r;return this._client.get(S`/evals/${i}/runs/${e}`,n)}list(e,r={},n){return this._client.getAPIList(S`/evals/${e}/runs`,X,{query:r,...n})}delete(e,r,n){let{eval_id:i}=r;return this._client.delete(S`/evals/${i}/runs/${e}`,n)}cancel(e,r,n){let{eval_id:i}=r;return this._client.post(S`/evals/${i}/runs/${e}`,n)}};Bi.OutputItems=Fa;var Mn=class extends k{constructor(){super(...arguments),this.runs=new Bi(this._client)}create(e,r){return this._client.post("/evals",{body:e,...r})}retrieve(e,r){return this._client.get(S`/evals/${e}`,r)}update(e,r,n){return this._client.post(S`/evals/${e}`,{body:r,...n})}list(e={},r){return this._client.getAPIList("/evals",X,{query:e,...r})}delete(e,r){return this._client.delete(S`/evals/${e}`,r)}};Mn.Runs=Bi;var Li=class extends k{create(e,r){return this._client.post("/files",Qt({body:e,...r},this._client))}retrieve(e,r){return this._client.get(S`/files/${e}`,r)}list(e={},r){return this._client.getAPIList("/files",X,{query:e,...r})}delete(e,r){return this._client.delete(S`/files/${e}`,r)}content(e,r){return this._client.get(S`/files/${e}/content`,{...r,headers:O([{Accept:"application/binary"},r?.headers]),__binaryResponse:!0})}async waitForProcessing(e,{pollInterval:r=5e3,maxWait:n=1800*1e3}={}){let i=new Set(["processed","error","deleted"]),s=Date.now(),a=await this.retrieve(e);for(;!a.status||!i.has(a.status);)if(await Or(r),a=await this.retrieve(e),Date.now()-s>n)throw new Cn({message:`Giving up on waiting for file ${e} to finish processing after ${n} milliseconds.`});return a}};var Ba=class extends k{};var La=class extends k{run(e,r){return this._client.post("/fine_tuning/alpha/graders/run",{body:e,...r})}validate(e,r){return this._client.post("/fine_tuning/alpha/graders/validate",{body:e,...r})}};var Ui=class extends k{constructor(){super(...arguments),this.graders=new La(this._client)}};Ui.Graders=La;var Ua=class extends k{create(e,r,n){return this._client.getAPIList(S`/fine_tuning/checkpoints/${e}/permissions`,jr,{body:r,method:"post",...n})}retrieve(e,r={},n){return this._client.get(S`/fine_tuning/checkpoints/${e}/permissions`,{query:r,...n})}delete(e,r,n){let{fine_tuned_model_checkpoint:i}=r;return this._client.delete(S`/fine_tuning/checkpoints/${i}/permissions/${e}`,n)}};var zi=class extends k{constructor(){super(...arguments),this.permissions=new Ua(this._client)}};zi.Permissions=Ua;var za=class extends k{list(e,r={},n){return this._client.getAPIList(S`/fine_tuning/jobs/${e}/checkpoints`,X,{query:r,...n})}};var Qi=class extends k{constructor(){super(...arguments),this.checkpoints=new za(this._client)}create(e,r){return this._client.post("/fine_tuning/jobs",{body:e,...r})}retrieve(e,r){return this._client.get(S`/fine_tuning/jobs/${e}`,r)}list(e={},r){return this._client.getAPIList("/fine_tuning/jobs",X,{query:e,...r})}cancel(e,r){return this._client.post(S`/fine_tuning/jobs/${e}/cancel`,r)}listEvents(e,r={},n){return this._client.getAPIList(S`/fine_tuning/jobs/${e}/events`,X,{query:r,...n})}pause(e,r){return this._client.post(S`/fine_tuning/jobs/${e}/pause`,r)}resume(e,r){return this._client.post(S`/fine_tuning/jobs/${e}/resume`,r)}};Qi.Checkpoints=za;var pr=class extends k{constructor(){super(...arguments),this.methods=new Ba(this._client),this.jobs=new Qi(this._client),this.checkpoints=new zi(this._client),this.alpha=new Ui(this._client)}};pr.Methods=Ba;pr.Jobs=Qi;pr.Checkpoints=zi;pr.Alpha=Ui;var Qa=class extends k{};var Fn=class extends k{constructor(){super(...arguments),this.graderModels=new Qa(this._client)}};Fn.GraderModels=Qa;var Hi=class extends k{createVariation(e,r){return this._client.post("/images/variations",Qt({body:e,...r},this._client))}edit(e,r){return this._client.post("/images/edits",Qt({body:e,...r,stream:e.stream??!1},this._client))}generate(e,r){return this._client.post("/images/generations",{body:e,...r,stream:e.stream??!1})}};var Vi=class extends k{retrieve(e,r){return this._client.get(S`/models/${e}`,r)}list(e){return this._client.getAPIList("/models",jr,e)}delete(e,r){return this._client.delete(S`/models/${e}`,r)}};var Wi=class extends k{create(e,r){return this._client.post("/moderations",{body:e,...r})}};var Ha=class extends k{accept(e,r,n){return this._client.post(S`/realtime/calls/${e}/accept`,{body:r,...n,headers:O([{Accept:"*/*"},n?.headers])})}hangup(e,r){return this._client.post(S`/realtime/calls/${e}/hangup`,{...r,headers:O([{Accept:"*/*"},r?.headers])})}refer(e,r,n){return this._client.post(S`/realtime/calls/${e}/refer`,{body:r,...n,headers:O([{Accept:"*/*"},n?.headers])})}reject(e,r={},n){return this._client.post(S`/realtime/calls/${e}/reject`,{body:r,...n,headers:O([{Accept:"*/*"},n?.headers])})}};var Va=class extends k{create(e,r){return this._client.post("/realtime/client_secrets",{body:e,...r})}};var Yr=class extends k{constructor(){super(...arguments),this.clientSecrets=new Va(this._client),this.calls=new Ha(this._client)}};Yr.ClientSecrets=Va;Yr.Calls=Ha;function _2(t,e){return!e||!tL(e)?{...t,output_parsed:null,output:t.output.map(r=>r.type==="function_call"?{...r,parsed_arguments:null}:r.type==="message"?{...r,content:r.content.map(n=>({...n,parsed:null}))}:r)}:xy(t,e)}function xy(t,e){let r=t.output.map(i=>{if(i.type==="function_call")return{...i,parsed_arguments:iL(e,i)};if(i.type==="message"){let s=i.content.map(a=>a.type==="output_text"?{...a,parsed:eL(e,a.text)}:a);return{...i,content:s}}return i}),n=Object.assign({},t,{output:r});return Object.getOwnPropertyDescriptor(t,"output_text")||Lp(n),Object.defineProperty(n,"output_parsed",{enumerable:!0,get(){for(let i of n.output)if(i.type==="message"){for(let s of i.content)if(s.type==="output_text"&&s.parsed!==null)return s.parsed}return null}}),n}function eL(t,e){return t.text?.format?.type!=="json_schema"?null:"$parseRaw"in t.text?.format?(t.text?.format).$parseRaw(e):JSON.parse(e)}function tL(t){return!!Zc(t.text?.format)}function rL(t){return t?.$brand==="auto-parseable-tool"}function nL(t,e){return t.find(r=>r.type==="function"&&r.name===e)}function iL(t,e){let r=nL(t.tools??[],e.name);return{...e,...e,parsed_arguments:rL(r)?r.$parseRaw(e.arguments):r?.strict?JSON.parse(e.arguments):null}}function Lp(t){let e=[];for(let r of t.output)if(r.type==="message")for(let n of r.content)n.type==="output_text"&&e.push(n.text);t.output_text=e.join("")}var Wa,Up,Bn,zp,S2,E2,A2,k2,Qp=class t extends Pn{constructor(e){super(),Wa.add(this),Up.set(this,void 0),Bn.set(this,void 0),zp.set(this,void 0),U(this,Up,e,"f")}static createResponse(e,r,n){let i=new t(r);return i._run(()=>i._createOrRetrieveResponse(e,r,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),i}async _createOrRetrieveResponse(e,r,n){let i=n?.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort())),b(this,Wa,"m",S2).call(this);let s,a=null;"response_id"in r?(s=await e.responses.retrieve(r.response_id,{stream:!0},{...n,signal:this.controller.signal,stream:!0}),a=r.starting_after??null):s=await e.responses.create({...r,stream:!0},{...n,signal:this.controller.signal}),this._connected();for await(let o of s)b(this,Wa,"m",E2).call(this,o,a);if(s.controller.signal?.aborted)throw new Le;return b(this,Wa,"m",A2).call(this)}[(Up=new WeakMap,Bn=new WeakMap,zp=new WeakMap,Wa=new WeakSet,S2=function(){this.ended||U(this,Bn,void 0,"f")},E2=function(r,n){if(this.ended)return;let i=(a,o)=>{(n==null||o.sequence_number>n)&&this._emit(a,o)},s=b(this,Wa,"m",k2).call(this,r);switch(i("event",r),r.type){case"response.output_text.delta":{let a=s.output[r.output_index];if(!a)throw new D(`missing output at index ${r.output_index}`);if(a.type==="message"){let o=a.content[r.content_index];if(!o)throw new D(`missing content at index ${r.content_index}`);if(o.type!=="output_text")throw new D(`expected content to be 'output_text', got ${o.type}`);i("response.output_text.delta",{...r,snapshot:o.text})}break}case"response.function_call_arguments.delta":{let a=s.output[r.output_index];if(!a)throw new D(`missing output at index ${r.output_index}`);a.type==="function_call"&&i("response.function_call_arguments.delta",{...r,snapshot:a.arguments});break}default:i(r.type,r);break}},A2=function(){if(this.ended)throw new D("stream has ended, this shouldn't happen");let r=b(this,Bn,"f");if(!r)throw new D("request ended without sending any events");U(this,Bn,void 0,"f");let n=sL(r,b(this,Up,"f"));return U(this,zp,n,"f"),n},k2=function(r){let n=b(this,Bn,"f");if(!n){if(r.type!=="response.created")throw new D(`When snapshot hasn't been set yet, expected 'response.created' event, got ${r.type}`);return n=U(this,Bn,r.response,"f"),n}switch(r.type){case"response.output_item.added":{n.output.push(r.item);break}case"response.content_part.added":{let i=n.output[r.output_index];if(!i)throw new D(`missing output at index ${r.output_index}`);let s=i.type,a=r.part;s==="message"&&a.type!=="reasoning_text"?i.content.push(a):s==="reasoning"&&a.type==="reasoning_text"&&(i.content||(i.content=[]),i.content.push(a));break}case"response.output_text.delta":{let i=n.output[r.output_index];if(!i)throw new D(`missing output at index ${r.output_index}`);if(i.type==="message"){let s=i.content[r.content_index];if(!s)throw new D(`missing content at index ${r.content_index}`);if(s.type!=="output_text")throw new D(`expected content to be 'output_text', got ${s.type}`);s.text+=r.delta}break}case"response.function_call_arguments.delta":{let i=n.output[r.output_index];if(!i)throw new D(`missing output at index ${r.output_index}`);i.type==="function_call"&&(i.arguments+=r.delta);break}case"response.reasoning_text.delta":{let i=n.output[r.output_index];if(!i)throw new D(`missing output at index ${r.output_index}`);if(i.type==="reasoning"){let s=i.content?.[r.content_index];if(!s)throw new D(`missing content at index ${r.content_index}`);if(s.type!=="reasoning_text")throw new D(`expected content to be 'reasoning_text', got ${s.type}`);s.text+=r.delta}break}case"response.completed":{U(this,Bn,r.response,"f");break}}return n},Symbol.asyncIterator)](){let e=[],r=[],n=!1;return this.on("event",i=>{let s=r.shift();s?s.resolve(i):e.push(i)}),this.on("end",()=>{n=!0;for(let i of r)i.resolve(void 0);r.length=0}),this.on("abort",i=>{n=!0;for(let s of r)s.reject(i);r.length=0}),this.on("error",i=>{n=!0;for(let s of r)s.reject(i);r.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((s,a)=>r.push({resolve:s,reject:a})).then(s=>s?{value:s,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();let e=b(this,zp,"f");if(!e)throw new D("stream ended without producing a ChatCompletion");return e}};function sL(t,e){return _2(t,e)}var Ga=class extends k{list(e,r={},n){return this._client.getAPIList(S`/responses/${e}/input_items`,X,{query:r,...n})}};var Ka=class extends k{count(e={},r){return this._client.post("/responses/input_tokens",{body:e,...r})}};var en=class extends k{constructor(){super(...arguments),this.inputItems=new Ga(this._client),this.inputTokens=new Ka(this._client)}create(e,r){return this._client.post("/responses",{body:e,...r,stream:e.stream??!1})._thenUnwrap(n=>("object"in n&&n.object==="response"&&Lp(n),n))}retrieve(e,r={},n){return this._client.get(S`/responses/${e}`,{query:r,...n,stream:r?.stream??!1})._thenUnwrap(i=>("object"in i&&i.object==="response"&&Lp(i),i))}delete(e,r){return this._client.delete(S`/responses/${e}`,{...r,headers:O([{Accept:"*/*"},r?.headers])})}parse(e,r){return this._client.responses.create(e,r)._thenUnwrap(n=>xy(n,e))}stream(e,r){return Qp.createResponse(this._client,e,r)}cancel(e,r){return this._client.post(S`/responses/${e}/cancel`,r)}compact(e,r){return this._client.post("/responses/compact",{body:e,...r})}};en.InputItems=Ga;en.InputTokens=Ka;var Ja=class extends k{create(e,r,n){return this._client.post(S`/uploads/${e}/parts`,Qt({body:r,...n},this._client))}};var Ln=class extends k{constructor(){super(...arguments),this.parts=new Ja(this._client)}create(e,r){return this._client.post("/uploads",{body:e,...r})}cancel(e,r){return this._client.post(S`/uploads/${e}/cancel`,r)}complete(e,r,n){return this._client.post(S`/uploads/${e}/complete`,{body:r,...n})}};Ln.Parts=Ja;var C2=async t=>{let e=await Promise.allSettled(t),r=e.filter(i=>i.status==="rejected");if(r.length){for(let i of r)console.error(i.reason);throw new Error(`${r.length} promise(s) failed - see the above errors`)}let n=[];for(let i of e)i.status==="fulfilled"&&n.push(i.value);return n};var Za=class extends k{create(e,r,n){return this._client.post(S`/vector_stores/${e}/file_batches`,{body:r,...n,headers:O([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}retrieve(e,r,n){let{vector_store_id:i}=r;return this._client.get(S`/vector_stores/${i}/file_batches/${e}`,{...n,headers:O([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}cancel(e,r,n){let{vector_store_id:i}=r;return this._client.post(S`/vector_stores/${i}/file_batches/${e}/cancel`,{...n,headers:O([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}async createAndPoll(e,r,n){let i=await this.create(e,r);return await this.poll(e,i.id,n)}listFiles(e,r,n){let{vector_store_id:i,...s}=r;return this._client.getAPIList(S`/vector_stores/${i}/file_batches/${e}/files`,X,{query:s,...n,headers:O([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}async poll(e,r,n){let i=O([n?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":n?.pollIntervalMs?.toString()??void 0}]);for(;;){let{data:s,response:a}=await this.retrieve(r,{vector_store_id:e},{...n,headers:i}).withResponse();switch(s.status){case"in_progress":let o=5e3;if(n?.pollIntervalMs)o=n.pollIntervalMs;else{let u=a.headers.get("openai-poll-after-ms");if(u){let c=parseInt(u);isNaN(c)||(o=c)}}await Or(o);break;case"failed":case"cancelled":case"completed":return s}}}async uploadAndPoll(e,{files:r,fileIds:n=[]},i){if(r==null||r.length==0)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");let s=i?.maxConcurrency??5,a=Math.min(s,r.length),o=this._client,u=r.values(),c=[...n];async function l(d){for(let f of d){let h=await o.files.create({file:f,purpose:"assistants"},i);c.push(h.id)}}let p=Array(a).fill(u).map(l);return await C2(p),await this.createAndPoll(e,{file_ids:c})}};var Xa=class extends k{create(e,r,n){return this._client.post(S`/vector_stores/${e}/files`,{body:r,...n,headers:O([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}retrieve(e,r,n){let{vector_store_id:i}=r;return this._client.get(S`/vector_stores/${i}/files/${e}`,{...n,headers:O([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}update(e,r,n){let{vector_store_id:i,...s}=r;return this._client.post(S`/vector_stores/${i}/files/${e}`,{body:s,...n,headers:O([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(e,r={},n){return this._client.getAPIList(S`/vector_stores/${e}/files`,X,{query:r,...n,headers:O([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}delete(e,r,n){let{vector_store_id:i}=r;return this._client.delete(S`/vector_stores/${i}/files/${e}`,{...n,headers:O([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}async createAndPoll(e,r,n){let i=await this.create(e,r,n);return await this.poll(e,i.id,n)}async poll(e,r,n){let i=O([n?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":n?.pollIntervalMs?.toString()??void 0}]);for(;;){let s=await this.retrieve(r,{vector_store_id:e},{...n,headers:i}).withResponse(),a=s.data;switch(a.status){case"in_progress":let o=5e3;if(n?.pollIntervalMs)o=n.pollIntervalMs;else{let u=s.response.headers.get("openai-poll-after-ms");if(u){let c=parseInt(u);isNaN(c)||(o=c)}}await Or(o);break;case"failed":case"completed":return a}}}async upload(e,r,n){let i=await this._client.files.create({file:r,purpose:"assistants"},n);return this.create(e,{file_id:i.id},n)}async uploadAndPoll(e,r,n){let i=await this.upload(e,r,n);return await this.poll(e,i.id,n)}content(e,r,n){let{vector_store_id:i}=r;return this._client.getAPIList(S`/vector_stores/${i}/files/${e}/content`,jr,{...n,headers:O([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}};var tn=class extends k{constructor(){super(...arguments),this.files=new Xa(this._client),this.fileBatches=new Za(this._client)}create(e,r){return this._client.post("/vector_stores",{body:e,...r,headers:O([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}retrieve(e,r){return this._client.get(S`/vector_stores/${e}`,{...r,headers:O([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}update(e,r,n){return this._client.post(S`/vector_stores/${e}`,{body:r,...n,headers:O([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(e={},r){return this._client.getAPIList("/vector_stores",X,{query:e,...r,headers:O([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}delete(e,r){return this._client.delete(S`/vector_stores/${e}`,{...r,headers:O([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}search(e,r,n){return this._client.getAPIList(S`/vector_stores/${e}/search`,jr,{body:r,method:"post",...n,headers:O([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}};tn.Files=Xa;tn.FileBatches=Za;var Gi=class extends k{create(e,r){return this._client.post("/videos",ty({body:e,...r},this._client))}retrieve(e,r){return this._client.get(S`/videos/${e}`,r)}list(e={},r){return this._client.getAPIList("/videos",Gr,{query:e,...r})}delete(e,r){return this._client.delete(S`/videos/${e}`,r)}downloadContent(e,r={},n){return this._client.get(S`/videos/${e}/content`,{query:r,...n,headers:O([{Accept:"application/binary"},n?.headers]),__binaryResponse:!0})}remix(e,r,n){return this._client.post(S`/videos/${e}/remix`,ty({body:r,...n},this._client))}};var Ya,T2,Hp,Ki=class extends k{constructor(){super(...arguments),Ya.add(this)}async unwrap(e,r,n=this._client.webhookSecret,i=300){return await this.verifySignature(e,r,n,i),JSON.parse(e)}async verifySignature(e,r,n=this._client.webhookSecret,i=300){if(typeof crypto>"u"||typeof crypto.subtle.importKey!="function"||typeof crypto.subtle.verify!="function")throw new Error("Webhook signature verification is only supported when the `crypto` global is defined");b(this,Ya,"m",T2).call(this,n);let s=O([r]).values,a=b(this,Ya,"m",Hp).call(this,s,"webhook-signature"),o=b(this,Ya,"m",Hp).call(this,s,"webhook-timestamp"),u=b(this,Ya,"m",Hp).call(this,s,"webhook-id"),c=parseInt(o,10);if(isNaN(c))throw new Ir("Invalid webhook timestamp format");let l=Math.floor(Date.now()/1e3);if(l-c>i)throw new Ir("Webhook timestamp is too old");if(c>l+i)throw new Ir("Webhook timestamp is too new");let p=a.split(" ").map(m=>m.startsWith("v1,")?m.substring(3):m),d=n.startsWith("whsec_")?Buffer.from(n.replace("whsec_",""),"base64"):Buffer.from(n,"utf-8"),f=u?`${u}.${o}.${e}`:`${o}.${e}`,h=await crypto.subtle.importKey("raw",d,{name:"HMAC",hash:"SHA-256"},!1,["verify"]);for(let m of p)try{let x=Buffer.from(m,"base64");if(await crypto.subtle.verify("HMAC",h,x,new TextEncoder().encode(f)))return}catch{continue}throw new Ir("The given webhook signature does not match the expected signature")}};Ya=new WeakSet,T2=function(e){if(typeof e!="string"||e.length===0)throw new Error("The webhook secret must either be set using the env var, OPENAI_WEBHOOK_SECRET, on the client class, OpenAI({ webhookSecret: '123' }), or passed to this function")},Hp=function(e,r){if(!e)throw new Error("Headers are required");let n=e.get(r);if(n==null)throw new Error(`Missing required header: ${r}`);return n};var by,wy,Vp,P2,W=class{constructor({baseURL:e=jn("OPENAI_BASE_URL"),apiKey:r=jn("OPENAI_API_KEY"),organization:n=jn("OPENAI_ORG_ID")??null,project:i=jn("OPENAI_PROJECT_ID")??null,webhookSecret:s=jn("OPENAI_WEBHOOK_SECRET")??null,...a}={}){if(by.add(this),Vp.set(this,void 0),this.completions=new $i(this),this.chat=new On(this),this.embeddings=new Fi(this),this.files=new Li(this),this.images=new Hi(this),this.audio=new qr(this),this.moderations=new Wi(this),this.models=new Vi(this),this.fineTuning=new pr(this),this.graders=new Fn(this),this.vectorStores=new tn(this),this.webhooks=new Ki(this),this.beta=new lr(this),this.batches=new Ni(this),this.uploads=new Ln(this),this.responses=new en(this),this.realtime=new Yr(this),this.conversations=new $n(this),this.evals=new Mn(this),this.containers=new Dn(this),this.videos=new Gi(this),r===void 0)throw new D("Missing credentials. Please pass an `apiKey`, or set the `OPENAI_API_KEY` environment variable.");let o={apiKey:r,organization:n,project:i,webhookSecret:s,...a,baseURL:e||"https://api.openai.com/v1"};if(!o.dangerouslyAllowBrowser&&D4())throw new D(`It looks like you're running in a browser-like environment.
    90
    91  This is disabled by default, as it risks exposing your secret API credentials to attackers.
    92  If you understand the risks and have appropriate mitigations in place,
    93  you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,
    94
    95  new OpenAI({ apiKey, dangerouslyAllowBrowser: true });
node:events:502
      throw er; // Unhandled 'error' event
      ^

Error: listen EADDRINUSE: address already in use 0.0.0.0:5000
    at Server.setupListenHandle [as _listen2] (node:net:1908:16)
    at listenInCluster (node:net:1965:12)
    at doListen (node:net:2139:7)
    at process.processTicksAndRejections (node:internal/process/task_queues:83:21)
Emitted 'error' event on Server instance at:
    at emitErrorNT (node:net:1944:8)
    at process.processTicksAndRejections (node:internal/process/task_queues:82:21) {
  code: 'EADDRINUSE',
  errno: -98,
  syscall: 'listen',
  address: '0.0.0.0',
  port: 5000
}

Node.js v20.19.3
~/workspace$ 